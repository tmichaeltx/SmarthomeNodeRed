[{"id":"a280aade.b19d78","type":"tab","label":"P Zigbee2MQTT Admin Panel","disabled":false,"info":""},{"id":"2b2a4010.a6b5e","type":"tab","label":"P Triggerable Flows","disabled":false,"info":""},{"id":"aad5f0e1.84355","type":"tab","label":"P IOT Parsing","disabled":false,"info":""},{"id":"54cae49c.6ee04c","type":"tab","label":"P Recurring Flow Triggers","disabled":false,"info":""},{"id":"b2da258c.19e8d8","type":"tab","label":"W Digi 2 fix","disabled":false,"info":""},{"id":"98a6e865.a02ea8","type":"tab","label":"Automation Flows","disabled":false,"info":""},{"id":"1a0aa13a.9d7b8f","type":"tab","label":"Fake Radar","disabled":false,"info":""},{"id":"1f1da42b.7b60bc","type":"tab","label":"W Dashboard Experimentation","disabled":false,"info":""},{"id":"87dacf16.bc47f","type":"tab","label":"R Duration Node","disabled":false,"info":""},{"id":"79e87940.d7f498","type":"tab","label":"W Timing Comparison","disabled":true,"info":""},{"id":"6f78a5a4.5b3adc","type":"tab","label":"W Sun Related Node Samples","disabled":false,"info":""},{"id":"e44a28b6.338da8","type":"tab","label":"W Z2MQTT commands","disabled":false,"info":""},{"id":"481337e1.e82348","type":"tab","label":"MQTT Out Control Template","disabled":false,"info":""},{"id":"b1faba.70712548","type":"tab","label":"W Store Important State","disabled":false,"info":""},{"id":"711cdb94.5b9a04","type":"subflow","name":"Decide Quality of Ping","info":"","category":"Abandoned Subflows","in":[{"x":40,"y":100,"wires":[{"id":"5117f3ab.9484cc"}]}],"out":[],"env":[],"color":"#FDF0C2"},{"id":"76e3605b.0e6e7","type":"subflow","name":"Process Ping Results To Local Files","info":"","category":"Mike Subflows","in":[{"x":20,"y":140,"wires":[{"id":"7c6b7df4.a02714"}]}],"out":[],"env":[],"color":"#0cad0c"},{"id":"aba876af.3a45e8","type":"subflow","name":"Ping, Write Down to Google and send Result to Process Ping Results","info":"","category":"Mike Subflows","in":[{"x":20,"y":100,"wires":[{"id":"81b5485a.3abc58"}]}],"out":[],"env":[],"color":"#C7E9C0","status":{"x":1220,"y":520,"wires":[{"id":"ffcbe690.d32758","port":0}]}},{"id":"c3686304.f6d31","type":"subflow","name":"Backup all 4 Hubitats using Bash Script","info":"","category":"Mike Subflows","in":[{"x":60,"y":80,"wires":[{"id":"dae3700e.3752"}]}],"out":[],"env":[],"color":"#0cad0c"},{"id":"a73af62e.c418b8","type":"subflow","name":"Monitor All Hubitat Devices","info":"","category":"Mike Subflows","in":[{"x":40,"y":40,"wires":[{"id":"7ec6233c.30bd0c"}]}],"out":[],"env":[],"color":"#FDF0C2","status":{"x":2400,"y":360,"wires":[{"id":"377f4ebf.3750b2","port":0}]}},{"id":"f9a34738.f12c28","type":"subflow","name":"Old Monitor All Homebridge Native Devices","info":"","category":"Mike Subflows","in":[{"x":60,"y":40,"wires":[{"id":"4f285b5d.c38f54"}]}],"out":[],"env":[],"color":"#FDF0C2","status":{"x":3590,"y":440,"wires":[{"id":"e648e029.afc3a","port":0}]}},{"id":"f14b69ba.8b2da8","type":"subflow","name":"Monitor Zigbee2MQTT Devices","info":"","category":"Mike Subflows","in":[{"x":40,"y":40,"wires":[{"id":"1263d8e6.0b9287"},{"id":"d17934c7.820378"}]}],"out":[],"env":[],"color":"#FDF0C2","status":{"x":1500,"y":760,"wires":[{"id":"e90820c6.94152","port":0}]}},{"id":"32252d88.e55b52","type":"subflow","name":"Read Spreadsheet For Details","info":"# **Preconditions**\nMake sure that the credentials for the read input from GSheet node are for an account that has access to the spreadsheets that will be passed to the subflow.\n## **Inputs**\nThe subflow takes as inputs in 3 ways.\n### **Default Environment Variables**\nThese are used if neither of the other options turn on their override variable. It is important to realize however the configuration is only for the authors own spreadsheet so it is unlikely that you will have access to this spreadsheet and so must at a minimum update the spreadsheet id to your own spreadsheet. Changing these values from within the subnode impacts all uses of the subnode when not overridden. In general it is better to use options 2 (Passed Environment Variables) or 3 (Passed Msg properties) to prevent unexpected behavior in flows not being edited.\n - Spreadsheet ID for the spreadsheet\n - TabName for the tab within that spreadsheet\n - ColStart for the letter(s) of the leftmost column\n - ColEnd for the letter(s) of rightmost column\n - MinRow for the number of the first row\n - MaxRow for the number of the last row\n - OverrideEnvVariables by default set to false as it wouldn't make sense for the default to say override the defaults.\n### **Passed Environment Variables**\nThese are used when the subflow's environment variable are specified in the calling flow at build time.\n - Spreadsheet ID for the spreadsheet\n - TabName for the tab within that spreadsheet\n - ColStart for the letter(s) of the leftmost column\n - ColEnd for the letter(s) of rightmost column\n - MinRow for the number of the first row\n - MaxRow for the number of the last row\n - OverrideEnvVariables is a key variable as it tells the subflow to ignore the subflow's global defaults and instead use those specified here.\n### **Setting Passed as Msg Properties**\nThese are used when the subflow's configuration should be driven by data populated at runtime. The inputs to do this are:\n - msg.IgnoreEnvVar is the boolean that says override the environment variables and use these properties\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n## **Outputs**\n### **Output1: Error**\nPasses any caught error to the error subflows intentially built error output. By intentionally built I mean I created one and labelled it as such. This is not there by default.\n### **Output 2: Last Populated Row**\nPasses the number of the last row within the requested range that had at least 1 cell populated.\n### **Output 3: First Empty Row**\nPasses the number for the row following the last populated row. Note, while it is in theory the first empty row, if the last populated row was the last row of the input range, this subflow does not guarantee the row returned really is empty as it has not been examined.\n### **Output 4: Last Populated Column**\nPasses the letter(s) of the last column within the requested range that had at least 1 cell populated.\n### **Output 5: First Empty Column**\nPasses the letter(s) for the column following the last populated column. Note, while it is in theory the first empty column, if the last populated column was the last column of the input range, this subflow does not guarantee the column returned really is empty as it has not been examined.\n### **Output 6: Full Data**\nPasses the array that contains the data retrieved from the Google Sheet.\n### **Output 7: Full Data with Inputs**\nReturns same information as Option 6, but does so without removing the msg properties that drove the retrieval process.","category":"Mike Subflows","in":[{"x":40,"y":20,"wires":[{"id":"b36306d5.1140f8"}]}],"out":[{"x":1060,"y":60,"wires":[{"id":"6b34896c.b7c258","port":0}]},{"x":1060,"y":140,"wires":[{"id":"19295ae9.4a7b45","port":0}]},{"x":1060,"y":220,"wires":[{"id":"2427fd2f.a3a022","port":0}]},{"x":1060,"y":300,"wires":[{"id":"77f0a296.84470c","port":0}]},{"x":1060,"y":380,"wires":[{"id":"17bd8e89.be33f1","port":0}]},{"x":1060,"y":460,"wires":[{"id":"d2a14166.06197","port":0}]},{"x":1060,"y":540,"wires":[{"id":"aa6d1a78.1abaa8","port":0}]},{"x":1060,"y":620,"wires":[{"id":"5d994f24.7baba","port":0}]}],"env":[{"name":"Spreadsheet ID","type":"str","value":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","ui":{"icon":"font-awesome/fa-file-excel-o","type":"input","opts":{"types":["str"]}}},{"name":"TabName","type":"str","value":"Devices","ui":{"icon":"font-awesome/fa-table","label":{"en-US":"Tab"},"type":"input","opts":{"types":["str"]}}},{"name":"ColStart","type":"str","value":"A","ui":{"icon":"font-awesome/fa-columns","type":"input","opts":{"types":["str"]}}},{"name":"ColEnd","type":"str","value":"Z","ui":{"icon":"font-awesome/fa-columns","type":"input","opts":{"types":["str"]}}},{"name":"MinRow","type":"num","value":"1","ui":{"icon":"font-awesome/fa-window-minimize","type":"input","opts":{"types":["num"]}}},{"name":"MaxRow","type":"num","value":"1000","ui":{"icon":"font-awesome/fa-window-maximize","type":"input","opts":{"types":["num"]}}},{"name":"OverrideEnvVariables","type":"bool","value":"false"}],"color":"#0cad0c","outputLabels":["Error","Last Populated Row","First Empty Row","Last Populated Column","First Empty Column","Spreadsheet Array","Full Data","Full Data with Inputs"],"icon":"font-awesome/fa-file-excel-o"},{"id":"809a2e43.861b6","type":"subflow","name":"Read Spreadsheet For Details (2)","info":"# **Preconditions**\nMake sure that the credentials for the read input from GSheet node are for an account that has access to the spreadsheets that will be passed to the subflow.\n## **Inputs**\nThe subflow takes as inputs in 3 ways.\n### **Default Environment Variables**\nThese are used if neither of the other options turn on their override variable. It is important to realize however the configuration is only for the authors own spreadsheet so it is unlikely that you will have access to this spreadsheet and so must at a minimum update the spreadsheet id to your own spreadsheet. Changing these values from within the subnode impacts all uses of the subnode when not overridden. In general it is better to use options 2 (Passed Environment Variables) or 3 (Passed Msg properties) to prevent unexpected behavior in flows not being edited.\n - Spreadsheet ID for the spreadsheet\n - TabName for the tab within that spreadsheet\n - ColStart for the letter(s) of the leftmost column\n - ColEnd for the letter(s) of rightmost column\n - MinRow for the number of the first row\n - MaxRow for the number of the last row\n - OverrideEnvVariables by default set to false as it wouldn't make sense for the default to say override the defaults.\n### **Passed Environment Variables**\nThese are used when the subflow's environment variable are specified in the calling flow at build time.\n - Spreadsheet ID for the spreadsheet\n - TabName for the tab within that spreadsheet\n - ColStart for the letter(s) of the leftmost column\n - ColEnd for the letter(s) of rightmost column\n - MinRow for the number of the first row\n - MaxRow for the number of the last row\n - OverrideEnvVariables is a key variable as it tells the subflow to ignore the subflow's global defaults and instead use those specified here.\n### **Setting Passed as Msg Properties**\nThese are used when the subflow's configuration should be driven by data populated at runtime. The inputs to do this are:\n - msg.IgnoreEnvVar is the boolean that says override the environment variables and use these properties\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n## **Outputs**\n### **Output1: Error**\nPasses any caught error to the error subflows intentially built error output. By intentionally built I mean I created one and labelled it as such. This is not there by default.\n### **Output 2: Last Populated Row**\nPasses the number of the last row within the requested range that had at least 1 cell populated.\n### **Output 3: First Empty Row**\nPasses the number for the row following the last populated row. Note, while it is in theory the first empty row, if the last populated row was the last row of the input range, this subflow does not guarantee the row returned really is empty as it has not been examined.\n### **Output 4: Last Populated Column**\nPasses the letter(s) of the last column within the requested range that had at least 1 cell populated.\n### **Output 5: First Empty Column**\nPasses the letter(s) for the column following the last populated column. Note, while it is in theory the first empty column, if the last populated column was the last column of the input range, this subflow does not guarantee the column returned really is empty as it has not been examined.\n### **Output 6: Full Data**\nPasses the array that contains the data retrieved from the Google Sheet.\n### **Output 7: Full Data with Inputs**\nReturns same information as Option 6, but does so without removing the msg properties that drove the retrieval process.","category":"Mike Subflows","in":[{"x":40,"y":20,"wires":[{"id":"9d08adeb.8b976"}]}],"out":[{"x":1060,"y":60,"wires":[{"id":"3ccf56cb.4c037a","port":0}]},{"x":1060,"y":140,"wires":[{"id":"d8658c5a.0a5ce","port":0}]},{"x":1060,"y":220,"wires":[{"id":"8b790e84.fc65e","port":0}]},{"x":1060,"y":300,"wires":[{"id":"1efad89c.adecf7","port":0}]},{"x":1060,"y":380,"wires":[{"id":"1fc02d15.67a363","port":0}]},{"x":1060,"y":460,"wires":[{"id":"f17df7e0.9c87e8","port":0}]},{"x":1060,"y":540,"wires":[{"id":"115f090d.01a1c7","port":0}]},{"x":1060,"y":620,"wires":[{"id":"71231cd6.a786c4","port":0}]}],"env":[{"name":"Spreadsheet ID","type":"str","value":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","ui":{"icon":"font-awesome/fa-file-excel-o","type":"input","opts":{"types":["str"]},"label":{}}},{"name":"TabName","type":"str","value":"Devices","ui":{"icon":"font-awesome/fa-table","label":{"en-US":"Tab"},"type":"input","opts":{"types":["str"]}}},{"name":"ColStart","type":"str","value":"A","ui":{"icon":"font-awesome/fa-columns","type":"input","opts":{"types":["str"]},"label":{}}},{"name":"ColEnd","type":"str","value":"Z","ui":{"icon":"font-awesome/fa-columns","type":"input","opts":{"types":["str"]},"label":{}}},{"name":"MinRow","type":"num","value":"1","ui":{"icon":"font-awesome/fa-window-minimize","type":"input","opts":{"types":["num"]},"label":{}}},{"name":"MaxRow","type":"num","value":"1000","ui":{"icon":"font-awesome/fa-window-maximize","type":"input","opts":{"types":["num"]},"label":{}}},{"name":"OverrideEnvVariables","type":"bool","value":"false"}],"color":"#0cad0c","outputLabels":["Error","Last Populated Row","First Empty Row","Last Populated Column","First Empty Column","Spreadsheet Array","Full Data","Full Data with Inputs"],"icon":"font-awesome/fa-file-excel-o"},{"id":"d078e2a6.ea488","type":"subflow","name":"Lookup Desired Data","info":"# Preconditions\nThis subflow is designed to use a 2-D array of data loaded from a google sheeet to lookup desired data. The data is arrayed with the first row being column headers describing the data in those columns in subsequent rows. There are multiple levels of caching within this subflow.\n\nFirst it looks to see if the exact same combination of search key value pairs and desired lookup keys have been found in the last 5 seconds. If so it just copies the search results.\n\nThe second level of caching is that the lookup is attempted against a locally cached set of the data. The data is cached in a memory global variable, so if Node-Red is restarted this cache will be empty. Additionally, any flow can delete the global variable. This level is valuable because memory lookup is much faster than a call to Google Sheets which may not even be available in case of internet outage.\n\nFinally, if the data is not locally, then this subflow will use the provided inputs to pull the data from its ultimate storage site (a Google Sheets spreadsheet).\n\nThis subflow assumes that the format will come in with the sorts of inputs show in the examples of preformatted inputs.\n\nThis flow requires the read spreadsheet for details subflow node exists and ....\n\n\n## **inputs**\n### globalsource \nThe name of the global variable holding the table of data\n### msg.keyvalues\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row.\n### msg.searchfor\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. The value enters the node empty.\n\n### **Setting Passed as Msg Properties**\nThese are used when the subflow's configuration should be driven by data populated at runtime. The inputs to do this are:\n - msg.IgnoreEnvVar is the boolean that says override the environment variables and use these properties\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\n\n\n\n\n## **outputs**\n### Output1: Value Found \nThis ouput is used when the subflow has successfully identified the requested data. That data is placed into the value portions of the key value pairs that made up the msg.searchfor input\n### Output 2: Error but try reloading from data source\nFor the subflow, this is intended to be informational. This says the subflow will be trying to load the table from Google sheets under the expectation that either this is the first time a lookup has been tried an the data had not yet been cached in the global variable or potentially the data in the cache has become stale and reloading from the Google sheet will add a row that will match the requested search criteria.\n### Output 3: Error despite having tried to reload from data source\nFor the subflow, this output is used when either the global variable to contain the data table either does no exist or does not contain a row with all of the requested search criteria and at least 1 attempt has already been made to reload the global vairable cache. This is effectively a notification of non-recoverable lookup failure.","category":"Mike Subflows","in":[{"x":50,"y":80,"wires":[{"id":"4ca5af11.b84a7"}]}],"out":[{"x":480,"y":67,"wires":[{"id":"4ca5af11.b84a7","port":0}]},{"x":540,"y":79,"wires":[{"id":"4ca5af11.b84a7","port":1}]},{"x":600,"y":91,"wires":[{"id":"4ca5af11.b84a7","port":2}]}],"env":[],"color":"#0cad0c","inputLabels":["Info for Lookup"],"outputLabels":["Value Found","Error but try reloading from data source","Error despite having tried to reload from data source"]},{"id":"88b1bb66.b78488","type":"subflow","name":"Read Spreadsheet For Details (3)","info":"# **Preconditions**\nMake sure that the credentials for the read input from GSheet node are for an account that has access to the spreadsheets that will be passed to the subflow.\n## **Inputs**\nThe subflow takes as inputs in 3 ways.\n### **Default Environment Variables**\nThese are used if neither of the other options turn on their override variable. It is important to realize however the configuration is only for the authors own spreadsheet so it is unlikely that you will have access to this spreadsheet and so must at a minimum update the spreadsheet id to your own spreadsheet. Changing these values from within the subnode impacts all uses of the subnode when not overridden. In general it is better to use options 2 (Passed Environment Variables) or 3 (Passed Msg properties) to prevent unexpected behavior in flows not being edited.\n - Spreadsheet ID for the spreadsheet\n - TabName for the tab within that spreadsheet\n - ColStart for the letter(s) of the leftmost column\n - ColEnd for the letter(s) of rightmost column\n - MinRow for the number of the first row\n - MaxRow for the number of the last row\n - OverrideEnvVariables by default set to false as it wouldn't make sense for the default to say override the defaults.\n### **Passed Environment Variables**\nThese are used when the subflow's environment variable are specified in the calling flow at build time.\n - Spreadsheet ID for the spreadsheet\n - TabName for the tab within that spreadsheet\n - ColStart for the letter(s) of the leftmost column\n - ColEnd for the letter(s) of rightmost column\n - MinRow for the number of the first row\n - MaxRow for the number of the last row\n - OverrideEnvVariables is a key variable as it tells the subflow to ignore the subflow's global defaults and instead use those specified here.\n### **Setting Passed as Msg Properties**\nThese are used when the subflow's configuration should be driven by data populated at runtime. The inputs to do this are:\n - msg.IgnoreEnvVar is the boolean that says override the environment variables and use these properties\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n## **Outputs**\n### **Output1: Error**\nPasses any caught error to the error subflows intentially built error output. By intentionally built I mean I created one and labelled it as such. This is not there by default.\n### **Output 2: Last Populated Row**\nPasses the number of the last row within the requested range that had at least 1 cell populated.\n### **Output 3: First Empty Row**\nPasses the number for the row following the last populated row. Note, while it is in theory the first empty row, if the last populated row was the last row of the input range, this subflow does not guarantee the row returned really is empty as it has not been examined.\n### **Output 4: Last Populated Column**\nPasses the letter(s) of the last column within the requested range that had at least 1 cell populated.\n### **Output 5: First Empty Column**\nPasses the letter(s) for the column following the last populated column. Note, while it is in theory the first empty column, if the last populated column was the last column of the input range, this subflow does not guarantee the column returned really is empty as it has not been examined.\n### **Output 6: Full Data**\nPasses the array that contains the data retrieved from the Google Sheet.\n### **Output 7: Full Data with Inputs**\nReturns same information as Option 6, but does so without removing the msg properties that drove the retrieval process.","category":"Mike Subflows","in":[{"x":40,"y":20,"wires":[{"id":"2d499f0.10a2b62"}]}],"out":[{"x":1060,"y":60,"wires":[{"id":"56c3aeb2.ff1f4","port":0}]},{"x":1060,"y":140,"wires":[{"id":"c7139127.7efa8","port":0}]},{"x":1060,"y":220,"wires":[{"id":"e336bdeb.a1ed4","port":0}]},{"x":1060,"y":300,"wires":[{"id":"ddb445f3.4541d8","port":0}]},{"x":1060,"y":380,"wires":[{"id":"89a29d6e.b7516","port":0}]},{"x":1060,"y":460,"wires":[{"id":"dc118d10.32edb","port":0}]},{"x":1060,"y":540,"wires":[{"id":"d1e7b582.91d168","port":0}]},{"x":1060,"y":620,"wires":[{"id":"c2f995a2.54ffd8","port":0}]}],"env":[{"name":"Spreadsheet ID","type":"str","value":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","ui":{"icon":"font-awesome/fa-file-excel-o","type":"input","opts":{"types":["str"]},"label":{}}},{"name":"TabName","type":"str","value":"Devices","ui":{"icon":"font-awesome/fa-table","label":{"en-US":"Tab"},"type":"input","opts":{"types":["str"]}}},{"name":"ColStart","type":"str","value":"A","ui":{"icon":"font-awesome/fa-columns","type":"input","opts":{"types":["str"]},"label":{}}},{"name":"ColEnd","type":"str","value":"Z","ui":{"icon":"font-awesome/fa-columns","type":"input","opts":{"types":["str"]},"label":{}}},{"name":"MinRow","type":"num","value":"1","ui":{"icon":"font-awesome/fa-window-minimize","type":"input","opts":{"types":["num"]},"label":{}}},{"name":"MaxRow","type":"num","value":"1000","ui":{"icon":"font-awesome/fa-window-maximize","type":"input","opts":{"types":["num"]},"label":{}}},{"name":"OverrideEnvVariables","type":"bool","value":"false"}],"color":"#0cad0c","outputLabels":["Error","Last Populated Row","First Empty Row","Last Populated Column","First Empty Column","Spreadsheet Array","Full Data","Full Data with Inputs"],"icon":"font-awesome/fa-file-excel-o"},{"id":"2a6ce360.19688c","type":"subflow","name":"Lookup Desired Data (2)","info":"# Preconditions\nThis subflow is designed to use a 2-D array of data loaded from a google sheeet to lookup desired data. The data is arrayed with the first row being column headers describing the data in those columns in subsequent rows. There are multiple levels of caching within this subflow.\n\nFirst it looks to see if the exact same combination of search key value pairs and desired lookup keys have been found in the last 5 seconds. If so it just copies the search results.\n\nThe second level of caching is that the lookup is attempted against a locally cached set of the data. The data is cached in a memory global variable, so if Node-Red is restarted this cache will be empty. Additionally, any flow can delete the global variable. This level is valuable because memory lookup is much faster than a call to Google Sheets which may not even be available in case of internet outage.\n\nFinally, if the data is not locally, then this subflow will use the provided inputs to pull the data from its ultimate storage site (a Google Sheets spreadsheet).\n\nThis subflow assumes that the format will come in with the sorts of inputs show in the examples of preformatted inputs.\n\nThis flow requires the read spreadsheet for details subflow node exists and ....\n\n\n## **inputs**\n### globalsource \nThe name of the global variable holding the table of data\n### msg.keyvalues\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row.\n### msg.searchfor\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. The value enters the node empty.\n\n### **Setting Passed as Msg Properties**\nThese are used when the subflow's configuration should be driven by data populated at runtime. The inputs to do this are:\n - msg.IgnoreEnvVar is the boolean that says override the environment variables and use these properties\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\n\n\n\n\n## **outputs**\n### Output1: Value Found \nThis ouput is used when the subflow has successfully identified the requested data. That data is placed into the value portions of the key value pairs that made up the msg.searchfor input\n### Output 2: Error but try reloading from data source\nFor the subflow, this is intended to be informational. This says the subflow will be trying to load the table from Google sheets under the expectation that either this is the first time a lookup has been tried an the data had not yet been cached in the global variable or potentially the data in the cache has become stale and reloading from the Google sheet will add a row that will match the requested search criteria.\n### Output 3: Error despite having tried to reload from data source\nFor the subflow, this output is used when either the global variable to contain the data table either does no exist or does not contain a row with all of the requested search criteria and at least 1 attempt has already been made to reload the global vairable cache. This is effectively a notification of non-recoverable lookup failure.","category":"Mike Subflows","in":[{"x":50,"y":80,"wires":[{"id":"e81b20c8.9dbf5"}]}],"out":[{"x":480,"y":67,"wires":[{"id":"e81b20c8.9dbf5","port":0}]},{"x":540,"y":79,"wires":[{"id":"e81b20c8.9dbf5","port":1}]},{"x":600,"y":91,"wires":[{"id":"e81b20c8.9dbf5","port":2}]}],"env":[],"color":"#FDF0C2","inputLabels":["Info for Lookup"],"outputLabels":["Value Found","Error but try reloading from data source","Error despite having tried to reload from data source"]},{"id":"c5ccb11d.87221","type":"subflow","name":"Read Spreadsheet For Details (4)","info":"# **Preconditions**\nMake sure that the credentials for the read input from GSheet node are for an account that has access to the spreadsheets that will be passed to the subflow.\n## **Inputs**\nThe subflow takes as inputs in 3 ways.\n### **Default Environment Variables**\nThese are used if neither of the other options turn on their override variable. It is important to realize however the configuration is only for the authors own spreadsheet so it is unlikely that you will have access to this spreadsheet and so must at a minimum update the spreadsheet id to your own spreadsheet. Changing these values from within the subnode impacts all uses of the subnode when not overridden. In general it is better to use options 2 (Passed Environment Variables) or 3 (Passed Msg properties) to prevent unexpected behavior in flows not being edited.\n - Spreadsheet ID for the spreadsheet\n - TabName for the tab within that spreadsheet\n - ColStart for the letter(s) of the leftmost column\n - ColEnd for the letter(s) of rightmost column\n - MinRow for the number of the first row\n - MaxRow for the number of the last row\n - OverrideEnvVariables by default set to false as it wouldn't make sense for the default to say override the defaults.\n### **Passed Environment Variables**\nThese are used when the subflow's environment variable are specified in the calling flow at build time.\n - Spreadsheet ID for the spreadsheet\n - TabName for the tab within that spreadsheet\n - ColStart for the letter(s) of the leftmost column\n - ColEnd for the letter(s) of rightmost column\n - MinRow for the number of the first row\n - MaxRow for the number of the last row\n - OverrideEnvVariables is a key variable as it tells the subflow to ignore the subflow's global defaults and instead use those specified here.\n### **Setting Passed as Msg Properties**\nThese are used when the subflow's configuration should be driven by data populated at runtime. The inputs to do this are:\n - msg.IgnoreEnvVar is the boolean that says override the environment variables and use these properties\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n## **Outputs**\n### **Output1: Error**\nPasses any caught error to the error subflows intentially built error output. By intentionally built I mean I created one and labelled it as such. This is not there by default.\n### **Output 2: Last Populated Row**\nPasses the number of the last row within the requested range that had at least 1 cell populated.\n### **Output 3: First Empty Row**\nPasses the number for the row following the last populated row. Note, while it is in theory the first empty row, if the last populated row was the last row of the input range, this subflow does not guarantee the row returned really is empty as it has not been examined.\n### **Output 4: Last Populated Column**\nPasses the letter(s) of the last column within the requested range that had at least 1 cell populated.\n### **Output 5: First Empty Column**\nPasses the letter(s) for the column following the last populated column. Note, while it is in theory the first empty column, if the last populated column was the last column of the input range, this subflow does not guarantee the column returned really is empty as it has not been examined.\n### **Output 6: Full Data**\nPasses the array that contains the data retrieved from the Google Sheet.\n### **Output 7: Full Data with Inputs**\nReturns same information as Option 6, but does so without removing the msg properties that drove the retrieval process.","category":"Mike Subflows","in":[{"x":40,"y":20,"wires":[{"id":"74eef5f0.8ccdbc"}]}],"out":[{"x":1060,"y":60,"wires":[{"id":"64cd2a10.a267c4","port":0}]},{"x":1060,"y":140,"wires":[{"id":"99ff283b.587b38","port":0}]},{"x":1060,"y":220,"wires":[{"id":"5d7a9aee.af6c34","port":0}]},{"x":1060,"y":300,"wires":[{"id":"2fa1add7.1958f2","port":0}]},{"x":1060,"y":380,"wires":[{"id":"5b88e253.4c4f2c","port":0}]},{"x":1060,"y":460,"wires":[{"id":"e965d93a.aff398","port":0}]},{"x":1060,"y":540,"wires":[{"id":"b383d4a7.b31098","port":0}]},{"x":1060,"y":620,"wires":[{"id":"4a364e2.bc44db","port":0}]}],"env":[{"name":"Spreadsheet ID","type":"str","value":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","ui":{"icon":"font-awesome/fa-file-excel-o","type":"input","opts":{"types":["str"]},"label":{}}},{"name":"TabName","type":"str","value":"Devices","ui":{"icon":"font-awesome/fa-table","label":{"en-US":"Tab"},"type":"input","opts":{"types":["str"]}}},{"name":"ColStart","type":"str","value":"A","ui":{"icon":"font-awesome/fa-columns","type":"input","opts":{"types":["str"]},"label":{}}},{"name":"ColEnd","type":"str","value":"Z","ui":{"icon":"font-awesome/fa-columns","type":"input","opts":{"types":["str"]},"label":{}}},{"name":"MinRow","type":"num","value":"1","ui":{"icon":"font-awesome/fa-window-minimize","type":"input","opts":{"types":["num"]},"label":{}}},{"name":"MaxRow","type":"num","value":"1000","ui":{"icon":"font-awesome/fa-window-maximize","type":"input","opts":{"types":["num"]},"label":{}}},{"name":"OverrideEnvVariables","type":"bool","value":"false"}],"color":"#0cad0c","outputLabels":["Error","Last Populated Row","First Empty Row","Last Populated Column","First Empty Column","Spreadsheet Array","Full Data","Full Data with Inputs"],"icon":"font-awesome/fa-file-excel-o"},{"id":"20c22900.896628","type":"subflow","name":"Lookup Desired Data (3)","info":"# Preconditions\nThis subflow is designed to use a 2-D array of data loaded from a google sheeet to lookup desired data. The data is arrayed with the first row being column headers describing the data in those columns in subsequent rows. There are multiple levels of caching within this subflow.\n\nFirst it looks to see if the exact same combination of search key value pairs and desired lookup keys have been found in the last 5 seconds. If so it just copies the search results.\n\nThe second level of caching is that the lookup is attempted against a locally cached set of the data. The data is cached in a memory global variable, so if Node-Red is restarted this cache will be empty. Additionally, any flow can delete the global variable. This level is valuable because memory lookup is much faster than a call to Google Sheets which may not even be available in case of internet outage.\n\nFinally, if the data is not locally, then this subflow will use the provided inputs to pull the data from its ultimate storage site (a Google Sheets spreadsheet).\n\nThis subflow assumes that the format will come in with the sorts of inputs show in the examples of preformatted inputs.\n\nThis flow requires the read spreadsheet for details subflow node exists and ....\n\n\n## **inputs**\n### globalsource \nThe name of the global variable holding the table of data\n### msg.keyvalues\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row.\n### msg.searchfor\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. The value enters the node empty.\n\n### **Setting Passed as Msg Properties**\nThese are used when the subflow's configuration should be driven by data populated at runtime. The inputs to do this are:\n - msg.IgnoreEnvVar is the boolean that says override the environment variables and use these properties\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\n\n\n\n\n## **outputs**\n### Output1: Value Found \nThis ouput is used when the subflow has successfully identified the requested data. That data is placed into the value portions of the key value pairs that made up the msg.searchfor input\n### Output 2: Error but try reloading from data source\nFor the subflow, this is intended to be informational. This says the subflow will be trying to load the table from Google sheets under the expectation that either this is the first time a lookup has been tried an the data had not yet been cached in the global variable or potentially the data in the cache has become stale and reloading from the Google sheet will add a row that will match the requested search criteria.\n### Output 3: Error despite having tried to reload from data source\nFor the subflow, this output is used when either the global variable to contain the data table either does no exist or does not contain a row with all of the requested search criteria and at least 1 attempt has already been made to reload the global vairable cache. This is effectively a notification of non-recoverable lookup failure.","category":"Mike Subflows","in":[{"x":50,"y":80,"wires":[{"id":"dbf60bd1.e6d018"}]}],"out":[{"x":480,"y":67,"wires":[{"id":"dbf60bd1.e6d018","port":0}]},{"x":540,"y":79,"wires":[{"id":"dbf60bd1.e6d018","port":1}]},{"x":600,"y":91,"wires":[{"id":"dbf60bd1.e6d018","port":2}]}],"env":[],"color":"#FDF0C2","inputLabels":["Info for Lookup"],"outputLabels":["Value Found","Error but try reloading from data source","Error despite having tried to reload from data source"]},{"id":"d663491c.25a828","type":"subflow","name":"Read Spreadsheet For Details (4) (2)","info":"# **Preconditions**\nMake sure that the credentials for the read input from GSheet node are for an account that has access to the spreadsheets that will be passed to the subflow.\n## **Inputs**\nThe subflow takes as inputs in 3 ways.\n### **Default Environment Variables**\nThese are used if neither of the other options turn on their override variable. It is important to realize however the configuration is only for the authors own spreadsheet so it is unlikely that you will have access to this spreadsheet and so must at a minimum update the spreadsheet id to your own spreadsheet. Changing these values from within the subnode impacts all uses of the subnode when not overridden. In general it is better to use options 2 (Passed Environment Variables) or 3 (Passed Msg properties) to prevent unexpected behavior in flows not being edited.\n - Spreadsheet ID for the spreadsheet\n - TabName for the tab within that spreadsheet\n - ColStart for the letter(s) of the leftmost column\n - ColEnd for the letter(s) of rightmost column\n - MinRow for the number of the first row\n - MaxRow for the number of the last row\n - OverrideEnvVariables by default set to false as it wouldn't make sense for the default to say override the defaults.\n### **Passed Environment Variables**\nThese are used when the subflow's environment variable are specified in the calling flow at build time.\n - Spreadsheet ID for the spreadsheet\n - TabName for the tab within that spreadsheet\n - ColStart for the letter(s) of the leftmost column\n - ColEnd for the letter(s) of rightmost column\n - MinRow for the number of the first row\n - MaxRow for the number of the last row\n - OverrideEnvVariables is a key variable as it tells the subflow to ignore the subflow's global defaults and instead use those specified here.\n### **Setting Passed as Msg Properties**\nThese are used when the subflow's configuration should be driven by data populated at runtime. The inputs to do this are:\n - msg.IgnoreEnvVar is the boolean that says override the environment variables and use these properties\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n## **Outputs**\n### **Output1: Error**\nPasses any caught error to the error subflows intentially built error output. By intentionally built I mean I created one and labelled it as such. This is not there by default.\n### **Output 2: Last Populated Row**\nPasses the number of the last row within the requested range that had at least 1 cell populated.\n### **Output 3: First Empty Row**\nPasses the number for the row following the last populated row. Note, while it is in theory the first empty row, if the last populated row was the last row of the input range, this subflow does not guarantee the row returned really is empty as it has not been examined.\n### **Output 4: Last Populated Column**\nPasses the letter(s) of the last column within the requested range that had at least 1 cell populated.\n### **Output 5: First Empty Column**\nPasses the letter(s) for the column following the last populated column. Note, while it is in theory the first empty column, if the last populated column was the last column of the input range, this subflow does not guarantee the column returned really is empty as it has not been examined.\n### **Output 6: Full Data**\nPasses the array that contains the data retrieved from the Google Sheet.\n### **Output 7: Full Data with Inputs**\nReturns same information as Option 6, but does so without removing the msg properties that drove the retrieval process.","category":"Mike Subflows","in":[{"x":40,"y":20,"wires":[{"id":"ab6529c.1531ed8"}]}],"out":[{"x":1060,"y":60,"wires":[{"id":"4d8a4132.a5994","port":0}]},{"x":1060,"y":140,"wires":[{"id":"33c4567d.d9c6ca","port":0}]},{"x":1060,"y":220,"wires":[{"id":"1aa4aac9.9051a5","port":0}]},{"x":1060,"y":300,"wires":[{"id":"b6ba033f.ff1c7","port":0}]},{"x":1060,"y":380,"wires":[{"id":"c4235ad0.b726a8","port":0}]},{"x":1060,"y":460,"wires":[{"id":"c4d8e16c.be2b1","port":0}]},{"x":1060,"y":540,"wires":[{"id":"4d35b8ed.52e478","port":0}]},{"x":1060,"y":620,"wires":[{"id":"a4266569.899ef8","port":0}]}],"env":[{"name":"Spreadsheet ID","type":"str","value":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","ui":{"icon":"font-awesome/fa-file-excel-o","type":"input","opts":{"types":["str"]},"label":{}}},{"name":"TabName","type":"str","value":"Devices","ui":{"icon":"font-awesome/fa-table","label":{"en-US":"Tab"},"type":"input","opts":{"types":["str"]}}},{"name":"ColStart","type":"str","value":"A","ui":{"icon":"font-awesome/fa-columns","type":"input","opts":{"types":["str"]},"label":{}}},{"name":"ColEnd","type":"str","value":"Z","ui":{"icon":"font-awesome/fa-columns","type":"input","opts":{"types":["str"]},"label":{}}},{"name":"MinRow","type":"num","value":"1","ui":{"icon":"font-awesome/fa-window-minimize","type":"input","opts":{"types":["num"]},"label":{}}},{"name":"MaxRow","type":"num","value":"1000","ui":{"icon":"font-awesome/fa-window-maximize","type":"input","opts":{"types":["num"]},"label":{}}},{"name":"OverrideEnvVariables","type":"bool","value":"false"}],"color":"#0cad0c","outputLabels":["Error","Last Populated Row","First Empty Row","Last Populated Column","First Empty Column","Spreadsheet Array","Full Data","Full Data with Inputs"],"icon":"font-awesome/fa-file-excel-o"},{"id":"cddaccaf.e0a04","type":"subflow","name":"Lookup Desired Data (3) (2)","info":"# Preconditions\nThis subflow is designed to use a 2-D array of data loaded from a google sheeet to lookup desired data. The data is arrayed with the first row being column headers describing the data in those columns in subsequent rows. There are multiple levels of caching within this subflow.\n\nFirst it looks to see if the exact same combination of search key value pairs and desired lookup keys have been found in the last 5 seconds. If so it just copies the search results.\n\nThe second level of caching is that the lookup is attempted against a locally cached set of the data. The data is cached in a memory global variable, so if Node-Red is restarted this cache will be empty. Additionally, any flow can delete the global variable. This level is valuable because memory lookup is much faster than a call to Google Sheets which may not even be available in case of internet outage.\n\nFinally, if the data is not locally, then this subflow will use the provided inputs to pull the data from its ultimate storage site (a Google Sheets spreadsheet).\n\nThis subflow assumes that the format will come in with the sorts of inputs show in the examples of preformatted inputs.\n\nThis flow requires the read spreadsheet for details subflow node exists and ....\n\n\n## **inputs**\n### globalsource \nThe name of the global variable holding the table of data\n### msg.keyvalues\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row.\n### msg.searchfor\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. The value enters the node empty.\n\n### **Setting Passed as Msg Properties**\nThese are used when the subflow's configuration should be driven by data populated at runtime. The inputs to do this are:\n - msg.IgnoreEnvVar is the boolean that says override the environment variables and use these properties\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\n\n\n\n\n## **outputs**\n### Output1: Value Found \nThis ouput is used when the subflow has successfully identified the requested data. That data is placed into the value portions of the key value pairs that made up the msg.searchfor input\n### Output 2: Error but try reloading from data source\nFor the subflow, this is intended to be informational. This says the subflow will be trying to load the table from Google sheets under the expectation that either this is the first time a lookup has been tried an the data had not yet been cached in the global variable or potentially the data in the cache has become stale and reloading from the Google sheet will add a row that will match the requested search criteria.\n### Output 3: Error despite having tried to reload from data source\nFor the subflow, this output is used when either the global variable to contain the data table either does no exist or does not contain a row with all of the requested search criteria and at least 1 attempt has already been made to reload the global vairable cache. This is effectively a notification of non-recoverable lookup failure.","category":"Mike Subflows","in":[{"x":50,"y":80,"wires":[{"id":"1e91ae7e.712612"}]}],"out":[{"x":480,"y":67,"wires":[{"id":"1e91ae7e.712612","port":0}]},{"x":540,"y":79,"wires":[{"id":"1e91ae7e.712612","port":1}]},{"x":600,"y":91,"wires":[{"id":"1e91ae7e.712612","port":2}]}],"env":[],"color":"#FDF0C2","inputLabels":["Info for Lookup"],"outputLabels":["Value Found","Error but try reloading from data source","Error despite having tried to reload from data source"]},{"id":"ff6040a4.0af3a","type":"subflow","name":"Monitor All Homebridge Native Devices","info":"","category":"Mike Subflows","in":[{"x":60,"y":40,"wires":[{"id":"4acb0da3.b878e4"}]}],"out":[],"env":[],"color":"#FDF0C2","status":{"x":2940,"y":2900,"wires":[{"id":"b0b991e.c80e67","port":0}]}},{"id":"b6874b18.031658","type":"subflow","name":"Read Spreadsheet For Details (final 6/2?)","info":"# **Preconditions**\nMake sure that the credentials for the read input from GSheet node are for an account that has access to the spreadsheets that will be passed to the subflow.\n## **Inputs**\nThe subflow takes as inputs in 3 ways.\n### **Default Environment Variables**\nThese are used if neither of the other options turn on their override variable. It is important to realize however the configuration is only for the authors own spreadsheet so it is unlikely that you will have access to this spreadsheet and so must at a minimum update the spreadsheet id to your own spreadsheet. Changing these values from within the subnode impacts all uses of the subnode when not overridden. In general it is better to use options 2 (Passed Environment Variables) or 3 (Passed Msg properties) to prevent unexpected behavior in flows not being edited.\n - Spreadsheet ID for the spreadsheet\n - TabName for the tab within that spreadsheet\n - ColStart for the letter(s) of the leftmost column\n - ColEnd for the letter(s) of rightmost column\n - MinRow for the number of the first row\n - MaxRow for the number of the last row\n - OverrideEnvVariables by default set to false as it wouldn't make sense for the default to say override the defaults.\n### **Passed Environment Variables**\nThese are used when the subflow's environment variable are specified in the calling flow at build time.\n - Spreadsheet ID for the spreadsheet\n - TabName for the tab within that spreadsheet\n - ColStart for the letter(s) of the leftmost column\n - ColEnd for the letter(s) of rightmost column\n - MinRow for the number of the first row\n - MaxRow for the number of the last row\n - OverrideEnvVariables is a key variable as it tells the subflow to ignore the subflow's global defaults and instead use those specified here.\n### **Setting Passed as Msg Properties**\nThese are used when the subflow's configuration should be driven by data populated at runtime. The inputs to do this are:\n - msg.IgnoreEnvVar is the boolean that says override the environment variables and use these properties\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n## **Outputs**\n### **Output1: Error**\nPasses any caught error to the error subflows intentially built error output. By intentionally built I mean I created one and labelled it as such. This is not there by default.\n### **Output 2: Last Populated Row**\nPasses the number of the last row within the requested range that had at least 1 cell populated.\n### **Output 3: First Empty Row**\nPasses the number for the row following the last populated row. Note, while it is in theory the first empty row, if the last populated row was the last row of the input range, this subflow does not guarantee the row returned really is empty as it has not been examined.\n### **Output 4: Last Populated Column**\nPasses the letter(s) of the last column within the requested range that had at least 1 cell populated.\n### **Output 5: First Empty Column**\nPasses the letter(s) for the column following the last populated column. Note, while it is in theory the first empty column, if the last populated column was the last column of the input range, this subflow does not guarantee the column returned really is empty as it has not been examined.\n### **Output 6: Full Data**\nPasses the array that contains the data retrieved from the Google Sheet.\n### **Output 7: Full Data with Inputs**\nReturns same information as Option 6, but does so without removing the msg properties that drove the retrieval process.","category":"Mike Subflows","in":[{"x":40,"y":20,"wires":[{"id":"daba477c.d0b948"}]}],"out":[{"x":1060,"y":60,"wires":[{"id":"8f22cf12.4d74","port":0}]},{"x":1060,"y":140,"wires":[{"id":"79b3124e.18036c","port":0}]},{"x":1060,"y":220,"wires":[{"id":"56be010e.c2e1e","port":0}]},{"x":1060,"y":300,"wires":[{"id":"1a59a46b.8ee7cc","port":0}]},{"x":1060,"y":380,"wires":[{"id":"1ad4dcad.4bea93","port":0}]},{"x":1060,"y":460,"wires":[{"id":"d23fbda5.934a8","port":0}]},{"x":1060,"y":540,"wires":[{"id":"a801b477.ec11b8","port":0}]},{"x":1060,"y":620,"wires":[{"id":"7c39f16.0e7151","port":0}]}],"env":[{"name":"Spreadsheet ID","type":"str","value":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","ui":{"icon":"font-awesome/fa-file-excel-o","type":"input","opts":{"types":["str"]},"label":{}}},{"name":"TabName","type":"str","value":"Devices","ui":{"icon":"font-awesome/fa-table","label":{"en-US":"Tab"},"type":"input","opts":{"types":["str"]}}},{"name":"ColStart","type":"str","value":"A","ui":{"icon":"font-awesome/fa-columns","type":"input","opts":{"types":["str"]},"label":{}}},{"name":"ColEnd","type":"str","value":"Z","ui":{"icon":"font-awesome/fa-columns","type":"input","opts":{"types":["str"]},"label":{}}},{"name":"MinRow","type":"num","value":"1","ui":{"icon":"font-awesome/fa-window-minimize","type":"input","opts":{"types":["num"]},"label":{}}},{"name":"MaxRow","type":"num","value":"1000","ui":{"icon":"font-awesome/fa-window-maximize","type":"input","opts":{"types":["num"]},"label":{}}},{"name":"OverrideEnvVariables","type":"bool","value":"false"}],"color":"#0cad0c","outputLabels":["Error","Last Populated Row","First Empty Row","Last Populated Column","First Empty Column","Spreadsheet Array","Full Data","Full Data with Inputs"],"icon":"font-awesome/fa-file-excel-o"},{"id":"11c4fe96.587e41","type":"subflow","name":"Lookup Desired Data (temp 6/2)","info":"# Preconditions\nThis subflow is designed to use a 2-D array of data loaded from a google sheeet to lookup desired data. The data is arrayed with the first row being column headers describing the data in those columns in subsequent rows. There are multiple levels of caching within this subflow.\n\nFirst it looks to see if the exact same combination of search key value pairs and desired lookup keys have been found in the last 5 seconds. If so it just copies the search results.\n\nThe second level of caching is that the lookup is attempted against a locally cached set of the data. The data is cached in a memory global variable, so if Node-Red is restarted this cache will be empty. Additionally, any flow can delete the global variable. This level is valuable because memory lookup is much faster than a call to Google Sheets which may not even be available in case of internet outage.\n\nFinally, if the data is not locally, then this subflow will use the provided inputs to pull the data from its ultimate storage site (a Google Sheets spreadsheet).\n\nThis subflow assumes that the format will come in with the sorts of inputs show in the examples of preformatted inputs.\n\nThis flow requires the read spreadsheet for details subflow node exists and ....\n\n\n## **inputs**\n### globalsource \nThe name of the global variable holding the table of data\n### msg.keyvalues\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row.\n### msg.searchfor\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. The value enters the node empty.\n\n### **Setting Passed as Msg Properties**\nThese are used when the subflow's configuration should be driven by data populated at runtime. The inputs to do this are:\n - msg.IgnoreEnvVar is the boolean that says override the environment variables and use these properties\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\n\n\n\n\n## **outputs**\n### Output1: Value Found \nThis ouput is used when the subflow has successfully identified the requested data. That data is placed into the value portions of the key value pairs that made up the msg.searchfor input\n### Output 2: Error but try reloading from data source\nFor the subflow, this is intended to be informational. This says the subflow will be trying to load the table from Google sheets under the expectation that either this is the first time a lookup has been tried an the data had not yet been cached in the global variable or potentially the data in the cache has become stale and reloading from the Google sheet will add a row that will match the requested search criteria.\n### Output 3: Error despite having tried to reload from data source\nFor the subflow, this output is used when either the global variable to contain the data table either does no exist or does not contain a row with all of the requested search criteria and at least 1 attempt has already been made to reload the global vairable cache. This is effectively a notification of non-recoverable lookup failure.","category":"Mike Subflows","in":[{"x":50,"y":80,"wires":[{"id":"36c11796.981068"}]}],"out":[{"x":480,"y":67,"wires":[{"id":"36c11796.981068","port":0}]},{"x":540,"y":79,"wires":[{"id":"36c11796.981068","port":1}]},{"x":600,"y":91,"wires":[{"id":"36c11796.981068","port":2}]}],"env":[],"color":"#FDF0C2","inputLabels":["Info for Lookup"],"outputLabels":["Value Found","Error but try reloading from data source","Error despite having tried to reload from data source"]},{"id":"7210fbae.22d8e4","type":"subflow","name":"Read Spreadsheet For Details (final 6/2?) (2)","info":"# **Preconditions**\nMake sure that the credentials for the read input from GSheet node are for an account that has access to the spreadsheets that will be passed to the subflow.\n## **Inputs**\nThe subflow takes as inputs in 3 ways.\n### **Default Environment Variables**\nThese are used if neither of the other options turn on their override variable. It is important to realize however the configuration is only for the authors own spreadsheet so it is unlikely that you will have access to this spreadsheet and so must at a minimum update the spreadsheet id to your own spreadsheet. Changing these values from within the subnode impacts all uses of the subnode when not overridden. In general it is better to use options 2 (Passed Environment Variables) or 3 (Passed Msg properties) to prevent unexpected behavior in flows not being edited.\n - Spreadsheet ID for the spreadsheet\n - TabName for the tab within that spreadsheet\n - ColStart for the letter(s) of the leftmost column\n - ColEnd for the letter(s) of rightmost column\n - MinRow for the number of the first row\n - MaxRow for the number of the last row\n - OverrideEnvVariables by default set to false as it wouldn't make sense for the default to say override the defaults.\n### **Passed Environment Variables**\nThese are used when the subflow's environment variable are specified in the calling flow at build time.\n - Spreadsheet ID for the spreadsheet\n - TabName for the tab within that spreadsheet\n - ColStart for the letter(s) of the leftmost column\n - ColEnd for the letter(s) of rightmost column\n - MinRow for the number of the first row\n - MaxRow for the number of the last row\n - OverrideEnvVariables is a key variable as it tells the subflow to ignore the subflow's global defaults and instead use those specified here.\n### **Setting Passed as Msg Properties**\nThese are used when the subflow's configuration should be driven by data populated at runtime. The inputs to do this are:\n - msg.IgnoreEnvVar is the boolean that says override the environment variables and use these properties\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n## **Outputs**\n### **Output1: Error**\nPasses any caught error to the error subflows intentially built error output. By intentionally built I mean I created one and labelled it as such. This is not there by default.\n### **Output 2: Last Populated Row**\nPasses the number of the last row within the requested range that had at least 1 cell populated.\n### **Output 3: First Empty Row**\nPasses the number for the row following the last populated row. Note, while it is in theory the first empty row, if the last populated row was the last row of the input range, this subflow does not guarantee the row returned really is empty as it has not been examined.\n### **Output 4: Last Populated Column**\nPasses the letter(s) of the last column within the requested range that had at least 1 cell populated.\n### **Output 5: First Empty Column**\nPasses the letter(s) for the column following the last populated column. Note, while it is in theory the first empty column, if the last populated column was the last column of the input range, this subflow does not guarantee the column returned really is empty as it has not been examined.\n### **Output 6: Full Data**\nPasses the array that contains the data retrieved from the Google Sheet.\n### **Output 7: Full Data with Inputs**\nReturns same information as Option 6, but does so without removing the msg properties that drove the retrieval process.","category":"Mike Subflows","in":[{"x":40,"y":20,"wires":[{"id":"1f6ce0c6.78a11f"}]}],"out":[{"x":1060,"y":60,"wires":[{"id":"69a18bbe.6b1de4","port":0}]},{"x":1060,"y":140,"wires":[{"id":"6332befe.13c62","port":0}]},{"x":1060,"y":220,"wires":[{"id":"e499f758.df9248","port":0}]},{"x":1060,"y":300,"wires":[{"id":"df768cb1.db976","port":0}]},{"x":1060,"y":380,"wires":[{"id":"a9d36d24.ce42a","port":0}]},{"x":1060,"y":460,"wires":[{"id":"83f841eb.373dc","port":0}]},{"x":1060,"y":540,"wires":[{"id":"2bc97be7.f37b34","port":0}]},{"x":1060,"y":620,"wires":[{"id":"3af3fc5d.4cb1a4","port":0}]}],"env":[{"name":"Spreadsheet ID","type":"str","value":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","ui":{"icon":"font-awesome/fa-file-excel-o","type":"input","opts":{"types":["str"]},"label":{}}},{"name":"TabName","type":"str","value":"Devices","ui":{"icon":"font-awesome/fa-table","label":{"en-US":"Tab"},"type":"input","opts":{"types":["str"]}}},{"name":"ColStart","type":"str","value":"A","ui":{"icon":"font-awesome/fa-columns","type":"input","opts":{"types":["str"]},"label":{}}},{"name":"ColEnd","type":"str","value":"Z","ui":{"icon":"font-awesome/fa-columns","type":"input","opts":{"types":["str"]},"label":{}}},{"name":"MinRow","type":"num","value":"1","ui":{"icon":"font-awesome/fa-window-minimize","type":"input","opts":{"types":["num"]},"label":{}}},{"name":"MaxRow","type":"num","value":"1000","ui":{"icon":"font-awesome/fa-window-maximize","type":"input","opts":{"types":["num"]},"label":{}}},{"name":"OverrideEnvVariables","type":"bool","value":"false"}],"color":"#0cad0c","outputLabels":["Error","Last Populated Row","First Empty Row","Last Populated Column","First Empty Column","Spreadsheet Array","Full Data","Full Data with Inputs"],"icon":"font-awesome/fa-file-excel-o"},{"id":"62402261.0f073c","type":"subflow","name":"Lookup Desired Data (Final 6/2?) (2)","info":"# Preconditions\nThis subflow is designed to use a 2-D array of data loaded from a google sheeet to lookup desired data. The data is arrayed with the first row being column headers describing the data in those columns in subsequent rows. There are multiple levels of caching within this subflow.\n\nFirst it looks to see if the exact same combination of search key value pairs and desired lookup keys have been found in the last 5 seconds. If so it just copies the search results.\n\nThe second level of caching is that the lookup is attempted against a locally cached set of the data. The data is cached in a memory global variable, so if Node-Red is restarted this cache will be empty. Additionally, any flow can delete the global variable. This level is valuable because memory lookup is much faster than a call to Google Sheets which may not even be available in case of internet outage.\n\nFinally, if the data is not locally, then this subflow will use the provided inputs to pull the data from its ultimate storage site (a Google Sheets spreadsheet).\n\nThis subflow assumes that the format will come in with the sorts of inputs show in the examples of preformatted inputs.\n\nThis flow requires the read spreadsheet for details subflow node exists and ....\n\n\n## **inputs**\n### globalsource \nThe name of the global variable holding the table of data\n### msg.keyvalues\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row.\n### msg.searchfor\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. The value enters the node empty.\n\n### **Setting Passed as Msg Properties**\nThese are used when the subflow's configuration should be driven by data populated at runtime. The inputs to do this are:\n - msg.IgnoreEnvVar is the boolean that says override the environment variables and use these properties\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\n\n\n\n\n## **outputs**\n### Output1: Value Found \nThis ouput is used when the subflow has successfully identified the requested data. That data is placed into the value portions of the key value pairs that made up the msg.searchfor input\n### Output 2: Error but try reloading from data source\nFor the subflow, this is intended to be informational. This says the subflow will be trying to load the table from Google sheets under the expectation that either this is the first time a lookup has been tried an the data had not yet been cached in the global variable or potentially the data in the cache has become stale and reloading from the Google sheet will add a row that will match the requested search criteria.\n### Output 3: Error despite having tried to reload from data source\nFor the subflow, this output is used when either the global variable to contain the data table either does no exist or does not contain a row with all of the requested search criteria and at least 1 attempt has already been made to reload the global vairable cache. This is effectively a notification of non-recoverable lookup failure.","category":"Mike Subflows","in":[{"x":50,"y":80,"wires":[{"id":"790c08a5.162c58"}]}],"out":[{"x":480,"y":67,"wires":[{"id":"790c08a5.162c58","port":0}]},{"x":540,"y":79,"wires":[{"id":"790c08a5.162c58","port":1}]},{"x":600,"y":91,"wires":[{"id":"790c08a5.162c58","port":2}]}],"env":[],"color":"#FDF0C2","inputLabels":["Info for Lookup"],"outputLabels":["Value Found","Error but try reloading from data source","Error despite having tried to reload from data source"]},{"id":"56462e67.8c2c1","type":"subflow","name":"Read Spreadsheet For Details (final 6/2?) (3)","info":"# **Preconditions**\nMake sure that the credentials for the read input from GSheet node are for an account that has access to the spreadsheets that will be passed to the subflow.\n## **Inputs**\nThe subflow takes as inputs in 3 ways.\n### **Default Environment Variables**\nThese are used if neither of the other options turn on their override variable. It is important to realize however the configuration is only for the authors own spreadsheet so it is unlikely that you will have access to this spreadsheet and so must at a minimum update the spreadsheet id to your own spreadsheet. Changing these values from within the subnode impacts all uses of the subnode when not overridden. In general it is better to use options 2 (Passed Environment Variables) or 3 (Passed Msg properties) to prevent unexpected behavior in flows not being edited.\n - Spreadsheet ID for the spreadsheet\n - TabName for the tab within that spreadsheet\n - ColStart for the letter(s) of the leftmost column\n - ColEnd for the letter(s) of rightmost column\n - MinRow for the number of the first row\n - MaxRow for the number of the last row\n - OverrideEnvVariables by default set to false as it wouldn't make sense for the default to say override the defaults.\n### **Passed Environment Variables**\nThese are used when the subflow's environment variable are specified in the calling flow at build time.\n - Spreadsheet ID for the spreadsheet\n - TabName for the tab within that spreadsheet\n - ColStart for the letter(s) of the leftmost column\n - ColEnd for the letter(s) of rightmost column\n - MinRow for the number of the first row\n - MaxRow for the number of the last row\n - OverrideEnvVariables is a key variable as it tells the subflow to ignore the subflow's global defaults and instead use those specified here.\n### **Setting Passed as Msg Properties**\nThese are used when the subflow's configuration should be driven by data populated at runtime. The inputs to do this are:\n - msg.IgnoreEnvVar is the boolean that says override the environment variables and use these properties\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n## **Outputs**\n### **Output1: Error**\nPasses any caught error to the error subflows intentially built error output. By intentionally built I mean I created one and labelled it as such. This is not there by default.\n### **Output 2: Last Populated Row**\nPasses the number of the last row within the requested range that had at least 1 cell populated.\n### **Output 3: First Empty Row**\nPasses the number for the row following the last populated row. Note, while it is in theory the first empty row, if the last populated row was the last row of the input range, this subflow does not guarantee the row returned really is empty as it has not been examined.\n### **Output 4: Last Populated Column**\nPasses the letter(s) of the last column within the requested range that had at least 1 cell populated.\n### **Output 5: First Empty Column**\nPasses the letter(s) for the column following the last populated column. Note, while it is in theory the first empty column, if the last populated column was the last column of the input range, this subflow does not guarantee the column returned really is empty as it has not been examined.\n### **Output 6: Full Data**\nPasses the array that contains the data retrieved from the Google Sheet.\n### **Output 7: Full Data with Inputs**\nReturns same information as Option 6, but does so without removing the msg properties that drove the retrieval process.","category":"Mike Subflows","in":[{"x":40,"y":20,"wires":[{"id":"4e5c896.eedb878"}]}],"out":[{"x":1060,"y":60,"wires":[{"id":"fd167f63.f0515","port":0}]},{"x":1060,"y":140,"wires":[{"id":"4e10e8d5.d61b48","port":0}]},{"x":1060,"y":220,"wires":[{"id":"a8dec9f9.1d9a08","port":0}]},{"x":1060,"y":300,"wires":[{"id":"6f59f913.bffce8","port":0}]},{"x":1060,"y":380,"wires":[{"id":"3029f7f0.2d1fb8","port":0}]},{"x":1060,"y":460,"wires":[{"id":"5f254201.4ba14c","port":0}]},{"x":1060,"y":540,"wires":[{"id":"1aad3709.387999","port":0}]},{"x":1060,"y":620,"wires":[{"id":"3437a510.51a74a","port":0}]}],"env":[{"name":"Spreadsheet ID","type":"str","value":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","ui":{"icon":"font-awesome/fa-file-excel-o","type":"input","opts":{"types":["str"]},"label":{}}},{"name":"TabName","type":"str","value":"Devices","ui":{"icon":"font-awesome/fa-table","label":{"en-US":"Tab"},"type":"input","opts":{"types":["str"]}}},{"name":"ColStart","type":"str","value":"A","ui":{"icon":"font-awesome/fa-columns","type":"input","opts":{"types":["str"]},"label":{}}},{"name":"ColEnd","type":"str","value":"Z","ui":{"icon":"font-awesome/fa-columns","type":"input","opts":{"types":["str"]},"label":{}}},{"name":"MinRow","type":"num","value":"1","ui":{"icon":"font-awesome/fa-window-minimize","type":"input","opts":{"types":["num"]},"label":{}}},{"name":"MaxRow","type":"num","value":"1000","ui":{"icon":"font-awesome/fa-window-maximize","type":"input","opts":{"types":["num"]},"label":{}}},{"name":"OverrideEnvVariables","type":"bool","value":"false"}],"color":"#0cad0c","outputLabels":["Error","Last Populated Row","First Empty Row","Last Populated Column","First Empty Column","Spreadsheet Array","Full Data","Full Data with Inputs"],"icon":"font-awesome/fa-file-excel-o"},{"id":"8b456115.ccf69","type":"subflow","name":"Lookup Desired Data (Final 6/2?) (3)","info":"# Preconditions\nThis subflow is designed to use a 2-D array of data loaded from a google sheeet to lookup desired data. The data is arrayed with the first row being column headers describing the data in those columns in subsequent rows. There are multiple levels of caching within this subflow.\n\nFirst it looks to see if the exact same combination of search key value pairs and desired lookup keys have been found in the last 5 seconds. If so it just copies the search results.\n\nThe second level of caching is that the lookup is attempted against a locally cached set of the data. The data is cached in a memory global variable, so if Node-Red is restarted this cache will be empty. Additionally, any flow can delete the global variable. This level is valuable because memory lookup is much faster than a call to Google Sheets which may not even be available in case of internet outage.\n\nFinally, if the data is not locally, then this subflow will use the provided inputs to pull the data from its ultimate storage site (a Google Sheets spreadsheet).\n\nThis subflow assumes that the format will come in with the sorts of inputs show in the examples of preformatted inputs.\n\nThis flow requires the read spreadsheet for details subflow node exists and ....\n\n\n## **inputs**\n### globalsource \nThe name of the global variable holding the table of data\n### msg.keyvalues\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row.\n### msg.searchfor\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. The value enters the node empty.\n\n### **Setting Passed as Msg Properties**\nThese are used when the subflow's configuration should be driven by data populated at runtime. The inputs to do this are:\n - msg.IgnoreEnvVar is the boolean that says override the environment variables and use these properties\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\n\n\n\n\n## **outputs**\n### Output1: Value Found \nThis ouput is used when the subflow has successfully identified the requested data. That data is placed into the value portions of the key value pairs that made up the msg.searchfor input\n### Output 2: Error but try reloading from data source\nFor the subflow, this is intended to be informational. This says the subflow will be trying to load the table from Google sheets under the expectation that either this is the first time a lookup has been tried an the data had not yet been cached in the global variable or potentially the data in the cache has become stale and reloading from the Google sheet will add a row that will match the requested search criteria.\n### Output 3: Error despite having tried to reload from data source\nFor the subflow, this output is used when either the global variable to contain the data table either does no exist or does not contain a row with all of the requested search criteria and at least 1 attempt has already been made to reload the global vairable cache. This is effectively a notification of non-recoverable lookup failure.","category":"Mike Subflows","in":[{"x":50,"y":80,"wires":[{"id":"23e47880.0f5478"}]}],"out":[{"x":480,"y":67,"wires":[{"id":"23e47880.0f5478","port":0}]},{"x":540,"y":79,"wires":[{"id":"23e47880.0f5478","port":1}]},{"x":600,"y":91,"wires":[{"id":"23e47880.0f5478","port":2}]}],"env":[],"color":"#FDF0C2","inputLabels":["Info for Lookup"],"outputLabels":["Value Found","Error but try reloading from data source","Error despite having tried to reload from data source"]},{"id":"542f8cf0.3c1ce4","type":"subflow","name":"WIP Lookup Desired Data (Final 6/7)","info":"","category":"","in":[{"x":60,"y":140,"wires":[{"id":"a0879f53.f0f19"}]}],"out":[{"x":460,"y":100,"wires":[{"id":"a0879f53.f0f19","port":0}]},{"x":560,"y":140,"wires":[]},{"x":400,"y":200,"wires":[]}],"env":[],"color":"#DDAA99"},{"id":"90f110ad.441f1","type":"subflow","name":"Read Spreadsheet For Details (final 6/2?) (4)","info":"# **Preconditions**\nMake sure that the credentials for the read input from GSheet node are for an account that has access to the spreadsheets that will be passed to the subflow.\n## **Inputs**\nThe subflow takes as inputs in 3 ways.\n### **Default Environment Variables**\nThese are used if neither of the other options turn on their override variable. It is important to realize however the configuration is only for the authors own spreadsheet so it is unlikely that you will have access to this spreadsheet and so must at a minimum update the spreadsheet id to your own spreadsheet. Changing these values from within the subnode impacts all uses of the subnode when not overridden. In general it is better to use options 2 (Passed Environment Variables) or 3 (Passed Msg properties) to prevent unexpected behavior in flows not being edited.\n - Spreadsheet ID for the spreadsheet\n - TabName for the tab within that spreadsheet\n - ColStart for the letter(s) of the leftmost column\n - ColEnd for the letter(s) of rightmost column\n - MinRow for the number of the first row\n - MaxRow for the number of the last row\n - OverrideEnvVariables by default set to false as it wouldn't make sense for the default to say override the defaults.\n### **Passed Environment Variables**\nThese are used when the subflow's environment variable are specified in the calling flow at build time.\n - Spreadsheet ID for the spreadsheet\n - TabName for the tab within that spreadsheet\n - ColStart for the letter(s) of the leftmost column\n - ColEnd for the letter(s) of rightmost column\n - MinRow for the number of the first row\n - MaxRow for the number of the last row\n - OverrideEnvVariables is a key variable as it tells the subflow to ignore the subflow's global defaults and instead use those specified here.\n### **Setting Passed as Msg Properties**\nThese are used when the subflow's configuration should be driven by data populated at runtime. The inputs to do this are:\n - msg.IgnoreEnvVar is the boolean that says override the environment variables and use these properties\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n## **Outputs**\n### **Output1: Error**\nPasses any caught error to the error subflows intentially built error output. By intentionally built I mean I created one and labelled it as such. This is not there by default.\n### **Output 2: Last Populated Row**\nPasses the number of the last row within the requested range that had at least 1 cell populated.\n### **Output 3: First Empty Row**\nPasses the number for the row following the last populated row. Note, while it is in theory the first empty row, if the last populated row was the last row of the input range, this subflow does not guarantee the row returned really is empty as it has not been examined.\n### **Output 4: Last Populated Column**\nPasses the letter(s) of the last column within the requested range that had at least 1 cell populated.\n### **Output 5: First Empty Column**\nPasses the letter(s) for the column following the last populated column. Note, while it is in theory the first empty column, if the last populated column was the last column of the input range, this subflow does not guarantee the column returned really is empty as it has not been examined.\n### **Output 6: Full Data**\nPasses the array that contains the data retrieved from the Google Sheet.\n### **Output 7: Full Data with Inputs**\nReturns same information as Option 6, but does so without removing the msg properties that drove the retrieval process.","category":"Mike Subflows","in":[{"x":40,"y":20,"wires":[{"id":"af11454c.93b218"}]}],"out":[{"x":1060,"y":60,"wires":[{"id":"4edff30e.00041c","port":0}]},{"x":1060,"y":140,"wires":[{"id":"d2310a59.812f78","port":0}]},{"x":1060,"y":220,"wires":[{"id":"6e9f3c8d.f55944","port":0}]},{"x":1060,"y":300,"wires":[{"id":"2d7a6524.7aa10a","port":0}]},{"x":1060,"y":380,"wires":[{"id":"233c90c2.90949","port":0}]},{"x":1060,"y":460,"wires":[{"id":"c5f2b797.a297f8","port":0}]},{"x":1060,"y":540,"wires":[{"id":"fa1fdeb4.721e1","port":0}]},{"x":1060,"y":620,"wires":[{"id":"6f8a278a.734cb8","port":0}]}],"env":[{"name":"Spreadsheet ID","type":"str","value":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","ui":{"icon":"font-awesome/fa-file-excel-o","type":"input","opts":{"types":["str"]},"label":{}}},{"name":"TabName","type":"str","value":"Devices","ui":{"icon":"font-awesome/fa-table","label":{"en-US":"Tab"},"type":"input","opts":{"types":["str"]}}},{"name":"ColStart","type":"str","value":"A","ui":{"icon":"font-awesome/fa-columns","type":"input","opts":{"types":["str"]},"label":{}}},{"name":"ColEnd","type":"str","value":"Z","ui":{"icon":"font-awesome/fa-columns","type":"input","opts":{"types":["str"]},"label":{}}},{"name":"MinRow","type":"num","value":"1","ui":{"icon":"font-awesome/fa-window-minimize","type":"input","opts":{"types":["num"]},"label":{}}},{"name":"MaxRow","type":"num","value":"1000","ui":{"icon":"font-awesome/fa-window-maximize","type":"input","opts":{"types":["num"]},"label":{}}},{"name":"OverrideEnvVariables","type":"bool","value":"false"}],"color":"#0cad0c","outputLabels":["Error","Last Populated Row","First Empty Row","Last Populated Column","First Empty Column","Spreadsheet Array","Full Data","Full Data with Inputs"],"icon":"font-awesome/fa-file-excel-o"},{"id":"69030aaf.dab944","type":"subflow","name":"Lookup Desired Data (Final 6/2?) (4)","info":"# Preconditions\nThis subflow is designed to use a 2-D array of data loaded from a google sheeet to lookup desired data. The data is arrayed with the first row being column headers describing the data in those columns in subsequent rows. There are multiple levels of caching within this subflow.\n\nFirst it looks to see if the exact same combination of search key value pairs and desired lookup keys have been found in the last 5 seconds. If so it just copies the search results.\n\nThe second level of caching is that the lookup is attempted against a locally cached set of the data. The data is cached in a memory global variable, so if Node-Red is restarted this cache will be empty. Additionally, any flow can delete the global variable. This level is valuable because memory lookup is much faster than a call to Google Sheets which may not even be available in case of internet outage.\n\nFinally, if the data is not locally, then this subflow will use the provided inputs to pull the data from its ultimate storage site (a Google Sheets spreadsheet).\n\nThis subflow assumes that the format will come in with the sorts of inputs show in the examples of preformatted inputs.\n\nThis flow requires the read spreadsheet for details subflow node exists and ....\n\n\n## **inputs**\n### globalsource \nThe name of the global variable holding the table of data\n### msg.keyvalues\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row.\n### msg.searchfor\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. The value enters the node empty.\n\n### **Setting Passed as Msg Properties**\nThese are used when the subflow's configuration should be driven by data populated at runtime. The inputs to do this are:\n - msg.IgnoreEnvVar is the boolean that says override the environment variables and use these properties\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\n\n\n\n\n## **outputs**\n### Output1: Value Found \nThis ouput is used when the subflow has successfully identified the requested data. That data is placed into the value portions of the key value pairs that made up the msg.searchfor input\n### Output 2: Error but try reloading from data source\nFor the subflow, this is intended to be informational. This says the subflow will be trying to load the table from Google sheets under the expectation that either this is the first time a lookup has been tried an the data had not yet been cached in the global variable or potentially the data in the cache has become stale and reloading from the Google sheet will add a row that will match the requested search criteria.\n### Output 3: Error despite having tried to reload from data source\nFor the subflow, this output is used when either the global variable to contain the data table either does no exist or does not contain a row with all of the requested search criteria and at least 1 attempt has already been made to reload the global vairable cache. This is effectively a notification of non-recoverable lookup failure.","category":"Mike Subflows","in":[{"x":50,"y":80,"wires":[{"id":"2c0f2be7.ed2b94"}]}],"out":[{"x":480,"y":67,"wires":[{"id":"2c0f2be7.ed2b94","port":0}]},{"x":540,"y":79,"wires":[{"id":"2c0f2be7.ed2b94","port":1}]},{"x":600,"y":91,"wires":[{"id":"2c0f2be7.ed2b94","port":2}]}],"env":[],"color":"#FDF0C2","inputLabels":["Info for Lookup"],"outputLabels":["Value Found","Error but try reloading from data source","Error despite having tried to reload from data source"]},{"id":"3bfce36.77ec51c","type":"subflow","name":"Read Spreadsheet For Details (final 6/2?) (5)","info":"# **Preconditions**\nMake sure that the credentials for the read input from GSheet node are for an account that has access to the spreadsheets that will be passed to the subflow.\n## **Inputs**\nThe subflow takes as inputs in 3 ways.\n### **Default Environment Variables**\nThese are used if neither of the other options turn on their override variable. It is important to realize however the configuration is only for the authors own spreadsheet so it is unlikely that you will have access to this spreadsheet and so must at a minimum update the spreadsheet id to your own spreadsheet. Changing these values from within the subnode impacts all uses of the subnode when not overridden. In general it is better to use options 2 (Passed Environment Variables) or 3 (Passed Msg properties) to prevent unexpected behavior in flows not being edited.\n - Spreadsheet ID for the spreadsheet\n - TabName for the tab within that spreadsheet\n - ColStart for the letter(s) of the leftmost column\n - ColEnd for the letter(s) of rightmost column\n - MinRow for the number of the first row\n - MaxRow for the number of the last row\n - OverrideEnvVariables by default set to false as it wouldn't make sense for the default to say override the defaults.\n### **Passed Environment Variables**\nThese are used when the subflow's environment variable are specified in the calling flow at build time.\n - Spreadsheet ID for the spreadsheet\n - TabName for the tab within that spreadsheet\n - ColStart for the letter(s) of the leftmost column\n - ColEnd for the letter(s) of rightmost column\n - MinRow for the number of the first row\n - MaxRow for the number of the last row\n - OverrideEnvVariables is a key variable as it tells the subflow to ignore the subflow's global defaults and instead use those specified here.\n### **Setting Passed as Msg Properties**\nThese are used when the subflow's configuration should be driven by data populated at runtime. The inputs to do this are:\n - msg.IgnoreEnvVar is the boolean that says override the environment variables and use these properties\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n## **Outputs**\n### **Output1: Error**\nPasses any caught error to the error subflows intentially built error output. By intentionally built I mean I created one and labelled it as such. This is not there by default.\n### **Output 2: Last Populated Row**\nPasses the number of the last row within the requested range that had at least 1 cell populated.\n### **Output 3: First Empty Row**\nPasses the number for the row following the last populated row. Note, while it is in theory the first empty row, if the last populated row was the last row of the input range, this subflow does not guarantee the row returned really is empty as it has not been examined.\n### **Output 4: Last Populated Column**\nPasses the letter(s) of the last column within the requested range that had at least 1 cell populated.\n### **Output 5: First Empty Column**\nPasses the letter(s) for the column following the last populated column. Note, while it is in theory the first empty column, if the last populated column was the last column of the input range, this subflow does not guarantee the column returned really is empty as it has not been examined.\n### **Output 6: Full Data**\nPasses the array that contains the data retrieved from the Google Sheet.\n### **Output 7: Full Data with Inputs**\nReturns same information as Option 6, but does so without removing the msg properties that drove the retrieval process.","category":"Mike Subflows","in":[{"x":40,"y":20,"wires":[{"id":"70a78de0.3eada4"}]}],"out":[{"x":1060,"y":60,"wires":[{"id":"ad80d089.0be6","port":0}]},{"x":1060,"y":140,"wires":[{"id":"9908b600.2b8b98","port":0}]},{"x":1060,"y":220,"wires":[{"id":"3cf3bc5a.886e64","port":0}]},{"x":1060,"y":300,"wires":[{"id":"c6ca02c6.9be92","port":0}]},{"x":1060,"y":380,"wires":[{"id":"10a747d6.2c6178","port":0}]},{"x":1060,"y":460,"wires":[{"id":"7d7cd356.a67e0c","port":0}]},{"x":1060,"y":540,"wires":[{"id":"8919b098.87e5d","port":0}]},{"x":1060,"y":620,"wires":[{"id":"85038b11.7139c8","port":0}]}],"env":[{"name":"Spreadsheet ID","type":"str","value":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","ui":{"icon":"font-awesome/fa-file-excel-o","type":"input","opts":{"types":["str"]},"label":{}}},{"name":"TabName","type":"str","value":"Devices","ui":{"icon":"font-awesome/fa-table","label":{"en-US":"Tab"},"type":"input","opts":{"types":["str"]}}},{"name":"ColStart","type":"str","value":"A","ui":{"icon":"font-awesome/fa-columns","type":"input","opts":{"types":["str"]},"label":{}}},{"name":"ColEnd","type":"str","value":"Z","ui":{"icon":"font-awesome/fa-columns","type":"input","opts":{"types":["str"]},"label":{}}},{"name":"MinRow","type":"num","value":"1","ui":{"icon":"font-awesome/fa-window-minimize","type":"input","opts":{"types":["num"]},"label":{}}},{"name":"MaxRow","type":"num","value":"1000","ui":{"icon":"font-awesome/fa-window-maximize","type":"input","opts":{"types":["num"]},"label":{}}},{"name":"OverrideEnvVariables","type":"bool","value":"false"}],"color":"#0cad0c","outputLabels":["Error","Last Populated Row","First Empty Row","Last Populated Column","First Empty Column","Spreadsheet Array","Full Data","Full Data with Inputs"],"icon":"font-awesome/fa-file-excel-o"},{"id":"612157af.990328","type":"subflow","name":"Read Spreadsheet For Details (final 6/2?) (5) (2)","info":"# **Preconditions**\nMake sure that the credentials for the read input from GSheet node are for an account that has access to the spreadsheets that will be passed to the subflow.\n## **Inputs**\nThe subflow takes as inputs in 3 ways.\n### **Default Environment Variables**\nThese are used if neither of the other options turn on their override variable. It is important to realize however the configuration is only for the authors own spreadsheet so it is unlikely that you will have access to this spreadsheet and so must at a minimum update the spreadsheet id to your own spreadsheet. Changing these values from within the subnode impacts all uses of the subnode when not overridden. In general it is better to use options 2 (Passed Environment Variables) or 3 (Passed Msg properties) to prevent unexpected behavior in flows not being edited.\n - Spreadsheet ID for the spreadsheet\n - TabName for the tab within that spreadsheet\n - ColStart for the letter(s) of the leftmost column\n - ColEnd for the letter(s) of rightmost column\n - MinRow for the number of the first row\n - MaxRow for the number of the last row\n - OverrideEnvVariables by default set to false as it wouldn't make sense for the default to say override the defaults.\n### **Passed Environment Variables**\nThese are used when the subflow's environment variable are specified in the calling flow at build time.\n - Spreadsheet ID for the spreadsheet\n - TabName for the tab within that spreadsheet\n - ColStart for the letter(s) of the leftmost column\n - ColEnd for the letter(s) of rightmost column\n - MinRow for the number of the first row\n - MaxRow for the number of the last row\n - OverrideEnvVariables is a key variable as it tells the subflow to ignore the subflow's global defaults and instead use those specified here.\n### **Setting Passed as Msg Properties**\nThese are used when the subflow's configuration should be driven by data populated at runtime. The inputs to do this are:\n - msg.IgnoreEnvVar is the boolean that says override the environment variables and use these properties\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n## **Outputs**\n### **Output1: Error**\nPasses any caught error to the error subflows intentially built error output. By intentionally built I mean I created one and labelled it as such. This is not there by default.\n### **Output 2: Last Populated Row**\nPasses the number of the last row within the requested range that had at least 1 cell populated.\n### **Output 3: First Empty Row**\nPasses the number for the row following the last populated row. Note, while it is in theory the first empty row, if the last populated row was the last row of the input range, this subflow does not guarantee the row returned really is empty as it has not been examined.\n### **Output 4: Last Populated Column**\nPasses the letter(s) of the last column within the requested range that had at least 1 cell populated.\n### **Output 5: First Empty Column**\nPasses the letter(s) for the column following the last populated column. Note, while it is in theory the first empty column, if the last populated column was the last column of the input range, this subflow does not guarantee the column returned really is empty as it has not been examined.\n### **Output 6: Full Data**\nPasses the array that contains the data retrieved from the Google Sheet.\n### **Output 7: Full Data with Inputs**\nReturns same information as Option 6, but does so without removing the msg properties that drove the retrieval process.","category":"Mike Subflows","in":[{"x":40,"y":20,"wires":[{"id":"bc48d67c.4fb9a8"}]}],"out":[{"x":1060,"y":60,"wires":[{"id":"e4b43a04.ea2398","port":0}]},{"x":1060,"y":140,"wires":[{"id":"21f57377.47771c","port":0}]},{"x":1060,"y":220,"wires":[{"id":"500b97d7.f990a8","port":0}]},{"x":1060,"y":300,"wires":[{"id":"54eec44a.cb413c","port":0}]},{"x":1060,"y":380,"wires":[{"id":"f14f21eb.6391","port":0}]},{"x":1060,"y":460,"wires":[{"id":"aa9c681e.d12238","port":0}]},{"x":1060,"y":540,"wires":[{"id":"9a5a7759.34fa38","port":0}]},{"x":1060,"y":620,"wires":[{"id":"b0f91300.e54a3","port":0}]}],"env":[{"name":"Spreadsheet ID","type":"str","value":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","ui":{"icon":"font-awesome/fa-file-excel-o","type":"input","opts":{"types":["str"]},"label":{}}},{"name":"TabName","type":"str","value":"Devices","ui":{"icon":"font-awesome/fa-table","label":{"en-US":"Tab"},"type":"input","opts":{"types":["str"]}}},{"name":"ColStart","type":"str","value":"A","ui":{"icon":"font-awesome/fa-columns","type":"input","opts":{"types":["str"]},"label":{}}},{"name":"ColEnd","type":"str","value":"Z","ui":{"icon":"font-awesome/fa-columns","type":"input","opts":{"types":["str"]},"label":{}}},{"name":"MinRow","type":"num","value":"1","ui":{"icon":"font-awesome/fa-window-minimize","type":"input","opts":{"types":["num"]},"label":{}}},{"name":"MaxRow","type":"num","value":"1000","ui":{"icon":"font-awesome/fa-window-maximize","type":"input","opts":{"types":["num"]},"label":{}}},{"name":"OverrideEnvVariables","type":"bool","value":"false"}],"color":"#0cad0c","outputLabels":["Error","Last Populated Row","First Empty Row","Last Populated Column","First Empty Column","Spreadsheet Array","Full Data","Full Data with Inputs"],"icon":"font-awesome/fa-file-excel-o"},{"id":"76571db3.5c77c4","type":"subflow","name":"WIP Lookup Desired Data (Final 6/7) (2)","info":"","category":"","in":[{"x":60,"y":140,"wires":[{"id":"a1684289.60ffe"}]}],"out":[{"x":460,"y":100,"wires":[{"id":"a1684289.60ffe","port":0}]},{"x":560,"y":140,"wires":[]},{"x":400,"y":200,"wires":[]}],"env":[],"color":"#DDAA99"},{"id":"5b8974a.7ce288c","type":"subflow","name":"Split and Lookup","info":"","category":"","in":[{"x":60,"y":60,"wires":[{"id":"9a85347b.8fd258"}]}],"out":[{"x":2060,"y":280,"wires":[{"id":"b0c9887a.a26758","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"fbc622f3.83b57","type":"group","z":"aad5f0e1.84355","name":"Populate/Update Devices Global Variable From Google Sheet","style":{"stroke":"#999999","fill":"#c8e7a7","label":true,"label-position":"nw","color":"#000000"},"nodes":["e4830a6f.ee5ce8","784e22ba.1f900c","588790c9.d8919","c006d5be.c7de98","4d5c35eb.8281bc"],"x":474,"y":33,"w":1132,"h":334},{"id":"76613d9c.dccc04","type":"group","z":"aad5f0e1.84355","name":"Homebridge Triggering","style":{"fill":"#3f3f3f","label":true,"color":"#ffffff"},"nodes":["b295d0a2.3827a","c91be57d.4adbd8","53b88059.cdf48","4d2c9b75.7d98a4","67948ec0.a84a8","e39ed404.bfa118","e9516723.fc8bd8"],"x":74,"y":619,"w":902,"h":142},{"id":"e7874dd3.6924a","type":"group","z":"aad5f0e1.84355","name":"msg.sheet is the name of the tab, msg.topic is the tab:A1:Z100, and msg.payload is the data to be written","style":{"label":true},"nodes":["9f9e13da.e50aa","e644c7ef.89f318","e625ff8e.09ee9","fd067392.609dd","8e62c71f.b63fb8"],"x":1804,"y":379,"w":802,"h":162},{"id":"e5fd1dc6.b851","type":"group","z":"aad5f0e1.84355","name":"Translations","style":{"label":true,"color":"#000000"},"nodes":["cd01ecf3.e6aff","8c66f89e.b02828","a7534bcc.c1ab18","9c104f6e.afc2c","95b9cf5e.5ff32","832559f3.cc1bb8","ea6b3e97.c688e","189d90e4.8ee89f","d65b1e49.85376","7aec7f68.da40a","87c2be57.634fa","d2515e1.0a2fba","d2ea1eb0.48f6c","1aed5d8b.2984b2","de7f4a2d.125ad8","8504be83.a891f","60b3e478.2fc69c","56032f68.120b7","461ad8e2.0df698","cd164dba.524df","a5c3185d.f9ce48","fe61512d.69ffc","d08f9116.8b5b8","c5bbe46.5e76b18","bfe3a4c6.afe848"],"x":1814,"y":559,"w":1232,"h":642},{"id":"f9871510.22aa18","type":"group","z":"aad5f0e1.84355","name":"Hubitat Triggering","style":{"stroke":"#ff3f3f","label":true,"color":"#d1d1d1","fill":"#000000"},"nodes":["4a4b8cce.471b54","2d909dd4.4e5672","487ce08f.9b1a9","679aaed4.e03f5","707812aa.431cac","ca1f0289.5f67f"],"x":74,"y":459,"w":832,"h":142},{"id":"9f4937e5.d52ff8","type":"group","z":"aad5f0e1.84355","name":"Sending Output","style":{"label":true,"color":"#000000"},"nodes":["e0622a2d.00e228","e60a21f7.7e2dd","9b330506.a45d58","8ce9bbe4.145998","8cee6136.dcb9d","10b91e22.6cd082","92b4cc1e.35457","efe434db.e36b48","dbcc8f4d.5cc5a"],"x":1814,"y":1219,"w":1132,"h":242},{"id":"8b23774d.98e8e8","type":"group","z":"aad5f0e1.84355","name":"Generic Error Catching","style":{"label":true},"nodes":["d0ffa256.f4e89","7704ff9e.7d439"],"x":994,"y":619,"w":552,"h":82},{"id":"a543d690.8e86c8","type":"group","z":"aad5f0e1.84355","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["31fcce08.aeb912","80316bba.f21e28","a304b755.b557a8"],"x":-12,"y":1493,"w":4460,"h":2614},{"id":"c1445c3e.6d48e","type":"group","z":"b2da258c.19e8d8","name":"Manual Digi2 to Digi 1","style":{"label":true},"nodes":["adf35407.239188","cb166a55.6d7d58"],"x":14,"y":79,"w":352,"h":82},{"id":"cff2e07e.8e261","type":"group","z":"79e87940.d7f498","name":"Manually Triggering (does not trigger On Device Activity)","style":{"label":true},"nodes":["346909b5.b8f336","722d5fa.6b610a"],"x":114,"y":59,"w":372,"h":82},{"id":"642f4ba4.a9e314","type":"group","z":"a280aade.b19d78","name":"Control Panel Nodes","style":{"label":true},"nodes":["31b3611d.278cde","21823b8b.ae61d4","3564a64b.7684ea","1b02a2b.abcaf5d","7b4a989f.c0d288","586d1a45.d6be04","53b53ce1.d1aa34","e38469d0.d510a8","3d9e168.cdfefea","ebcc8417.372c88"],"x":74,"y":19,"w":512,"h":322},{"id":"b132be5b.9e822","type":"group","z":"e44a28b6.338da8","name":"Testing Desktop IKEA Bulb Controls","style":{"label":true},"nodes":["2253a7f6.2d7b38","ea184bab.747168","dc54ae57.73fe1","d4093dc4.b77d1","3602f87d.88dce8","5ea1ab79.f59de4","c54c81cf.3a417","e078961d.4e68b8","8f7a8370.fbb19","cb93c0f4.0bfdf","945316e0.7e2a28"],"x":94,"y":1899,"w":1092,"h":302},{"id":"cc225987.ffcee8","type":"group","z":"e44a28b6.338da8","name":"Leave on/off output as is for Z2M, but extract on/off  from {state: \"on\"}  to on for and move to command for Hubitat and build payload.on = 1 or 0 for Homebridge","style":{"label":true},"nodes":["2bc33989.0e89e6","4a3f9c76.970004","ad285b99.fc74b8","4c11bd56.c00074","50a7660c.894a18","1ebda1a7.499b6e","d368bbf9.2d2178","7968fdae.101df4","bcd4d82d.ecc1e8","d5bb4820.386358"],"x":194,"y":3259,"w":1252,"h":242},{"id":"7d1b3f3e.fa86d","type":"group","z":"e44a28b6.338da8","name":"Turn on/off into {state: \"on\"} for Z2M and move to command for Hubitat and turn into payload.on = 1 or 0 for Homebridge","style":{"label":true},"nodes":["a7319be8.a96638","b3fddad3.fa2898","4f89b4b7.3c75cc","77ce1917.fc4498","d24423d4.34e07","ffac1bf3.869248","db0f4a3c.744a38","a99ff613.c827b8","2f9778a9.980358","2787e91f.733566"],"x":194,"y":3519,"w":1172,"h":242},{"id":"c730932b.5c8e6","type":"group","z":"481337e1.e82348","name":"Hubitat","style":{"fill":"#92d04f","label":true,"color":"#000000"},"nodes":["1cfc0072.40871","2194357f.89933a","3602fd1c.580aa2","3af227d6.68cec8","4171da49.8a2e44","5fcf2c1c.449414","691926c9.59a1e8","8bfaa544.8fa1d8","ac710f2a.d2737","b5b8aad0.940468","c27d7eb3.149fc","d40b3c67.f669","e2b7b94f.02bf78","ec8e921b.d0ce5","fbe7994a.3fd628"],"x":28,"y":27,"w":2249,"h":1180},{"id":"6ecada9d.502b84","type":"group","z":"481337e1.e82348","name":"Z2M","style":{"label":true,"fill":"#ffc038","color":"#000000"},"nodes":["8211996b.2cfe68","93c3f7b8.06fa18","fa854bd6.b3d638","5460ac7a.f7e854","37ff4f4f.b6184","6afd9338.2d5d3c","fda02c70.1211e"],"x":28,"y":1219,"w":858,"h":328},{"id":"93fa55f4.842198","type":"group","z":"481337e1.e82348","name":"HomeBridge","style":{"fill":"#D32F2F","label":true,"color":"#ffffff"},"nodes":["56c25a14.8719e4","5c5015c4.d11ccc","809745d4.ddc178","d7efe446.21ed78","e5284a2c.f8baa8"],"x":28,"y":1573,"w":1344,"h":534},{"id":"bdde2335.4840a","type":"group","z":"a280aade.b19d78","name":"NR method of triggering Z2M OTA firmware update","style":{"label":true},"nodes":["d9df1bf2.6077f8","be27da93.96e918"],"x":74,"y":359,"w":652,"h":82},{"id":"f2d9165a.c6adf8","type":"group","z":"98a6e865.a02ea8","name":"Native NR to Hubitat","style":{"label":true},"nodes":["4b143d5a.e11b54","53de30cb.5a905","8c38df2a.5984b","91cf3e9c.c1ae1","349ff253.9b9a7e","323994d.e2eaa6c","d430a9c7.458158"],"x":34,"y":599,"w":932,"h":142},{"id":"31fcce08.aeb912","type":"group","z":"aad5f0e1.84355","g":"a543d690.8e86c8","name":"Hubitat Inputs","style":{"stroke":"#000000","fill":"#bfdbef","label":true,"color":"#ffffff"},"nodes":["9686658a.9e0c98","ede75678.e2ec78","9ac29116.d9479","2b27b4b8.d9690c","2bc81335.2f14ac","3f1ae5e1.92424a","d0446017.f96b6","e8031c0e.d3d9a","21e9fa34.3b4a66","39a539e1.65d106","8bd3f727.b29db8","718b3fd2.1f26e","53c980a9.dc33c","b53ad46.e642028","3f3c92bc.cd5fce","933c1db8.d9032","5a908f73.da181","b0616ef3.ead08","b6da80b8.9f4e5","ab473f5c.4e5d8","6b444044.0dee2","dc464a97.634b78","33ab73a5.59c42c","4a1c9677.755688","db620345.d052b","cb6c10b4.5a2e","f35d5349.5eb6d","34f72340.8b283c","265659c4.d23e76","5a451ce0.7a5274","7e4e69d.a9b0298","91d26d99.559fa","fbb470db.09ad5","76d5fc39.f0d2e4","c4a10293.bcf0b","2dd0b340.1a587c","9ffac8ed.762118","184d9ad7.b114b5","b4138881.6751b8","757d63b2.d0d25c","282fa136.55eb5e","4874a973.627198","91880de4.14e32","1e9ddd8f.a38da2","89f8b40e.504f18","f592b991.a497f8","d0fc6523.c2f838","d351da0f.dd52c8","a6318e8f.6ee14","7d69bcc1.bdb604","59a51be.7e822e4","b4361b99.d75f18","e86fa2b3.9ef13","a0496ad.affe898","fd75b62c.e67cb8","9c31b900.ed2898","313b6c5.abff194","1536ac8c.ea23d3","a90e3954.76acb8","fa45468d.00d578","6e477e7a.aa08f","da0cb1bd.1903c","d36893a9.7c576","9b7fc51f.3b46a8","69a47913.e8e1f8","8ebf997a.87c988","31961548.aaeb2a","dc22a6e.c88b358","aee8065.1bbf6f8","8c497469.4907a8","c7bde6db.d7af08"],"x":834,"y":1519,"w":972,"h":2562},{"id":"e4830a6f.ee5ce8","type":"group","z":"aad5f0e1.84355","g":"fbc622f3.83b57","name":"Data Translations","style":{"stroke":"#999999","fill":"#ffffff","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["18da18f6.f23207","685f00bd.3c4ae"],"x":954,"y":259,"w":412,"h":82},{"id":"784e22ba.1f900c","type":"group","z":"aad5f0e1.84355","g":"fbc622f3.83b57","name":"Devices","style":{"stroke":"#999999","fill":"#ffffff","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["77a65d8c.a5ca44","c473872f.c48ee8"],"x":954,"y":59,"w":412,"h":82},{"id":"a304b755.b557a8","type":"group","z":"aad5f0e1.84355","g":"a543d690.8e86c8","name":"Homebridge Inputs","style":{"stroke":"#000000","label":true,"fill":"#bfdbef","color":"#ffffff"},"nodes":["146deab7.c05a55","9834023f.0eb12","cd25065b.de59c8","ebf77e9c.f4512","fef43fdd.99e2e"],"x":1828,"y":1519,"w":2594,"h":880},{"id":"c006d5be.c7de98","type":"group","z":"aad5f0e1.84355","g":"fbc622f3.83b57","name":"MeasurementTranslations","style":{"stroke":"#999999","fill":"#ffffff","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["36b2610.0603da","78c01376.f5c0ac"],"x":954,"y":159,"w":412,"h":82},{"id":"80316bba.f21e28","type":"group","z":"aad5f0e1.84355","g":"a543d690.8e86c8","name":"MQTT inputs","style":{"fill":"#bfdbef","label":true,"color":"#ffffff"},"nodes":["cd099940.525638","35065786.6c5288","cf18086e.605d38","94d280de.04719","c01af137.e08d9","7db29c53.77dd34","bfd65805.3d00f8","b12cd0e6.dfbe8","b6c8e770.ae0898","c8d5e79e.9ad1b8","310ccc9e.f2d9c4","98a796c3.64daa8","b05fa203.88579"],"x":14,"y":1519,"w":792,"h":342},{"id":"1cfc0072.40871","type":"group","z":"481337e1.e82348","g":"c730932b.5c8e6","name":"Hubitat Turn On/Off","style":{"label":true,"fill":"#ffffff"},"nodes":["90f0cc14.30531","bcfb8526.b53e18","8664d555.58afb8","e5a812bc.f89","5cc37db4.5a2044","b1681343.9904d"],"x":54,"y":53,"w":1138,"h":694},{"id":"5fcf2c1c.449414","type":"group","z":"481337e1.e82348","g":"c730932b.5c8e6","name":"Hubitat setColorTemperature Items","style":{"label":true,"fill":"#ffffff"},"nodes":["515cd74d.7f7d28","f78aa478.45d368","5bcd4d89.6513a4","97507876.983ee8","d5904e32.44aaf"],"x":54,"y":939,"w":232,"h":242},{"id":"b5b8aad0.940468","type":"group","z":"481337e1.e82348","g":"c730932b.5c8e6","name":"Hubitat setLevel Items","style":{"label":true,"fill":"#ffffff"},"nodes":["8324096.dc7cbf8","6741ff76.5ffc","fc102f26.cb3e9","21f15176.1fa80e","ef72e3a8.e236d","6454b524.365b2c","e66ac6da.b340e8","64929fcd.f4c78","7edfaff8.d08f6","a8021164.f656c","dae17a18.9e7e08","6426f02e.271d3","49171ad.54822e4","48baeb3e.f01624","ab1865ce.bc9a48","ac4740a0.1f37e"],"x":1214,"y":59,"w":272,"h":682},{"id":"2194357f.89933a","type":"group","z":"481337e1.e82348","g":"c730932b.5c8e6","name":"Hubitat startLevelChange Items","style":{"label":true,"fill":"#ffffff"},"nodes":["a617dd42.ebdf4","239b1054.7376","17c26925.860b87","fa57579c.221228","f26bcbe6.0fc778","537f73d.857728c","99c0eadd.9f9a68","7dfc5bc2.981494","a49b8c46.6e61","9e7ee581.78da68","1c5e5e4e.59f752"],"x":1514,"y":59,"w":272,"h":482},{"id":"691926c9.59a1e8","type":"group","z":"481337e1.e82348","g":"c730932b.5c8e6","name":"Hubitat startLevelChange Items","style":{"label":true,"fill":"#ffffff"},"nodes":["12b3cb36.3eb905","d70644b.75340b8","2a0007f9.e3a438"],"x":54,"y":759,"w":1132,"h":162},{"id":"e2b7b94f.02bf78","type":"group","z":"481337e1.e82348","g":"c730932b.5c8e6","name":"Hubitat childOff, childOn, childRefresh Items","style":{"label":true,"fill":"#ffffff"},"nodes":["51b641a7.dbc0b","46716217.ec44cc"],"x":1014,"y":939,"w":282,"h":122},{"id":"fbe7994a.3fd628","type":"group","z":"481337e1.e82348","g":"c730932b.5c8e6","name":"Hubitat stopLevelChange Items","style":{"label":true,"fill":"#ffffff"},"nodes":["47d22d28.c47b84","63fc0dc0.2fd394","381c5439.2cb0ec","a69a21fb.4e10e","41da27bf.765ff8","ac614496.960178","bc9f26a2.8bc7c8","c4f855a8.478738","e5224b3a.a4e618","970f2d6e.13372","13cd04c4.acea3b"],"x":1794,"y":59,"w":272,"h":482},{"id":"c27d7eb3.149fc","type":"group","z":"481337e1.e82348","g":"c730932b.5c8e6","name":"Hubitat arrived, departed Items","style":{"label":true,"fill":"#ffffff"},"nodes":["84cb058.cc221f8"],"x":294,"y":1079,"w":200,"h":82},{"id":"3602fd1c.580aa2","type":"group","z":"481337e1.e82348","g":"c730932b.5c8e6","name":"Thermostat Control","style":{"label":true,"fill":"#ffffff"},"nodes":["e30dfb91.e146d8","bac2d7d7.6bd6c8","eaae5ca7.e708e","d47ef1ee.537aa","6b635506.e948ac","bd2af955.ef6598","65d7f4e4.bbe14c"],"x":1314,"y":759,"w":732,"h":322},{"id":"ec8e921b.d0ce5","type":"group","z":"481337e1.e82348","g":"c730932b.5c8e6","name":"Hubitat deviceNotification Items","style":{"label":true,"fill":"#ffffff"},"nodes":["3952d0aa.59f2d"],"x":514,"y":1079,"w":204,"h":82},{"id":"3af227d6.68cec8","type":"group","z":"481337e1.e82348","g":"c730932b.5c8e6","name":"Hubitat startNotification, stopNotification Items","style":{"label":true,"fill":"#ffffff"},"nodes":["3c7a681b.8ba658"],"x":734,"y":1079,"w":294,"h":82},{"id":"d40b3c67.f669","type":"group","z":"481337e1.e82348","g":"c730932b.5c8e6","name":"Hubitat Harmony: channelDown, channelPrev, channelUp, mute, off, on, setVolume, unmute, volumeDown, volumeUp","style":{"label":true,"fill":"#ffffff"},"nodes":["cb808f9d.84ead"],"x":1514,"y":559,"w":737,"h":82},{"id":"8bfaa544.8fa1d8","type":"group","z":"481337e1.e82348","g":"c730932b.5c8e6","name":"Hubitat Fan Items: cycleSpeed setSpeed ","style":{"label":true,"fill":"#ffffff"},"nodes":["c4aaba66.dba198","b33a6178.6d6be"],"x":734,"y":939,"w":262,"h":122},{"id":"4171da49.8a2e44","type":"group","z":"481337e1.e82348","g":"c730932b.5c8e6","name":"Hubitat Colored Light Manipulation: setColor, setHue, setSaturation","style":{"label":true,"fill":"#ffffff"},"nodes":["de76a753.ee18a8","43479e5c.d3962"],"x":294,"y":939,"w":424,"h":122},{"id":"ac710f2a.d2737","type":"group","z":"481337e1.e82348","g":"c730932b.5c8e6","name":"Hubitat Vibraition Sensor Config: SetSensitivityLevelToHigh, SetSensitivityLevelToLow, SetSensitivityLevelToMedium","style":{"label":true,"fill":"#ffffff"},"nodes":["ead00cef.d826c","d17d82f2.030be"],"x":1514,"y":659,"w":731,"h":82},{"id":"37ff4f4f.b6184","type":"group","z":"481337e1.e82348","g":"6ecada9d.502b84","name":"Z2M On/Off Items","style":{"label":true,"fill":"#ffffff"},"nodes":["4f8817a.d72a6e8","5b02fc04.de2ca4"],"x":54,"y":1339,"w":372,"h":142},{"id":"6afd9338.2d5d3c","type":"group","z":"481337e1.e82348","g":"6ecada9d.502b84","name":"Z2M brightness Items","style":{"label":true,"fill":"#ffffff"},"nodes":["bcf60527.834e88"],"x":434,"y":1339,"w":372,"h":82},{"id":"fda02c70.1211e","type":"group","z":"481337e1.e82348","g":"6ecada9d.502b84","name":"Z2M color xy Items","style":{"label":true,"fill":"#ffffff"},"nodes":["22d00ca4.c9e694"],"x":434,"y":1439,"w":372,"h":82},{"id":"d7efe446.21ed78","type":"group","z":"481337e1.e82348","g":"93fa55f4.842198","name":"Homebridge Set Thermostat Target (Heating or Cooling Mode)","style":{"label":true,"fill":"#ffffff"},"nodes":["8ccdbe13.fae39","fb9a586.eba64a8"],"x":54,"y":1899,"w":472,"h":82},{"id":"5c5015c4.d11ccc","type":"group","z":"481337e1.e82348","g":"93fa55f4.842198","name":"Homebridge Set Thermostat Cooling Threshold (Auto Mode)","style":{"label":true,"fill":"#ffffff"},"nodes":["ea7a3a4a.96a588","aac5a23a.34e79"],"x":54,"y":1999,"w":472,"h":82},{"id":"809745d4.ddc178","type":"group","z":"481337e1.e82348","g":"93fa55f4.842198","name":"Homebridge Set Thermostat Heating Threshold (Auto Mode)","style":{"label":true,"fill":"#ffffff"},"nodes":["565c2b07.2a1f84","309239cd.81e696"],"x":534,"y":1899,"w":472,"h":82},{"id":"e5284a2c.f8baa8","type":"group","z":"481337e1.e82348","g":"93fa55f4.842198","name":"Homebride Turn On/Off","style":{"fill":"#ffffff","label":true},"nodes":["f4df6486.cdd2b8","d32fc9e5.21a7e8","5e64def3.ca5bd","20ae92aa.eaa5ee","616e6017.c4931","bf15a5fd.ebd9c8","6e495760.f7b1d8","e769370a.657bb8"],"x":54,"y":1599,"w":1292,"h":288},{"id":"56c25a14.8719e4","type":"group","z":"481337e1.e82348","g":"93fa55f4.842198","name":"Homebridge Set Thermostat Mode (0 = Off, 1 = Heat, 2 = Cool, 3 = Auto)","style":{"label":true,"fill":"#ffffff"},"nodes":["52792ea7.98309","70a516e8.cc1b08"],"x":534,"y":1999,"w":459,"h":82},{"id":"ebf77e9c.f4512","type":"group","z":"aad5f0e1.84355","g":"a304b755.b557a8","name":"Nest Protect Devices","style":{"label":true},"nodes":["5fca20ed.d9177","b74bcaff.688858","4715a743.874778","1232a17e.690f7f","8cbf499c.833c58","daf44023.0a56c","889acb57.8e7e68","17244be3.93d874","6327ffb0.5cfb3","ca5872f5.b3abc","5437f1fb.3c186","2fdc5364.37623c","b6583b9b.b0f1b8","21b1d38.3c5722c","63be61b0.967be","2b3f0c7.2ac52f4","17c6ce0.96c3f32","c1aa0bf.f4185f8","764591d6.f90ae"],"x":2374,"y":1545,"w":562,"h":682},{"id":"cd25065b.de59c8","type":"group","z":"aad5f0e1.84355","g":"a304b755.b557a8","name":"Nest Thermostat","style":{"label":true},"nodes":["2ca51afb.75f7d6","62ef5c1a.dfdb84","e0007e6f.b8466","885d993a.fd3208","67f25f0.fa84aa","6e0aafc0.e29d8","4dbc729f.3f0fec","151d2efd.7e8481"],"x":3454,"y":1545,"w":522,"h":282},{"id":"9834023f.0eb12","type":"group","z":"aad5f0e1.84355","g":"a304b755.b557a8","name":"Presence Sensors","style":{"label":true},"nodes":["71e72d51.053644","2141dfc8.694e4","b9e75269.5c12d","bde48c26.b9345","28906905.70d9f6","3cad3f54.76744","eef9cff5.9a2d9","b6f9cec9.a3b52","759c545b.c3563c","b4ce45ab.d2fa38","76776180.9ea89","81f45827.0d7048","65234354.ebf3ec"],"x":3994,"y":1545,"w":402,"h":482},{"id":"146deab7.c05a55","type":"group","z":"aad5f0e1.84355","g":"a304b755.b557a8","name":"Motion Sensors","style":{"label":true},"nodes":["7622423a.cac26c","9f909535.038648","77f71e65.e470f","46e4d5f0.ea3dac","3f3c1b3f.18fef4","a6c60f34.491f4"],"x":1854,"y":1545,"w":502,"h":828},{"id":"fef43fdd.99e2e","type":"group","z":"aad5f0e1.84355","g":"a304b755.b557a8","name":"Nest Protect Smoke Detector","style":{"label":true},"nodes":["55a42036.68041","ed2504d.1fef1f8","c39d5d8c.91dac","f547610e.77f35","b57bbced.6239a","5a40284.62595d8","7f870556.6466bc","5f80a4cb.10025c","2e628595.e1e36a","9d4d6ce3.887dc","78486b97.576e34","e752bc04.c8411","cdf114a6.0927e8","22a580c6.d24fe","6707634c.609abc","d3c0d72c.f06bf8","26c4754b.7bba6a","76334fc8.eadf1","bfa05903.f8cb38"],"x":2954,"y":1545,"w":482,"h":682},{"id":"b1681343.9904d","type":"group","z":"481337e1.e82348","g":"1cfc0072.40871","name":"Example of passing Device ID to Generic Hubitat Node","style":{"label":true},"nodes":["4cea4a5c.197bc4","4dbd9fce.6a7e5"],"x":814,"y":79,"w":349,"h":82},{"id":"5cc37db4.5a2044","type":"group","z":"481337e1.e82348","g":"1cfc0072.40871","name":"Hubitat On/Off Items","style":{"label":true},"nodes":["fedd4e4d.ae903","b1f1f25b.1fc4f","f1ca7a62.85d178","eab19d68.9462d","746947a4.f11db8","9e4c834d.6c39f","a1ce02e6.a318b","4ca6fee6.fc1a4","41b2ef5a.7319","1fa5a655.6e047a","bde033ac.6a6db","b783cc2b.d48de","e684cbd9.e7ddb8","885f1db3.2806d","68cf880c.c002c8","e4307409.5cf348","fc3adce1.8e926","7824f88c.bb1848","cc05cf89.21677","32b2350d.f3fe1a","55159957.ef2368","f6748f23.aface","8b7a6450.aacce8","9ccf5fc3.e644c","c172e9ad.ce4098","7fbbf644.8d2188","49d4edee.f18604","8b01bd7b.527a2","280721d6.7c18ee","10910d68.1eef73","2d93e75.9b43d18","69d99ef7.b96fe","1bec295c.0f92b7","e4d53505.aa5f28","6642f91c.3e8d98","4e3730d.e5190d"],"x":94,"y":199,"w":1072,"h":522},{"id":"e769370a.657bb8","type":"group","z":"481337e1.e82348","g":"e5284a2c.f8baa8","name":"Z2M On/Off Items","style":{"label":true,"fill":"#ffffff"},"nodes":["34b5558e.a9e7ba","67332e58.d9463","d1fef5f2.aa4c28"],"x":274,"y":1699,"w":312,"h":162},{"id":"77f71e65.e470f","type":"group","z":"aad5f0e1.84355","g":"146deab7.c05a55","name":"Nest Protect Motion Sensors","style":{"label":true},"nodes":["2abbe3d2.3077cc","6193baf8.1ebd04","88eb591a.cceea8","f61e3814.cf3248","5f2a119f.5822b","510dcf85.3a02f","2d6f09e.c5c90f6","bdfa65e1.617688","46ec3a5d.ec1c54","aaf72904.785ac8","5b71736f.78baac","a019df8.057cf2","54e7940b.d9bcbc","a22edff9.efc3e","2657afa2.16e68","c2bd7a8d.c5d448"],"x":1964,"y":1665,"w":272,"h":682},{"id":"2f23f49.924a10c","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Mike's Production Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"true","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"3ce7ceed.69be02","type":"homekit-bridge","z":"","bridgeName":"Mike","pinCode":"121-01-707","port":"","allowInsecureRequest":true,"manufacturer":"TMS Industries","model":"1","serialNo":"1","customMdnsConfig":false,"mdnsMulticast":true,"mdnsInterface":"","mdnsPort":"","mdnsIp":"","mdnsTtl":"","mdnsLoopback":true,"mdnsReuseAddr":true,"allowMessagePassthrough":true},{"id":"a5bf81ee.27852","type":"mqtt-broker","z":"","name":"MQTT Docker","broker":"192.168.86.3","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"adb4e9b8.8beee8","type":"gauth","z":""},{"id":"430b7850.44c1a8","type":"influxdb","z":"","hostname":"127.0.0.1","port":"8086","protocol":"http","database":"MikeTestFromNR","name":"","usetls":false,"tls":""},{"id":"55e4481a.722098","type":"hubitat config","z":"","name":"Main Hub (110) Maker Production Node Red","usetls":false,"host":"192.168.86.110","port":"80","appId":"646","nodeRedServer":"http://mike:Rufflestx1@192.168.86.3:1980","webhookPath":"/hubitat/prodwebhook/","autoRefresh":true,"useWebsocket":false},{"id":"b862b36a.1a11d","type":"influxdb","z":"","hostname":"127.0.0.1","port":"8086","protocol":"http","database":"MikeTestFromNR","name":"","usetls":false,"tls":""},{"id":"18f340fe.a70a3f","type":"ui_group","z":"","name":"Control","tab":"e1b0e744.6a5428","order":1,"disp":true,"width":"27","collapse":false},{"id":"8abf2e02.5fe9f","type":"ui_group","name":"Group 5","tab":"d5ea0f3.4753bf","order":4,"disp":true,"width":6},{"id":"60c16cd3.e9d974","type":"ui_spacer","name":"spacer","group":"8abf2e02.5fe9f","order":2,"width":1,"height":1},{"id":"9e60bee8.9eb17","type":"ui_spacer","name":"spacer","group":"8abf2e02.5fe9f","order":3,"width":1,"height":1},{"id":"429e5ab.771c5a4","type":"ui_tab","z":"","name":"Radar","icon":"dashboard","order":1,"disabled":false,"hidden":false},{"id":"4baf1468.abb01c","type":"ui_group","z":"","name":"Airport Filters","tab":"429e5ab.771c5a4","order":4,"disp":true,"width":"6","collapse":true},{"id":"9cbb54f5.392db8","type":"ui_group","z":"","name":"Aircraft Filters","tab":"429e5ab.771c5a4","order":5,"disp":true,"width":"6","collapse":true},{"id":"c7810244.5e40a","type":"ui_group","z":"","name":"Map","tab":"429e5ab.771c5a4","order":2,"disp":false,"width":"17","collapse":false},{"id":"a68c0105.e9c7e","type":"ui_tab","z":"","name":"Table Holder","icon":"dashboard","order":2,"disabled":false,"hidden":false},{"id":"e298b809.c3c2f8","type":"ui_group","z":"","name":"Before/After Modification","tab":"a68c0105.e9c7e","order":2,"disp":true,"width":"22","collapse":true},{"id":"1a94010f.a3b71f","type":"ui_tab","z":"","name":"Gauge Play","icon":"dashboard","order":3,"disabled":false,"hidden":false},{"id":"2a128af6.d72c46","type":"ui_group","z":"","name":"After Modification","tab":"a68c0105.e9c7e","order":3,"disp":false,"width":"22","collapse":false},{"id":"602d7c75.e52ed4","type":"ui_group","z":"","name":"Radar Console","tab":"429e5ab.771c5a4","order":3,"disp":true,"width":"6","collapse":false},{"id":"a4570963.5547f8","type":"ui_group","z":"","name":"Group 3","tab":"a68c0105.e9c7e","order":1,"disp":false,"width":"3","collapse":false},{"id":"820d7886.9debb8","type":"ui_spacer","name":"spacer","group":"a4570963.5547f8","order":6,"width":"3","height":"6"},{"id":"5455b6b3.8080f8","type":"ui_spacer","name":"spacer","group":"602d7c75.e52ed4","order":3,"width":"6","height":1},{"id":"df59aa47.b26148","type":"hb-conf","z":"","username":"121-01-707"},{"id":"577b1b11.27d264","type":"influxdb","z":"","hostname":"127.0.0.1","port":"8086","protocol":"http","database":"MikeTest","name":"","usetls":false,"tls":""},{"id":"e95739a9.f90a28","type":"influxdb","z":"","hostname":"192.168.86.3","port":"8086","protocol":"http","database":"MikeTestFromNR","name":"","usetls":false,"tls":""},{"id":"39dac4b7.0333ac","type":"influxdb","z":"","hostname":"192.168.86.3","port":"8086","protocol":"http","database":"MikeTestFromNR","name":"","usetls":false,"tls":""},{"id":"82aca41a.30fed8","type":"influxdb","z":"","hostname":"192.168.86.3","port":"8086","protocol":"http","database":"MikeTestFromNR","name":"","usetls":false,"tls":""},{"id":"28ac2ef0.6cbb12","type":"influxdb","z":"","hostname":"192.168.86.3","port":"8086","protocol":"http","database":"MikeTestFromNR","name":"","usetls":false,"tls":""},{"id":"6a229a9c.dc9cc4","type":"ui_group","z":"","name":"August Testing","tab":"1a94010f.a3b71f","order":1,"disp":false,"width":"24","collapse":false},{"id":"cf631ec5.cd065","type":"harmonyws-server","z":"","name":"Living Room Hub","ip":"192.168.86.102","debug":false},{"id":"c9c8a4fb.d854e8","type":"gauth","z":""},{"id":"77f0bd20.e51724","type":"ui_group","z":"","name":"Control","tab":"e11725b6.8eeeb8","order":1,"disp":true,"width":"18","collapse":false},{"id":"35ed5dc0.de7dc2","type":"ui_group","z":"","name":"Airport Filters","tab":"","order":3,"disp":true,"width":"14","collapse":false},{"id":"27d924cc.61f12c","type":"ui_group","z":"","name":"Type Filters","tab":"e11725b6.8eeeb8","order":4,"disp":true,"width":"6","collapse":false},{"id":"5a24230.26c21dc","type":"ui_group","z":"","name":"Map","tab":"e11725b6.8eeeb8","order":2,"disp":true,"width":"22","collapse":true},{"id":"10d58216.fa5bae","type":"alexa-remote-account","z":"","name":"Ashmont","authMethod":"proxy","proxyOwnIp":"192.168.86.3","proxyPort":"3456","cookieFile":"","refreshInterval":"3","alexaServiceHost":"pitangui.amazon.com","amazonPage":"amazon.com","acceptLanguage":"en-US","userAgent":"","useWsMqtt":"on","autoInit":"on"},{"id":"ee56137f.1880e","type":"hubitat config","z":"","name":"116 Hub","usetls":false,"host":"192.168.86.116","port":"80","appId":"66","nodeRedServer":"http://mike:Rufflestx1@192.168.86.3:1980","webhookPath":"/hubitat/116/","autoRefresh":true,"useWebsocket":false},{"id":"aeee420f.f7cd4","type":"position-config","z":"","name":"Ashmont","isValide":"true","longitude":"0","latitude":"0","angleType":"deg","timeZoneOffset":"99","timeZoneDST":"0","stateTimeFormat":"3","stateDateFormat":"12"},{"id":"52d15c09.cb0a54","type":"ui_group","z":"","name":"Status","tab":"a2b4537b.26e83","order":2,"disp":true,"width":"6","collapse":false},{"id":"81fcece9.90fc9","type":"ui_group","z":"","name":"Permit Join","tab":"a2b4537b.26e83","order":3,"disp":true,"width":"6","collapse":false},{"id":"e832c0be.76a5b","type":"tls-config","z":"","name":"","cert":"","key":"","ca":"","certname":"m2mqtt_srv.crt","keyname":"m2mqtt_srv.key","caname":"m2mqtt_ca.crt","servername":"","verifyservercert":false},{"id":"f7e25252.6bea5","type":"ui_group","z":"","name":"Rename Device","tab":"a2b4537b.26e83","order":6,"disp":true,"width":"6","collapse":false},{"id":"a2b4537b.26e83","type":"ui_tab","z":"","name":"Zigbee2MQTT Admin Panel","icon":"dashboard","order":5},{"id":"87b2e499.dc7108","type":"ui_group","z":"","name":"Testing Desktop Ikea bulb","tab":"8528e7ce.1b0b88","order":1,"disp":true,"width":"20","collapse":false},{"id":"8528e7ce.1b0b88","type":"ui_tab","z":"","name":"MQTT Device Control","icon":"bulb","order":6,"disabled":false,"hidden":false},{"id":"636ef47.ef2f20c","type":"ui_group","z":"","name":"Device management","tab":"e1b0e744.6a5428","order":4,"disp":true,"width":"6","collapse":false},{"id":"4f7b0da9.89e434","type":"mqtt-broker","z":"","name":"mqtt","broker":"mqtt","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"8b3c2d85.589b8","type":"ui_group","z":"","name":"Device list","tab":"e1b0e744.6a5428","order":2,"disp":true,"width":"6","collapse":false},{"id":"9fd008b7.8ec528","type":"ui_group","z":"","name":"Bridge configuration","tab":"e1b0e744.6a5428","order":6,"disp":true,"width":"6","collapse":true},{"id":"c99397bb.35de18","type":"ui_group","z":"","name":"Network map","tab":"c8dd7b49.605c88","order":1,"disp":false,"width":"27","collapse":false},{"id":"ce6ff330.8a1e6","type":"ui_group","z":"","name":"Device details","tab":"e1b0e744.6a5428","order":3,"disp":true,"width":"6","collapse":false},{"id":"8df93714.7ca768","type":"ui_group","z":"","name":"Group configuration","tab":"e1b0e744.6a5428","order":5,"disp":true,"width":"6","collapse":true},{"id":"e1b0e744.6a5428","type":"ui_tab","z":"","name":"Z2M Admin","icon":"dashboard","disabled":false,"hidden":false},{"id":"c8dd7b49.605c88","type":"ui_tab","z":"","name":"Z2M Network map","icon":"dashboard","disabled":false,"hidden":false},{"id":"1ed2281e.c0c068","type":"ui_tab","z":"","name":"MQTT2","icon":"dashboard","disabled":false,"hidden":false},{"id":"3ac6140a.a2989c","type":"ui_group","z":"","name":"Radar Control","tab":"1ed2281e.c0c068","order":1,"disp":true,"width":"6","collapse":false},{"id":"3c70bf8b.57792","type":"zigbee2mqtt-server","z":"","name":"CS MQTT","host":"192.168.86.3","mqtt_port":"1883","mqtt_username":"mike","mqtt_password":"ruffles","tls":"e832c0be.76a5b","usetls":false,"base_topic":"zigbee2mqtt"},{"id":"f9ce45cd.70d568","type":"rbe","z":"76e3605b.0e6e7","name":"Changing Ping?","func":"rbe","gap":"","start":"","inout":"out","property":"PingStatus","x":860,"y":100,"wires":[["23c83a68.f57316"]]},{"id":"54bcf469.64fc1c","type":"file","z":"76e3605b.0e6e7","name":"Append to NetUpPerpetual","filename":"","appendNewline":true,"createDir":false,"overwriteFile":"false","encoding":"none","x":940,"y":220,"wires":[[]]},{"id":"800cd2f0.7e6fc","type":"simpletime","z":"76e3605b.0e6e7","name":"Populate Time Messages","x":150,"y":240,"wires":[["2224f154.3db68e"]]},{"id":"2224f154.3db68e","type":"change","z":"76e3605b.0e6e7","name":"Create Log Start line with Formated Date","rules":[{"t":"set","p":"payload","pt":"msg","to":"myyear\t&\"-\"&\tmymonthn\t&\"-\"&\tmydom\t&\" \"&\tmyhourpm\t&\":\"&\tmyminute\t&\":\"&\tmysecond\t&\".\"&\tmymillis\t&\" \"&\tmypm\t&\"          Log Start\"","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":440,"y":240,"wires":[["54bcf469.64fc1c","b832f02e.6f68d"]]},{"id":"7b2187a9.5139d8","type":"change","z":"76e3605b.0e6e7","name":"Get dir/file destination from Flow context","rules":[{"t":"set","p":"filename","pt":"msg","to":"$flowContext('OutputDirectory') &\tpingtarget & \".txt\"","tot":"jsonata"},{"t":"set","p":"pingtime","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":140,"wires":[["833fda41.17b198","41c7aa38.91a0b4"]]},{"id":"f1a77239.f0493","type":"comment","z":"76e3605b.0e6e7","name":"JSONata Flow context","info":"myyear&\"-\"&mymonthn&\"-\"&mydom&\" \"&myhourpm &\":\"&myminute&\":\"&mysecond&\n\".\"&mymillis\n","x":500,"y":100,"wires":[]},{"id":"38e74b76.ec65d4","type":"change","z":"76e3605b.0e6e7","name":"Failure Start time","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":150,"y":960,"wires":[["b89a96f9.f64b88","f6326890.3b8ae8","148d89ae.8a8376"]]},{"id":"c2fdf835.927178","type":"change","z":"76e3605b.0e6e7","name":"Failure End time","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":1000,"wires":[["b89a96f9.f64b88"]]},{"id":"6b07ffa.4eb28","type":"calculator","z":"76e3605b.0e6e7","name":"Calculate the difference","inputMsgField":"payload","outputMsgField":"payload","operation":"sub","constant":"","x":610,"y":1040,"wires":[["94dfb9b5.59e1a8"]]},{"id":"b89a96f9.f64b88","type":"join","z":"76e3605b.0e6e7","name":"Get start and end times","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":170,"y":1040,"wires":[["6b07ffa.4eb28"]]},{"id":"f6326890.3b8ae8","type":"delay","z":"76e3605b.0e6e7","name":"","pauseType":"random","timeout":"1300","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"milliseconds","drop":false,"x":400,"y":1000,"wires":[["c2fdf835.927178"]]},{"id":"94dfb9b5.59e1a8","type":"calculator","z":"76e3605b.0e6e7","name":"Multiply by -1 to get positive duration","inputMsgField":"payload","outputMsgField":"payload","operation":"mult","constant":"-1","x":210,"y":1080,"wires":[["2ea97499.5a805c"]]},{"id":"2ea97499.5a805c","type":"function","z":"76e3605b.0e6e7","name":"Translate Duration Function","func":"/* \n * Create Variables\n * \n */\n        var milliseconds = msg.payload;\n        var years, weeks, days, hours, minutes, seconds, millis;\n    //creating 2 string versions of each of the durations that can be in the middle of a 1:01:01.001 duration \n    //minstr is the always 2 character one\n    //lminstr is the version that can be 1 or more characers that will be used when that part is the portion of the duration\n        var minstr, secstr, millistr, lminstr, lsecstr, lmillistr;\n        var whichcomponents, readableduration;\n\n/*\n * Calculate the numbers for the subcomponents\n * \n */\n    //by getting the remainder when dividing by 1000\n    //it leaves just the fraction of milliseconds\n        millis = milliseconds % 1000;\n    //the floor function drops the decimal portion\n    //returning the non fractional seconds\n        seconds = Math.floor(milliseconds / 1000);\n    //the floor function drops the decimal portion\n    //returning the non fractional minutes\n        minutes = Math.floor(seconds / 60);\n    //Once the minutes have been calculated, then\n    //the seconds is replaced with those seconds not\n    //accounted for by the minutes\n        seconds = seconds % 60;\n    //The same sequence as used for minutes/seconds\n    //then used to calulate minutes, hours, dayss, weeks, years\n\n        hours = Math.floor(minutes / 60);\n        minutes = minutes % 60;\n        days = Math.floor(hours / 24);\n        hours = hours % 24;\n        weeks = Math.floor(days / 7)\n        days = days % 7;\n        years = Math.floor(days / 365.25)\n        weeks = weeks % 52;\n\n/*\n * Put the subcomponents into msg payloads for easy access by later nodes\n *\n */\n        msg.years = years\n        msg.weeks = weeks\n        msg.days = days\n        msg.hours = hours\n        msg.minutes = minutes\n        msg.seconds = seconds\n        msg.millis = millis\n \n\n/*\n * create the string verssion for the subcomponents\n */\n    //milliseconds\n        lmillistr = millis.toString();\n        //put padding on the milliseconds so that 1 ms shows as .001 and not .1 when concatenated after a decimal\n            millistr = millis.toString().padStart(3, \"0\");\n    //seconds\n        lsecstr = seconds.toString();\n        //put padding on the seconds so that 1 s shows as :01.000 and not :1.000 when concatenated after a dividing :\n            secstr = lsecstr.padStart(2, \"0\");\n    //minutes\n        lminstr = minutes.toString();\n        //put padding on the minutes so that 1 m shows as :01:00.000 and not :1:00.000 when concatenated after a dividing :\n            minstr = lminstr.padStart(2, \"0\");\n\n/*\n * Build output based on largest significant populated unit\n * The general rule is to include in the output the largest unit (years, weeks, days, etc) followed by the next 2\n * smaller units if the happen to be populated\n */\n    readableduration =\"\"\n//years populated\n    if (years !== 0) { \n        if (days !== 0) {\n            if (days === 1) {\n                readableduration = \" \".concat(days.toString(), \" Day\", readableduration)\n            } else {\n                readableduration = \" \".concat(days.toString(), \" Days\", readableduration)\n            }\n        }\n        if (weeks !== 0) {\n            if (weeks === 1) {\n                readableduration = \" \".concat(weeks.toString(), \" Week\", readableduration)\n            } else {\n                readableduration = \" \".concat(weeks.toString(), \" Weeks\", readableduration)\n            }\n        }\n        if (years === 1) {\n            readableduration = years.toString().concat(\" Year\", readableduration)\n        } else {\n            readableduration = years.toString().concat(\" Years\", readableduration)\n        }\n//weeks populated\n    } else if (weeks !== 0) {\n        if (hours !== 0) {\n            if (hours === 1) {\n                readableduration = \" \".concat(hours.toString(), \" Hour\", readableduration)\n            } else {\n                readableduration = \" \".concat(hours.toString(), \" Hours\", readableduration)\n            }\n        }\n        if (days !== 0) {\n            if (weeks === 1) {\n                readableduration = \" \".concat(days.toString(), \" Day\", readableduration)\n            } else {\n                readableduration = \" \".concat(days.toString(), \" Days\", readableduration)\n            }\n        }\n        if (weeks === 1) {\n            readableduration = weeks.toString().concat(\" Week\", readableduration)\n        } else {\n            readableduration = weeks.toString().concat(\" Weeks\", readableduration)\n        }\n//days populated\n    } else if (days !== 0) {\n        if ((minutes !== 0) && (hours !== 0)) { //If both are non-zero then 1:01 format. If only 1 then either 2 hours or 1 minute\n            if (minutes !== 0) {\n                readableduration = \":\".concat(minstr, readableduration)\n            }\n            if (hours !== 0) {\n                readableduration = \" \".concat(hours.toString(), readableduration)\n            } else {\n                readableduration = \" 0\".concat(readableduration)\n            }\n        } else {\n            if (minutes === 1) {\n                readableduration = \" 1 Minute\".concat(readableduration)\n            } else if (minutes > 1) {\n                readableduration = \" \".concat(lminstr,\" Minutes\", readableduration)\n            } else if (hours === 1) {\n                readableduration = \" 1 Hour\".concat(readableduration)\n            } else {\n                if (hours >1) {\n                    readableduration = \" \".concat(hours.toString(),\" Hours\", readableduration)\n                }\n            }\n        }\n        if (days === 1) {\n            readableduration = days.toString().concat(\" Day\", readableduration)\n        } else {\n            readableduration = days.toString().concat(\" Days\", readableduration)\n        }\n//hours populated\n    } else if (hours !== 0) {\n        if ((minutes !== 0) || (seconds !== 0)) { //End result h Hours or h:mm:ss\n            readableduration = hours.toString().concat(\":\", minstr, \":\", secstr, readableduration)\n        } else {\n            if (hours === 1) {\n                readableduration = \"1 Hour\"\n            } else {\n                readableduration = hours.toString().concat(\" Hours\", readableduration)\n            }\n        }\n//minutes populated\n    } else if (minutes !== 0) { //End result m Minutes or mm:ss.MMM\n        if (seconds !== 0 || millis !== 0) { //End result h Hours or h:mm:ss\n            readableduration = lminstr.concat(\":\", secstr, \".\", millistr, readableduration)\n        } else {\n            if (minutes === 1) {\n                readableduration = \"1 Minute\".concat( readableduration)\n            } else {\n                readableduration = lminstr.concat(\" Minutes\", readableduration)\n            }\n        }\n//seconds populated\n    } else if (seconds !== 0) {\n        if (millis !== 0) { //End result s Seconds or s.MMM\n            readableduration = lsecstr.concat(\".\", millistr, \" Seconds\", readableduration)\n        } else {\n            if (seconds === 1) {\n                readableduration = \"1 Second\".concat( readableduration)\n            } else {\n                readableduration = lsecstr.concat(\" Seconds\", readableduration)\n            }\n        }\n//milliseconds populated\n    } else if (millis !== 0) {\n        if (millis !== 1) {\n            readableduration = lmillistr.concat(\" Milliseconds\", readableduration)\n        } else {\n            readableduration = \"1 Millisecond\".concat( readableduration)\n        }\n    } else {\n        readableduration = \"0\"\n    }\n    msg.years = years\n    msg.weeks = weeks\n    msg.days = days\n    msg.hours = hours\n    msg.minutes = minutes\n    msg.seconds = seconds\n    msg.millis = millis\n    msg.payload = readableduration\n    return msg;","outputs":1,"noerr":0,"x":500,"y":1080,"wires":[["82c9edda.537d7"]]},{"id":"408b8df6.b9b044","type":"join","z":"76e3605b.0e6e7","name":"Join the failure start time with the duration for output","mode":"custom","build":"string","property":"payload","propertyType":"msg","key":"topic","joiner":"","joinerType":"str","accumulate":false,"timeout":"","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1070,"y":960,"wires":[[]]},{"id":"82c9edda.537d7","type":"function","z":"76e3605b.0e6e7","name":"Pad the text duration to 24 characters","func":"msg.payload = msg.payload.padStart(24)\nreturn msg;","outputs":1,"noerr":0,"x":801,"y":1080,"wires":[["408b8df6.b9b044"]]},{"id":"148d89ae.8a8376","type":"change","z":"76e3605b.0e6e7","name":"Create Log Start line with Formated Date","rules":[{"t":"set","p":"payload","pt":"msg","to":"myyear\t&\"-\"&\tmymonthn\t&\"-\"&\tmydom\t&\" \"&\tmyhourpm\t&\":\"&\tmyminute\t&\":\"&\tmysecond\t&\".\"&\tmymillis\t&\" \"&\tmypm","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":660,"y":960,"wires":[["408b8df6.b9b044"]]},{"id":"6e44be2e.917c7","type":"function","z":"76e3605b.0e6e7","name":"Include Ping Time if Successful","func":"if (isNaN(msg.pingtime)) {\n    msg.payload = msg.CurrentTime.padEnd(28,\" \") + msg.PingStatus.padEnd(20, \" \")\n} else {\nmsg.payload = msg.CurrentTime.padEnd(28,\" \") + msg.PingStatus.padEnd(9, \" \") + msg.pingtime.toString().padEnd(11,\" \") + msg.Min.toString().padEnd(11,\" \") + msg.Max.toString().padEnd(11,\" \") + msg.RollingAverage.toString().padEnd(11,\" \")\n}\nreturn msg;","outputs":1,"noerr":0,"x":950,"y":460,"wires":[["54bcf469.64fc1c"]]},{"id":"23c83a68.f57316","type":"simpletime","z":"76e3605b.0e6e7","name":"Populate Time Messages","x":1070,"y":60,"wires":[["8ac84738.ad8f18"]]},{"id":"8ac84738.ad8f18","type":"change","z":"76e3605b.0e6e7","name":"Formated Date for ping log entry","rules":[{"t":"set","p":"CurrentTime","pt":"msg","to":"myyear\t&\"-\"&\tmymonthn\t&\"-\"&\tmydom\t&\" \"&\tmyhourpm\t&\":\"&\tmyminute\t&\":\"&\tmysecond\t&\".\"&\tmymillis\t&\" \"&\tmypm","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1050,"y":160,"wires":[["6e44be2e.917c7"]]},{"id":"833fda41.17b198","type":"rbe","z":"76e3605b.0e6e7","name":"Only write headers first time process is initiated","func":"rbe","gap":"","start":"","inout":"out","property":"filename","x":220,"y":200,"wires":[["3a6e32fc.4a089e"]]},{"id":"41c7aa38.91a0b4","type":"delay","z":"76e3605b.0e6e7","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":700,"y":60,"wires":[["f9ce45cd.70d568","48434c5b.387c44","e6f86ef9.f3af6"]]},{"id":"7c6b7df4.a02714","type":"function","z":"76e3605b.0e6e7","name":"Update Flow Results Based on Latest Input","func":"var CurrentCount = flow.get(\"Count\")\nif (!isNaN(msg.payload)) {\n    var next = Number(msg.payload)\n    if (next === 0) {\n    } else {\n        var CurrentAvg = flow.get(\"RollingAverage\")\n        var CurrentMax = flow.get(\"Max\")\n        var CurrentMin = flow.get(\"Min\")\n        var OldMax = CurrentMax\n        var OldMin = CurrentMin\n        if (CurrentCount === 0) {\n            CurrentAvg = next;\n            CurrentMin = next;\n            CurrentMax = next;\n            CurrentCount = CurrentCount + 1\n        } else {\n            oldtotal = CurrentAvg * CurrentCount\n            newtotal = next + oldtotal\n            CurrentCount = CurrentCount + 1\n            CurrentAvg = newtotal / CurrentCount\n            CurrentMax = Math.max(next, CurrentMax)\n            if (CurrentMax != OldMax) {\n                msg.NewMax = true\n            }\n            CurrentMin = Math.min(next, CurrentMin)\n            if (CurrentMin != OldMin) {\n                msg.NewMin = true\n            }\n        }\n        flow.set(\"RollingAverage\", CurrentAvg);\n        flow.set(\"Max\", CurrentMax);\n        flow.set(\"Min\", CurrentMin);\n        flow.set(\"Count\", CurrentCount);\n        msg.next = next\n        msg.RollingAverage = CurrentAvg;\n        msg.Max = CurrentMax;\n        msg.Min = CurrentMin;\n        msg.Count = CurrentCount;\n        return msg;\n    }\n}\n","outputs":1,"noerr":0,"x":230,"y":140,"wires":[["7b2187a9.5139d8"]]},{"id":"b832f02e.6f68d","type":"function","z":"76e3605b.0e6e7","name":"--Divider","func":"var a=\"-\"\na=a.padEnd(81,\"-\")\nmsg.payload = a\nreturn msg;","outputs":1,"noerr":0,"x":540,"y":280,"wires":[["54bcf469.64fc1c","11aeda74.2913e6"]]},{"id":"11aeda74.2913e6","type":"function","z":"76e3605b.0e6e7","name":"Send Header","func":"var a=\"\"\na = a + \"Date\".padEnd(28,\" \")+ \"Status\".padEnd(9,\" \")+ \"Roundtrip\".padEnd(11,\" \")+ \"Min\".padEnd(11,\" \")+ \"Max\".padEnd(11,\" \")+ \"Average\".padEnd(11,\" \")\nmsg.payload = a\nreturn msg;","outputs":1,"noerr":0,"x":530,"y":320,"wires":[["54bcf469.64fc1c"]]},{"id":"3a6e32fc.4a089e","type":"function","z":"76e3605b.0e6e7","name":"===Divider","func":"var a=\"=\"\na=a.padEnd(81,\"=\")\nmsg.payload = a\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":200,"wires":[["800cd2f0.7e6fc","54bcf469.64fc1c"]]},{"id":"f97e59e9.764a98","type":"config","z":"76e3605b.0e6e7","name":"Config output directory","properties":[{"p":"OutputDirectory","pt":"flow","to":"/CS/Uptime/","tot":"str"},{"p":"Count","pt":"flow","to":"0","tot":"num"},{"p":"Min","pt":"flow","to":"None","tot":"str"},{"p":"Max","pt":"flow","to":"None","tot":"str"},{"p":"RollingAverage","pt":"flow","to":"None","tot":"str"}],"active":true,"x":140,"y":80,"wires":[],"info":"Note: by having a config node in a subflow, this sets the flow variables for when the subflow is activated. There is no way to use the click ability of a config node in a subflow, but it does do the initial population of the variable each time the subflow is triggered. In this case because the subflow is triggered via 12 different outputs, each of the 12 is a different set of the same variables."},{"id":"81c7815c.892cd","type":"config","z":"711cdb94.5b9a04","name":"Config output directory","properties":[{"p":"OutputDirectory","pt":"flow","to":"/CS/Uptime/","tot":"str"},{"p":"Count","pt":"flow","to":"0","tot":"num"},{"p":"Min","pt":"flow","to":"None","tot":"str"},{"p":"Max","pt":"flow","to":"None","tot":"str"},{"p":"RollingAverage","pt":"flow","to":"None","tot":"str"},{"p":"downcount","pt":"flow","to":"0","tot":"str"},{"p":"calculateandwriteoutage","pt":"flow","to":"false","tot":"bool"}],"active":true,"x":140,"y":240,"wires":[],"info":" * CS 192.168.86.3\r\n * G Wifi 192.168.86.1\r\n * Emby laptop 192.168.86.2\r\n * Lennox 192.168.86.101\r\n * ATT router 192.168.1.254\r\n * Cloudflare 1.1.1.1\r\n * Level 3 4.2.2.2\r\n * Google 8.8.8.8\r\n * OpenDNS 208.67.222.222\r\n * dfw25s26-in-f19.1e100.net 172.217.9.147\r\n * ghs.googlehosted.com 172.217.9.147\r\n * "},{"id":"159589d9.1135c6","type":"GSheet","z":"711cdb94.5b9a04","creds":"adb4e9b8.8beee8","method":"append","action":"","sheet":"1ZKNZWvcBqLcxkkFSrV9JN-BAeXiGoGrDjepUyD-S5Cs","cells":"Sheet1!A2:J1000","name":"","x":1137,"y":500,"wires":[[]]},{"id":"c77a0cee.02f32","type":"function","z":"711cdb94.5b9a04","name":"Examine messages for Internet vs host down","func":"if (msg.internettarget){\n    var downCount = flow.get(\"downcount\")\n    if(!isNaN(downCount)){\n        if(downCount<6){ //it would be better and more elegant to have something count the number of internet targets and pass that in, but for now it is just hardcoded to 6\n            downCount++\n            if(downCount == 6) {\n                flow.set(\"wentdownat\",Date.now())\n                flow.set(\"internetdown\", true)\n            }\n        }\n        \n    }\n    flow.set(\"downcount\", downCount);\n    return msg;}","outputs":1,"noerr":0,"x":710,"y":53,"wires":[[]],"info":"This Node is triggered by a ping response of false (i.e. more than 5 seconds to respond and thus either the network or the target host is offline)\n\n * gets how many consecutive times the ping has shown as down\n * sets internet down as true\n * Makes sure the down count is a number (belt and suspenders that could almost certainly be removed\n * If it is not a number than nothing happens\n * If it is, the it checks to see if the number of down responses has reached 6. The 6 is how many internet hosts are being examined. I assume that if we reach 6 then it is the internet and not just one or more of the total hosts that are down. If it is already at 6 then the system is treating the internet as down aleady and no further action is required.\n * If it is less than 6, then the count is incremented\n * If incrementing it has now made the count 6, it then records (in epoch time) the time the count went from 5 to 6.\n * Finally it saves the count back into a flow variable.\n"},{"id":"2286604.c0f71a","type":"function","z":"711cdb94.5b9a04","name":"Time to report outage?","func":"if (msg.internettarget){\n    var downCount = flow.get(\"downcount\")\n    var originalDownCount = downCount\n    flow.set(\"calculateandwriteoutage\",false)\n    if(!isNaN(downCount)){\n        if(downCount > 0){\n            downCount--\n            if(downCount === 0 && flow.get(\"internetdown\")) {\n                flow.set(\"internetdown\", false)\n                flow.set(\"cameupat\",Date.now())\n                flow.set(\"calculateandwriteoutage\",true)\n            }\n        }\n    }\n    flow.set(\"downcount\", downCount);\n    if(flow.get(\"calculateandwriteoutage\")){\n        return msg;\n        \n    }\n}","outputs":1,"noerr":0,"x":760,"y":100,"wires":[["8a0a15c8.5a92d8"]],"info":"This Node is triggered by a ping response of a number (i.e. between 1 and 4999 milliseconds for a ping response)\n\n * get how many nodes are down\n * save a copy of how many nodes are down\n * Set flow variable for whether to do a calculation and output to false by default\n * Makes sure the down count is a number (belt and suspenders that could almost certainly be removed)\n * Check if the count is greater than zero\n * If it is then decrement the count\n * check if the decremented count is 0 now and that the internetdown flag is true (this flag means the down count reached 6)\n * If it is, then the internet is up enough to then this record this as the time the internet came up and set the internetdown back to false and change the flag for whether to calculated and write the outage to Gsheet to true\n * Record the down count to the flow variable"},{"id":"cfec0785.b80348","type":"switch","z":"711cdb94.5b9a04","name":"","property":"pingtargetnum","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"str"},{"t":"eq","v":"2","vt":"str"},{"t":"eq","v":"3","vt":"str"},{"t":"eq","v":"4","vt":"str"},{"t":"eq","v":"5","vt":"str"},{"t":"eq","v":"6","vt":"str"},{"t":"eq","v":"7","vt":"str"},{"t":"eq","v":"8","vt":"str"},{"t":"eq","v":"9","vt":"str"},{"t":"eq","v":"10","vt":"str"},{"t":"eq","v":"11","vt":"str"},{"t":"eq","v":"12","vt":"str"}],"checkall":"false","repair":false,"outputs":12,"x":930,"y":240,"wires":[["625ab66.59d0b48"],["c5d470b0.da92f"],["469f91ba.58236"],["6caf4611.732b98"],["59014ce7.0a1b44"],["83e3d76d.17aad8"],["25747400.0795cc"],["2c8b7f98.87f3e"],["8f9ccce1.dd365"],["c8251ad6.9dcaf8"],["f54e3165.fa3b4"],["84a64174.16425"]]},{"id":"2a8bf2f.e6a000e","type":"function","z":"711cdb94.5b9a04","name":"Calculate Duration of Outage","func":"if(flow.get(\"calculateandwriteoutage\")){\n    var duration = flow.get(\"cameupat\") - flow.get(\"wentdownat\")\n    flow.set(\"calculateandwriteoutage\",false)\n    msg.payload = duration\n    return msg;\n} \n","outputs":1,"noerr":0,"x":160,"y":580,"wires":[["9a5ed7f0.5f0c68"]]},{"id":"cd0652f2.24c1b","type":"change","z":"711cdb94.5b9a04","name":"Set Ping Status Down","rules":[{"t":"set","p":"PingStatus","pt":"msg","to":"Down","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":53,"wires":[["cfec0785.b80348","c77a0cee.02f32"]]},{"id":"625ab66.59d0b48","type":"subflow:76e3605b.0e6e7","z":"711cdb94.5b9a04","x":1150,"y":20,"wires":[]},{"id":"c5d470b0.da92f","type":"subflow:76e3605b.0e6e7","z":"711cdb94.5b9a04","name":"","x":1150,"y":60,"wires":[]},{"id":"469f91ba.58236","type":"subflow:76e3605b.0e6e7","z":"711cdb94.5b9a04","name":"","x":1150,"y":100,"wires":[]},{"id":"6caf4611.732b98","type":"subflow:76e3605b.0e6e7","z":"711cdb94.5b9a04","name":"","x":1150,"y":140,"wires":[]},{"id":"59014ce7.0a1b44","type":"subflow:76e3605b.0e6e7","z":"711cdb94.5b9a04","name":"","x":1150,"y":180,"wires":[]},{"id":"83e3d76d.17aad8","type":"subflow:76e3605b.0e6e7","z":"711cdb94.5b9a04","name":"","x":1150,"y":220,"wires":[]},{"id":"25747400.0795cc","type":"subflow:76e3605b.0e6e7","z":"711cdb94.5b9a04","name":"","x":1150,"y":260,"wires":[]},{"id":"2c8b7f98.87f3e","type":"subflow:76e3605b.0e6e7","z":"711cdb94.5b9a04","name":"","x":1150,"y":300,"wires":[]},{"id":"8f9ccce1.dd365","type":"subflow:76e3605b.0e6e7","z":"711cdb94.5b9a04","name":"","x":1150,"y":340,"wires":[]},{"id":"c8251ad6.9dcaf8","type":"subflow:76e3605b.0e6e7","z":"711cdb94.5b9a04","name":"","x":1150,"y":380,"wires":[]},{"id":"f54e3165.fa3b4","type":"subflow:76e3605b.0e6e7","z":"711cdb94.5b9a04","name":"","x":1150,"y":420,"wires":[]},{"id":"84a64174.16425","type":"subflow:76e3605b.0e6e7","z":"711cdb94.5b9a04","name":"","x":1149,"y":460,"wires":[]},{"id":"286de803.dcf568","type":"change","z":"711cdb94.5b9a04","name":"Set Ping Status Good","rules":[{"t":"set","p":"PingStatus","pt":"msg","to":"Good","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":100,"wires":[["cfec0785.b80348","2286604.c0f71a"]]},{"id":"3716f3a5.c360dc","type":"change","z":"711cdb94.5b9a04","name":"Set Ping Status Slow","rules":[{"t":"set","p":"PingStatus","pt":"msg","to":"Slow","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":140,"wires":[["cfec0785.b80348","2286604.c0f71a"]]},{"id":"9a5ed7f0.5f0c68","type":"function","z":"711cdb94.5b9a04","name":"Translate Duration Function","func":"/* \n * Create Variables\n * \n */\n        var milliseconds = msg.payload;\n        var years, weeks, days, hours, minutes, seconds, millis;\n    //creating 2 string versions of each of the durations that can be in the middle of a 1:01:01.001 duration \n    //minstr is the always 2 character one\n    //lminstr is the version that can be 1 or more characers that will be used when that part is the portion of the duration\n        var minstr, secstr, millistr, lminstr, lsecstr, lmillistr;\n        var whichcomponents, readableduration;\n\n/*\n * Calculate the numbers for the subcomponents\n * \n */\n    //by getting the remainder when dividing by 1000\n    //it leaves just the fraction of milliseconds\n        millis = milliseconds % 1000;\n    //the floor function drops the decimal portion\n    //returning the non fractional seconds\n        seconds = Math.floor(milliseconds / 1000);\n    //the floor function drops the decimal portion\n    //returning the non fractional minutes\n        minutes = Math.floor(seconds / 60);\n    //Once the minutes have been calculated, then\n    //the seconds is replaced with those seconds not\n    //accounted for by the minutes\n        seconds = seconds % 60;\n    //The same sequence as used for minutes/seconds\n    //then used to calulate minutes, hours, dayss, weeks, years\n\n        hours = Math.floor(minutes / 60);\n        minutes = minutes % 60;\n        days = Math.floor(hours / 24);\n        hours = hours % 24;\n        weeks = Math.floor(days / 7)\n        days = days % 7;\n        years = Math.floor(days / 365.25)\n        weeks = weeks % 52;\n\n/*\n * Put the subcomponents into msg payloads for easy access by later nodes\n *\n */\n        msg.years = years\n        msg.weeks = weeks\n        msg.days = days\n        msg.hours = hours\n        msg.minutes = minutes\n        msg.seconds = seconds\n        msg.millis = millis\n \n\n/*\n * create the string verssion for the subcomponents\n */\n    //milliseconds\n        lmillistr = millis.toString();\n        //put padding on the milliseconds so that 1 ms shows as .001 and not .1 when concatenated after a decimal\n            millistr = millis.toString().padStart(3, \"0\");\n    //seconds\n        lsecstr = seconds.toString();\n        //put padding on the seconds so that 1 s shows as :01.000 and not :1.000 when concatenated after a dividing :\n            secstr = lsecstr.padStart(2, \"0\");\n    //minutes\n        lminstr = minutes.toString();\n        //put padding on the minutes so that 1 m shows as :01:00.000 and not :1:00.000 when concatenated after a dividing :\n            minstr = lminstr.padStart(2, \"0\");\n\n/*\n * Build output based on largest significant populated unit\n * The general rule is to include in the output the largest unit (years, weeks, days, etc) followed by the next 2\n * smaller units if the happen to be populated\n */\n    readableduration =\"\"\n//years populated\n    if (years !== 0) { \n        if (days !== 0) {\n            if (days === 1) {\n                readableduration = \" \".concat(days.toString(), \" Day\", readableduration)\n            } else {\n                readableduration = \" \".concat(days.toString(), \" Days\", readableduration)\n            }\n        }\n        if (weeks !== 0) {\n            if (weeks === 1) {\n                readableduration = \" \".concat(weeks.toString(), \" Week\", readableduration)\n            } else {\n                readableduration = \" \".concat(weeks.toString(), \" Weeks\", readableduration)\n            }\n        }\n        if (years === 1) {\n            readableduration = years.toString().concat(\" Year\", readableduration)\n        } else {\n            readableduration = years.toString().concat(\" Years\", readableduration)\n        }\n//weeks populated\n    } else if (weeks !== 0) {\n        if (hours !== 0) {\n            if (hours === 1) {\n                readableduration = \" \".concat(hours.toString(), \" Hour\", readableduration)\n            } else {\n                readableduration = \" \".concat(hours.toString(), \" Hours\", readableduration)\n            }\n        }\n        if (days !== 0) {\n            if (weeks === 1) {\n                readableduration = \" \".concat(days.toString(), \" Day\", readableduration)\n            } else {\n                readableduration = \" \".concat(days.toString(), \" Days\", readableduration)\n            }\n        }\n        if (weeks === 1) {\n            readableduration = weeks.toString().concat(\" Week\", readableduration)\n        } else {\n            readableduration = weeks.toString().concat(\" Weeks\", readableduration)\n        }\n//days populated\n    } else if (days !== 0) {\n        if ((minutes !== 0) && (hours !== 0)) { //If both are non-zero then 1:01 format. If only 1 then either 2 hours or 1 minute\n            if (minutes !== 0) {\n                readableduration = \":\".concat(minstr, readableduration)\n            }\n            if (hours !== 0) {\n                readableduration = \" \".concat(hours.toString(), readableduration)\n            } else {\n                readableduration = \" 0\".concat(readableduration)\n            }\n        } else {\n            if (minutes === 1) {\n                readableduration = \" 1 Minute\".concat(readableduration)\n            } else if (minutes > 1) {\n                readableduration = \" \".concat(lminstr,\" Minutes\", readableduration)\n            } else if (hours === 1) {\n                readableduration = \" 1 Hour\".concat(readableduration)\n            } else {\n                if (hours >1) {\n                    readableduration = \" \".concat(hours.toString(),\" Hours\", readableduration)\n                }\n            }\n        }\n        if (days === 1) {\n            readableduration = days.toString().concat(\" Day\", readableduration)\n        } else {\n            readableduration = days.toString().concat(\" Days\", readableduration)\n        }\n//hours populated\n    } else if (hours !== 0) {\n        if ((minutes !== 0) || (seconds !== 0)) { //End result h Hours or h:mm:ss\n            readableduration = hours.toString().concat(\":\", minstr, \":\", secstr, readableduration)\n        } else {\n            if (hours === 1) {\n                readableduration = \"1 Hour\"\n            } else {\n                readableduration = hours.toString().concat(\" Hours\", readableduration)\n            }\n        }\n//minutes populated\n    } else if (minutes !== 0) { //End result m Minutes or mm:ss.MMM\n        if (seconds !== 0 || millis !== 0) { //End result h Hours or h:mm:ss\n            readableduration = lminstr.concat(\":\", secstr, \".\", millistr, readableduration)\n        } else {\n            if (minutes === 1) {\n                readableduration = \"1 Minute\".concat( readableduration)\n            } else {\n                readableduration = lminstr.concat(\" Minutes\", readableduration)\n            }\n        }\n//seconds populated\n    } else if (seconds !== 0) {\n        if (millis !== 0) { //End result s Seconds or s.MMM\n            readableduration = lsecstr.concat(\".\", millistr, \" Seconds\", readableduration)\n        } else {\n            if (seconds === 1) {\n                readableduration = \"1 Second\".concat( readableduration)\n            } else {\n                readableduration = lsecstr.concat(\" Seconds\", readableduration)\n            }\n        }\n//milliseconds populated\n    } else if (millis !== 0) {\n        if (millis !== 1) {\n            readableduration = lmillistr.concat(\" Milliseconds\", readableduration)\n        } else {\n            readableduration = \"1 Millisecond\".concat( readableduration)\n        }\n    } else {\n        readableduration = \"0\"\n    }\n    msg.years = years\n    msg.weeks = weeks\n    msg.days = days\n    msg.hours = hours\n    msg.minutes = minutes\n    msg.seconds = seconds\n    msg.millis = millis\n    msg.payload = readableduration\n    return msg;","outputs":1,"noerr":0,"x":420,"y":580,"wires":[["533989e6.19aa38"]]},{"id":"5117f3ab.9484cc","type":"switch","z":"711cdb94.5b9a04","name":"Ping Status","property":"payload","propertyType":"msg","rules":[{"t":"false"},{"t":"lt","v":"goodbad","vt":"msg"},{"t":"gte","v":"goodbad","vt":"msg"}],"checkall":"false","repair":false,"outputs":3,"x":150,"y":100,"wires":[["cd0652f2.24c1b"],["286de803.dcf568"],["3716f3a5.c360dc"]]},{"id":"45d73ffd.6779d","type":"join","z":"711cdb94.5b9a04","name":"Assemble all columns and then send to Gsheet","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"num","reduceFixup":"","x":847,"y":500,"wires":[["159589d9.1135c6"]]},{"id":"8a0a15c8.5a92d8","type":"change","z":"711cdb94.5b9a04","name":"Build Column A data","rules":[{"t":"set","p":"payload","pt":"msg","to":"Outage","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":360,"y":500,"wires":[["45d73ffd.6779d","faa029b5.b65c28"]]},{"id":"faa029b5.b65c28","type":"simpletime","z":"711cdb94.5b9a04","name":"Populate Time Messages","x":150,"y":540,"wires":[["88071c08.c524"]]},{"id":"88071c08.c524","type":"change","z":"711cdb94.5b9a04","name":"Build Date/Time for Column B","rules":[{"t":"set","p":"payload","pt":"msg","to":"myyear\t&\"-\"&\tmymonthn\t&\"-\"&\tmydom\t&\" \"&\tmyhourpm\t&\":\"&\tmyminute\t&\":\"&\tmysecond\t&\".\"&\tmymillis\t&\" \"&\tmypm","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":540,"wires":[["45d73ffd.6779d","2a8bf2f.e6a000e"]]},{"id":"533989e6.19aa38","type":"change","z":"711cdb94.5b9a04","name":"Pass Duration for Column C and send complet to Join","rules":[{"t":"set","p":"complete","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":620,"wires":[["45d73ffd.6779d"]]},{"id":"e6f86ef9.f3af6","type":"rbe","z":"76e3605b.0e6e7","name":"New Max?","func":"rbei","gap":"","start":"","inout":"out","property":"Max","x":850,"y":20,"wires":[["23c83a68.f57316"]]},{"id":"48434c5b.387c44","type":"rbe","z":"76e3605b.0e6e7","name":"New Min?","func":"rbei","gap":"","start":"","inout":"out","property":"Min","x":850,"y":60,"wires":[["23c83a68.f57316"]]},{"id":"f6c04470.d3df38","type":"inject","z":"2b2a4010.a6b5e","name":"Start Backup of All 4 Hubitat Hubs","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":220,"y":80,"wires":[["79bd7f0.4778b8"]]},{"id":"dae3700e.3752","type":"exec","z":"c3686304.f6d31","command":"/data/bashscripts/backup4hubitats.sh","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":290,"y":80,"wires":[["8061cf59.05783"],["8061cf59.05783"],["8061cf59.05783"]]},{"id":"8061cf59.05783","type":"debug","z":"c3686304.f6d31","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":550,"y":80,"wires":[]},{"id":"2808c99d.c92d26","type":"adv ping","z":"aba876af.3a45e8","name":"Ping the passed Host","host":"","x":360,"y":100,"wires":[["5992611c.d72ca","34f3f319.96490c"]]},{"id":"67721e37.f8a89","type":"inject","z":"54cae49c.6ee04c","name":"Turn Off Pinging","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"stop","payloadType":"str","x":140,"y":100,"wires":[["385c5512.c9ac4a"]]},{"id":"9d8367a6.55abe8","type":"inject","z":"54cae49c.6ee04c","name":"Start Pinging","repeat":"","crontab":"","once":true,"onceDelay":"0","topic":"","payload":"Ping","payloadType":"str","x":130,"y":60,"wires":[["385c5512.c9ac4a"]]},{"id":"81b5485a.3abc58","type":"function","z":"aba876af.3a45e8","name":"Start currentNum","func":"// check to see if the current number (currentNum is equal to the number of hosts being pinged (totalNum)\n    //when it is, reset the current number (currentNum) to the startinng number (startNum)\n    //when it is not, then increment the current number (currentNum)\n    //in both cases record the new value of the current number (currentNum) to the new value (flow.set.....)\nif (flow.get(\"currentNum\") == flow.get(\"totalNum\")){\n    flow.set(\"currentNum\", flow.get(\"startNum\"))\n}else {\n    flow.set(\"currentNum\", Number(flow.get(\"currentNum\"))+1)\n}\n/*\n*   Use the current number (cNum) as the index to get the other data for this round of pings\n*/\nvar cNum = flow.get(\"currentNum\")\n    //set ip address to be used by downstream\nmsg.host = flow.get(\"PT\"+cNum)\n    //set name to be used by downstream\nmsg.pingtarget = flow.get(\"PT\"+cNum+\"Name\")\n    //set target number to be used by downstream\nmsg.pingtargetnum = cNum\n    //set the dividing line between good and bad for the host to be pinged for use by downstream\nmsg.goodbad = flow.get(\"GoodBadPT\"+cNum)\n    //set a boolean for downstream to identify if the current target is an internet host or LAN host to be used by downstream\nmsg.internettarget = flow.get(\"InternetPT\"+cNum)\n    //show via status node which host will be pinged based on the latest output from this node\nnode.status({fill:\"green\",shape:\"dot\",text:\"Ping \"+ flow.get(\"PT\"+flow.get(\"currentNum\")+\"Name\")});\nreturn msg;\n\n/* Before refactoring\n\nif (flow.get(\"currentNum\") == flow.get(\"totalNum\")){\n    flow.set(\"currentNum\", flow.get(\"startNum\"))\n}else {\n    flow.set(\"currentNum\", Number(flow.get(\"currentNum\"))+1)\n}\nmsg.host = flow.get(\"PT\"+flow.get(\"currentNum\"))\nmsg.payload = flow.get(\"currentNum\")\nnode.status({fill:\"green\",shape:\"dot\",text:\"Ping \"+ flow.get(\"PT\"+flow.get(\"currentNum\")+\"Name\")});\nmsg.pingtarget = flow.get(\"PT\"+flow.get(\"currentNum\")+\"Name\")\nmsg.pingtargetnum = flow.get(\"currentNum\")\nmsg.goodbad = flow.get(\"GoodBadPT\"+flow.get(\"currentNum\"))\nmsg.internettarget = flow.get(\"InternetPT\"+flow.get(\"currentNum\"))\nreturn msg;\n*/","outputs":1,"noerr":0,"x":150,"y":100,"wires":[["2808c99d.c92d26"]]},{"id":"385c5512.c9ac4a","type":"trigger","z":"54cae49c.6ee04c","name":"Send request every 1s unless turned off","op1":"","op2":"0","op1type":"pay","op2type":"str","duration":"-1","extend":false,"units":"s","reset":"stop","bytopic":"all","outputs":1,"x":460,"y":60,"wires":[["eb8fea44.7fab68"]]},{"id":"eb8fea44.7fab68","type":"subflow:aba876af.3a45e8","z":"54cae49c.6ee04c","name":"","env":[],"x":910,"y":60,"wires":[]},{"id":"3ab1249d.86543c","type":"config","z":"aba876af.3a45e8","name":"Config ping targets","properties":[{"p":"PT1Name","pt":"flow","to":"Central Services","tot":"str"},{"p":"PT1","pt":"flow","to":"192.168.86.3","tot":"str"},{"p":"PT2Name","pt":"flow","to":"Google Wifi","tot":"str"},{"p":"PT2","pt":"flow","to":"192.168.86.1","tot":"str"},{"p":"PT3Name","pt":"flow","to":"Emby","tot":"str"},{"p":"PT3","pt":"flow","to":"192.168.86.2","tot":"str"},{"p":"PT4Name","pt":"flow","to":"Lennox Themostat","tot":"str"},{"p":"PT4","pt":"flow","to":"192.168.86.101","tot":"str"},{"p":"PT5Name","pt":"flow","to":"AT&T router ","tot":"str"},{"p":"PT5","pt":"flow","to":"192.168.1.254","tot":"str"},{"p":"PT6Name","pt":"flow","to":"Cloudflare ","tot":"str"},{"p":"PT6","pt":"flow","to":"1.1.1.1","tot":"str"},{"p":"PT7Name","pt":"flow","to":"Level 3","tot":"str"},{"p":"PT7","pt":"flow","to":"4.2.2.2","tot":"str"},{"p":"PT8Name","pt":"flow","to":"Google","tot":"str"},{"p":"PT8","pt":"flow","to":"8.8.8.8","tot":"str"},{"p":"PT9Name","pt":"flow","to":"OpenDNS","tot":"str"},{"p":"PT9","pt":"flow","to":"208.67.222.222","tot":"str"},{"p":"PT10Name","pt":"flow","to":"dfw25 (near google hosted)","tot":"str"},{"p":"PT10","pt":"flow","to":"172.217.9.147","tot":"str"},{"p":"PT11Name","pt":"flow","to":"ghs.googlehosted.com","tot":"str"},{"p":"PT11","pt":"flow","to":"172.217.9.179","tot":"str"},{"p":"startNum","pt":"flow","to":"1","tot":"str"},{"p":"totalNum","pt":"flow","to":"11","tot":"str"},{"p":"currentNum","pt":"flow","to":"","tot":"str"}],"active":true,"x":110,"y":140,"wires":[],"info":"Note: by having a config node in a subflow, this sets the flow variables for when the subflow is activated. There is no way to use the click ability of a config node in a subflow, but it does do the initial population of the variable each time the subflow is triggered. In this case because the subflow is triggered via 12 different outputs, each of the 12 is a different set of the same variables."},{"id":"ae97e491.065718","type":"config","z":"aba876af.3a45e8","name":"Config Good/Bad Dividing Lines by Ping Target","properties":[{"p":"GoodBadPT1","pt":"flow","to":"1","tot":"num"},{"p":"GoodBadPT2","pt":"flow","to":"500","tot":"num"},{"p":"GoodBadPT3","pt":"flow","to":"500","tot":"num"},{"p":"GoodBadPT4","pt":"flow","to":"4500","tot":"num"},{"p":"GoodBadPT5","pt":"flow","to":"2000","tot":"num"},{"p":"GoodBadPT6","pt":"flow","to":"1000","tot":"num"},{"p":"GoodBadPT7","pt":"flow","to":"1000","tot":"num"},{"p":"GoodBadPT8","pt":"flow","to":"1000","tot":"num"},{"p":"GoodBadPT9","pt":"flow","to":"1000","tot":"num"},{"p":"GoodBadPT10","pt":"flow","to":"1000","tot":"num"},{"p":"GoodBadPT11","pt":"flow","to":"1000","tot":"num"}],"active":true,"x":200,"y":180,"wires":[],"info":"Note: by having a config node in a subflow, this sets the flow variables for when the subflow is activated. There is no way to use the click ability of a config node in a subflow, but it does do the initial population of the variable each time the subflow is triggered. In this case because the subflow is triggered via 12 different outputs, each of the 12 is a different set of the same variables."},{"id":"cc5cceb1.282c3","type":"config","z":"aba876af.3a45e8","name":"Config If Target Counts toward down Internet Tracking","properties":[{"p":"InternetPT1","pt":"flow","to":"false","tot":"bool"},{"p":"InternetPT2","pt":"flow","to":"false","tot":"bool"},{"p":"InternetPT3","pt":"flow","to":"false","tot":"bool"},{"p":"InternetPT4","pt":"flow","to":"false","tot":"bool"},{"p":"InternetPT5","pt":"flow","to":"false","tot":"bool"},{"p":"InternetPT6","pt":"flow","to":"true","tot":"bool"},{"p":"InternetPT7","pt":"flow","to":"true","tot":"bool"},{"p":"InternetPT8","pt":"flow","to":"true","tot":"bool"},{"p":"InternetPT9","pt":"flow","to":"true","tot":"bool"},{"p":"InternetPT10","pt":"flow","to":"true","tot":"bool"},{"p":"InternetPT11","pt":"flow","to":"true","tot":"bool"}],"active":true,"x":220,"y":220,"wires":[],"info":"Note: by having a config node in a subflow, this sets the flow variables for when the subflow is activated. There is no way to use the click ability of a config node in a subflow, but it does do the initial population of the variable each time the subflow is triggered. In this case because the subflow is triggered via 12 different outputs, each of the 12 is a different set of the same variables."},{"id":"8c5abc2f.833c4","type":"GSheet","z":"aba876af.3a45e8","creds":"adb4e9b8.8beee8","method":"append","action":"","sheet":"1ZKNZWvcBqLcxkkFSrV9JN-BAeXiGoGrDjepUyD-S5Cs","cells":"Sheet1!A2:J1000","name":"","x":890,"y":340,"wires":[[]]},{"id":"36301876.b0d678","type":"function","z":"aba876af.3a45e8","name":"Examine messages for Internet vs host down","func":"// Conceptually the flow is keeping track of how many down internet hosts there are per the ping results.\n// This function does 2/3rds of that process whenever it is triggered. It is triggered when the ping status node recieves a false instead of a numeric quantity from the ping result.\n// The 3 things this funtion does are:\n//      1. increment the down count\n//      2. record the time/date the down count reached 6 (which indicates that all of the internet hosts did not reply to a ping)\n//      3. set the flow variable that the internet is down\n\nif (msg.internettarget){\n    var downCount = flow.get(\"downcount\")\n    if(!isNaN(downCount)){\n        if(downCount<6){ //it would be better and more elegant to have something count the number of internet targets and pass that in, but for now it is just hardcoded to 6\n            downCount++\n            if(downCount == 6) {\n                flow.set(\"wentdownat\",Date.now())\n                flow.set(\"internetdown\", true)\n            }\n        }\n    }\n    flow.set(\"downcount\", downCount);\n    return msg;}\n    \n    /* Before refactor\n    if (msg.internettarget){\n    var downCount = flow.get(\"downcount\")\n    if(!isNaN(downCount)){\n        if(downCount<6){ //it would be better and more elegant to have something count the number of internet targets and pass that in, but for now it is just hardcoded to 6\n            downCount++\n            if(downCount == 6) {\n                flow.set(\"wentdownat\",Date.now())\n                flow.set(\"internetdown\", true)\n            }\n        }\n        \n    }\n    flow.set(\"downcount\", downCount);\n    return msg;}\n    */","outputs":1,"noerr":0,"x":670,"y":20,"wires":[[]],"info":"This Node is triggered by a ping response of false (i.e. more than 5 seconds to respond and thus either the network or the target host is offline)\n\n * gets how many consecutive times the ping has shown as down\n * sets internet down as true\n * Makes sure the down count is a number (belt and suspenders that could almost certainly be removed\n * If it is not a number than nothing happens\n * If it is, the it checks to see if the number of down responses has reached 6. The 6 is how many internet hosts are being examined. I assume that if we reach 6 then it is the internet and not just one or more of the total hosts that are down. If it is already at 6 then the system is treating the internet as down aleady and no further action is required.\n * If it is less than 6, then the count is incremented\n * If incrementing it has now made the count 6, it then records (in epoch time) the time the count went from 5 to 6.\n * Finally it saves the count back into a flow variable.\n"},{"id":"a8e0ea25.6b4598","type":"function","z":"aba876af.3a45e8","name":"Time to report outage?","func":"// Conceptually the flow is keeping track of how many down internet hosts there are per the ping results.\n// This function does 1/4th of that process whenever it is triggered. It is triggered when the ping status node recieves a  numeric quantity from the ping result.\n// The 3 things this funtion does are:\n//      1. decrement the down count\n//      2. whenever the down count reaches 0 and the internet down boolean is true, then this means the internet is back up so then:\n//          a. set internet down boolean back to false\n//          b. record the time/date it came back up\n//          c. set the boolean that it is time to write the outage (to google sheet) to true\n//      3. set the flow variable that the internet is down\n\nif (msg.internettarget){\n    var downCount = flow.get(\"downcount\")\n    var originalDownCount = downCount\n    flow.set(\"calculateandwriteoutage\",false)\n    if(!isNaN(downCount)){\n        if(downCount > 0){\n            downCount--\n            if(downCount === 0 && flow.get(\"internetdown\")) {\n                flow.set(\"internetdown\", false)\n                flow.set(\"cameupat\",Date.now())\n                flow.set(\"calculateandwriteoutage\",true)\n            }\n        }\n    }\n    flow.set(\"downcount\", downCount);\n//note a msg is passed along to the write to google portion of the flow only if the calculate and write outage boolean is true\n//by note returning a msg, that portion of the flow is otherwise not triggered\n    if(flow.get(\"calculateandwriteoutage\")){\n        return msg;\n    }\n}\n\n\n/*Before refactor\nif (msg.internettarget){\n    var downCount = flow.get(\"downcount\")\n    var originalDownCount = downCount\n    flow.set(\"calculateandwriteoutage\",false)\n    if(!isNaN(downCount)){\n        if(downCount > 0){\n            downCount--\n            if(downCount === 0 && flow.get(\"internetdown\")) {\n                flow.set(\"internetdown\", false)\n                flow.set(\"cameupat\",Date.now())\n                flow.set(\"calculateandwriteoutage\",true)\n            }\n        }\n    }\n    flow.set(\"downcount\", downCount);\n    if(flow.get(\"calculateandwriteoutage\")){\n        return msg;\n        \n    }\n}\n*/","outputs":1,"noerr":0,"x":740,"y":200,"wires":[["49386f9d.e406"]],"info":"This Node is triggered by a ping response of a number (i.e. between 1 and 4999 milliseconds for a ping response)\n\n * get how many nodes are down\n * save a copy of how many nodes are down\n * Set flow variable for whether to do a calculation and output to false by default\n * Makes sure the down count is a number (belt and suspenders that could almost certainly be removed)\n * Check if the count is greater than zero\n * If it is then decrement the count\n * check if the decremented count is 0 now and that the internetdown flag is true (this flag means the down count reached 6)\n * If it is, then the internet is up enough to then this record this as the time the internet came up and set the internetdown back to false and change the flag for whether to calculated and write the outage to Gsheet to true\n * Record the down count to the flow variable"},{"id":"e23234f9.e2e198","type":"switch","z":"aba876af.3a45e8","name":"","property":"pingtargetnum","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"str"},{"t":"eq","v":"2","vt":"str"},{"t":"eq","v":"3","vt":"str"},{"t":"eq","v":"4","vt":"str"},{"t":"eq","v":"5","vt":"str"},{"t":"eq","v":"6","vt":"str"},{"t":"eq","v":"7","vt":"str"},{"t":"eq","v":"8","vt":"str"},{"t":"eq","v":"9","vt":"str"},{"t":"eq","v":"10","vt":"str"},{"t":"eq","v":"11","vt":"str"},{"t":"eq","v":"12","vt":"str"}],"checkall":"false","repair":false,"outputs":12,"x":970,"y":100,"wires":[["3838a30d.96e3ec"],["fe23a693.782e18"],["1c3e1fb5.2eb41"],["2aa59192.460dde"],["86a51f60.f66ee"],["f5b3dcb3.7054e"],["1b3bd6d1.3f1d89"],["4192675e.f2a288"],["77eed45b.16a24c"],["f527a986.c0db98"],["7d4621ff.a0f4d"],["12c58136.35d53f"]]},{"id":"31ff04f7.29ffec","type":"function","z":"aba876af.3a45e8","name":"Calculate Duration of Outage","func":"//This function makes sure it should be doing the calculate, then calculates the duration of the outage turns of the calculate flag and sends on the duration\n//This calculation could probably be moved back to the Time to report outage? node\nif(flow.get(\"calculateandwriteoutage\")){\n    var duration = flow.get(\"cameupat\") - flow.get(\"wentdownat\")\n    flow.set(\"calculateandwriteoutage\",false)\n    msg.payload = duration\n    return msg;\n}","outputs":1,"noerr":0,"x":160,"y":380,"wires":[["a927b98b.7807d8"]]},{"id":"8fa076b9.4abe38","type":"change","z":"aba876af.3a45e8","name":"Set Ping Status Down","rules":[{"t":"set","p":"PingStatus","pt":"msg","to":"Down","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":60,"wires":[["e23234f9.e2e198","36301876.b0d678","ffcbe690.d32758"]]},{"id":"3838a30d.96e3ec","type":"subflow:76e3605b.0e6e7","z":"aba876af.3a45e8","x":1190,"y":20,"wires":[]},{"id":"fe23a693.782e18","type":"subflow:76e3605b.0e6e7","z":"aba876af.3a45e8","name":"","x":1190,"y":60,"wires":[]},{"id":"1c3e1fb5.2eb41","type":"subflow:76e3605b.0e6e7","z":"aba876af.3a45e8","name":"","x":1190,"y":100,"wires":[]},{"id":"2aa59192.460dde","type":"subflow:76e3605b.0e6e7","z":"aba876af.3a45e8","name":"","x":1190,"y":140,"wires":[]},{"id":"86a51f60.f66ee","type":"subflow:76e3605b.0e6e7","z":"aba876af.3a45e8","name":"","x":1190,"y":180,"wires":[]},{"id":"f5b3dcb3.7054e","type":"subflow:76e3605b.0e6e7","z":"aba876af.3a45e8","name":"","x":1190,"y":220,"wires":[]},{"id":"1b3bd6d1.3f1d89","type":"subflow:76e3605b.0e6e7","z":"aba876af.3a45e8","name":"","x":1190,"y":260,"wires":[]},{"id":"4192675e.f2a288","type":"subflow:76e3605b.0e6e7","z":"aba876af.3a45e8","name":"","x":1190,"y":300,"wires":[]},{"id":"77eed45b.16a24c","type":"subflow:76e3605b.0e6e7","z":"aba876af.3a45e8","name":"","x":1190,"y":340,"wires":[]},{"id":"f527a986.c0db98","type":"subflow:76e3605b.0e6e7","z":"aba876af.3a45e8","name":"","x":1190,"y":380,"wires":[]},{"id":"7d4621ff.a0f4d","type":"subflow:76e3605b.0e6e7","z":"aba876af.3a45e8","name":"","x":1190,"y":420,"wires":[]},{"id":"12c58136.35d53f","type":"subflow:76e3605b.0e6e7","z":"aba876af.3a45e8","name":"","x":1189,"y":460,"wires":[]},{"id":"121af4fc.20aceb","type":"change","z":"aba876af.3a45e8","name":"Set Ping Status Good","rules":[{"t":"set","p":"PingStatus","pt":"msg","to":"Good","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":100,"wires":[["e23234f9.e2e198","a8e0ea25.6b4598","d9ed9f5c.50725","ffcbe690.d32758"]]},{"id":"7eadecfd.6684c4","type":"change","z":"aba876af.3a45e8","name":"Set Ping Status Slow","rules":[{"t":"set","p":"PingStatus","pt":"msg","to":"Slow","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":140,"wires":[["e23234f9.e2e198","a8e0ea25.6b4598","d9ed9f5c.50725","ffcbe690.d32758"]]},{"id":"a927b98b.7807d8","type":"function","z":"aba876af.3a45e8","name":"Translate Duration Function","func":"//This function translates a duration into a friendly person readable format\n/* \n * Create Variables\n * \n */\n        var milliseconds = msg.payload;\n        var years, weeks, days, hours, minutes, seconds, millis;\n    //creating 2 string versions of each of the durations that can be in the middle of a 1:01:01.001 duration \n    //minstr is the always 2 character one\n    //lminstr is the version that can be 1 or more characers that will be used when that part is the portion of the duration\n        var minstr, secstr, millistr, lminstr, lsecstr, lmillistr;\n        var whichcomponents, readableduration;\n\n/*\n * Calculate the numbers for the subcomponents\n * \n */\n    //by getting the remainder when dividing by 1000\n    //it leaves just the fraction of milliseconds\n        millis = milliseconds % 1000;\n    //the floor function drops the decimal portion\n    //returning the non fractional seconds\n        seconds = Math.floor(milliseconds / 1000);\n    //the floor function drops the decimal portion\n    //returning the non fractional minutes\n        minutes = Math.floor(seconds / 60);\n    //Once the minutes have been calculated, then\n    //the seconds is replaced with those seconds not\n    //accounted for by the minutes\n        seconds = seconds % 60;\n    //The same sequence as used for minutes/seconds\n    //then used to calulate minutes, hours, dayss, weeks, years\n\n        hours = Math.floor(minutes / 60);\n        minutes = minutes % 60;\n        days = Math.floor(hours / 24);\n        hours = hours % 24;\n        weeks = Math.floor(days / 7)\n        days = days % 7;\n        years = Math.floor(days / 365.25)\n        weeks = weeks % 52;\n\n/*\n * Put the subcomponents into msg payloads for easy access by later nodes\n *\n */\n        msg.years = years\n        msg.weeks = weeks\n        msg.days = days\n        msg.hours = hours\n        msg.minutes = minutes\n        msg.seconds = seconds\n        msg.millis = millis\n \n\n/*\n * create the string verssion for the subcomponents\n */\n    //milliseconds\n        lmillistr = millis.toString();\n        //put padding on the milliseconds so that 1 ms shows as .001 and not .1 when concatenated after a decimal\n            millistr = millis.toString().padStart(3, \"0\");\n    //seconds\n        lsecstr = seconds.toString();\n        //put padding on the seconds so that 1 s shows as :01.000 and not :1.000 when concatenated after a dividing :\n            secstr = lsecstr.padStart(2, \"0\");\n    //minutes\n        lminstr = minutes.toString();\n        //put padding on the minutes so that 1 m shows as :01:00.000 and not :1:00.000 when concatenated after a dividing :\n            minstr = lminstr.padStart(2, \"0\");\n\n/*\n * Build output based on largest significant populated unit\n * The general rule is to include in the output the largest unit (years, weeks, days, etc) followed by the next 2\n * smaller units if the happen to be populated\n */\n    readableduration =\"\"\n//years populated\n    if (years !== 0) { \n        if (days !== 0) {\n            if (days === 1) {\n                readableduration = \" \".concat(days.toString(), \" Day\", readableduration)\n            } else {\n                readableduration = \" \".concat(days.toString(), \" Days\", readableduration)\n            }\n        }\n        if (weeks !== 0) {\n            if (weeks === 1) {\n                readableduration = \" \".concat(weeks.toString(), \" Week\", readableduration)\n            } else {\n                readableduration = \" \".concat(weeks.toString(), \" Weeks\", readableduration)\n            }\n        }\n        if (years === 1) {\n            readableduration = years.toString().concat(\" Year\", readableduration)\n        } else {\n            readableduration = years.toString().concat(\" Years\", readableduration)\n        }\n//weeks populated\n    } else if (weeks !== 0) {\n        if (hours !== 0) {\n            if (hours === 1) {\n                readableduration = \" \".concat(hours.toString(), \" Hour\", readableduration)\n            } else {\n                readableduration = \" \".concat(hours.toString(), \" Hours\", readableduration)\n            }\n        }\n        if (days !== 0) {\n            if (weeks === 1) {\n                readableduration = \" \".concat(days.toString(), \" Day\", readableduration)\n            } else {\n                readableduration = \" \".concat(days.toString(), \" Days\", readableduration)\n            }\n        }\n        if (weeks === 1) {\n            readableduration = weeks.toString().concat(\" Week\", readableduration)\n        } else {\n            readableduration = weeks.toString().concat(\" Weeks\", readableduration)\n        }\n//days populated\n    } else if (days !== 0) {\n        if ((minutes !== 0) && (hours !== 0)) { //If both are non-zero then 1:01 format. If only 1 then either 2 hours or 1 minute\n            if (minutes !== 0) {\n                readableduration = \":\".concat(minstr, readableduration)\n            }\n            if (hours !== 0) {\n                readableduration = \" \".concat(hours.toString(), readableduration)\n            } else {\n                readableduration = \" 0\".concat(readableduration)\n            }\n        } else {\n            if (minutes === 1) {\n                readableduration = \" 1 Minute\".concat(readableduration)\n            } else if (minutes > 1) {\n                readableduration = \" \".concat(lminstr,\" Minutes\", readableduration)\n            } else if (hours === 1) {\n                readableduration = \" 1 Hour\".concat(readableduration)\n            } else {\n                if (hours >1) {\n                    readableduration = \" \".concat(hours.toString(),\" Hours\", readableduration)\n                }\n            }\n        }\n        if (days === 1) {\n            readableduration = days.toString().concat(\" Day\", readableduration)\n        } else {\n            readableduration = days.toString().concat(\" Days\", readableduration)\n        }\n//hours populated\n    } else if (hours !== 0) {\n        if ((minutes !== 0) || (seconds !== 0)) { //End result h Hours or h:mm:ss\n            readableduration = hours.toString().concat(\":\", minstr, \":\", secstr, readableduration)\n        } else {\n            if (hours === 1) {\n                readableduration = \"1 Hour\"\n            } else {\n                readableduration = hours.toString().concat(\" Hours\", readableduration)\n            }\n        }\n//minutes populated\n    } else if (minutes !== 0) { //End result m Minutes or mm:ss.MMM\n        if (seconds !== 0 || millis !== 0) { //End result h Hours or h:mm:ss\n            readableduration = lminstr.concat(\":\", secstr, \".\", millistr, readableduration)\n        } else {\n            if (minutes === 1) {\n                readableduration = \"1 Minute\".concat( readableduration)\n            } else {\n                readableduration = lminstr.concat(\" Minutes\", readableduration)\n            }\n        }\n//seconds populated\n    } else if (seconds !== 0) {\n        if (millis !== 0) { //End result s Seconds or s.MMM\n            readableduration = lsecstr.concat(\".\", millistr, \" Seconds\", readableduration)\n        } else {\n            if (seconds === 1) {\n                readableduration = \"1 Second\".concat( readableduration)\n            } else {\n                readableduration = lsecstr.concat(\" Seconds\", readableduration)\n            }\n        }\n//milliseconds populated\n    } else if (millis !== 0) {\n        if (millis !== 1) {\n            readableduration = lmillistr.concat(\" Milliseconds\", readableduration)\n        } else {\n            readableduration = \"1 Millisecond\".concat( readableduration)\n        }\n    } else {\n        readableduration = \"0\"\n    }\n    msg.years = years\n    msg.weeks = weeks\n    msg.days = days\n    msg.hours = hours\n    msg.minutes = minutes\n    msg.seconds = seconds\n    msg.millis = millis\n    msg.payload = readableduration\n    return msg;","outputs":1,"noerr":0,"x":420,"y":380,"wires":[["10b233e9.17db8c"]]},{"id":"5992611c.d72ca","type":"switch","z":"aba876af.3a45e8","name":"Ping Status","property":"payload","propertyType":"msg","rules":[{"t":"false"},{"t":"lt","v":"goodbad","vt":"msg"},{"t":"gte","v":"goodbad","vt":"msg"}],"checkall":"false","repair":false,"outputs":3,"x":550,"y":100,"wires":[["8fa076b9.4abe38"],["121af4fc.20aceb"],["7eadecfd.6684c4"]]},{"id":"de3cd25d.34a83","type":"join","z":"aba876af.3a45e8","name":"Assemble all columns and then send to Gsheet","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"num","reduceFixup":"","x":800,"y":280,"wires":[["8c5abc2f.833c4"]]},{"id":"49386f9d.e406","type":"change","z":"aba876af.3a45e8","name":"Build Column A data","rules":[{"t":"set","p":"payload","pt":"msg","to":"Outage","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":140,"y":280,"wires":[["de3cd25d.34a83","9aa9821b.c03f1"]]},{"id":"9aa9821b.c03f1","type":"simpletime","z":"aba876af.3a45e8","name":"Populate Time Messages","x":150,"y":340,"wires":[["7e0f855b.bdf2dc"]]},{"id":"7e0f855b.bdf2dc","type":"change","z":"aba876af.3a45e8","name":"Build Date/Time for Column B","rules":[{"t":"set","p":"payload","pt":"msg","to":"myyear\t&\"-\"&\tmymonthn\t&\"-\"&\tmydom\t&\" \"&\tmyhourpm\t&\":\"&\tmyminute\t&\":\"&\tmysecond\t&\".\"&\tmymillis\t&\" \"&\tmypm","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":340,"wires":[["de3cd25d.34a83","31ff04f7.29ffec"]]},{"id":"10b233e9.17db8c","type":"change","z":"aba876af.3a45e8","name":"Pass Duration for Column C and send complet to Join","rules":[{"t":"set","p":"complete","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":420,"wires":[["de3cd25d.34a83"]]},{"id":"79bd7f0.4778b8","type":"subflow:c3686304.f6d31","z":"2b2a4010.a6b5e","name":"","env":[],"x":560,"y":80,"wires":[]},{"id":"4ba5918f.c183f","type":"comment","z":"54cae49c.6ee04c","name":"Ping 11 IP addresses","info":"This starts automatically but can be stopped via the Turn Off Pinging injection node.","x":140,"y":20,"wires":[]},{"id":"34f3f319.96490c","type":"function","z":"aba876af.3a45e8","name":"Format Internet UpDown for InfluxDB","func":"//This function checks if the pinged target is an internet host of local to the LAN host and then only does something for internet hosts\n//Assuming it is an internet host it creates input to be sent to the InfluxDB. This includes the hostname, IP address and 2 indicators of if the pinged target responded or not\n//At least for now both a boolean and numeric are sent as Chronograf doesn't seem to know how to handle boolean, but hopefully Grafana with discrete plugin will\nvar targetIP = msg.topic\nvar targetName = msg.pingtarget\nvar pingresult = msg.payload\nif (msg.internettarget) {\n    if (pingresult) {\n        combinedObj = [\n            {\n                Connected: true,\n                ConnectedNumeric: 1\n            },\n            {\n                TargetName: targetName,\n                TargetIPAddress: targetIP\n            }\n        ];\n    } else {\n        combinedObj = [\n            {\n                Connected: false,\n                ConnectedNumeric: 0\n            },\n            {\n                TargetName: targetName,\n                TargetIPAddress: targetIP\n            }\n        ];\n    }\n    msg.payload = combinedObj\n    return msg;\n}","outputs":1,"noerr":0,"x":430,"y":600,"wires":[["eda2c0bf.ab20c"]]},{"id":"d9ed9f5c.50725","type":"function","z":"aba876af.3a45e8","name":"Prepare Ping Duration for InfluxDB","func":"//This function creates input to be sent to the InfluxDB. This includes the hostname, IP address and the roundtrip time of the ping\nvar targetIP = msg.topic\nvar duration = msg.payload\nvar targetName = msg.pingtarget\nvar combinedObj;\ncombinedObj = [\n    {\n        RountripDuration: duration\n    },\n    {\n        TargetName: targetName,\n        TargetIPAddress: targetIP\n    }\n];\nmsg.payload = combinedObj\nreturn msg;","outputs":1,"noerr":0,"x":720,"y":520,"wires":[["eda2c0bf.ab20c"]]},{"id":"eda2c0bf.ab20c","type":"influxdb out","z":"aba876af.3a45e8","influxdb":"430b7850.44c1a8","name":"","measurement":"NetworkUptime","precision":"","retentionPolicy":"","x":1030,"y":600,"wires":[]},{"id":"ffcbe690.d32758","type":"function","z":"aba876af.3a45e8","name":"Populate Status Details","func":"msg.payload = \"Latest Ping Quality: \" + msg.PingStatus + \" (\"+ msg.payload+\")\"\nreturn msg;","outputs":1,"noerr":0,"x":1070,"y":520,"wires":[[]]},{"id":"4b143d5a.e11b54","type":"hubitat command","z":"98a6e865.a02ea8","g":"f2d9165a.c6adf8","name":"Mike Bedside","server":"55e4481a.722098","deviceId":"257","command":"","commandArgs":"","x":860,"y":680,"wires":[[]]},{"id":"53de30cb.5a905","type":"hubitat device","z":"98a6e865.a02ea8","g":"f2d9165a.c6adf8","name":"Mike Bedside Currently?","server":"55e4481a.722098","deviceId":"257","attribute":"switch","sendEvent":false,"x":410,"y":680,"wires":[["8c38df2a.5984b"]]},{"id":"8c38df2a.5984b","type":"switch","z":"98a6e865.a02ea8","g":"f2d9165a.c6adf8","name":"Off/On","property":"payload.value","propertyType":"msg","rules":[{"t":"eq","v":"off","vt":"str"},{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":590,"y":680,"wires":[["91cf3e9c.c1ae1"],["349ff253.9b9a7e"]]},{"id":"91cf3e9c.c1ae1","type":"change","z":"98a6e865.a02ea8","g":"f2d9165a.c6adf8","name":"On","rules":[{"t":"set","p":"command","pt":"msg","to":"on","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":710,"y":660,"wires":[["4b143d5a.e11b54"]]},{"id":"349ff253.9b9a7e","type":"change","z":"98a6e865.a02ea8","g":"f2d9165a.c6adf8","name":"Off","rules":[{"t":"set","p":"command","pt":"msg","to":"off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":710,"y":700,"wires":[["4b143d5a.e11b54"]]},{"id":"323994d.e2eaa6c","type":"hubitat device","z":"98a6e865.a02ea8","g":"f2d9165a.c6adf8","name":"Aqara button pushed","server":"55e4481a.722098","deviceId":"356","attribute":"pushed","sendEvent":true,"x":160,"y":680,"wires":[[]]},{"id":"d430a9c7.458158","type":"comment","z":"98a6e865.a02ea8","g":"f2d9165a.c6adf8","name":"Push of Aqara button toggles the switch controlling Mike's beside lamp","info":"","x":310,"y":640,"wires":[]},{"id":"db5d9766.57c9f8","type":"inject","z":"1a0aa13a.9d7b8f","name":"Initiate Check every 5 sec","repeat":"5","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"1","payloadType":"num","x":180,"y":100,"wires":[["da8cbc87.ae3a5"]]},{"id":"de53fc38.e8dfb","type":"ui_button","z":"1a0aa13a.9d7b8f","name":"Start/Restart","group":"3ac6140a.a2989c","order":1,"width":3,"height":1,"passthru":false,"label":"Start/Restart","tooltip":"","color":"","bgcolor":"Green","icon":"","payload":"1","payloadType":"num","topic":"","x":90,"y":220,"wires":[["92dd4796.6f9b78"]]},{"id":"876a7f0f.97ec","type":"ui_button","z":"1a0aa13a.9d7b8f","name":"Manual Update Frisco","group":"3ac6140a.a2989c","order":3,"width":3,"height":1,"passthru":false,"label":"Update Frisco","tooltip":"","color":"","bgcolor":"#163e80","icon":"","payload":"1","payloadType":"num","topic":"","x":120,"y":460,"wires":[["e3a36dc7.11be4"]]},{"id":"92dd4796.6f9b78","type":"function","z":"1a0aa13a.9d7b8f","name":"flow.set(\"status\",\"run\");","func":"flow.set(\"status\",\"run\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":280,"y":220,"wires":[[]]},{"id":"b95d43d.3a36dc","type":"function","z":"1a0aa13a.9d7b8f","name":"flow.set(\"status\",\"stopped\");","func":"flow.set(\"status\",\"stopped\");\nreturn msg;","outputs":1,"noerr":0,"x":300,"y":300,"wires":[[]]},{"id":"da8cbc87.ae3a5","type":"function","z":"1a0aa13a.9d7b8f","name":"Pass request if status is run","func":"var status = flow.get(\"status\")||\"stopped\";\n\nif (status==\"run\") {\n   msg.payload = 1;\n   return msg;\n}","outputs":1,"noerr":0,"x":440,"y":100,"wires":[["2c536eac.962c32"]]},{"id":"cccb923b.d858e","type":"ui_button","z":"1a0aa13a.9d7b8f","name":"No filter","group":"4baf1468.abb01c","order":1,"width":0,"height":0,"passthru":false,"label":"No filter","tooltip":"","color":"","bgcolor":"","icon":"","payload":"1","payloadType":"num","topic":"none","x":80,"y":660,"wires":[["d5ba20b1.2a352"]]},{"id":"aa86cd79.d94ad","type":"ui_button","z":"1a0aa13a.9d7b8f","name":"DFW","group":"4baf1468.abb01c","order":2,"width":3,"height":1,"passthru":false,"label":"DFW","tooltip":"Dallas/Fort Worth","color":"","bgcolor":"#163e80","icon":"","payload":"1","payloadType":"num","topic":"DFW","x":70,"y":700,"wires":[["d5ba20b1.2a352"]]},{"id":"27435c82.f51e34","type":"ui_button","z":"1a0aa13a.9d7b8f","name":"DAL","group":"4baf1468.abb01c","order":3,"width":3,"height":1,"passthru":false,"label":"DAL","tooltip":"Love Field","color":"","bgcolor":"#dec733","icon":"","payload":"1","payloadType":"num","topic":"DAL","x":70,"y":740,"wires":[["d5ba20b1.2a352"]]},{"id":"d5ba20b1.2a352","type":"function","z":"1a0aa13a.9d7b8f","name":"","func":"flow.set(\"filter\",msg.topic);\nreturn msg;","outputs":1,"noerr":0,"x":250,"y":660,"wires":[["93bd58c2.f4fe18"]]},{"id":"93bd58c2.f4fe18","type":"function","z":"1a0aa13a.9d7b8f","name":"Clear the map","func":"var command = {clear :(\"Planes\")};\nmsg.payload ={command};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":440,"y":620,"wires":[["be318435.10d8b8"]]},{"id":"caee0f1a.07ba8","type":"ui_button","z":"1a0aa13a.9d7b8f","name":"AUS","group":"4baf1468.abb01c","order":4,"width":3,"height":1,"passthru":false,"label":"AUS","tooltip":"Austin","color":"","bgcolor":"#e3a209","icon":"","payload":"1","payloadType":"num","topic":"AUS","x":70,"y":780,"wires":[["d5ba20b1.2a352"]]},{"id":"f9d66341.1059a","type":"ui_button","z":"1a0aa13a.9d7b8f","name":"ADK","group":"4baf1468.abb01c","order":5,"width":3,"height":1,"passthru":false,"label":"ADK","tooltip":"Adak","color":"black","bgcolor":"#03fff2","icon":"","payload":"1","payloadType":"num","topic":"ADK","x":70,"y":820,"wires":[["d5ba20b1.2a352"]]},{"id":"8e440b7b.6ab8f8","type":"ui_button","z":"1a0aa13a.9d7b8f","name":"Clear Map","group":"3ac6140a.a2989c","order":6,"width":3,"height":1,"passthru":false,"label":"Clear Map","tooltip":"","color":"","bgcolor":"","icon":"","payload":"unknown","payloadType":"str","topic":"","x":90,"y":620,"wires":[["93bd58c2.f4fe18"]]},{"id":"4140806e.6466f","type":"function","z":"1a0aa13a.9d7b8f","name":"","func":"flow.set(\"filter_ac_type\",msg.topic);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":250,"y":860,"wires":[["93bd58c2.f4fe18"]]},{"id":"ba4470ea.c6f46","type":"ui_button","z":"1a0aa13a.9d7b8f","name":"No filter","group":"9cbb54f5.392db8","order":1,"width":"0","height":"0","passthru":false,"label":"No filter","tooltip":"","color":"","bgcolor":"","icon":"","payload":"1","payloadType":"num","topic":"none","x":80,"y":861,"wires":[["4140806e.6466f"]]},{"id":"f7bd0619.7b5958","type":"ui_button","z":"1a0aa13a.9d7b8f","name":"E75L","group":"9cbb54f5.392db8","order":5,"width":3,"height":1,"passthru":false,"label":"E75L","tooltip":"E75L","color":"","bgcolor":"tan","icon":"","payload":"1","payloadType":"num","topic":"E75L","x":70,"y":980,"wires":[["4140806e.6466f"]]},{"id":"cd272b01.efcf38","type":"ui_button","z":"1a0aa13a.9d7b8f","name":"CRJ9","group":"9cbb54f5.392db8","order":4,"width":3,"height":1,"passthru":false,"label":"CRJ9","tooltip":"CRJ9","color":"","bgcolor":"tan","icon":"","payload":"1","payloadType":"num","topic":"CRJ9","x":70,"y":940,"wires":[["4140806e.6466f"]]},{"id":"6ac93ca1.3b5044","type":"ui_button","z":"1a0aa13a.9d7b8f","name":"B738","group":"9cbb54f5.392db8","order":11,"width":3,"height":1,"passthru":false,"label":"B738","tooltip":"B738","color":"","bgcolor":"tan","icon":"","payload":"1","payloadType":"num","topic":"B738","x":70,"y":900,"wires":[["4140806e.6466f"]]},{"id":"2069470f.ed9d38","type":"ui_button","z":"1a0aa13a.9d7b8f","name":"PC12","group":"9cbb54f5.392db8","order":6,"width":3,"height":1,"passthru":false,"label":"PC12","tooltip":"PC12","color":"","bgcolor":"tan","icon":"","payload":"1","payloadType":"num","topic":"PC12","x":70,"y":1020,"wires":[["4140806e.6466f"]]},{"id":"70e6c475.1c4e3c","type":"inject","z":"1a0aa13a.9d7b8f","name":"Starutp","repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"1","payloadType":"num","x":120,"y":60,"wires":[["6a58e276.4439bc"]]},{"id":"6a58e276.4439bc","type":"function","z":"1a0aa13a.9d7b8f","name":"Set Initial Conditions","func":"flow.set(\"status\",\"stopped\");\nflow.set(\"filter\",\"none\");\nflow.set(\"filter_ac_type\",\"none\");\nflow.set(\"Flights\",0);\nflow.set(\"Unnamed\",0);\nreturn msg;","outputs":1,"noerr":0,"x":420,"y":60,"wires":[[]]},{"id":"e0dbb5f4.ea61a8","type":"inject","z":"1a0aa13a.9d7b8f","name":"Put static items","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1100,"y":420,"wires":[["ae3e0ad9.38d3d8","40300d96.260ec4","f8753462.d6e958","df986dbb.427e1","f4d88d0e.bab43","b79ed39b.475ae"]]},{"id":"40300d96.260ec4","type":"change","z":"1a0aa13a.9d7b8f","name":"Ashmont 5 mile Ring","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"name\":\"Ashmont 5 Mile Ring\",\"lat\":33.110554,\"lon\":-96.790415,\"radius\":8047,\"layer\":\"Guides\",\"stroke\":true,\"fill\":false,\"color\":\"#163e80\"}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1360,"y":500,"wires":[["65c68644.d9f5f8"]]},{"id":"df986dbb.427e1","type":"change","z":"1a0aa13a.9d7b8f","name":"Round Rock  5 mile ring","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"name\":\"Round Rock 5 Mile Ring\",\"lat\":30.580425,\"lon\":-97.6687,\"radius\":8047,\"layer\":\"Guides\",\"color\":\"#e3a209\",\"stroke\":true,\"fill\":false}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1370,"y":580,"wires":[["65c68644.d9f5f8"]]},{"id":"ae3e0ad9.38d3d8","type":"change","z":"1a0aa13a.9d7b8f","name":"Ashmont +-1degree box","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"name\":\"Ashmont 2 degree box\",\"area\":[[34.110554,-95.790415],[32.110554,-97.790415]],\"layer\":\"Guides\",\"color\":\"#163e80\",\"stroke\":true,\"fill\":false}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1370,"y":460,"wires":[["65c68644.d9f5f8"]]},{"id":"f8753462.d6e958","type":"change","z":"1a0aa13a.9d7b8f","name":"Round Rock +-1degree box","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"name\":\"Round Rock 2 degree box\",\"area\":[[31.580425,-96.6687],[29.580425,-98.6687]],\"layer\":\"Guides\",\"color\":\"#e3a209\",\"stroke\":true,\"fill\":false}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1380,"y":540,"wires":[["65c68644.d9f5f8"]]},{"id":"f4d88d0e.bab43","type":"change","z":"1a0aa13a.9d7b8f","name":"Adak +-1degree box","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"name\":\"Adak 2 degree box\",\"area\":[[52.881211,-175.645945],[50.881211,-177.645945]],\"layer\":\"Guides\",\"color\":\"#42e6f5\",\"stroke\":true,\"fill\":false}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1360,"y":620,"wires":[["65c68644.d9f5f8"]]},{"id":"8649aebd.474bf","type":"ui_button","z":"1a0aa13a.9d7b8f","name":"Manual Update Round Rock","group":"3ac6140a.a2989c","order":4,"width":3,"height":1,"passthru":false,"label":"Update Round Rock","tooltip":"","color":"","bgcolor":"#e3a209","icon":"","payload":"2","payloadType":"num","topic":"","x":140,"y":380,"wires":[["e3a36dc7.11be4"]]},{"id":"c190d566.420e98","type":"ui_button","z":"1a0aa13a.9d7b8f","name":"Manual Update Adak","group":"3ac6140a.a2989c","order":5,"width":3,"height":1,"passthru":false,"label":"Update Adak","tooltip":"","color":"black","bgcolor":"#03fff2","icon":"","payload":"3","payloadType":"num","topic":"","x":120,"y":540,"wires":[["e3a36dc7.11be4"]]},{"id":"65c68644.d9f5f8","type":"link out","z":"1a0aa13a.9d7b8f","name":"","links":["1d42282.fe857d8","ee484184.496fc"],"x":1615,"y":540,"wires":[]},{"id":"be318435.10d8b8","type":"link out","z":"1a0aa13a.9d7b8f","name":"","links":["ee484184.496fc","9524e728.08d2c8"],"x":555,"y":620,"wires":[]},{"id":"e087c831.86ec18","type":"worldmap in","z":"1a0aa13a.9d7b8f","name":"","path":"/worldmapF","events":"","x":780,"y":620,"wires":[["f30ac03a.0ad73"]]},{"id":"ffbec31e.59c3e","type":"worldmap","z":"1a0aa13a.9d7b8f","name":"","lat":"","lon":"","zoom":"9","layer":"","cluster":"9","maxage":"10","usermenu":"hide","layers":"hide","panit":"false","panlock":"false","zoomlock":"false","hiderightclick":"false","coords":"none","showgrid":"false","path":"/worldmapF","x":1570,"y":180,"wires":[]},{"id":"80419bfc.5b1768","type":"change","z":"1a0aa13a.9d7b8f","name":"Adak","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"command\":{\"zoom\":9,\"lat\":51.881211,\"lon\":-176.645945}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":950,"y":780,"wires":[["a93f4f39.d0072"]]},{"id":"190bf318.1a650d","type":"inject","z":"1a0aa13a.9d7b8f","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":755,"y":780,"wires":[["80419bfc.5b1768"]],"l":false},{"id":"fa8f9937.f27ee8","type":"change","z":"1a0aa13a.9d7b8f","name":"Round Rock","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"command\":{\"zoom\":9,\"lat\":30.580425,\"lon\":-97.6687}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":970,"y":860,"wires":[["a93f4f39.d0072"]]},{"id":"1a1fa532.ab215b","type":"inject","z":"1a0aa13a.9d7b8f","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":755,"y":860,"wires":[["fa8f9937.f27ee8"]],"l":false},{"id":"b4b2bf95.3b1ee","type":"change","z":"1a0aa13a.9d7b8f","name":"Frisco","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"command\":{\"zoom\":9,\"lat\":33.110554,\"lon\":-96.790415}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":950,"y":940,"wires":[["a93f4f39.d0072"]]},{"id":"bf385b8.2b4ada8","type":"inject","z":"1a0aa13a.9d7b8f","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":755,"y":940,"wires":[["b4b2bf95.3b1ee"]],"l":false},{"id":"e407c2b6.a946a","type":"comment","z":"1a0aa13a.9d7b8f","name":"Center Map Manually or View Dashboard","info":"","x":880,"y":720,"wires":[]},{"id":"f30ac03a.0ad73","type":"switch","z":"1a0aa13a.9d7b8f","name":"Put Static Items upon connection","property":"payload.action","propertyType":"msg","rules":[{"t":"eq","v":"other","vt":"str"},{"t":"eq","v":"connected","vt":"str"},{"t":"eq","v":"blah","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":1040,"y":620,"wires":[[],["ae3e0ad9.38d3d8","40300d96.260ec4","f8753462.d6e958","df986dbb.427e1","f4d88d0e.bab43","f597fefe.493b4","b79ed39b.475ae"],[]]},{"id":"3c198e04.951cf2","type":"comment","z":"1a0aa13a.9d7b8f","name":"Place Static Items","info":"","x":810,"y":380,"wires":[]},{"id":"d9c4756d.4912a8","type":"function","z":"1a0aa13a.9d7b8f","name":"Fix Null names, Color Aircraft, filter","func":"msg.payload.layer = \"Planes\"\nmsg.payload.iconColor = \"#111212\"\nif (msg.payload.name === null) {\n    msg.payload.name = \"Call Sign \" + msg.payload.callsign\n}\nif (msg.payload.destination == \"DFW\") {\n    msg.payload.iconColor = \"#4287f5\";\n} else if (msg.payload.destination == \"DAL\") {\n    msg.payload.iconColor = \"#dec733\";\n} else if (msg.payload.origin == \"DFW\") {\n    msg.payload.iconColor = \"#163e80\";\n} else if (msg.payload.origin == \"DAL\") {\n    msg.payload.iconColor = \"#6b6015\";\n} else if (msg.payload.destination == \"AUS\") {\n    msg.payload.iconColor = \"#e3a209\";\n} else if (msg.payload.origin == \"AUS\") {\n    msg.payload.iconColor = \"#6e520f\";\n} else if (msg.payload.destination == \"ADK\") {\n    msg.payload.iconColor = \"#03fff2\";\n} else if (msg.payload.origin == \"ADK\") {\n    msg.payload.iconColor = \"#026e68\";\n}\nvar flightcount = flow.get(\"Flights\")\nflightcount++\nflow.set(\"Flights\", flightcount)\nvar filter = flow.get(\"filter\");\nvar filter_ac_type = flow.get(\"filter_ac_type\");\n\nif ((msg.payload.origin == filter) || (msg.payload.destination == filter) || (\"none\" == filter)) {\n    if ((msg.payload.model == filter_ac_type) || (\"none\" == filter_ac_type)) {\n        return msg;\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1280,"y":140,"wires":[["35c05549.6bfb8a","ffbec31e.59c3e"]]},{"id":"f597fefe.493b4","type":"change","z":"1a0aa13a.9d7b8f","name":"Adak Ct 1 meter ring","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"name\":\"Courmayeur Ct 5 Mile Ring\",\"lat\":51.8812115,\"lon\":-176.645945,\"radius\":1,\"layer\":\"Guides\",\"color\":\"#42e6f5\",\"stroke\":true,\"fill\":false}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1360,"y":660,"wires":[["65c68644.d9f5f8"]]},{"id":"ee484184.496fc","type":"link in","z":"1a0aa13a.9d7b8f","name":"Send Update to Map","links":["65c68644.d9f5f8","be318435.10d8b8","a93f4f39.d0072"],"x":1395,"y":180,"wires":[["ffbec31e.59c3e"]]},{"id":"c1a95748.60dee8","type":"inject","z":"1a0aa13a.9d7b8f","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":860,"y":300,"wires":[["e8dfc379.a198b"]]},{"id":"deb62833.319248","type":"ui_button","z":"1a0aa13a.9d7b8f","name":"Pause","group":"3ac6140a.a2989c","order":2,"width":3,"height":1,"passthru":false,"label":"Pause","tooltip":"","color":"black","bgcolor":"Yellow","icon":"","payload":"1","payloadType":"num","topic":"","x":70,"y":300,"wires":[["b95d43d.3a36dc"]]},{"id":"23f14bb4.2a9524","type":"change","z":"1a0aa13a.9d7b8f","name":"Frisco Close","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"command\":{\"zoom\":12,\"lat\":33.110554,\"lon\":-96.790415}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":970,"y":1020,"wires":[["a93f4f39.d0072"]]},{"id":"32ca5c62.a67e44","type":"inject","z":"1a0aa13a.9d7b8f","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":755,"y":1020,"wires":[["23f14bb4.2a9524"]],"l":false},{"id":"b79ed39b.475ae","type":"change","z":"1a0aa13a.9d7b8f","name":"Ashmont Home","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"name\":\"Home\",\"lat\":33.110555,\"lon\":-96.790415,\"radius\":0,\"layer\":\"House\",\"stroke\":true,\"fill\":false,\"color\":\"red\",\"icon\":\"home\"}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1340,"y":420,"wires":[["65c68644.d9f5f8"]]},{"id":"b7d336e3.07e088","type":"join","z":"1a0aa13a.9d7b8f","name":"","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"3","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1190,"y":100,"wires":[["6837dde8.0c0a64"]]},{"id":"6837dde8.0c0a64","type":"ui_table","z":"1a0aa13a.9d7b8f","group":"e298b809.c3c2f8","name":"Before mod","order":1,"width":"22","height":"7","columns":[{"field":"name","title":"Name","width":"80","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"iconColor","title":"Icon Color","width":"105","align":"left","formatter":"color","formatterParams":{"target":"_blank"}},{"field":"id","title":"ID","width":"80","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"registration","title":"Reg","width":"70","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"flight","title":"Flight","width":"80","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"callsign","title":"Call Sign","width":"95","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"origin","title":"Origin","width":"80","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"destination","title":"Destination","width":"110","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"altitude","title":"Altitude","width":"90","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"bearing","title":"Bearing","width":"90","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"speed","title":"Speed","width":"80","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"rateOfClimb","title":"Rate of Climb","width":"125","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"isOnGround","title":"On Ground","width":"110","align":"left","formatter":"tickCross","formatterParams":{"target":"_blank"}},{"field":"squawkCode","title":"Squawk","width":"90","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"model","title":"Model","width":"80","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"modeSCode","title":"Mode S","width":"95","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"radar","title":"Radar","width":"80","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"timestamp","title":"Timestamp","width":"110","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"lat","title":"Latitude","width":"90","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"lon","title":"Longitude","width":"110","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}}],"outputs":0,"cts":false,"x":1670,"y":101,"wires":[]},{"id":"35c05549.6bfb8a","type":"join","z":"1a0aa13a.9d7b8f","name":"","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"3","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1510,"y":141,"wires":[["cf54cd13.c8b4c"]]},{"id":"cf54cd13.c8b4c","type":"ui_table","z":"1a0aa13a.9d7b8f","group":"2a128af6.d72c46","name":"After Mod","order":2,"width":"22","height":"7","columns":[{"field":"name","title":"Name","width":"80","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"iconColor","title":"Icon Color","width":"105","align":"left","formatter":"color","formatterParams":{"target":"_blank"}},{"field":"id","title":"ID","width":"80","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"registration","title":"Reg","width":"70","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"flight","title":"Flight","width":"80","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"callsign","title":"Call Sign","width":"95","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"origin","title":"Origin","width":"80","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"destination","title":"Destination","width":"110","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"altitude","title":"Altitude","width":"90","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"bearing","title":"Bearing","width":"90","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"speed","title":"Speed","width":"80","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"rateOfClimb","title":"Rate of Climb","width":"125","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"isOnGround","title":"On Ground","width":"110","align":"left","formatter":"tickCross","formatterParams":{"target":"_blank"}},{"field":"squawkCode","title":"Squawk","width":"90","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"model","title":"Model","width":"80","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"modeSCode","title":"Mode S","width":"95","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"radar","title":"Radar","width":"80","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"timestamp","title":"Timestamp","width":"110","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"lat","title":"Latitude","width":"90","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"lon","title":"Longitude","width":"110","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}}],"outputs":0,"cts":false,"x":1660,"y":141,"wires":[]},{"id":"cb24235e.8e734","type":"flightradar24","z":"1a0aa13a.9d7b8f","lat":"33.110554","latType":"num","lon":"-96.790415","lonType":"num","name":"Frisco","x":830,"y":140,"wires":[["828d7df1.ced63","b7d336e3.07e088","d9c4756d.4912a8"]]},{"id":"1bb63a9a.228e25","type":"flightradar24","z":"1a0aa13a.9d7b8f","lat":"30.580425","latType":"num","lon":"-97.6687","lonType":"num","name":"Round Rock","x":850,"y":100,"wires":[["828d7df1.ced63","b7d336e3.07e088","d9c4756d.4912a8"]]},{"id":"8231f6f8.f19dc8","type":"flightradar24","z":"1a0aa13a.9d7b8f","lat":"51.881211","latType":"num","lon":"-176.645945","lonType":"num","name":"Adak","x":830,"y":180,"wires":[["828d7df1.ced63","b7d336e3.07e088","d9c4756d.4912a8"]]},{"id":"ddcdc7a9.5ce8e8","type":"ui_button","z":"1a0aa13a.9d7b8f","name":"Frisco","group":"602d7c75.e52ed4","order":1,"width":3,"height":1,"passthru":false,"label":"Frisco","tooltip":"","color":"","bgcolor":"#163e80","icon":"","payload":"1","payloadType":"num","topic":"","x":770,"y":980,"wires":[["b4b2bf95.3b1ee"]]},{"id":"643b8a51.1824d4","type":"ui_button","z":"1a0aa13a.9d7b8f","name":"Ashmont","group":"602d7c75.e52ed4","order":1,"width":3,"height":1,"passthru":false,"label":"Ashmont","tooltip":"","color":"","bgcolor":"#163e80","icon":"","payload":"1","payloadType":"num","topic":"","x":780,"y":1060,"wires":[["23f14bb4.2a9524"]]},{"id":"275ee96d.2d18c6","type":"ui_button","z":"1a0aa13a.9d7b8f","name":"Round Rock","group":"602d7c75.e52ed4","order":1,"width":3,"height":1,"passthru":false,"label":"Round Rock","tooltip":"","color":"","bgcolor":"#e3a209","icon":"","payload":"1","payloadType":"num","topic":"","x":790,"y":900,"wires":[["fa8f9937.f27ee8"]]},{"id":"8a0cf593.496128","type":"ui_button","z":"1a0aa13a.9d7b8f","name":"Adak","group":"602d7c75.e52ed4","order":1,"width":3,"height":1,"passthru":false,"label":"Adak","tooltip":"","color":"black","bgcolor":"#03fff2","icon":"","payload":"1","payloadType":"num","topic":"","x":770,"y":820,"wires":[["80419bfc.5b1768"]]},{"id":"e7d8ec72.7f72c","type":"ui_button","z":"1a0aa13a.9d7b8f","name":"Start/Restart","group":"a4570963.5547f8","order":1,"width":3,"height":1,"passthru":false,"label":"Start/Restart","tooltip":"","color":"","bgcolor":"Green","icon":"","payload":"1","payloadType":"num","topic":"","x":90,"y":260,"wires":[["92dd4796.6f9b78"]]},{"id":"f2f3203e.fb7b3","type":"ui_button","z":"1a0aa13a.9d7b8f","name":"Pause","group":"a4570963.5547f8","order":2,"width":3,"height":1,"passthru":false,"label":"Pause","tooltip":"","color":"black","bgcolor":"Yellow","icon":"","payload":"1","payloadType":"num","topic":"","x":70,"y":340,"wires":[["b95d43d.3a36dc"]]},{"id":"b80a6cf0.92a58","type":"ui_button","z":"1a0aa13a.9d7b8f","name":"Manual Update Frisco","group":"a4570963.5547f8","order":3,"width":3,"height":1,"passthru":false,"label":"Update Frisco","tooltip":"","color":"","bgcolor":"#163e80","icon":"","payload":"1","payloadType":"num","topic":"","x":120,"y":500,"wires":[["e3a36dc7.11be4"]]},{"id":"d499fa12.02bb28","type":"ui_button","z":"1a0aa13a.9d7b8f","name":"Manual Update Round Rock","group":"a4570963.5547f8","order":4,"width":3,"height":1,"passthru":false,"label":"Update Round Rock","tooltip":"","color":"","bgcolor":"#e3a209","icon":"","payload":"2","payloadType":"num","topic":"","x":140,"y":420,"wires":[["e3a36dc7.11be4"]]},{"id":"9b0185ef.894958","type":"ui_button","z":"1a0aa13a.9d7b8f","name":"Manual Update Adak","group":"a4570963.5547f8","order":5,"width":3,"height":1,"passthru":false,"label":"Update Adak","tooltip":"","color":"black","bgcolor":"#03fff2","icon":"","payload":"3","payloadType":"num","topic":"","x":120,"y":580,"wires":[["e3a36dc7.11be4"]]},{"id":"9524e728.08d2c8","type":"link in","z":"1a0aa13a.9d7b8f","name":"Trigger FR for All 3 locations","links":["2c536eac.962c32","e3a36dc7.11be4","e8dfc379.a198b","be318435.10d8b8"],"x":655,"y":140,"wires":[["cb24235e.8e734","1bb63a9a.228e25","8231f6f8.f19dc8"]]},{"id":"e3a36dc7.11be4","type":"link out","z":"1a0aa13a.9d7b8f","name":"Go to FR for All 3 Locations","links":["9524e728.08d2c8"],"x":355,"y":480,"wires":[]},{"id":"e8dfc379.a198b","type":"link out","z":"1a0aa13a.9d7b8f","name":"Go to FR for All 3 Locations","links":["9524e728.08d2c8"],"x":955,"y":300,"wires":[]},{"id":"2c536eac.962c32","type":"link out","z":"1a0aa13a.9d7b8f","name":"Go to FR for All 3 Locations","links":["9524e728.08d2c8"],"x":595,"y":100,"wires":[]},{"id":"4d548e5d.bb86b","type":"comment","z":"1a0aa13a.9d7b8f","name":"Startup and recurring trigger","info":"","x":160,"y":20,"wires":[]},{"id":"4c6c5ac3.b7f5f4","type":"comment","z":"1a0aa13a.9d7b8f","name":"Get Radar results, Send to table and map","info":"","x":880,"y":20,"wires":[]},{"id":"adcc6159.2a741","type":"comment","z":"1a0aa13a.9d7b8f","name":"Dashboard controls","info":"","x":130,"y":180,"wires":[]},{"id":"7037ef88.7d4fd","type":"comment","z":"1a0aa13a.9d7b8f","name":"Quick trigger of 1 radar update","info":"","x":840,"y":260,"wires":[]},{"id":"a93f4f39.d0072","type":"link out","z":"1a0aa13a.9d7b8f","name":"","links":["1d42282.fe857d8","ee484184.496fc"],"x":1115,"y":880,"wires":[]},{"id":"828d7df1.ced63","type":"delay","z":"1a0aa13a.9d7b8f","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1030,"y":220,"wires":[[]]},{"id":"9b6c715d.7d0df","type":"hubitat device","z":"a73af62e.c418b8","name":"Aqara button","server":"55e4481a.722098","deviceId":"356","attribute":"","sendEvent":true,"x":330,"y":100,"wires":[["5cf6a5cd.b96f2c"]]},{"id":"7ec6233c.30bd0c","type":"link out","z":"a73af62e.c418b8","name":"Passthrough to enable subflow","links":["c3d2eb8b.0e8048","65cb4f4d.450a1","804a40fe.1d409"],"x":230,"y":40,"wires":[],"l":true},{"id":"c3d2eb8b.0e8048","type":"link in","z":"a73af62e.c418b8","name":"From Input","links":["7ec6233c.30bd0c"],"x":100,"y":100,"wires":[["9b6c715d.7d0df","cf8e9b11.19c528","18f40ebe.889bd1","49a1b73f.b67818","b237626a.d45a","e1e92c35.1d1fd","6b022c72.4d95c4","23464554.36baaa","5b30cc27.8dd184","2651fd89.0d2442","918f661d.bacfa8","60dbefae.a983f","f8119c1f.d777a","c115715c.9116e"]],"l":true},{"id":"7b80fecb.c058a","type":"influxdb out","z":"a73af62e.c418b8","influxdb":"b862b36a.1a11d","name":"","measurement":"Smarthome","precision":"","retentionPolicy":"","x":2110,"y":320,"wires":[]},{"id":"13c8ec56.33a504","type":"function","z":"a73af62e.c418b8","name":"Format for InfluxDB & MQTT","func":"/* This function takes input from a hubitat device node and data stored in config node which holds details about the device\n * and creates an properly formated object to be sent to InfluxDB node via output 1 which will in turn write to the InfluxDB\n * It also formats an MQTT topic and the data sending that to output 2 which in turn can be used by an MQTT node to send to \n * MQTT\n * \n * \n */\n//gather the name of the device which had a reading that triggered the flow to be included as a tag (index) sent to InfluxDB\n//note: this is the hubitat device ID\nvar deviceID = msg.payload.deviceId;\n\n//gather the name of the measurement that was sent by the device to be included as a tag (index) for invalid measurements and as the fieldname for valid measurements sent to InfluxDB\nvar typeOfMeasurement = msg.payload.name;\n\n//gather the actual measurement value that was sent by the device to be included as the data for the field (when the measurement is valid) sent to InfluxDB\nvar theData = msg.payload.value;\n\n//initialize the measurements object\nvar measurementsObj = {};\n\n//initialize the tags (indices) object\nvar tagsObj = {};\n\n//create the object that will later be used to combine the measurementsObj and tagsObj\nvar combinedObj;\n\n//create the boolean that will be used to hold the evaluation of whether the measurement is valid or not\nvar validMeasurement;\n\n//create the booleans that will be used to hold whether the reason a measurement is invalid is because it is a non-standard type or\n// if the type of the measurement and the type passed from the device differ or\n// if the value (data) is null\nvar nonStandardType = false;\nvar measurementTypeMismatch = false;\nvar nullData = false;\n\n//create a boolean to keep track of if there are any tags (indices) that should be sent to the InfluxDB \n// it starts false but if any tag is valid then will become true. See below for what to send to InfluxDB based on valid measures and tags\nvar validTag = false;\n\n\n/*\n *show node status section. In retrospect this is probably irrelevant\n *\n */\n\n\nif ((typeof theData == msg.payload.dataType.toLowerCase()) || (msg.payload.dataType == 'ENUM') || (theData === null)) {\n    if (typeof theData == 'number') {\n        node.status({ fill: \"red\", shape: \"ring\", text: \"matched number\" });\n\n        if (!theData.isNaN) {\n            validMeasurement = true;\n        }\n    } else if (typeof theData == 'string') {\n        node.status({ fill: \"red\", shape: \"ring\", text: \"matched string\" });\n        if (theData.length >= 0) {\n            validMeasurement = true;\n        }\n    } else if (msg.payload.dataType == 'ENUM') { //This is checking to make sure the value matches one of the values in the ENUM from the device \n        node.status({ fill: \"red\", shape: \"ring\", text: msg.payload.dataType + \" matched ENUM\" });\n\n        msg.payload.values.forEach(element => {\n            if (flow.get(deviceID +element) == theData) {\n                validMeasurement = true;\n            }\n        })\n    } else if (theData === null) {\n        node.status({ fill: \"red\", shape: \"ring\", text: \"matched null data\" });\n        nullData = true;\n    } else {\n        node.status({ fill: \"red\", shape: \"ring\", text: \"matched nonstandardtype\" });\n        nonStandardType = true;\n    }\n} else {\n    node.status({ fill: \"red\", shape: \"ring\", text: \"measurement type mismatch\" });\n    measurementTypeMismatch = true;\n}\n\n\n\n\n//scanning all of the tags from the config node and creating a tag for that item if the entry on the config node has info\ncommonTags = [\"House\", \"Floor\", \"Room\", \"Location\", \"DeviceType\", \"Manufacturer\", \"AccessProtocol\", \"PhysicalVirtualType\"]\ncommonTags.forEach(element => {\n    if (flow.get(deviceID +element).length > 0) {\n        tagsObj[element] = flow.get(deviceID + element)\n        validTag = true\n    }\n});\n\n//Based on whether or not the measurement is \"valid\" it either adds the device id to the tags or it goes to the else portion\nif (validMeasurement) {\n    measurementsObj[typeOfMeasurement] = theData;\n    if (deviceID.length > 0) {\n        tagsObj[\"DeviceID\"] = deviceID;\n        validTag = true;\n    }\n    if (validTag) {\n        combinedObj = [measurementsObj, tagsObj]\n    } else {\n        //skip tags if none would be valid\n        combinedObj = [measurementsObj]\n    }\n} else {\n\n    //if the measeurement was not \"valid\", then it puts in a Generic measurement of true and tag it as either Non-Standard Type of Measurement Type Mismatch\n    if (nonStandardType) {\n        measurementsObj[\"Generic\"] = true\n        tagsObj[\"ReasonGeneric\"] = \"Non-Standard Type\"\n        tagsObj[\"Measure\"] = typeOfMeasurement\n    }\n    if (deviceID.length > 0) {\n        tagsObj[\"DeviceID\"] = deviceID\n        validTag = true\n    }\n    if (measurementTypeMismatch) {\n        measurementsObj[\"Generic\"] = true\n        tagsObj[\"ReasonGeneric\"] = \"Measurement Type Mismatch\"\n        tagsObj[\"Measure\"] = typeOfMeasurement\n    }\n    //upon review this if statement looks redundant\n    if (deviceID.length > 0) {\n        tagsObj[\"DeviceID\"] = deviceID\n        validTag = true\n    }\n    combinedObj = [measurementsObj, tagsObj]\n}\n\n//put the object into the payload\nmsg.payload = combinedObj;\n\n//build the status to be shown on the status of the subnode\nmsg.status = typeOfMeasurement + \": \" + theData;\n\n/* MQTT section \n * \n * \n * \n */\n\n//create the placeholder object\nvar msg2 = {}\n//add the MQTT topic\nmsg2.topic = \"Hubitat/\" + flow.get(deviceID +\"MQTTDeviceTopic\") + \"/\" + typeOfMeasurement\n//add the data to be recorded to MQTT\nmsg2.payload = theData\n\n\n\n//send the created combinedObj downstream (to the InfluxDB node), but only if the measurement is not null\nif (!nullData) {\n    return [msg, msg2]\n}","outputs":2,"noerr":0,"x":1740,"y":320,"wires":[["377f4ebf.3750b2","7b80fecb.c058a"],["495328dc.7fdd98"]]},{"id":"377f4ebf.3750b2","type":"change","z":"a73af62e.c418b8","name":"Move Status to Payload for Consumption by Status Node","rules":[{"t":"set","p":"payload","pt":"msg","to":"status","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2150,"y":360,"wires":[[]]},{"id":"495328dc.7fdd98","type":"mqtt out","z":"a73af62e.c418b8","name":"Write reading to MQTT","topic":"","qos":"1","retain":"true","broker":"a5bf81ee.27852","x":1720,"y":360,"wires":[]},{"id":"628d4a24.2b1aa4","type":"inject","z":"98a6e865.a02ea8","name":"11 pm Turn Off First Light","repeat":"","crontab":"00 23 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":180,"wires":[["563a472b.7924e8"]]},{"id":"d4d54bb9.9ec768","type":"inject","z":"98a6e865.a02ea8","name":"11:30 pm Turn Off Second Living Room Light","repeat":"","crontab":"30 23 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":220,"y":220,"wires":[["c490e6e5.e0e728"]]},{"id":"563a472b.7924e8","type":"hubitat command","z":"98a6e865.a02ea8","name":"Corner Off","server":"55e4481a.722098","deviceId":"100","command":"off","commandArgs":"","x":370,"y":180,"wires":[[]]},{"id":"c490e6e5.e0e728","type":"hubitat command","z":"98a6e865.a02ea8","name":"Table Lamp Off","server":"55e4481a.722098","deviceId":"225","command":"off","commandArgs":"","x":500,"y":220,"wires":[[]]},{"id":"27d40011.32d0e","type":"inject","z":"98a6e865.a02ea8","name":"7 pm Turn on Bedside Light","repeat":"","crontab":"00 19 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":260,"wires":[["3c71784d.a38fe8"]]},{"id":"3c71784d.a38fe8","type":"hubitat command","z":"98a6e865.a02ea8","name":"Mike Bedside On","server":"55e4481a.722098","deviceId":"257","command":"on","commandArgs":"","x":390,"y":260,"wires":[[]]},{"id":"8db205c8.4a1268","type":"hubitat device","z":"98a6e865.a02ea8","name":"Master Light Overhead Switch double tapped","server":"55e4481a.722098","deviceId":"33","attribute":"doubleTapped","sendEvent":true,"x":190,"y":120,"wires":[["3128627d.70be9e"]]},{"id":"3128627d.70be9e","type":"hubitat command","z":"98a6e865.a02ea8","name":"Turn on Table Lamp@10%","server":"55e4481a.722098","deviceId":"225","command":"setLevel","commandArgs":"10,0","x":500,"y":120,"wires":[[]]},{"id":"5fbe337e.5eaf8c","type":"function","z":"a73af62e.c418b8","name":"Splitting Preprocessor","func":"/*\n * Main function node code \n * \n */\n//Check if there is any data. If not, stop processing. At the time this was created, the trackData sent from a Hubitat Elevation device node was always null\nif (msg.payload.value === null) {\n    return null;\n}\n//delete the currentValue portion of the object since it is deprecated\ndelete msg.payload.currentValue\n//initial call into the recursive function\nhandlemsg(msg)\n//send nothing from main code\nreturn\n\n/*\n * Main recursive function code\n *\n */\n\nfunction handlemsg(msg) {\n    //The evaluation part of this switch/case statement determines which type of entity is in the value\n    //  the key idea is that once the value is an atomic item (number, string, bool) then the message should be sent out\n    //  of the node to downstream, but if the value is a splittable, then it should be split into multiple messages. These\n    //  messages are then evaulated individually. They in turn are either found to have atomic entries in the value or have\n    //  values that are themselves splittable.\n    //  For example:\n    //  JSON - each key value pair will be used to create a new msg. The msg.payload.name will be changed to add \":\" and the key\n    //          from the key value pair. The msg.payload.value will become the value from the key value pair\n    //  Array - TBAdded\n    //  Object - TBAdded\n    switch (typeofhubitatvalue(msg.payload.value, \"msg.payload.value\")) {\n        case \"number\":\n        case \"bigint\":\n            //numbers are an atomic type of value and should be sent to downstream nodes\n            msg.payload.dataType = \"Number\"\n            //send the version of the msg with an atomic value to downstream nodes\n            node.send(msg)\n            //do nothing more once msg has been sent\n            break;\n        case \"boolean\":\n            //Booleans are an atomic type of value and should be sent to downstream nodes\n            msg.payload.dataType = \"Boolean\"\n            //send the version of the msg with an atomic value to downstream nodes\n            node.send(msg)\n            //do nothing more once msg has been sent\n            break;\n        case \"string\":\n            //Strings are an atomic type of value and should be sent to downstream nodes\n            msg.payload.dataType = \"String\"\n            //send the version of the msg with an atomic value to downstream nodes\n            node.send(msg)\n            //do nothing more once msg has been sent\n            break;\n        case \"unsplittable array\":\n            //This case is where the item is an array, but with only a single entry. The idea is to move that single\n            //  value out of the array and into the value natively and then to call the recursive function to evaluate\n            //  what type of item it now is and then process (split or send or extract) appropriately\n            msg.payload.value = msg.payload.value[0]\n            handlemsg(msg)\n            break;\n        case \"splittable JSON\":\n            //This is for cases where the JSON is in the form of key:value where there is at least 1 pair\n            //  Examples of \"valid\" JSON that would not be coming to this case would be {} or 100\n            splitJSON(msg)\n            break;\n        case \"splittable array\":\n            //This is for cases where the Array is in the form [\"A\",\"B\",\"C\"] where there is are at least 2 members\n            //  SplitArray function not yet built. TBD\n            splitArray(msg)\n            break;\n        case \"unsplittable JSON\":\n            //This is for handling \"valid\" JSON that does not have key:value pairs.\n            //  Examples of \"valid\" JSON that are handed here are {} or 100 or \"100\"\n            //  This case either treats it as a string (no changes made) or a number where a number in\n            //  a string like \"100\" is changed into an actual number like 100\n\n            //by checking if NaN, if it is a number 100 or \"100\", the ++ followed by -- changes it to a number 100\n            //  without changing its actual value\n            if (isNaN(msg.payload.value)) { } else {\n                ++msg.payload.value;\n                --msg.payload.value;\n             }\n            //Sets the data type for downstream since the incoming message could have been a variety of types\n            //  before JSON, object or array was split\n            msg.payload.dataType = typeof (msg.payload.value)\n            //send the version of the msg with an atomic value to downstream nodes (could probably just recursively call\n            //  handlemsg, but I can't identify a circumstance where that would give a different result to downstream,\n            //  but this would be a place to investigate if downstream results are unexpected.)\n            node.send(msg)\n            break\n        case \"object\":\n            //This is for handling an object. It then calls splitObj to create multiple msgs with the object keys into the names\n            //  and the values from those keys moved into the value of the new object.\n            splitObj(msg)\n            break\n        default:\n            //This is just in case no valid process is found by the typeofhubitatvalue function.\n            //  If you encounter this then you will either need to investigate the function or contact tmichael in\n            //  Hubitat discourse forums https://community.hubitat.com/\n            return\n    }\n}\n\n/*\n * This function is used by the Main recursive function (handlemsg) to decide whether to send the msg on as\n *  the msg.payload.value is atomic or if it needs to split the value into multiple msgs\n *\n */\nfunction typeofhubitatvalue(value, source = \"\") {\n    switch (typeof (value)) {\n        case \"number\":\n            //atomic just return the result of typeof\n            return \"number\"\n            break;\n        case \"bigint\":\n            //atomic just return the result of typeof\n            return \"bigint\"\n            break;\n        case \"boolean\":\n            //atomic just return the result of typeof\n            return \"boolean\"\n            break;\n        case \"string\":\n            //most splittable values are encoded strictly as text and so may be identified as a string\n\n            //Fist check if the string is \"valid\" JSON\n            if (isvalidJSONstring(value)) {\n                //When it is \"valid\" JSON, check if it is splittable\n                if (issplittablevalidJSONstring(value)) {\n                    //When it is splittable, then return type as splittable JSON\n                    return \"splittable JSON\"\n                }\n                else\n                {\n                    //if it is JSON, but not splittable ({}, \"100, 100) return unsplittable JSON\n                    return \"unsplittable JSON\"\n                }\n            }\n            else\n            {\n                //When it isn't \"valid\" JSON, check if it is an array\n                if (isvalidarray(value)) {\n                    //When it is an array, check if it is splittable\n                    if (issplittablearray(value)) {\n                        //When it is splittable, return splittable Array\n                        return \"splittable Array\"\n                    }\n                    else\n                    {\n                        //if the array is not splittable ([\"apple\"]) return unsplittable array\n                        return \"unsplittable array\"\n                    }\n                }\n                else\n                {\n                    //When it is neither JSON or Array, then it is really just a string, so return string\n                    return \"string\"\n                }\n            }\n            break;\n        case \"object\":\n            //some  splittable values are identified as objects\n\n            //Fist check if the object is \"valid\" JSON\n            if (isvalidJSONstring(value)) {\n                //When it is \"valid\" JSON, check if it is splittable\n                if (issplittablevalidJSONstring(value)) {\n                    //When it is splittable, then return type as splittable JSON\n                    return \"splittable JSON\"\n                }\n                else\n                {\n                    //if it is JSON, but not splittable ({}, \"100, 100) return unsplittable JSON\n                    return \"unsplittable JSON\"\n                }\n            }\n            else\n            {\n                //When it isn't \"valid\" JSON, check if it is an array\n                if (isvalidarray(value)) {\n                    //When it is an array, check if it is splittable\n                    if (issplittablearray(value)) {\n                        //When it is splittable, return splittable Array\n                        return \"splittable Array\"\n                    }\n                    else {\n                        //if the array is not splittable ([\"apple\"]) return unsplittable array\n                        return \"unsplittable array\"\n                    }\n                }\n                else\n                {\n                    //When it is neither JSON or Array, then I have not accounted for it. If you reach this point during an\n                    //  investigation, it might be worth using the example that triggered your investigation to see if the object\n                    //  is really just a string (without a triggering example I have not investigated)\n                    return \"object\"\n                }\n            }\n            break;\n        default:\n            //When the type is not one that I coded for then return unhandled because the situation is by definition unhandled\n            return \"unhandled\"\n            break;\n    }\n}\n\n//True False functions\n/*\n * This function was found on the internet to check if an input is valid JSON\n * There seems to be a belief that there should be some more elegant method that trying parse and the catching the error,\n * but no one seems to have demonstrated what that more elegant way would be\n */\nfunction isvalidJSONstring(str) {\n    try {\n        JSON.parse(str);\n    } catch (e) {\n        return false;\n    }\n    return true;\n}\n\n/*\n * This function decides where the JSON is made up of at least 1 key:value pair\n */\nfunction issplittablevalidJSONstring(str) {\n    if (str.includes(\":\")) {\n        return true;\n    }\n    else {\n        return false;\n    }\n}\n/*\n * This function is simply wrapping the Array.isArray, to align the function naming with the other true false functions\n */\nfunction isvalidarray(str) {\n    if (Array.isArray(str)) {\n        return true;\n    }\n    else {\n        return false;\n    }\n}\n/*\n * This function identifies if the array has only a single entry or multiple entries i.e. [\"Apple\"] not splittable,\n *  [\"Apple\",\"Pear\"] splittable\n */\nfunction issplittablearray(str) {\n    // If the length is more than 1, then the array has mutliple entries, but if it is just 1, then it is not splittable\n    if (str.length > 1) {\n        return true;\n    }\n    else {\n        return false;\n    }\n}\n\n//Splitting functions\n/*\n * This function takes in a msg where msg.payload.value is splittable JSON and iterates through all key:value pairs and then\n *  recursively calls handlemsg with multiple messages. Each new message retains most of the details of the input message, \n *  but the name and value are changed.\n *  The name has the key from the key:value pair appended with a : as a seperator\n *  The value is replaced with the value from the key:value pair\n *  A new message is created for each key:value pair\n */\nfunction splitJSON(latestMsg) {\n    //put the inputs value into a variable for easier access\n    var valueJSON = JSON.parse(latestMsg.payload.value);\n    //put the inputs name aside for multiple reuses\n    var name = latestMsg.payload.name\n    //Iterative loop\n    Object.keys(valueJSON).forEach(function (key) {\n        //concatenate the original name, a colon and the key from the pair\n        latestMsg.payload.name = name + \":\" + key;\n        //move the value from the pair to payload.value\n        latestMsg.payload.value = valueJSON[key];\n        //recursively call this function in case the value is itself splittable\n        handlemsg(latestMsg)\n    }\n    )\n    return\n}\n\n/*\n * This function takes in a msg where msg.payload.value is splittable object\n *  and iterates through all key:value pairs and then\n *  recursively calls handlemsg with multiple messages. Each new message retains most of the details of the input message,\n *  but the name and value are changed.\n *  The name has the key from the key:value pair appended with a : as a seperator\n *  The value is replaced with the value from the key:value pair\n *  A new message is created for each key:value pair\n *  \n *  Note: While working on the splitArray function, I realized that I may not have tested this on an object value with multiple\n *  pairs, so it is possible that the function only handles the first pair\n */\nfunction splitObj(oMsg) {\n    //put the inputs name aside for multiple reuses\n    var name = oMsg.payload.name\n    //Iterative loop\n    for (let [key, value] of Object.entries(oMsg.payload.value)) {\n        if ((value !== null) && (key !== null)) {\n            oMsg.payload.name = name + \":\" + key;\n            oMsg.payload.value = value;\n            //recursively call this function in case the value is itself splittable\n            handlemsg(oMsg)\n        }\n    }\n}\n\n/*\n * Note: At the time of creation, I did not have a live example and had too many other things in the works to construct one.\n * \n * This function takes in a msg where msg.payload.value is splittable array\n *  and iterates through all entries and recursively calls handlemsg with multiple messages. \n *  Each new message retains most of the details of the input message,\n *  but the value is changed.\n *  The value is replaced with the value from the entry in the Array\n *  For example if the input value is [\"Apple\",\"Pear\"], then the first msg will have a value of \"Apple\"\n *  and the second will have a value of \"Pear\"\n */\nfunction splitArray(aMsg) {\n    //Iterative loop\n    for (index = 0; index < aMsg.payload.value.length; index++) {\n        (aMsg.payload.value = aMsg.payload.value[index]);\n        //recursively call this function in case the value is itself splittable\n        handlemsg(aMsg)\n    }\n}","outputs":1,"noerr":0,"x":1320,"y":40,"wires":[["13c8ec56.33a504","67fca0f9.da6f8"]]},{"id":"9fe681fa.d63","type":"function","z":"a73af62e.c418b8","name":"Split 2 types of device node outputs","func":"var singleAttributeData = false\nvar foundType\nfor (let [key, value] of Object.entries(msg.payload)) {\n  foundtype= typeof(value)\n  if ((foundtype==\"string\")||(foundtype==\"number\")||(foundtype==\"boolean\")){\n      singleAttributeData =true\n  }\n}\nif (singleAttributeData){\n    node.send([msg,null])\n} else\n{\n    node.send([null,msg])\n    //interate through the objects in the input\n    for (let [key, value] of Object.entries(msg.payload))\n    {    \n        msg.payload = value\n        node.send([msg,null])\n        node.done()\n        \n    }\n}\nreturn","outputs":2,"noerr":0,"x":1040,"y":40,"wires":[["5fbe337e.5eaf8c"],[]]},{"id":"79af2189.fdbfe","type":"link in","z":"a73af62e.c418b8","name":"Send to InfluxDB, MQTT","links":["5cf6a5cd.b96f2c","5f3cfdbe.fa5cd4","9b2f3d79.c657a","1d6d8c5.03a1d74"],"x":590,"y":40,"wires":[[]],"l":true},{"id":"5cf6a5cd.b96f2c","type":"link out","z":"a73af62e.c418b8","name":"Gather to Send to InfluxDB, MQTT","links":["79af2189.fdbfe"],"x":700,"y":100,"wires":[],"l":true},{"id":"cf8e9b11.19c528","type":"hubitat device","z":"a73af62e.c418b8","name":"Corner","server":"55e4481a.722098","deviceId":"100","attribute":"","sendEvent":true,"x":310,"y":140,"wires":[["5cf6a5cd.b96f2c"]]},{"id":"18f40ebe.889bd1","type":"hubitat device","z":"a73af62e.c418b8","name":"Cube 1","server":"55e4481a.722098","deviceId":"360","attribute":"","sendEvent":true,"x":320,"y":180,"wires":[["5cf6a5cd.b96f2c"]]},{"id":"49a1b73f.b67818","type":"hubitat device","z":"a73af62e.c418b8","name":"Downstairs Thermostat","server":"55e4481a.722098","deviceId":"161","attribute":"","sendEvent":true,"x":360,"y":220,"wires":[["5cf6a5cd.b96f2c"]]},{"id":"b237626a.d45a","type":"hubitat device","z":"a73af62e.c418b8","name":"Echo - Office","server":"55e4481a.722098","deviceId":"321","attribute":"","sendEvent":true,"x":330,"y":260,"wires":[["5f3cfdbe.fa5cd4"]]},{"id":"e1e92c35.1d1fd","type":"hubitat device","z":"a73af62e.c418b8","name":"Game Room Floor Lamp","server":"55e4481a.722098","deviceId":"357","attribute":"","sendEvent":true,"x":370,"y":300,"wires":[["5f3cfdbe.fa5cd4"]]},{"id":"6b022c72.4d95c4","type":"hubitat device","z":"a73af62e.c418b8","name":"Master Fan","server":"55e4481a.722098","deviceId":"65","attribute":"","sendEvent":true,"x":330,"y":340,"wires":[["9b2f3d79.c657a"]]},{"id":"23464554.36baaa","type":"hubitat device","z":"a73af62e.c418b8","name":"Master Light Overhead","server":"55e4481a.722098","deviceId":"33","attribute":"","sendEvent":true,"x":360,"y":380,"wires":[["9b2f3d79.c657a"]]},{"id":"5b30cc27.8dd184","type":"hubitat device","z":"a73af62e.c418b8","name":"Mike Bedside","server":"55e4481a.722098","deviceId":"257","attribute":"","sendEvent":true,"x":340,"y":420,"wires":[["9b2f3d79.c657a"]]},{"id":"2651fd89.0d2442","type":"hubitat device","z":"a73af62e.c418b8","name":"Mike Credenza Light","server":"55e4481a.722098","deviceId":"388","attribute":"","sendEvent":true,"x":360,"y":460,"wires":[["9b2f3d79.c657a"]]},{"id":"918f661d.bacfa8","type":"hubitat device","z":"a73af62e.c418b8","name":"Mike's Ipad","server":"55e4481a.722098","deviceId":"129","attribute":"","sendEvent":true,"x":330,"y":500,"wires":[["1d6d8c5.03a1d74"]]},{"id":"60dbefae.a983f","type":"hubitat device","z":"a73af62e.c418b8","name":"Office Desk Lamp","server":"55e4481a.722098","deviceId":"550","attribute":"","sendEvent":true,"x":350,"y":540,"wires":[["1d6d8c5.03a1d74"]]},{"id":"f8119c1f.d777a","type":"hubitat device","z":"a73af62e.c418b8","name":"Table Lamp","server":"55e4481a.722098","deviceId":"225","attribute":"","sendEvent":true,"x":330,"y":580,"wires":[["1d6d8c5.03a1d74"]]},{"id":"c115715c.9116e","type":"hubitat device","z":"a73af62e.c418b8","name":"Watch Uverse","server":"55e4481a.722098","deviceId":"262","attribute":"","sendEvent":true,"x":340,"y":620,"wires":[["1d6d8c5.03a1d74"]]},{"id":"5f3cfdbe.fa5cd4","type":"link out","z":"a73af62e.c418b8","name":"Gather to Send to InfluxDB, MQTT","links":["79af2189.fdbfe"],"x":700,"y":260,"wires":[],"l":true},{"id":"9b2f3d79.c657a","type":"link out","z":"a73af62e.c418b8","name":"Gather to Send to InfluxDB, MQTT","links":["79af2189.fdbfe"],"x":700,"y":340,"wires":[],"l":true},{"id":"1d6d8c5.03a1d74","type":"link out","z":"a73af62e.c418b8","name":"Gather to Send to InfluxDB, MQTT","links":["79af2189.fdbfe"],"x":700,"y":540,"wires":[],"l":true},{"id":"be4b942b.9bcd08","type":"config","z":"a73af62e.c418b8","name":"357 Game Room Floor Lamp Config","properties":[{"p":"357Floor","pt":"flow","to":"2","tot":"str"},{"p":"357Location","pt":"flow","to":"Northeast Corner","tot":"str"},{"p":"357Room","pt":"flow","to":"Game Room","tot":"str"},{"p":"357DeviceType","pt":"flow","to":"Bulb","tot":"str"},{"p":"357Manufacturer","pt":"flow","to":"Ikea","tot":"str"},{"p":"357AccessProtocol","pt":"flow","to":"Zigbee","tot":"str"},{"p":"357PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"357PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"357House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"357MQTTDeviceTopic","pt":"flow","to":"Game Room Floor Lamp","tot":"str"}],"active":true,"x":1050,"y":300,"wires":[]},{"id":"5f674567.0f7cac","type":"config","z":"a73af62e.c418b8","name":"356 Aqara Button Config","properties":[{"p":"356Floor","pt":"flow","to":"1","tot":"str"},{"p":"356Location","pt":"flow","to":"Mike Bedside","tot":"str"},{"p":"356Room","pt":"flow","to":"Master Bedroom","tot":"str"},{"p":"356DeviceType","pt":"flow","to":"Button","tot":"str"},{"p":"356Manufacturer","pt":"flow","to":"Aqara","tot":"str"},{"p":"356AccessProtocol","pt":"flow","to":"Zigbee","tot":"str"},{"p":"356PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"356PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"356House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"356MQTTDeviceTopic","pt":"flow","to":"Aqara button","tot":"str"}],"active":true,"x":1010,"y":100,"wires":[]},{"id":"5e417522.eca8dc","type":"config","z":"a73af62e.c418b8","name":"100 Corner Lamp IKEA Switch Config","properties":[{"p":"100Floor","pt":"flow","to":"1","tot":"str"},{"p":"100Location","pt":"flow","to":"Northeast Corner","tot":"str"},{"p":"100Room","pt":"flow","to":"Living Room","tot":"str"},{"p":"100DeviceType","pt":"flow","to":"Switch","tot":"str"},{"p":"100Manufacturer","pt":"flow","to":"IKEA","tot":"str"},{"p":"100AccessProtocol","pt":"flow","to":"Zigbee","tot":"str"},{"p":"100PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"100PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"100House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"100MQTTDeviceTopic","pt":"flow","to":"Corner Light","tot":"str"}],"active":true,"x":1050,"y":140,"wires":[]},{"id":"19119e30.02ebd2","type":"config","z":"a73af62e.c418b8","name":"360 Cube 1 Config","properties":[{"p":"360Floor","pt":"flow","to":"2","tot":"str"},{"p":"360Location","pt":"flow","to":"Mike's Desk","tot":"str"},{"p":"360Room","pt":"flow","to":"Game Room","tot":"str"},{"p":"360DeviceType","pt":"flow","to":"Cube","tot":"str"},{"p":"360Manufacturer","pt":"flow","to":"Aqara","tot":"str"},{"p":"360AccessProtocol","pt":"flow","to":"Zigbee","tot":"str"},{"p":"360PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"360PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"360House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"360MQTTDeviceTopic","pt":"flow","to":"Cube 1","tot":"str"}],"active":true,"x":990,"y":180,"wires":[]},{"id":"7f51d1c4.17391","type":"config","z":"a73af62e.c418b8","name":"161 Lennox Thermostat Config","properties":[{"p":"161Floor","pt":"flow","to":"1","tot":"str"},{"p":"161Location","pt":"flow","to":"Narrow Hall","tot":"str"},{"p":"161Room","pt":"flow","to":"","tot":"str"},{"p":"161DeviceType","pt":"flow","to":"Thermostat","tot":"str"},{"p":"161Manufacturer","pt":"flow","to":"Lennox","tot":"str"},{"p":"161AccessProtocol","pt":"flow","to":"WiFi","tot":"str"},{"p":"161PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"161PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"161House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"161MQTTDeviceTopic","pt":"flow","to":"Lennox Thermostat","tot":"str"}],"active":true,"x":1030,"y":220,"wires":[]},{"id":"866270d7.044cb","type":"config","z":"a73af62e.c418b8","name":"321 Office Echo Config","properties":[{"p":"321Floor","pt":"flow","to":"2","tot":"str"},{"p":"321Location","pt":"flow","to":"Mike's Desk","tot":"str"},{"p":"321Room","pt":"flow","to":"Game Room","tot":"str"},{"p":"321DeviceType","pt":"flow","to":"Echo","tot":"str"},{"p":"321Manufacturer","pt":"flow","to":"Amazon","tot":"str"},{"p":"321AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"321PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"321PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"321House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"321MQTTDeviceTopic","pt":"flow","to":"Office Echo","tot":"str"}],"active":true,"x":1010,"y":260,"wires":[]},{"id":"f81312e7.2608b","type":"config","z":"a73af62e.c418b8","name":"65 Master Fan Config","properties":[{"p":"65Floor","pt":"flow","to":"1","tot":"str"},{"p":"65Location","pt":"flow","to":"North","tot":"str"},{"p":"65Room","pt":"flow","to":"Master Bedroom","tot":"str"},{"p":"65DeviceType","pt":"flow","to":"Switch","tot":"str"},{"p":"65Manufacturer","pt":"flow","to":"GE/Jasco","tot":"str"},{"p":"65AccessProtocol","pt":"flow","to":"Z-Wave","tot":"str"},{"p":"65PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"65PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"65House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"65MQTTDeviceTopic","pt":"flow","to":"Master Fan","tot":"str"}],"active":true,"x":1000,"y":340,"wires":[]},{"id":"e33c573c.c232f8","type":"config","z":"a73af62e.c418b8","name":"33 Master Light Config","properties":[{"p":"33Floor","pt":"flow","to":"1","tot":"str"},{"p":"33Location","pt":"flow","to":"North","tot":"str"},{"p":"33Room","pt":"flow","to":"Master Bedroom","tot":"str"},{"p":"33DeviceType","pt":"flow","to":"Switch","tot":"str"},{"p":"33Manufacturer","pt":"flow","to":"GE/Jasco","tot":"str"},{"p":"33AccessProtocol","pt":"flow","to":"Z-Wave","tot":"str"},{"p":"33PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"33PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"33House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"33MQTTDeviceTopic","pt":"flow","to":"Master Overhead Light","tot":"str"}],"active":true,"x":1000,"y":380,"wires":[]},{"id":"f4206f1a.b8e7b","type":"config","z":"a73af62e.c418b8","name":"257 Mike Bedside Config","properties":[{"p":"257Floor","pt":"flow","to":"1","tot":"str"},{"p":"257Location","pt":"flow","to":"Southeast Corner","tot":"str"},{"p":"257Room","pt":"flow","to":"Master Bedroom","tot":"str"},{"p":"257DeviceType","pt":"flow","to":"Switch","tot":"str"},{"p":"257Manufacturer","pt":"flow","to":"Wemo","tot":"str"},{"p":"257AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"257PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"257PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"257House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"257MQTTDeviceTopic","pt":"flow","to":"Mike's Bedside Light","tot":"str"}],"active":true,"x":1010,"y":420,"wires":[]},{"id":"cc12bf55.bf86c","type":"config","z":"a73af62e.c418b8","name":"388 Mike Credenza Light Config","properties":[{"p":"388Floor","pt":"flow","to":"2","tot":"str"},{"p":"388Location","pt":"flow","to":"Mike's Desk","tot":"str"},{"p":"388Room","pt":"flow","to":"Game Room","tot":"str"},{"p":"388DeviceType","pt":"flow","to":"Switch","tot":"str"},{"p":"388Manufacturer","pt":"flow","to":"IKEA","tot":"str"},{"p":"388AccessProtocol","pt":"flow","to":"Zigbee","tot":"str"},{"p":"388PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"388PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"388House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"388MQTTDeviceTopic","pt":"flow","to":"Mike's Credenza Light","tot":"str"}],"active":true,"x":1030,"y":460,"wires":[]},{"id":"4d415bf0.1cb284","type":"config","z":"a73af62e.c418b8","name":"129 Mike iPad Config","properties":[{"p":"129Floor","pt":"flow","to":"","tot":"str"},{"p":"129Location","pt":"flow","to":"","tot":"str"},{"p":"129Room","pt":"flow","to":"","tot":"str"},{"p":"129DeviceType","pt":"flow","to":"Tablet","tot":"str"},{"p":"129Manufacturer","pt":"flow","to":"Apple","tot":"str"},{"p":"129AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"129PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"129PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"129House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"129MQTTDeviceTopic","pt":"flow","to":"Mike's iPad","tot":"str"}],"active":true,"x":1000,"y":500,"wires":[]},{"id":"d1089d9c.8a2fa","type":"config","z":"a73af62e.c418b8","name":"550 Ofice Desk Lamp Config","properties":[{"p":"550Floor","pt":"flow","to":"2","tot":"str"},{"p":"550Location","pt":"flow","to":"Mike's Desk","tot":"str"},{"p":"550Room","pt":"flow","to":"Game Room","tot":"str"},{"p":"550DeviceType","pt":"flow","to":"Switch","tot":"str"},{"p":"550Manufacturer","pt":"flow","to":"IKEA","tot":"str"},{"p":"550AccessProtocol","pt":"flow","to":"Zigbee","tot":"str"},{"p":"550PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"550PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"550House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"550MQTTDeviceTopic","pt":"flow","to":"Mike's Office Lamp","tot":"str"}],"active":true,"x":1020,"y":540,"wires":[]},{"id":"12d11f92.746c3","type":"config","z":"a73af62e.c418b8","name":"225 Table Lamp Config","properties":[{"p":"225Floor","pt":"flow","to":"1","tot":"str"},{"p":"225Location","pt":"flow","to":"North Side","tot":"str"},{"p":"225Room","pt":"flow","to":"Living Room","tot":"str"},{"p":"225DeviceType","pt":"flow","to":"Bulb","tot":"str"},{"p":"225Manufacturer","pt":"flow","to":"TP-Link","tot":"str"},{"p":"225AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"225PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"225PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"225House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"225MQTTDeviceTopic","pt":"flow","to":"Table Lamp","tot":"str"}],"active":true,"x":1010,"y":580,"wires":[]},{"id":"5091e13d.3b68b","type":"config","z":"a73af62e.c418b8","name":"262 Mike Watch Uverse","properties":[{"p":"262Floor","pt":"flow","to":"1","tot":"str"},{"p":"262Location","pt":"flow","to":"TV Cabinet","tot":"str"},{"p":"262Room","pt":"flow","to":"Living Room","tot":"str"},{"p":"262DeviceType","pt":"flow","to":"Harmony Activity","tot":"str"},{"p":"262Manufacturer","pt":"flow","to":"Logitech","tot":"str"},{"p":"262AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"262PhysicalVirtualType","pt":"flow","to":"Virtual","tot":"str"},{"p":"262PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"262House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"262MQTTDeviceTopic","pt":"flow","to":"Watch Uverse","tot":"str"}],"active":true,"x":1010,"y":620,"wires":[]},{"id":"bee29f25.e7e95","type":"split","z":"f9a34738.f12c28","name":"k:v pair Key ->name, k:v pair Value ->payload","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"name","x":1970,"y":80,"wires":[["1ef57e64.81fd82","9392480e.f981f8"]]},{"id":"a6bbf579.19e548","type":"change","z":"f9a34738.f12c28","name":"","rules":[{"t":"delete","p":"_rawMessage","pt":"msg"},{"t":"delete","p":"Homebridge","pt":"msg"},{"t":"delete","p":"_device","pt":"msg"},{"t":"delete","p":"parts","pt":"msg"},{"t":"delete","p":"Manufacturer","pt":"msg"},{"t":"delete","p":"_confId","pt":"msg"},{"t":"set","p":"value","pt":"msg","to":"payload","tot":"msg"},{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.value","pt":"msg","to":"value","tot":"msg"},{"t":"set","p":"payload.name","pt":"msg","to":"name","tot":"msg"},{"t":"delete","p":"value","pt":"msg"},{"t":"delete","p":"name","pt":"msg"},{"t":"delete","p":"translate","pt":"msg"},{"t":"set","p":"payload.deviceId","pt":"msg","to":"DeviceID","tot":"msg"},{"t":"delete","p":"DeviceID","pt":"msg"},{"t":"delete","p":"TranslationTarget","pt":"msg"},{"t":"delete","p":"TranslationType","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2370,"y":460,"wires":[["a4fea75b.dd8748"]]},{"id":"c2c2bbb5.74f918","type":"change","z":"f9a34738.f12c28","name":"name -> topic","rules":[{"t":"set","p":"topic","pt":"msg","to":"name","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1460,"y":160,"wires":[["831c7de9.65f3c"]]},{"id":"27685686.faec2a","type":"influxdb out","z":"f9a34738.f12c28","influxdb":"b862b36a.1a11d","name":"","measurement":"Smarthome","precision":"","retentionPolicy":"","x":3230,"y":400,"wires":[]},{"id":"5f42d976.714a58","type":"function","z":"f9a34738.f12c28","name":"Format for InfluxDB & MQTT Homebridge","func":"/* This function takes input from a hubitat device node and data stored in config node which holds details about the device\n * and creates an properly formated object to be sent to InfluxDB node via output 1 which will in turn write to the InfluxDB\n * It also formats an MQTT topic and the data sending that to output 2 which in turn can be used by an MQTT node to send to \n * MQTT\n * \n * \n */\n//gather the name of the device which had a reading that triggered the flow to be included as a tag (index) sent to InfluxDB\n//note: this is the hubitat device ID\nvar deviceID = msg.payload.deviceId;\n//node.warn(\"11 \"+ deviceID)\n//gather the name of the measurement that was sent by the device to be included as a tag (index) for invalid measurements and as the fieldname for valid measurements sent to InfluxDB\nvar typeOfMeasurement = msg.payload.name;\n\n//gather the actual measurement value that was sent by the device to be included as the data for the field (when the measurement is valid) sent to InfluxDB\nvar theData = msg.payload.value;\n//initialize the measurements object\nvar measurementsObj = {};\n\n//initialize the tags (indices) object\nvar tagsObj = {};\n\n//create the object that will later be used to combine the measurementsObj and tagsObj\nvar combinedObj;\n\n//create the boolean that will be used to hold the evaluation of whether the measurement is valid or not\nvar validMeasurement;\n\n//create the booleans that will be used to hold whether the reason a measurement is invalid is because it is a non-standard type or\n// if the type of the measurement and the type passed from the device differ or\n// if the value (data) is null\nvar nonStandardType = false;\nvar measurementTypeMismatch = false;\nvar nullData = false;\n\n//create a boolean to keep track of if there are any tags (indices) that should be sent to the InfluxDB \n// it starts false but if any tag is valid then will become true. See below for what to send to InfluxDB based on valid measures and tags\nvar validTag = false;\n\n\n\nif ((typeof theData == msg.payload.dataType.toLowerCase()) || (msg.payload.dataType == 'ENUM') || (theData === null)) {\n    if (typeof theData == 'number') {\n        node.status({ fill: \"red\", shape: \"ring\", text: \"matched number\" });\n        if (!theData.isNaN) {\n            validMeasurement = true;\n        }\n    } else if (typeof theData == 'string') {\n        node.status({ fill: \"red\", shape: \"ring\", text: \"matched string\" });\n        //node.warn(\"50 length\")\n        if (theData.length >= 0) {\n            validMeasurement = true;\n        }\n    } else if (typeof theData == 'boolean') {\n        node.status({ fill: \"red\", shape: \"ring\", text: \"matched boolean\" });\n        validMeasurement = true;\n    } else if (msg.payload.dataType == 'ENUM') { //This is checking to make sure the value matches one of the values in the ENUM from the device \n        node.status({ fill: \"red\", shape: \"ring\", text: msg.payload.dataType + \" matched ENUM\" });\n\n        msg.payload.values.forEach(element => {\n            if (flow.get(deviceID + element) == theData) {\n                validMeasurement = true;\n            }\n        })\n    } else if (theData === null) {\n        node.status({ fill: \"red\", shape: \"ring\", text: \"matched null data\" });\n        nullData = true;\n    } else {\n        node.status({ fill: \"red\", shape: \"ring\", text: \"matched nonstandardtype\" });\n        nonStandardType = true;\n    }\n}\nelse {\n    node.status({ fill: \"red\", shape: \"ring\", text: \"measurement type mismatch\" });\n    measurementTypeMismatch = true;\n}\n\n\n\n\n//scanning all of the tags from the config node and creating a tag for that item if the entry on the config node has info\ncommonTags = [\"House\", \"Floor\", \"Room\", \"Location\", \"DeviceType\", \"Manufacturer\", \"AccessProtocol\", \"PhysicalVirtualType\", \"PhysicalDigitalRegular\"]\ncommonTags.forEach(element => {\n    //node.warn(\"84 length\")\n    //node.warn(element)\n    //node.warn(deviceID)\n    if (flow.get(deviceID + element).length > 0) {\n        tagsObj[element] = flow.get(deviceID + element)\n        validTag = true\n    }\n});\n\n//Based on whether or not the measurement is \"valid\" it either adds the device id to the tags or it goes to the else portion\nif (validMeasurement) {\n    measurementsObj[typeOfMeasurement] = theData;\n    //node.warn(\"94 length\")\n    if (deviceID.length > 0) {\n        tagsObj[\"DeviceID\"] = deviceID;\n        validTag = true;\n    }\n    if (validTag) {\n        combinedObj = [measurementsObj, tagsObj]\n    } else {\n        //skip tags if none would be valid\n        combinedObj = [measurementsObj]\n    }\n} else {\n\n    //if the measeurement was not \"valid\", then it puts in a Generic measurement of true and tag it as either Non-Standard Type of Measurement Type Mismatch\n    if (nonStandardType) {\n        measurementsObj[\"Generic\"] = true\n        tagsObj[\"ReasonGeneric\"] = \"Non-Standard Type\"\n        tagsObj[\"Measure\"] = typeOfMeasurement\n    }\n    //node.warn(\"113 length\")\n    if (deviceID.length > 0) {\n        tagsObj[\"DeviceID\"] = deviceID\n        validTag = true\n    }\n    if (measurementTypeMismatch) {\n        measurementsObj[\"Generic\"] = true\n        tagsObj[\"ReasonGeneric\"] = \"Measurement Type Mismatch\"\n        tagsObj[\"Measure\"] = typeOfMeasurement\n    }\n    //node.warn(\"123 length\")\n    if (deviceID.length > 0) {\n        tagsObj[\"DeviceID\"] = deviceID\n        validTag = true\n    }\n    combinedObj = [measurementsObj, tagsObj]\n}\n\n//put the object into the payload\nmsg.payload = combinedObj;\n\n//build the status to be shown on the status of the subnode\nmsg.status = typeOfMeasurement + \": \" + theData;\n\n/* MQTT section \n * \n * \n * \n */\n//create the placeholder object\nvar msg2 = {}\n//add the MQTT topic\nmsg2.topic = \"Homebridge/\" + flow.get(deviceID + \"MQTTDeviceTopic\") + \"/\" + typeOfMeasurement\n//add the data to be recorded to MQTT\nmsg2.payload = theData\n\n\n\n//send the created combinedObj downstream (to the InfluxDB node), but only if the measurement is not null\nif (!nullData) {\n    return [msg, msg2]\n}","outputs":2,"noerr":0,"x":2860,"y":460,"wires":[["27685686.faec2a","e648e029.afc3a"],["567d385d.589a18"]]},{"id":"567d385d.589a18","type":"mqtt out","z":"f9a34738.f12c28","name":"Write reading to MQTT","topic":"","qos":"1","retain":"true","broker":"a5bf81ee.27852","x":3160,"y":480,"wires":[]},{"id":"a4fea75b.dd8748","type":"function","z":"f9a34738.f12c28","name":"Splitting Preprocessor","func":"/*\n * Main function node code \n * \n */\n//Check if there is any data. If not, stop processing. At the time this was created, the trackData sent from a Hubitat Elevation device node was always null\nif (msg.payload.value === null) {\n    return null;\n}\n//delete the currentValue portion of the object since it is deprecated\ndelete msg.payload.currentValue\n//initial call into the recursive function\nhandlemsg(msg)\n//send nothing from main code\nreturn\n\n/*\n * Main recursive function code\n *\n */\n\nfunction handlemsg(msg) {\n    //The evaluation part of this switch/case statement determines which type of entity is in the value\n    //  the key idea is that once the value is an atomic item (number, string, bool) then the message should be sent out\n    //  of the node to downstream, but if the value is a splittable, then it should be split into multiple messages. These\n    //  messages are then evaulated individually. They in turn are either found to have atomic entries in the value or have\n    //  values that are themselves splittable.\n    //  For example:\n    //  JSON - each key value pair will be used to create a new msg. The msg.payload.name will be changed to add \":\" and the key\n    //          from the key value pair. The msg.payload.value will become the value from the key value pair\n    //  Array - TBAdded\n    //  Object - TBAdded\n    switch (typeofhubitatvalue(msg.payload.value, \"msg.payload.value\")) {\n        case \"number\":\n        case \"bigint\":\n            //numbers are an atomic type of value and should be sent to downstream nodes\n            msg.payload.dataType = \"Number\"\n            //send the version of the msg with an atomic value to downstream nodes\n            node.send(msg)\n            //do nothing more once msg has been sent\n            break;\n        case \"boolean\":\n            //Booleans are an atomic type of value and should be sent to downstream nodes\n            msg.payload.dataType = \"Boolean\"\n            //send the version of the msg with an atomic value to downstream nodes\n            node.send(msg)\n            //do nothing more once msg has been sent\n            break;\n        case \"string\":\n            //Strings are an atomic type of value and should be sent to downstream nodes\n            msg.payload.dataType = \"String\"\n            //send the version of the msg with an atomic value to downstream nodes\n            node.send(msg)\n            //do nothing more once msg has been sent\n            break;\n        case \"unsplittable array\":\n            //This case is where the item is an array, but with only a single entry. The idea is to move that single\n            //  value out of the array and into the value natively and then to call the recursive function to evaluate\n            //  what type of item it now is and then process (split or send or extract) appropriately\n            msg.payload.value = msg.payload.value[0]\n            handlemsg(msg)\n            break;\n        case \"splittable JSON\":\n            //This is for cases where the JSON is in the form of key:value where there is at least 1 pair\n            //  Examples of \"valid\" JSON that would not be coming to this case would be {} or 100\n            splitJSON(msg)\n            break;\n        case \"splittable array\":\n            //This is for cases where the Array is in the form [\"A\",\"B\",\"C\"] where there is are at least 2 members\n            //  SplitArray function not yet built. TBD\n            splitArray(msg)\n            break;\n        case \"unsplittable JSON\":\n            //This is for handling \"valid\" JSON that does not have key:value pairs.\n            //  Examples of \"valid\" JSON that are handed here are {} or 100 or \"100\"\n            //  This case either treats it as a string (no changes made) or a number where a number in\n            //  a string like \"100\" is changed into an actual number like 100\n\n            //by checking if NaN, if it is a number 100 or \"100\", the ++ followed by -- changes it to a number 100\n            //  without changing its actual value\n            if (isNaN(msg.payload.value)) { } else {\n                ++msg.payload.value\n                --msg.payload.value\n             }\n            //Sets the data type for downstream since the incoming message could have been a variety of types\n            //  before JSON, object or array was split\n            msg.payload.dataType = typeof (msg.payload.value)\n            //send the version of the msg with an atomic value to downstream nodes (could probably just recursively call\n            //  handlemsg, but I can't identify a circumstance where that would give a different result to downstream,\n            //  but this would be a place to investigate if downstream results are unexpected.)\n            node.send(msg)\n            break\n        case \"object\":\n            //This is for handling an object. It then calls splitObj to create multiple msgs with the object keys into the names\n            //  and the values from those keys moved into the value of the new object.\n            splitObj(msg)\n            break\n        default:\n            //This is just in case no valid process is found by the typeofhubitatvalue function.\n            //  If you encounter this then you will either need to investigate the function or contact tmichael in\n            //  Hubitat discourse forums https://community.hubitat.com/\n            return\n    }\n}\n\n/*\n * This function is used by the Main recursive function (handlemsg) to decide whether to send the msg on as\n *  the msg.payload.value is atomic or if it needs to split the value into multiple msgs\n *\n */\nfunction typeofhubitatvalue(value, source = \"\") {\n    switch (typeof (value)) {\n        case \"number\":\n            //atomic just return the result of typeof\n            return \"number\"\n            break;\n        case \"bigint\":\n            //atomic just return the result of typeof\n            return \"bigint\"\n            break;\n        case \"boolean\":\n            //atomic just return the result of typeof\n            return \"boolean\"\n            break;\n        case \"string\":\n            //most splittable values are encoded strictly as text and so may be identified as a string\n\n            //Fist check if the string is \"valid\" JSON\n            if (isvalidJSONstring(value)) {\n                //When it is \"valid\" JSON, check if it is splittable\n                if (issplittablevalidJSONstring(value)) {\n                    //When it is splittable, then return type as splittable JSON\n                    return \"splittable JSON\"\n                }\n                else\n                {\n                    //if it is JSON, but not splittable ({}, \"100, 100) return unsplittable JSON\n                    return \"unsplittable JSON\"\n                }\n            }\n            else\n            {\n                //When it isn't \"valid\" JSON, check if it is an array\n                if (isvalidarray(value)) {\n                    //When it is an array, check if it is splittable\n                    if (issplittablearray(value)) {\n                        //When it is splittable, return splittable Array\n                        return \"splittable Array\"\n                    }\n                    else\n                    {\n                        //if the array is not splittable ([\"apple\"]) return unsplittable array\n                        return \"unsplittable array\"\n                    }\n                }\n                else\n                {\n                    //When it is neither JSON or Array, then it is really just a string, so return string\n                    return \"string\"\n                }\n            }\n            break;\n        case \"object\":\n            //some  splittable values are identified as objects\n\n            //Fist check if the object is \"valid\" JSON\n            if (isvalidJSONstring(value)) {\n                //When it is \"valid\" JSON, check if it is splittable\n                if (issplittablevalidJSONstring(value)) {\n                    //When it is splittable, then return type as splittable JSON\n                    return \"splittable JSON\"\n                }\n                else\n                {\n                    //if it is JSON, but not splittable ({}, \"100, 100) return unsplittable JSON\n                    return \"unsplittable JSON\"\n                }\n            }\n            else\n            {\n                //When it isn't \"valid\" JSON, check if it is an array\n                if (isvalidarray(value)) {\n                    //When it is an array, check if it is splittable\n                    if (issplittablearray(value)) {\n                        //When it is splittable, return splittable Array\n                        return \"splittable Array\"\n                    }\n                    else {\n                        //if the array is not splittable ([\"apple\"]) return unsplittable array\n                        return \"unsplittable array\"\n                    }\n                }\n                else\n                {\n                    //When it is neither JSON or Array, then I have not accounted for it. If you reach this point during an\n                    //  investigation, it might be worth using the example that triggered your investigation to see if the object\n                    //  is really just a string (without a triggering example I have not investigated)\n                    return \"object\"\n                }\n            }\n            break;\n        default:\n            //When the type is not one that I coded for then return unhandled because the situation is by definition unhandled\n            return \"unhandled\"\n            break;\n    }\n}\n\n//True False functions\n/*\n * This function was found on the internet to check if an input is valid JSON\n * There seems to be a belief that there should be some more elegant method that trying parse and the catching the error,\n * but no one seems to have demonstrated what that more elegant way would be\n */\nfunction isvalidJSONstring(str) {\n    try {\n        JSON.parse(str);\n    } catch (e) {\n        return false;\n    }\n    return true;\n}\n\n/*\n * This function decides where the JSON is made up of at least 1 key:value pair\n */\nfunction issplittablevalidJSONstring(str) {\n    if (str.includes(\":\")) {\n        return true;\n    }\n    else {\n        return false;\n    }\n}\n/*\n * This function is simply wrapping the Array.isArray, to align the function naming with the other true false functions\n */\nfunction isvalidarray(str) {\n    if (Array.isArray(str)) {\n        return true;\n    }\n    else {\n        return false;\n    }\n}\n/*\n * This function identifies if the array has only a single entry or multiple entries i.e. [\"Apple\"] not splittable,\n *  [\"Apple\",\"Pear\"] splittable\n */\nfunction issplittablearray(str) {\n    // If the length is more than 1, then the array has mutliple entries, but if it is just 1, then it is not splittable\n    if (str.length > 1) {\n        return true;\n    }\n    else {\n        return false;\n    }\n}\n\n//Splitting functions\n/*\n * This function takes in a msg where msg.payload.value is splittable JSON and iterates through all key:value pairs and then\n *  recursively calls handlemsg with multiple messages. Each new message retains most of the details of the input message, \n *  but the name and value are changed.\n *  The name has the key from the key:value pair appended with a : as a seperator\n *  The value is replaced with the value from the key:value pair\n *  A new message is created for each key:value pair\n */\nfunction splitJSON(latestMsg) {\n    //put the inputs value into a variable for easier access\n    var valueJSON = JSON.parse(latestMsg.payload.value);\n    //put the inputs name aside for multiple reuses\n    var name = latestMsg.payload.name\n    //Iterative loop\n    Object.keys(valueJSON).forEach(function (key) {\n        //concatenate the original name, a colon and the key from the pair\n        latestMsg.payload.name = name + \":\" + key;\n        //move the value from the pair to payload.value\n        latestMsg.payload.value = valueJSON[key];\n        //recursively call this function in case the value is itself splittable\n        handlemsg(latestMsg)\n    }\n    )\n    return\n}\n\n/*\n * This function takes in a msg where msg.payload.value is splittable object\n *  and iterates through all key:value pairs and then\n *  recursively calls handlemsg with multiple messages. Each new message retains most of the details of the input message,\n *  but the name and value are changed.\n *  The name has the key from the key:value pair appended with a : as a seperator\n *  The value is replaced with the value from the key:value pair\n *  A new message is created for each key:value pair\n *  \n *  Note: While working on the splitArray function, I realized that I may not have tested this on an object value with multiple\n *  pairs, so it is possible that the function only handles the first pair\n */\nfunction splitObj(oMsg) {\n    //put the inputs name aside for multiple reuses\n    var name = oMsg.payload.name\n    //Iterative loop\n    for (let [key, value] of Object.entries(oMsg.payload.value)) {\n        if ((value !== null) && (key !== null)) {\n            oMsg.payload.name = name + \":\" + key;\n            oMsg.payload.value = value;\n            //recursively call this function in case the value is itself splittable\n            handlemsg(oMsg)\n        }\n    }\n}\n\n/*\n * Note: At the time of creation, I did not have a live example and had too many other things in the works to construct one.\n * \n * This function takes in a msg where msg.payload.value is splittable array\n *  and iterates through all entries and recursively calls handlemsg with multiple messages. \n *  Each new message retains most of the details of the input message,\n *  but the value is changed.\n *  The value is replaced with the value from the entry in the Array\n *  For example if the input value is [\"Apple\",\"Pear\"], then the first msg will have a value of \"Apple\"\n *  and the second will have a value of \"Pear\"\n */\nfunction splitArray(aMsg) {\n    //Iterative loop\n    for (index = 0; index < aMsg.payload.value.length; index++) {\n        (aMsg.payload.value = aMsg.payload.value[index]);\n        //recursively call this function in case the value is itself splittable\n        handlemsg(aMsg)\n    }\n}","outputs":1,"noerr":0,"x":2580,"y":460,"wires":[["5f42d976.714a58"]]},{"id":"e648e029.afc3a","type":"change","z":"f9a34738.f12c28","name":"needed?? Move Status to Payload for Consumption by Status Node","rules":[{"t":"set","p":"payload","pt":"msg","to":"status","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":3300,"y":440,"wires":[[]]},{"id":"1b13a87.0d07e58","type":"hb-status","z":"f9a34738.f12c28","name":"Downstairs Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestDownstairs Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":710,"y":1480,"wires":[["5b95acb3.6703c4"]]},{"id":"ea65001b.4eed9","type":"switch","z":"f9a34738.f12c28","name":"10TF Translate","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":3210,"y":60,"wires":[["12d3c9f2.fc39a6"],["9c3b0ec9.7f3be"]],"outputLabels":["True","False"]},{"id":"12d3c9f2.fc39a6","type":"change","z":"f9a34738.f12c28","name":"Value True","rules":[{"t":"set","p":"name","pt":"msg","to":"msg.name&\"TranslatedToBoolean\"\t","tot":"jsonata"},{"t":"set","p":"payload","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":3380,"y":40,"wires":[["97e5868a.1f6d68"]]},{"id":"9c3b0ec9.7f3be","type":"change","z":"f9a34738.f12c28","name":"Value False","rules":[{"t":"set","p":"name","pt":"msg","to":"msg.name&\"TranslatedToBoolean\"\t\t","tot":"jsonata"},{"t":"set","p":"payload","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":3380,"y":80,"wires":[["97e5868a.1f6d68"]]},{"id":"bd274667.e264c8","type":"change","z":"f9a34738.f12c28","name":"CtoF Translate","rules":[{"t":"set","p":"name","pt":"msg","to":"msg.name&\"F\"\t","tot":"jsonata"},{"t":"set","p":"payload","pt":"msg","to":"payload*9/5+32","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":3210,"y":120,"wires":[["29b82fd4.8eec1"]]},{"id":"4b38e4c.5af8f1c","type":"switch","z":"f9a34738.f12c28","name":"CurrentHeatingCoolingState Translate","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"str"},{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"str"},{"t":"eq","v":"3","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":3260,"y":220,"wires":[["ff99cc8c.1b17"],["252f93bc.e62a0c"],["c5356c3f.41874"],["5afc7f76.72e51"]],"outputLabels":["off","heat","cool","heat-cool"]},{"id":"ff99cc8c.1b17","type":"change","z":"f9a34738.f12c28","name":"Value Off","rules":[{"t":"set","p":"name","pt":"msg","to":"msg.name&\"TranslatedToBoolean\"\t","tot":"jsonata"},{"t":"set","p":"payload","pt":"msg","to":"off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":3510,"y":160,"wires":[["2b4cceab.bf3d92"]]},{"id":"252f93bc.e62a0c","type":"change","z":"f9a34738.f12c28","name":"Value Heat","rules":[{"t":"set","p":"name","pt":"msg","to":"msg.name&\"TranslatedToBoolean\"\t","tot":"jsonata"},{"t":"set","p":"payload","pt":"msg","to":"heat","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":3520,"y":200,"wires":[["2b4cceab.bf3d92"]]},{"id":"c5356c3f.41874","type":"change","z":"f9a34738.f12c28","name":"Value Cool","rules":[{"t":"set","p":"name","pt":"msg","to":"msg.name&\"TranslatedToBoolean\"\t","tot":"jsonata"},{"t":"set","p":"payload","pt":"msg","to":"cool","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":3520,"y":240,"wires":[["2b4cceab.bf3d92"]]},{"id":"5afc7f76.72e51","type":"change","z":"f9a34738.f12c28","name":"Value Heat-Cool","rules":[{"t":"set","p":"name","pt":"msg","to":"msg.name&\"TranslatedToBoolean\"\t","tot":"jsonata"},{"t":"set","p":"payload","pt":"msg","to":"heat-cool","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":3530,"y":280,"wires":[["2b4cceab.bf3d92"]]},{"id":"647cd3f8.06a1bc","type":"config","z":"f9a34738.f12c28","name":"HB001 Anyone Presence","properties":[{"p":"HB001Floor","pt":"flow","to":"","tot":"str"},{"p":"HB001Location","pt":"flow","to":"","tot":"str"},{"p":"HB001Room","pt":"flow","to":"","tot":"str"},{"p":"HB001DeviceType","pt":"flow","to":"Presence","tot":"str"},{"p":"HB001Manufacturer","pt":"flow","to":"homebridge-people-geofence","tot":"str"},{"p":"HB001AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB001PhysicalVirtualType","pt":"flow","to":"Virtual","tot":"str"},{"p":"HB001PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB001House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB001MQTTDeviceTopic","pt":"flow","to":"Anyone Present","tot":"str"},{"p":"HB001OccupancyDetected","pt":"flow","to":"10TF","tot":"str"}],"active":true,"x":170,"y":720,"wires":[]},{"id":"52bf20d9.2c66e","type":"config","z":"f9a34738.f12c28","name":"HB002 Downstairs Carbon Monoxide","properties":[{"p":"HB002Floor","pt":"flow","to":"1","tot":"str"},{"p":"HB002Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB002Room","pt":"flow","to":"Mini-Hall","tot":"str"},{"p":"HB002DeviceType","pt":"flow","to":"CO","tot":"str"},{"p":"HB002Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB002AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB002PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB002PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB002House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB002MQTTDeviceTopic","pt":"flow","to":"Downwstair Hall Nest Protect","tot":"str"},{"p":"HB002CarbonMonoxideDetected","pt":"flow","to":"10TF","tot":"str"},{"p":"HB002StatusLowBattery","pt":"flow","to":"10TF","tot":"str"},{"p":"HB002StatusActive","pt":"flow","to":"null","tot":"str"},{"p":"HB002ManualTestActive","pt":"flow","to":"null","tot":"str"}],"active":true,"x":210,"y":1479,"wires":[]},{"id":"798f469f.1fce38","type":"comment","z":"f9a34738.f12c28","name":"Presence Sensors","info":"","x":150,"y":680,"wires":[]},{"id":"56aa56fb.dda018","type":"comment","z":"f9a34738.f12c28","name":"Placeholder Kathy Home","info":"","x":170,"y":960,"wires":[]},{"id":"1ef57e64.81fd82","type":"change","z":"f9a34738.f12c28","name":"","rules":[{"t":"set","p":"TranslationTarget","pt":"msg","to":"DeviceID&name","tot":"jsonata"},{"t":"set","p":"TranslationType","pt":"msg","to":"$flowContext([$$.TranslationTarget])","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":2790,"y":20,"wires":[["be9353ed.da2b6","57819b5c.3b68f4"]]},{"id":"be9353ed.da2b6","type":"switch","z":"f9a34738.f12c28","name":"","property":"TranslationType","propertyType":"msg","rules":[{"t":"eq","v":"10TF","vt":"str"},{"t":"eq","v":"C2F","vt":"str"},{"t":"eq","v":"NestThMap","vt":"str"},{"t":"eq","v":"012CF","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":3000,"y":160,"wires":[["ea65001b.4eed9"],["bd274667.e264c8"],["4b38e4c.5af8f1c"],["f42f879e.018fe8"]],"outputLabels":["1 or 0 to True or False Map","Celcius to Fahrenheit Conversion","Nest Thermostat Map","Celcius or Fahrenheit Map"]},{"id":"6dad159c.2922fc","type":"link in","z":"f9a34738.f12c28","name":"Cleanup Parse and Send","links":["97e5868a.1f6d68","57819b5c.3b68f4","29b82fd4.8eec1","2b4cceab.bf3d92","171e5c14.6a53b4"],"x":2150,"y":460,"wires":[["a6bbf579.19e548"]],"l":true},{"id":"97e5868a.1f6d68","type":"link out","z":"f9a34738.f12c28","name":"Go To Cleanup, Parse and Send","links":["6dad159c.2922fc"],"x":3620,"y":60,"wires":[],"l":true},{"id":"57819b5c.3b68f4","type":"link out","z":"f9a34738.f12c28","name":"Go To Cleanup, Parse and Send","links":["6dad159c.2922fc"],"x":3040,"y":20,"wires":[],"l":true},{"id":"29b82fd4.8eec1","type":"link out","z":"f9a34738.f12c28","name":"Go To Cleanup, Parse and Send","links":["6dad159c.2922fc"],"x":3440,"y":120,"wires":[],"l":true},{"id":"2b4cceab.bf3d92","type":"link out","z":"f9a34738.f12c28","name":"Go To Cleanup, Parse and Send","links":["6dad159c.2922fc"],"x":3800,"y":220,"wires":[],"l":true},{"id":"5b95acb3.6703c4","type":"change","z":"f9a34738.f12c28","name":"DeviceID HB002","rules":[{"t":"set","p":"DeviceID","pt":"msg","to":"HB002","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1000,"y":1500,"wires":[["90ec7406.2298d8"]]},{"id":"1603ee4.7168c12","type":"link in","z":"f9a34738.f12c28","name":"Jump In","links":["c8fbb0bd.33e56","90ec7406.2298d8","cd7d5571.9128d8","f3a2d75c.740ec8","81537293.13e73"],"x":1290,"y":780,"wires":[[]],"l":true},{"id":"202dcb4.a2a8734","type":"hb-status","z":"f9a34738.f12c28","name":"Anyone","Homebridge":"Homebridge","Manufacturer":"Default-Manufacturer","Service":"Occupancy Sensor","device":"HomebridgeCC:22:3D:E3:CE:30Default-ManufacturerAnyone00000086","conf":"df59aa47.b26148","x":400,"y":720,"wires":[["f7257b5f.36fde8"]]},{"id":"f7257b5f.36fde8","type":"change","z":"f9a34738.f12c28","name":"DeviceID HB001","rules":[{"t":"set","p":"DeviceID","pt":"msg","to":"HB001","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":740,"wires":[["cd7d5571.9128d8"]]},{"id":"c8fbb0bd.33e56","type":"link out","z":"f9a34738.f12c28","name":"Go To Jump In","links":["1603ee4.7168c12"],"x":1260,"y":2240,"wires":[],"l":true},{"id":"d26af67.632a608","type":"hb-status","z":"f9a34738.f12c28","name":"Downstairs Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestDownstairs Motion00000085","conf":"df59aa47.b26148","x":690,"y":2520,"wires":[["636d300.353bbd"]]},{"id":"748df81f.2777b8","type":"config","z":"f9a34738.f12c28","name":"HB003 Downstairs Motion Sensor","properties":[{"p":"HB003Floor","pt":"flow","to":"1","tot":"str"},{"p":"HB003Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB003Room","pt":"flow","to":"Mini-Hall","tot":"str"},{"p":"HB003DeviceType","pt":"flow","to":"Motion Sensor","tot":"str"},{"p":"HB003Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB003AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB003PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB003PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB003House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB003MQTTDeviceTopic","pt":"flow","to":"Downwstair Hall Nest Protect","tot":"str"},{"p":"HB003MotionDetected","pt":"flow","to":"null","tot":"str"}],"active":true,"x":200,"y":2520,"wires":[]},{"id":"636d300.353bbd","type":"change","z":"f9a34738.f12c28","name":"DeviceID HB003","rules":[{"t":"set","p":"DeviceID","pt":"msg","to":"HB003","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1020,"y":2540,"wires":[["f3a2d75c.740ec8"]]},{"id":"cd850a69.e4ed28","type":"hb-status","z":"f9a34738.f12c28","name":"Downstairs Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestDownstairs Smoke00000087","conf":"df59aa47.b26148","x":690,"y":3200,"wires":[["84bd556d.20f958"]]},{"id":"84bd556d.20f958","type":"change","z":"f9a34738.f12c28","name":"DeviceID HB004","rules":[{"t":"set","p":"DeviceID","pt":"msg","to":"HB004","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1020,"y":3220,"wires":[["81537293.13e73"]]},{"id":"e024dd52.5928f","type":"config","z":"f9a34738.f12c28","name":"HB004 Downstairs Smoke","properties":[{"p":"HB004Floor","pt":"flow","to":"1","tot":"str"},{"p":"HB004Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB004Room","pt":"flow","to":"Mini-Hall","tot":"str"},{"p":"HB004DeviceType","pt":"flow","to":"CO","tot":"str"},{"p":"HB004Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB004AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB004PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB004PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB004House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB004MQTTDeviceTopic","pt":"flow","to":"Downwstair Hall Nest Protect","tot":"str"},{"p":"HB004SmokeDetected","pt":"flow","to":"10TF","tot":"str"},{"p":"HB004StatusLowBattery","pt":"flow","to":"10TF","tot":"str"},{"p":"HB004StatusActive","pt":"flow","to":"null","tot":"str"},{"p":"HB004ManualTestActive","pt":"flow","to":"null","tot":"str"}],"active":true,"x":170,"y":3200,"wires":[]},{"id":"bedd60b7.1ca69","type":"hb-status","z":"f9a34738.f12c28","name":"Gratuity Thermostat - Eco Mode","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Switch","device":"HomebridgeCC:22:3D:E3:CE:30NestGratuity Thermostat - Eco Mode00000049","conf":"df59aa47.b26148","x":730,"y":2160,"wires":[["9d5d566.2ff75a8"]]},{"id":"9d5d566.2ff75a8","type":"change","z":"f9a34738.f12c28","name":"DeviceID HB005","rules":[{"t":"set","p":"DeviceID","pt":"msg","to":"HB005","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1020,"y":2180,"wires":[["c8fbb0bd.33e56"]]},{"id":"c524a6e4.936cb8","type":"config","z":"f9a34738.f12c28","name":"HB005 Gratuity Thermostat Eco ","properties":[{"p":"HB005Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB005Location","pt":"flow","to":"North","tot":"str"},{"p":"HB005Room","pt":"flow","to":"Upstairs Hall","tot":"str"},{"p":"HB005DeviceType","pt":"flow","to":"Thermostat","tot":"str"},{"p":"HB005Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB005AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB005PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB005PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB005House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB005MQTTDeviceTopic","pt":"flow","to":"Nest Thermostat Eco Mode","tot":"str"},{"p":"HB005On","pt":"flow","to":"null","tot":"str"}],"active":true,"x":190,"y":2160,"wires":[]},{"id":"18d88d36.df96f3","type":"hb-status","z":"f9a34738.f12c28","name":"Gratuity Thermostat - Fan","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Fan","device":"HomebridgeCC:22:3D:E3:CE:30NestGratuity Thermostat - Fan00000040","conf":"df59aa47.b26148","x":710,"y":2240,"wires":[["ef866360.cdb2f"]]},{"id":"ef866360.cdb2f","type":"change","z":"f9a34738.f12c28","name":"DeviceID HB006","rules":[{"t":"set","p":"DeviceID","pt":"msg","to":"HB006","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1020,"y":2260,"wires":[["c8fbb0bd.33e56"]]},{"id":"aaff02bb.982ff","type":"config","z":"f9a34738.f12c28","name":"HB006 Gratuity Thermostat Fan","properties":[{"p":"HB006Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB006Location","pt":"flow","to":"North","tot":"str"},{"p":"HB006Room","pt":"flow","to":"Upstairs Hall","tot":"str"},{"p":"HB006DeviceType","pt":"flow","to":"Thermostat","tot":"str"},{"p":"HB006Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB006AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB006PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB006PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB006House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB006MQTTDeviceTopic","pt":"flow","to":"Nest Thermostat Fan Mode","tot":"str"},{"p":"HB006On","pt":"flow","to":"null","tot":"str"}],"active":true,"x":190,"y":2240,"wires":[]},{"id":"660ce4a4.5c000c","type":"hb-status","z":"f9a34738.f12c28","name":"Gratuity Thermostat","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Thermostat","device":"HomebridgeCC:22:3D:E3:CE:30NestGratuity Thermostat0000004A","conf":"df59aa47.b26148","x":690,"y":2320,"wires":[["57b61fd.c48b8e"]]},{"id":"57b61fd.c48b8e","type":"change","z":"f9a34738.f12c28","name":"DeviceID HB007","rules":[{"t":"set","p":"DeviceID","pt":"msg","to":"HB007","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1020,"y":2340,"wires":[["c8fbb0bd.33e56"]]},{"id":"3fae24ba.73728c","type":"config","z":"f9a34738.f12c28","name":"HB007 Gratuity Thermostat","properties":[{"p":"HB007Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB007Location","pt":"flow","to":"North","tot":"str"},{"p":"HB007Room","pt":"flow","to":"Upstairs Hall","tot":"str"},{"p":"HB007DeviceType","pt":"flow","to":"Thermostat","tot":"str"},{"p":"HB007Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB007AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB007PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB007PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB007House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB007MQTTDeviceTopic","pt":"flow","to":"Nest Thermostat","tot":"str"},{"p":"HB007CurrentHeatingCoolingState","pt":"flow","to":"NestThMap","tot":"str"},{"p":"HB007TargetHeatingCoolingState","pt":"flow","to":"NestThMap","tot":"str"},{"p":"HB007CurrentTemperature","pt":"flow","to":"C2F","tot":"str"},{"p":"HB007TargetTemperature","pt":"flow","to":"C2F","tot":"str"},{"p":"HB007TemperatureDisplayUnits","pt":"flow","to":"012CF","tot":"str"},{"p":"HB007CurrentRelativeHumidity","pt":"flow","to":"null","tot":"str"},{"p":"HB007CoolingThresholdTemperature","pt":"flow","to":"C2F","tot":"str"},{"p":"HB007HeatingThresholdTemperature","pt":"flow","to":"C2F","tot":"str"},{"p":"HB007StatusActive","pt":"flow","to":"null","tot":"str"},{"p":"HB007FanTimerActive","pt":"flow","to":"null","tot":"str"},{"p":"HB007FanTimerDuration","pt":"flow","to":"null","tot":"str"},{"p":"HB007HasLeaf","pt":"flow","to":"null","tot":"str"},{"p":"HB007SunlightCorrectionEnabled","pt":"flow","to":"null","tot":"str"},{"p":"HB007SunlightCorrectionActive","pt":"flow","to":"null","tot":"str"},{"p":"HB007UsingEmergencyHeat","pt":"flow","to":"null","tot":"str"}],"active":true,"x":180,"y":2320,"wires":[]},{"id":"f42f879e.018fe8","type":"switch","z":"f9a34738.f12c28","name":"012CF Translate","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":3200,"y":340,"wires":[["1bb18fa1.44e16"],["56f65d6.dcc4da4"]],"outputLabels":["True","False"]},{"id":"1bb18fa1.44e16","type":"change","z":"f9a34738.f12c28","name":"Value Fahrenheit","rules":[{"t":"set","p":"name","pt":"msg","to":"msg.name&\"TranslatedToBoolean\"\t","tot":"jsonata"},{"t":"set","p":"payload","pt":"msg","to":"Fahrenheit","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":3408,"y":320,"wires":[["171e5c14.6a53b4"]]},{"id":"56f65d6.dcc4da4","type":"change","z":"f9a34738.f12c28","name":"Value Celcius","rules":[{"t":"set","p":"name","pt":"msg","to":"msg.name&\"TranslatedToBoolean\"\t\t","tot":"jsonata"},{"t":"set","p":"payload","pt":"msg","to":"Celcius","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":3398,"y":360,"wires":[["171e5c14.6a53b4"]]},{"id":"171e5c14.6a53b4","type":"link out","z":"f9a34738.f12c28","name":"Go To Cleanup, Parse and Send","links":["6dad159c.2922fc"],"x":3668,"y":340,"wires":[],"l":true},{"id":"5d85e6a0.8c26d8","type":"config","z":"f9a34738.f12c28","name":"HB009 Mike Home Presence","properties":[{"p":"HB009Floor","pt":"flow","to":"","tot":"str"},{"p":"HB009Location","pt":"flow","to":"","tot":"str"},{"p":"HB009Room","pt":"flow","to":"","tot":"str"},{"p":"HB009DeviceType","pt":"flow","to":"Presence","tot":"str"},{"p":"HB009Manufacturer","pt":"flow","to":"homebridge-people-geofence","tot":"str"},{"p":"HB009AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB009PhysicalVirtualType","pt":"flow","to":"Virtual","tot":"str"},{"p":"HB009PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB009House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB009MQTTDeviceTopic","pt":"flow","to":"Mike Home","tot":"str"},{"p":"HB009OccupancyDetected","pt":"flow","to":"10TF","tot":"str"}],"active":true,"x":180,"y":800,"wires":[]},{"id":"b583e09d.b680f","type":"hb-status","z":"f9a34738.f12c28","name":"Mike iPhone Home","Homebridge":"Homebridge","Manufacturer":"Default-Manufacturer","Service":"Occupancy Sensor","device":"HomebridgeCC:22:3D:E3:CE:30Default-ManufacturerMike iPhone Home00000086","conf":"df59aa47.b26148","x":430,"y":800,"wires":[["63cab4e2.8e7d6c"]]},{"id":"63cab4e2.8e7d6c","type":"change","z":"f9a34738.f12c28","name":"DeviceID HB009","rules":[{"t":"set","p":"DeviceID","pt":"msg","to":"HB009","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":820,"wires":[["cd7d5571.9128d8"]]},{"id":"1ab09f9a.d8911","type":"comment","z":"f9a34738.f12c28","name":"Placeholder Eva Home","info":"","x":160,"y":1040,"wires":[]},{"id":"715f3010.d8f07","type":"comment","z":"f9a34738.f12c28","name":"Placeholder Eva LTHS","info":"","x":160,"y":1120,"wires":[]},{"id":"9af2e3e2.a0002","type":"comment","z":"f9a34738.f12c28","name":"Placeholder Eva CTE","info":"","x":160,"y":1200,"wires":[]},{"id":"be9be4aa.ade968","type":"comment","z":"f9a34738.f12c28","name":"Placeholder Eva Dance","info":"","x":160,"y":1280,"wires":[]},{"id":"3c034631.98a37a","type":"comment","z":"f9a34738.f12c28","name":"Placeholder Kathy Dance","info":"","x":170,"y":1360,"wires":[]},{"id":"d1bc6ca6.77628","type":"comment","z":"f9a34738.f12c28","name":"Placeholder Mike Work","info":"","x":160,"y":880,"wires":[]},{"id":"bcf152a2.df2c6","type":"comment","z":"f9a34738.f12c28","name":"Nest Protect CO","info":"","x":140,"y":1440,"wires":[]},{"id":"78318771.a939e8","type":"hb-status","z":"f9a34738.f12c28","name":"Eva Hallway Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestEva Hallway Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":710,"y":1560,"wires":[["db5046b9.ea5b68"]]},{"id":"ff8357f7.c621b8","type":"config","z":"f9a34738.f12c28","name":"HB010 Eva Hallway Carbon Monoxide","properties":[{"p":"HB010Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB010Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB010Room","pt":"flow","to":"Upstairs Hallway","tot":"str"},{"p":"HB010DeviceType","pt":"flow","to":"CO","tot":"str"},{"p":"HB010Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB010AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB010PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB010PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB010House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB010MQTTDeviceTopic","pt":"flow","to":"Eva Hallway Nest Protect","tot":"str"},{"p":"HB010CarbonMonoxideDetected","pt":"flow","to":"10TF","tot":"str"},{"p":"HB010StatusLowBattery","pt":"flow","to":"10TF","tot":"str"},{"p":"HB010StatusActive","pt":"flow","to":"null","tot":"str"},{"p":"HB010ManualTestActive","pt":"flow","to":"null","tot":"str"}],"active":true,"x":210,"y":1560,"wires":[]},{"id":"db5046b9.ea5b68","type":"change","z":"f9a34738.f12c28","name":"DeviceID HB010","rules":[{"t":"set","p":"DeviceID","pt":"msg","to":"HB010","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1000,"y":1580,"wires":[["90ec7406.2298d8"]]},{"id":"6b6855e9.dac06c","type":"hb-status","z":"f9a34738.f12c28","name":"Evas Bedroom Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestEvas Bedroom Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":720,"y":1640,"wires":[["c53a4c63.fae2f"]]},{"id":"9fb26d60.e31ce","type":"config","z":"f9a34738.f12c28","name":"HB011 Eva's Bedroom Carbon Monoxide","properties":[{"p":"HB011Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB011Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB011Room","pt":"flow","to":"Eva's Room","tot":"str"},{"p":"HB011DeviceType","pt":"flow","to":"CO","tot":"str"},{"p":"HB011Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB011AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB011PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB011PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB011House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB011MQTTDeviceTopic","pt":"flow","to":"Eva's Bedroom Nest Protect","tot":"str"},{"p":"HB011CarbonMonoxideDetected","pt":"flow","to":"10TF","tot":"str"},{"p":"HB011StatusLowBattery","pt":"flow","to":"10TF","tot":"str"},{"p":"HB011StatusActive","pt":"flow","to":"null","tot":"str"},{"p":"HB011ManualTestActive","pt":"flow","to":"null","tot":"str"}],"active":true,"x":220,"y":1640,"wires":[]},{"id":"c53a4c63.fae2f","type":"change","z":"f9a34738.f12c28","name":"DeviceID    HB011","rules":[{"t":"set","p":"DeviceID","pt":"msg","to":"HB011","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1000,"y":1660,"wires":[["90ec7406.2298d8"]]},{"id":"adfeed17.0987e","type":"hb-status","z":"f9a34738.f12c28","name":"Game Room Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestGame Room Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":710,"y":1720,"wires":[["1f972683.0eaff9"]]},{"id":"f37ec77a.4b7938","type":"config","z":"f9a34738.f12c28","name":"HB012 Game Room Carbon Monoxide","properties":[{"p":"HB012Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB012Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB012Room","pt":"flow","to":"Game Room","tot":"str"},{"p":"HB012DeviceType","pt":"flow","to":"CO","tot":"str"},{"p":"HB012Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB012AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB012PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB012PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB012House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB012MQTTDeviceTopic","pt":"flow","to":"Game Room Nest Protect","tot":"str"},{"p":"HB012CarbonMonoxideDetected","pt":"flow","to":"10TF","tot":"str"},{"p":"HB012StatusLowBattery","pt":"flow","to":"10TF","tot":"str"},{"p":"HB012StatusActive","pt":"flow","to":"null","tot":"str"},{"p":"HB012ManualTestActive","pt":"flow","to":"null","tot":"str"}],"active":true,"x":210,"y":1720,"wires":[]},{"id":"1f972683.0eaff9","type":"change","z":"f9a34738.f12c28","name":"DeviceID HB012","rules":[{"t":"set","p":"DeviceID","pt":"msg","to":"HB012","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1000,"y":1740,"wires":[["90ec7406.2298d8"]]},{"id":"1c0ae1de.24557e","type":"hb-status","z":"f9a34738.f12c28","name":"Guest Bedroom Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestGuest Bedroom Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":720,"y":1800,"wires":[["16523dae.1d4ab2"]]},{"id":"dcc1725c.1008c","type":"config","z":"f9a34738.f12c28","name":"HB013 Guest Bedroom Carbon Monoxide","properties":[{"p":"HB013Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB013Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB013Room","pt":"flow","to":"Guest Room","tot":"str"},{"p":"HB013DeviceType","pt":"flow","to":"CO","tot":"str"},{"p":"HB013Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB013AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB013PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB013PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB013House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB013MQTTDeviceTopic","pt":"flow","to":"Guest Room Nest Protect","tot":"str"},{"p":"HB013CarbonMonoxideDetected","pt":"flow","to":"10TF","tot":"str"},{"p":"HB013StatusLowBattery","pt":"flow","to":"10TF","tot":"str"},{"p":"HB013StatusActive","pt":"flow","to":"null","tot":"str"},{"p":"HB013ManualTestActive","pt":"flow","to":"null","tot":"str"}],"active":true,"x":220,"y":1800,"wires":[]},{"id":"16523dae.1d4ab2","type":"change","z":"f9a34738.f12c28","name":"DeviceID HB013","rules":[{"t":"set","p":"DeviceID","pt":"msg","to":"HB013","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1000,"y":1820,"wires":[["90ec7406.2298d8"]]},{"id":"3caf4319.a1ecfc","type":"hb-status","z":"f9a34738.f12c28","name":"Master Bedroom Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestMaster Bedroom Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":720,"y":1880,"wires":[["980378d9.2ceb48"]]},{"id":"c8ce36a6.1dd2a8","type":"config","z":"f9a34738.f12c28","name":"HB014 Master Bedroom Carbon Monoxide","properties":[{"p":"HB014Floor","pt":"flow","to":"1","tot":"str"},{"p":"HB014Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB014Room","pt":"flow","to":"Master Bedroom","tot":"str"},{"p":"HB014DeviceType","pt":"flow","to":"CO","tot":"str"},{"p":"HB014Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB014AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB014PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB014PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB014House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB014MQTTDeviceTopic","pt":"flow","to":"Master Bedroom Nest Protect","tot":"str"},{"p":"HB014CarbonMonoxideDetected","pt":"flow","to":"10TF","tot":"str"},{"p":"HB014StatusLowBattery","pt":"flow","to":"10TF","tot":"str"},{"p":"HB014StatusActive","pt":"flow","to":"null","tot":"str"},{"p":"HB014ManualTestActive","pt":"flow","to":"null","tot":"str"}],"active":true,"x":230,"y":1880,"wires":[]},{"id":"980378d9.2ceb48","type":"change","z":"f9a34738.f12c28","name":"DeviceID HB014","rules":[{"t":"set","p":"DeviceID","pt":"msg","to":"HB014","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1000,"y":1900,"wires":[["90ec7406.2298d8"]]},{"id":"a0bd1182.45b31","type":"hb-status","z":"f9a34738.f12c28","name":"Toy Room Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestToy Room Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":700,"y":1960,"wires":[["e0d4f5c5.a1b428"]]},{"id":"a2a8a1f5.0f524","type":"config","z":"f9a34738.f12c28","name":"HB015 Toy Room Carbon Monoxide","properties":[{"p":"HB015Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB015Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB015Room","pt":"flow","to":"Toy Room","tot":"str"},{"p":"HB015DeviceType","pt":"flow","to":"CO","tot":"str"},{"p":"HB015Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB015AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB015PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB015PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB015House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB015MQTTDeviceTopic","pt":"flow","to":"Toy Room Nest Protect","tot":"str"},{"p":"HB015CarbonMonoxideDetected","pt":"flow","to":"10TF","tot":"str"},{"p":"HB015StatusLowBattery","pt":"flow","to":"10TF","tot":"str"},{"p":"HB015StatusActive","pt":"flow","to":"null","tot":"str"},{"p":"HB015ManualTestActive","pt":"flow","to":"null","tot":"str"}],"active":true,"x":200,"y":1960,"wires":[]},{"id":"e0d4f5c5.a1b428","type":"change","z":"f9a34738.f12c28","name":"DeviceID HB015","rules":[{"t":"set","p":"DeviceID","pt":"msg","to":"HB015","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1000,"y":1980,"wires":[["90ec7406.2298d8"]]},{"id":"f4585f0b.b4c2b","type":"hb-status","z":"f9a34738.f12c28","name":"Toy Room Hallway Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestToy Room Hallway Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":730,"y":2040,"wires":[["cdee6060.7dc84"]]},{"id":"9939ada.1e3df5","type":"config","z":"f9a34738.f12c28","name":"HB016 Toy Room Hallway Carbon Monoxide","properties":[{"p":"HB016Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB016Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB016Room","pt":"flow","to":"Upstairs Hallway","tot":"str"},{"p":"HB016DeviceType","pt":"flow","to":"CO","tot":"str"},{"p":"HB016Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB016AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB016PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB016PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB016House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB016MQTTDeviceTopic","pt":"flow","to":"Toy Room Hallway Nest Protect","tot":"str"},{"p":"HB016CarbonMonoxideDetected","pt":"flow","to":"10TF","tot":"str"},{"p":"HB016StatusLowBattery","pt":"flow","to":"10TF","tot":"str"},{"p":"HB016StatusActive","pt":"flow","to":"null","tot":"str"},{"p":"HB016ManualTestActive","pt":"flow","to":"null","tot":"str"}],"active":true,"x":230,"y":2040,"wires":[]},{"id":"cdee6060.7dc84","type":"change","z":"f9a34738.f12c28","name":"DeviceID HB016","rules":[{"t":"set","p":"DeviceID","pt":"msg","to":"HB016","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1000,"y":2060,"wires":[["90ec7406.2298d8"]]},{"id":"90ec7406.2298d8","type":"link out","z":"f9a34738.f12c28","name":"Go To Jump In","links":["1603ee4.7168c12"],"x":1240,"y":1800,"wires":[],"l":true},{"id":"cd7d5571.9128d8","type":"link out","z":"f9a34738.f12c28","name":"Go To Jump In","links":["1603ee4.7168c12"],"x":1080,"y":780,"wires":[],"l":true},{"id":"f3a2d75c.740ec8","type":"link out","z":"f9a34738.f12c28","name":"Go To Jump In","links":["1603ee4.7168c12"],"x":1260,"y":2780,"wires":[],"l":true},{"id":"aab44d16.50feb","type":"hb-status","z":"f9a34738.f12c28","name":"Eva Hallway Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestEva Hallway Motion00000085","conf":"df59aa47.b26148","x":690,"y":2600,"wires":[["4b4d6e64.d94ae"]]},{"id":"4b4d6e64.d94ae","type":"change","z":"f9a34738.f12c28","name":"DeviceID HB017","rules":[{"t":"set","p":"DeviceID","pt":"msg","to":"HB017","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1020,"y":2620,"wires":[["f3a2d75c.740ec8"]]},{"id":"a2e52c08.00d87","type":"hb-status","z":"f9a34738.f12c28","name":"Evas Bedroom Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestEvas Bedroom Motion00000085","conf":"df59aa47.b26148","x":700,"y":2680,"wires":[["d286bd34.626bc"]]},{"id":"d286bd34.626bc","type":"change","z":"f9a34738.f12c28","name":"DeviceID HB018","rules":[{"t":"set","p":"DeviceID","pt":"msg","to":"HB018","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1020,"y":2700,"wires":[["f3a2d75c.740ec8"]]},{"id":"b13bd099.b9d3e","type":"hb-status","z":"f9a34738.f12c28","name":"Guest Bedroom Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestGuest Bedroom Motion00000085","conf":"df59aa47.b26148","x":710,"y":2840,"wires":[["7bf58fcc.11142"]]},{"id":"7bf58fcc.11142","type":"change","z":"f9a34738.f12c28","name":"DeviceID HB020","rules":[{"t":"set","p":"DeviceID","pt":"msg","to":"HB020","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1020,"y":2860,"wires":[["f3a2d75c.740ec8"]]},{"id":"1b89af40.f8f521","type":"hb-status","z":"f9a34738.f12c28","name":"Master Bedroom Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestMaster Bedroom Motion00000085","conf":"df59aa47.b26148","x":710,"y":2920,"wires":[["59ae9905.4884b8"]]},{"id":"59ae9905.4884b8","type":"change","z":"f9a34738.f12c28","name":"DeviceID HB021","rules":[{"t":"set","p":"DeviceID","pt":"msg","to":"HB021","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1020,"y":2940,"wires":[["f3a2d75c.740ec8"]]},{"id":"cc1cf75c.d6be08","type":"hb-status","z":"f9a34738.f12c28","name":"Toy Room Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestToy Room Motion00000085","conf":"df59aa47.b26148","x":690,"y":3000,"wires":[["d52ef045.cd6d5"]]},{"id":"d52ef045.cd6d5","type":"change","z":"f9a34738.f12c28","name":"DeviceID HB022","rules":[{"t":"set","p":"DeviceID","pt":"msg","to":"HB022","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1020,"y":3020,"wires":[["f3a2d75c.740ec8"]]},{"id":"40db4052.cf63f","type":"hb-status","z":"f9a34738.f12c28","name":"Toy Room Hallway Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestToy Room Hallway Motion00000085","conf":"df59aa47.b26148","x":710,"y":3080,"wires":[["9b2c44ce.7a9758"]]},{"id":"9b2c44ce.7a9758","type":"change","z":"f9a34738.f12c28","name":"DeviceID HB023","rules":[{"t":"set","p":"DeviceID","pt":"msg","to":"HB023","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1020,"y":3100,"wires":[["f3a2d75c.740ec8"]]},{"id":"3fc34fc9.2889c","type":"config","z":"f9a34738.f12c28","name":"HB017 Eva Hallway Motion Sensor","properties":[{"p":"HB017Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB017Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB017Room","pt":"flow","to":"Upstairs Hallway","tot":"str"},{"p":"HB017DeviceType","pt":"flow","to":"Motion Sensor","tot":"str"},{"p":"HB017Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB017AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB017PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB017PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB017House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB017MQTTDeviceTopic","pt":"flow","to":"Eva Hallway Nest Protect","tot":"str"},{"p":"HB017MotionDetected","pt":"flow","to":"null","tot":"str"}],"active":true,"x":200,"y":2600,"wires":[]},{"id":"8db32853.2b2f28","type":"config","z":"f9a34738.f12c28","name":"HB018 Eva's Bedroom Motion Sensor","properties":[{"p":"HB018Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB018Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB018Room","pt":"flow","to":"Eva's Room","tot":"str"},{"p":"HB018DeviceType","pt":"flow","to":"Motion Sensor","tot":"str"},{"p":"HB018Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB018AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB018PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB018PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB018House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB018MQTTDeviceTopic","pt":"flow","to":"Eva's Bedroom Nest Protect","tot":"str"},{"p":"HB018MotionDetected","pt":"flow","to":"null","tot":"str"}],"active":true,"x":210,"y":2680,"wires":[]},{"id":"912b2c47.24fa5","type":"config","z":"f9a34738.f12c28","name":"HB020 Guest Room Motion Sensor","properties":[{"p":"HB020Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB020Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB020Room","pt":"flow","to":"Guest Room","tot":"str"},{"p":"HB020DeviceType","pt":"flow","to":"Motion Sensor","tot":"str"},{"p":"HB020Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB020AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB020PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB020PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB020House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB020MQTTDeviceTopic","pt":"flow","to":"Guest Room Nest Protect","tot":"str"},{"p":"HB020MotionDetected","pt":"flow","to":"null","tot":"str"}],"active":true,"x":200,"y":2840,"wires":[]},{"id":"9b33930f.bbff5","type":"config","z":"f9a34738.f12c28","name":"HB021 Master Bedroom Motion Sensor","properties":[{"p":"HB021Floor","pt":"flow","to":"1","tot":"str"},{"p":"HB021Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB021Room","pt":"flow","to":"Master Bedroom","tot":"str"},{"p":"HB021DeviceType","pt":"flow","to":"Motion Sensor","tot":"str"},{"p":"HB021Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB021AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB021PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB021PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB021House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB021MQTTDeviceTopic","pt":"flow","to":"Master Bedroom Nest Protect","tot":"str"},{"p":"HB021MotionDetected","pt":"flow","to":"null","tot":"str"}],"active":true,"x":220,"y":2920,"wires":[]},{"id":"bf4c5b6a.ea75b8","type":"config","z":"f9a34738.f12c28","name":"HB022 Toy Room Motion Sensor","properties":[{"p":"HB022Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB022Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB022Room","pt":"flow","to":"Toy Room","tot":"str"},{"p":"HB022DeviceType","pt":"flow","to":"Motion Sensor","tot":"str"},{"p":"HB022Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB022AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB022PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB022PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB022House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB022MQTTDeviceTopic","pt":"flow","to":"Toy Room Nest Protect","tot":"str"},{"p":"HB022MotionDetected","pt":"flow","to":"null","tot":"str"}],"active":true,"x":190,"y":3000,"wires":[]},{"id":"2d493413.40938c","type":"config","z":"f9a34738.f12c28","name":"HB023 Toy Room Hallway Motion Sensor","properties":[{"p":"HB023Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB023Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB023Room","pt":"flow","to":"Upstairs Hallway","tot":"str"},{"p":"HB023DeviceType","pt":"flow","to":"Motion Sensor","tot":"str"},{"p":"HB023Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB023AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB023PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB023PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB023House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB023MQTTDeviceTopic","pt":"flow","to":"Toy Room Hallway Nest Protect","tot":"str"},{"p":"HB023MotionDetected","pt":"flow","to":"null","tot":"str"}],"active":true,"x":220,"y":3080,"wires":[]},{"id":"eeae0d7f.b3561","type":"hb-status","z":"f9a34738.f12c28","name":"Game Room Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestGame Room Motion00000085","conf":"df59aa47.b26148","x":700,"y":2760,"wires":[["f9e0d4d6.f72528"]]},{"id":"f9e0d4d6.f72528","type":"change","z":"f9a34738.f12c28","name":"DeviceID HB019","rules":[{"t":"set","p":"DeviceID","pt":"msg","to":"HB019","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1020,"y":2780,"wires":[["f3a2d75c.740ec8"]]},{"id":"c38e45a9.bda0e8","type":"config","z":"f9a34738.f12c28","name":"HB019 GameRoom Motion Sensor","properties":[{"p":"HB019Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB019Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB019Room","pt":"flow","to":"Game Room","tot":"str"},{"p":"HB019DeviceType","pt":"flow","to":"Motion Sensor","tot":"str"},{"p":"HB019Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB019AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB019PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB019PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB019House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB019MQTTDeviceTopic","pt":"flow","to":"Game Room Nest Protect","tot":"str"},{"p":"HB019MotionDetected","pt":"flow","to":"null","tot":"str"}],"active":true,"x":200,"y":2760,"wires":[]},{"id":"b97ce64.e6ec618","type":"comment","z":"f9a34738.f12c28","name":"Nest Protect Smoke","info":"","x":150,"y":3160,"wires":[]},{"id":"81537293.13e73","type":"link out","z":"f9a34738.f12c28","name":"Go To Jump In","links":["1603ee4.7168c12"],"x":1260,"y":3500,"wires":[],"l":true},{"id":"3be02020.93799","type":"hb-status","z":"f9a34738.f12c28","name":"Eva Hallway Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestEva Hallway Smoke00000087","conf":"df59aa47.b26148","x":700,"y":3280,"wires":[["17fe7b33.7df185"]]},{"id":"17fe7b33.7df185","type":"change","z":"f9a34738.f12c28","name":"DeviceID HB024","rules":[{"t":"set","p":"DeviceID","pt":"msg","to":"HB024","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1020,"y":3300,"wires":[["81537293.13e73"]]},{"id":"91975f7b.808d5","type":"config","z":"f9a34738.f12c28","name":"HB024 Eva Hallway Smoke","properties":[{"p":"HB024Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB024Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB024Room","pt":"flow","to":"Upstairs Hallway","tot":"str"},{"p":"HB024DeviceType","pt":"flow","to":"CO","tot":"str"},{"p":"HB024Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB024AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB024PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB024PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB024House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB024MQTTDeviceTopic","pt":"flow","to":"Eva Hallway Nest Protect","tot":"str"},{"p":"HB024SmokeDetected","pt":"flow","to":"10TF","tot":"str"},{"p":"HB024StatusLowBattery","pt":"flow","to":"10TF","tot":"str"},{"p":"HB024StatusActive","pt":"flow","to":"null","tot":"str"},{"p":"HB024ManualTestActive","pt":"flow","to":"null","tot":"str"}],"active":true,"x":180,"y":3280,"wires":[]},{"id":"9e5d8bab.af25b8","type":"hb-status","z":"f9a34738.f12c28","name":"Evas Bedroom Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestEvas Bedroom Smoke00000087","conf":"df59aa47.b26148","x":700,"y":3360,"wires":[["ca08351c.a95028"]]},{"id":"ca08351c.a95028","type":"change","z":"f9a34738.f12c28","name":"DeviceID HB025","rules":[{"t":"set","p":"DeviceID","pt":"msg","to":"HB025","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1020,"y":3380,"wires":[["81537293.13e73"]]},{"id":"757b9442.e6863c","type":"config","z":"f9a34738.f12c28","name":"HB025 Evas Bedroom Smoke","properties":[{"p":"HB025Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB025Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB025Room","pt":"flow","to":"Eva's Room","tot":"str"},{"p":"HB025DeviceType","pt":"flow","to":"CO","tot":"str"},{"p":"HB025Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB025AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB025PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB025PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB025House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB025MQTTDeviceTopic","pt":"flow","to":"Eva's Bedroom Nest Protect","tot":"str"},{"p":"HB025SmokeDetected","pt":"flow","to":"10TF","tot":"str"},{"p":"HB025StatusLowBattery","pt":"flow","to":"10TF","tot":"str"},{"p":"HB025StatusActive","pt":"flow","to":"null","tot":"str"},{"p":"HB025ManualTestActive","pt":"flow","to":"null","tot":"str"}],"active":true,"x":190,"y":3360,"wires":[]},{"id":"11192dbb.00ea72","type":"hb-status","z":"f9a34738.f12c28","name":"Game Room Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestGame Room Smoke00000087","conf":"df59aa47.b26148","x":700,"y":3440,"wires":[["42f7c1d5.c7d4f"]]},{"id":"42f7c1d5.c7d4f","type":"change","z":"f9a34738.f12c28","name":"DeviceID HB026","rules":[{"t":"set","p":"DeviceID","pt":"msg","to":"HB026","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1020,"y":3460,"wires":[["81537293.13e73"]]},{"id":"54253810.43d5c8","type":"config","z":"f9a34738.f12c28","name":"HB026 Game Room Smoke","properties":[{"p":"HB026Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB026Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB026Room","pt":"flow","to":"Game Room","tot":"str"},{"p":"HB026DeviceType","pt":"flow","to":"CO","tot":"str"},{"p":"HB026Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB026AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB026PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB026PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB026House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB026MQTTDeviceTopic","pt":"flow","to":"Game Room Nest Protect","tot":"str"},{"p":"HB026SmokeDetected","pt":"flow","to":"10TF","tot":"str"},{"p":"HB026StatusLowBattery","pt":"flow","to":"10TF","tot":"str"},{"p":"HB026StatusActive","pt":"flow","to":"null","tot":"str"},{"p":"HB026ManualTestActive","pt":"flow","to":"null","tot":"str"}],"active":true,"x":180,"y":3440,"wires":[]},{"id":"364b41.bb52b4c","type":"hb-status","z":"f9a34738.f12c28","name":"Guest Bedroom Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestGuest Bedroom Smoke00000087","conf":"df59aa47.b26148","x":710,"y":3520,"wires":[["d0a6e049.ebc7"]]},{"id":"d0a6e049.ebc7","type":"change","z":"f9a34738.f12c28","name":"DeviceID HB027","rules":[{"t":"set","p":"DeviceID","pt":"msg","to":"HB027","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1020,"y":3540,"wires":[["81537293.13e73"]]},{"id":"fe1cb05d.1ac9a","type":"config","z":"f9a34738.f12c28","name":"HB027 Guest Bedroom Smoke","properties":[{"p":"HB027Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB027Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB027Room","pt":"flow","to":"Guest Room","tot":"str"},{"p":"HB027DeviceType","pt":"flow","to":"CO","tot":"str"},{"p":"HB027Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB027AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB027PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB027PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB027House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB027MQTTDeviceTopic","pt":"flow","to":"Guest Room Nest Protect","tot":"str"},{"p":"HB027SmokeDetected","pt":"flow","to":"10TF","tot":"str"},{"p":"HB027StatusLowBattery","pt":"flow","to":"10TF","tot":"str"},{"p":"HB027StatusActive","pt":"flow","to":"null","tot":"str"},{"p":"HB027ManualTestActive","pt":"flow","to":"null","tot":"str"}],"active":true,"x":190,"y":3520,"wires":[]},{"id":"925697a0.b848f8","type":"hb-status","z":"f9a34738.f12c28","name":"Master Bedroom Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestMaster Bedroom Smoke00000087","conf":"df59aa47.b26148","x":710,"y":3600,"wires":[["f61875b0.4d5f98"]]},{"id":"f61875b0.4d5f98","type":"change","z":"f9a34738.f12c28","name":"DeviceID HB028","rules":[{"t":"set","p":"DeviceID","pt":"msg","to":"HB028","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1020,"y":3620,"wires":[["81537293.13e73"]]},{"id":"87286fc7.46572","type":"config","z":"f9a34738.f12c28","name":"HB028 Master Bedroom Smoke","properties":[{"p":"HB028Floor","pt":"flow","to":"1","tot":"str"},{"p":"HB028Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB028Room","pt":"flow","to":"Master Bedroom","tot":"str"},{"p":"HB028DeviceType","pt":"flow","to":"CO","tot":"str"},{"p":"HB028Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB028AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB028PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB028PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB028House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB028MQTTDeviceTopic","pt":"flow","to":"Master Bedroom Nest Protect","tot":"str"},{"p":"HB028SmokeDetected","pt":"flow","to":"10TF","tot":"str"},{"p":"HB028StatusLowBattery","pt":"flow","to":"10TF","tot":"str"},{"p":"HB028StatusActive","pt":"flow","to":"null","tot":"str"},{"p":"HB028ManualTestActive","pt":"flow","to":"null","tot":"str"}],"active":true,"x":190,"y":3600,"wires":[]},{"id":"65db2405.46f30c","type":"hb-status","z":"f9a34738.f12c28","name":"Toy Room Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestToy Room Smoke00000087","conf":"df59aa47.b26148","x":690,"y":3680,"wires":[["459b6782.84a098"]]},{"id":"459b6782.84a098","type":"change","z":"f9a34738.f12c28","name":"DeviceID HB029","rules":[{"t":"set","p":"DeviceID","pt":"msg","to":"HB029","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1020,"y":3700,"wires":[["81537293.13e73"]]},{"id":"8894eb52.20dcd8","type":"config","z":"f9a34738.f12c28","name":"HB029 Toy Room Smoke","properties":[{"p":"HB029Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB029Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB029Room","pt":"flow","to":"Toy Room","tot":"str"},{"p":"HB029DeviceType","pt":"flow","to":"CO","tot":"str"},{"p":"HB029Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB029AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB029PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB029PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB029House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB029MQTTDeviceTopic","pt":"flow","to":"Toy Room Nest Protect","tot":"str"},{"p":"HB029SmokeDetected","pt":"flow","to":"10TF","tot":"str"},{"p":"HB029StatusLowBattery","pt":"flow","to":"10TF","tot":"str"},{"p":"HB029StatusActive","pt":"flow","to":"null","tot":"str"},{"p":"HB029ManualTestActive","pt":"flow","to":"null","tot":"str"}],"active":true,"x":170,"y":3680,"wires":[]},{"id":"7d4a10e7.f416e","type":"hb-status","z":"f9a34738.f12c28","name":"Toy Room Hallway Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestToy Room Hallway Smoke00000087","conf":"df59aa47.b26148","x":710,"y":3760,"wires":[["58f0cb48.60e4a4"]]},{"id":"58f0cb48.60e4a4","type":"change","z":"f9a34738.f12c28","name":"DeviceID HB030","rules":[{"t":"set","p":"DeviceID","pt":"msg","to":"HB030","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1020,"y":3780,"wires":[["81537293.13e73"]]},{"id":"35c29021.baf","type":"config","z":"f9a34738.f12c28","name":"HB030 Toy Room Hallway Smoke","properties":[{"p":"HB030Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB030Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB030Room","pt":"flow","to":"Upstairs Hallway","tot":"str"},{"p":"HB030DeviceType","pt":"flow","to":"CO","tot":"str"},{"p":"HB030Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB030AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB030PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB030PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB030House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB030MQTTDeviceTopic","pt":"flow","to":"Toy Room Hallway Nest Protect","tot":"str"},{"p":"HB030SmokeDetected","pt":"flow","to":"10TF","tot":"str"},{"p":"HB030StatusLowBattery","pt":"flow","to":"10TF","tot":"str"},{"p":"HB030StatusActive","pt":"flow","to":"null","tot":"str"},{"p":"HB030ManualTestActive","pt":"flow","to":"null","tot":"str"}],"active":true,"x":200,"y":3760,"wires":[]},{"id":"d4130c1.d9792f","type":"comment","z":"f9a34738.f12c28","name":"Nest Thermostat","info":"","x":140,"y":2120,"wires":[]},{"id":"9c027d37.ed6e6","type":"hb-status","z":"f9a34738.f12c28","name":"Eve Motion Passthrough","Homebridge":"Homebridge","Manufacturer":"Default-Manufacturer","Service":"Switch","device":"HomebridgeCC:22:3D:E3:CE:30Default-ManufacturerEve Motion Passthrough00000049","conf":"df59aa47.b26148","x":710,"y":2440,"wires":[["6b3e7071.2fb57"]]},{"id":"6b3e7071.2fb57","type":"change","z":"f9a34738.f12c28","name":"DeviceID HB031","rules":[{"t":"set","p":"DeviceID","pt":"msg","to":"HB031","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1020,"y":2460,"wires":[["f3a2d75c.740ec8"]]},{"id":"e059fe7f.6fcf7","type":"config","z":"f9a34738.f12c28","name":"HB031 Eve Motion Passthrough","properties":[{"p":"HB031Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB031Location","pt":"flow","to":"South by Doorway","tot":"str"},{"p":"HB031Room","pt":"flow","to":"Game Room","tot":"str"},{"p":"HB031DeviceType","pt":"flow","to":"Motion Sensor","tot":"str"},{"p":"HB031Manufacturer","pt":"flow","to":"Eve","tot":"str"},{"p":"HB031AccessProtocol","pt":"flow","to":"Bluetooth","tot":"str"},{"p":"HB031PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB031PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB031House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB031MQTTDeviceTopic","pt":"flow","to":"Eve Motion Sensor","tot":"str"},{"p":"HB031On","pt":"flow","to":"null","tot":"str"}],"active":true,"x":190,"y":2440,"wires":[]},{"id":"8ee0b80b.800658","type":"comment","z":"f9a34738.f12c28","name":"Motion Sensors","info":"","x":140,"y":2400,"wires":[]},{"id":"9b3443eb.7f318","type":"hb-event","z":"f9a34738.f12c28","name":"Eve Motion Passthrough","Homebridge":"Homebridge","Manufacturer":"Default-Manufacturer","Service":"Switch","device":"HomebridgeCC:22:3D:E3:CE:30Default-ManufacturerEve Motion Passthrough00000049","conf":"df59aa47.b26148","x":710,"y":2480,"wires":[["6b3e7071.2fb57"]]},{"id":"9eacb317.51d7c","type":"hb-event","z":"f9a34738.f12c28","name":"Gratuity Thermostat","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Thermostat","device":"HomebridgeCC:22:3D:E3:CE:30NestGratuity Thermostat0000004A","conf":"df59aa47.b26148","x":690,"y":2360,"wires":[["57b61fd.c48b8e"]]},{"id":"95f99121.2cccd","type":"hb-event","z":"f9a34738.f12c28","name":"Gratuity Thermostat - Fan","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Fan","device":"HomebridgeCC:22:3D:E3:CE:30NestGratuity Thermostat - Fan00000040","conf":"df59aa47.b26148","x":710,"y":2280,"wires":[["ef866360.cdb2f"]]},{"id":"781c5ae7.1ade54","type":"hb-event","z":"f9a34738.f12c28","name":"Gratuity Thermostat - Eco Mode","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Switch","device":"HomebridgeCC:22:3D:E3:CE:30NestGratuity Thermostat - Eco Mode00000049","conf":"df59aa47.b26148","x":730,"y":2200,"wires":[["9d5d566.2ff75a8"]]},{"id":"b32422bd.d01b","type":"hb-event","z":"f9a34738.f12c28","name":"Downstairs Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestDownstairs Motion00000085","conf":"df59aa47.b26148","x":690,"y":2560,"wires":[["636d300.353bbd"]]},{"id":"befc182.a3c90e8","type":"hb-event","z":"f9a34738.f12c28","name":"Eva Hallway Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestEva Hallway Motion00000085","conf":"df59aa47.b26148","x":690,"y":2640,"wires":[["4b4d6e64.d94ae"]]},{"id":"92f7d254.e5e24","type":"hb-event","z":"f9a34738.f12c28","name":"Evas Bedroom Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestEvas Bedroom Motion00000085","conf":"df59aa47.b26148","x":700,"y":2720,"wires":[["d286bd34.626bc"]]},{"id":"18dc8b04.70cc65","type":"hb-event","z":"f9a34738.f12c28","name":"Game Room Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestGame Room Motion00000085","conf":"df59aa47.b26148","x":690,"y":2800,"wires":[["f9e0d4d6.f72528"]]},{"id":"29e7a548.6f8a5a","type":"hb-event","z":"f9a34738.f12c28","name":"Guest Bedroom Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestGuest Bedroom Motion00000085","conf":"df59aa47.b26148","x":700,"y":2880,"wires":[["7bf58fcc.11142"]]},{"id":"cc7e1bfa.bddc38","type":"hb-event","z":"f9a34738.f12c28","name":"Master Bedroom Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestMaster Bedroom Motion00000085","conf":"df59aa47.b26148","x":700,"y":2960,"wires":[["59ae9905.4884b8"]]},{"id":"33414bae.7dce84","type":"hb-event","z":"f9a34738.f12c28","name":"Toy Room Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestToy Room Motion00000085","conf":"df59aa47.b26148","x":680,"y":3040,"wires":[["d52ef045.cd6d5"]]},{"id":"4b571d69.850e34","type":"hb-event","z":"f9a34738.f12c28","name":"Toy Room Hallway Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestToy Room Hallway Motion00000085","conf":"df59aa47.b26148","x":710,"y":3120,"wires":[["9b2c44ce.7a9758"]]},{"id":"f1184b12.2b2b48","type":"hb-event","z":"f9a34738.f12c28","name":"Downstairs Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestDownstairs Smoke00000087","conf":"df59aa47.b26148","x":690,"y":3240,"wires":[["84bd556d.20f958"]]},{"id":"2b010923.710376","type":"hb-event","z":"f9a34738.f12c28","name":"Eva Hallway Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestEva Hallway Smoke00000087","conf":"df59aa47.b26148","x":690,"y":3320,"wires":[["17fe7b33.7df185"]]},{"id":"cf2fe02a.9e6e5","type":"hb-event","z":"f9a34738.f12c28","name":"Evas Bedroom Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestEvas Bedroom Smoke00000087","conf":"df59aa47.b26148","x":700,"y":3400,"wires":[["ca08351c.a95028"]]},{"id":"51d9e16c.9d1aa","type":"hb-event","z":"f9a34738.f12c28","name":"Game Room Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestGame Room Smoke00000087","conf":"df59aa47.b26148","x":690,"y":3480,"wires":[["42f7c1d5.c7d4f"]]},{"id":"e8f08cec.2494f","type":"hb-event","z":"f9a34738.f12c28","name":"Guest Bedroom Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestGuest Bedroom Smoke00000087","conf":"df59aa47.b26148","x":700,"y":3560,"wires":[["d0a6e049.ebc7"]]},{"id":"89119260.e835","type":"hb-event","z":"f9a34738.f12c28","name":"Master Bedroom Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestMaster Bedroom Smoke00000087","conf":"df59aa47.b26148","x":710,"y":3640,"wires":[["f61875b0.4d5f98"]]},{"id":"78b46a33.31d464","type":"hb-event","z":"f9a34738.f12c28","name":"Toy Room Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestToy Room Smoke00000087","conf":"df59aa47.b26148","x":680,"y":3720,"wires":[["459b6782.84a098"]]},{"id":"49decd71.acbd04","type":"hb-event","z":"f9a34738.f12c28","name":"Toy Room Hallway Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestToy Room Hallway Smoke00000087","conf":"df59aa47.b26148","x":710,"y":3800,"wires":[["58f0cb48.60e4a4"]]},{"id":"7b371695.401bc8","type":"hb-event","z":"f9a34738.f12c28","name":"Downstairs Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestDownstairs Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":700,"y":1520,"wires":[["5b95acb3.6703c4"]]},{"id":"9f3c275c.0c8f78","type":"hb-event","z":"f9a34738.f12c28","name":"Eva Hallway Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestEva Hallway Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":710,"y":1600,"wires":[["db5046b9.ea5b68"]]},{"id":"9ac0f0fd.fca53","type":"hb-event","z":"f9a34738.f12c28","name":"Evas Bedroom Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestEvas Bedroom Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":710,"y":1680,"wires":[["c53a4c63.fae2f"]]},{"id":"b02821e.f1ac3e","type":"hb-event","z":"f9a34738.f12c28","name":"Game Room Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestGame Room Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":710,"y":1760,"wires":[["1f972683.0eaff9"]]},{"id":"fef20ede.6177a","type":"hb-event","z":"f9a34738.f12c28","name":"Guest Bedroom Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestGuest Bedroom Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":720,"y":1840,"wires":[["16523dae.1d4ab2"]]},{"id":"4e35d578.3c110c","type":"hb-event","z":"f9a34738.f12c28","name":"Master Bedroom Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestMaster Bedroom Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":720,"y":1920,"wires":[["980378d9.2ceb48"]]},{"id":"e8b918b1.147db8","type":"hb-event","z":"f9a34738.f12c28","name":"Toy Room Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestToy Room Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":700,"y":2000,"wires":[["e0d4f5c5.a1b428"]]},{"id":"1f806b72.fa6b25","type":"hb-event","z":"f9a34738.f12c28","name":"Toy Room Hallway Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestToy Room Hallway Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":720,"y":2080,"wires":[["cdee6060.7dc84"]]},{"id":"cefbdf8.a07b92","type":"hb-event","z":"f9a34738.f12c28","name":"Anyone","Homebridge":"Homebridge","Manufacturer":"Default-Manufacturer","Service":"Occupancy Sensor","device":"HomebridgeCC:22:3D:E3:CE:30Default-ManufacturerAnyone00000086","conf":"df59aa47.b26148","x":390,"y":760,"wires":[["f7257b5f.36fde8"]]},{"id":"4b2aa4b1.3fcc5c","type":"hb-event","z":"f9a34738.f12c28","name":"Mike iPhone Home","Homebridge":"Homebridge","Manufacturer":"Default-Manufacturer","Service":"Occupancy Sensor","device":"HomebridgeCC:22:3D:E3:CE:30Default-ManufacturerMike iPhone Home00000086","conf":"df59aa47.b26148","x":430,"y":840,"wires":[["63cab4e2.8e7d6c"]]},{"id":"4f285b5d.c38f54","type":"link out","z":"f9a34738.f12c28","name":"Go To Prepopulate When Triggered","links":["27360a42.d6fb36","a7412d51.61ec2","b4d90ffd.ff375","2ebae543.d8331a","20b20d29.bcd242","27122768.aab468","1477ba60.9984b6","f0808b86.806db8","e772584b.aec7e8","de8eb49f.38fd18","b2877917.448a98","6804f008.b2126","a4be9a2.85cfd68"],"x":240,"y":40,"wires":[],"l":true},{"id":"2ebae543.d8331a","type":"link in","z":"f9a34738.f12c28","name":"Prepopulate","links":["4f285b5d.c38f54","c91be57d.4adbd8"],"x":230,"y":760,"wires":[["202dcb4.a2a8734","b583e09d.b680f"]],"l":true},{"id":"20b20d29.bcd242","type":"link in","z":"f9a34738.f12c28","name":"Prepopulate","links":["4f285b5d.c38f54"],"x":430,"y":1760,"wires":[["1b13a87.0d07e58","78318771.a939e8","6b6855e9.dac06c","adfeed17.0987e","1c0ae1de.24557e","3caf4319.a1ecfc","a0bd1182.45b31","f4585f0b.b4c2b"]],"l":true},{"id":"27122768.aab468","type":"link in","z":"f9a34738.f12c28","name":"Prepopulate","links":["4f285b5d.c38f54","c91be57d.4adbd8"],"x":450,"y":2240,"wires":[["bedd60b7.1ca69","18d88d36.df96f3","660ce4a4.5c000c"]],"l":true},{"id":"1477ba60.9984b6","type":"link in","z":"f9a34738.f12c28","name":"Prepopulate","links":["4f285b5d.c38f54","c91be57d.4adbd8"],"x":450,"y":2800,"wires":[["9c027d37.ed6e6","d26af67.632a608","aab44d16.50feb","a2e52c08.00d87","eeae0d7f.b3561","b13bd099.b9d3e","1b89af40.f8f521","cc1cf75c.d6be08","40db4052.cf63f"]],"l":true},{"id":"f0808b86.806db8","type":"link in","z":"f9a34738.f12c28","name":"Prepopulate","links":["4f285b5d.c38f54","c91be57d.4adbd8"],"x":450,"y":3480,"wires":[["cd850a69.e4ed28","3be02020.93799","9e5d8bab.af25b8","11192dbb.00ea72","364b41.bb52b4c","925697a0.b848f8","65db2405.46f30c","7d4a10e7.f416e"]],"l":true},{"id":"2f464d73.081182","type":"function","z":"f9a34738.f12c28","name":"","func":"global.set(\"1Before\", msg)\nreturn msg;","outputs":1,"noerr":0,"x":2760,"y":520,"wires":[[]]},{"id":"777bf417.0ecbbc","type":"function","z":"f9a34738.f12c28","name":"","func":"global.set(\"2InfluxOut\", msg)\nreturn msg;","outputs":1,"noerr":0,"x":3080,"y":540,"wires":[[]]},{"id":"244a5829.ac4bb8","type":"function","z":"f9a34738.f12c28","name":"","func":"global.set(\"3MQTTOut\", msg)\nreturn msg;","outputs":1,"noerr":0,"x":3220,"y":540,"wires":[[]]},{"id":"3902c9f.2f36d36","type":"mqtt in","z":"98a6e865.a02ea8","name":"","topic":"zigbee2mqtt/Remote_5_Buttons","qos":"2","datatype":"json","broker":"a5bf81ee.27852","x":270,"y":400,"wires":[["a6ca8257.77159"]]},{"id":"a6ca8257.77159","type":"switch","z":"98a6e865.a02ea8","name":"","property":"payload.action","propertyType":"msg","rules":[{"t":"eq","v":"toggle","vt":"str"},{"t":"eq","v":"brightness_down_click","vt":"str"},{"t":"eq","v":"brightness_up_click","vt":"str"},{"t":"eq","v":"arrow_left_click","vt":"str"},{"t":"eq","v":"arrow_right_click","vt":"str"}],"checkall":"true","repair":false,"outputs":5,"x":470,"y":400,"wires":[["6338070a.bcc328"],[],[],[],[]]},{"id":"6338070a.bcc328","type":"hubitat device","z":"98a6e865.a02ea8","name":"Mike Credenza Light","server":"55e4481a.722098","deviceId":"388","attribute":"switch","sendEvent":false,"x":680,"y":380,"wires":[["4550010.2bf78"]]},{"id":"4550010.2bf78","type":"switch","z":"98a6e865.a02ea8","name":"Off/On","property":"payload.value","propertyType":"msg","rules":[{"t":"eq","v":"off","vt":"str"},{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":900,"y":380,"wires":[["7be32827.eeaac8"],["e006e93f.81f6b8"]]},{"id":"7be32827.eeaac8","type":"change","z":"98a6e865.a02ea8","name":"On","rules":[{"t":"set","p":"command","pt":"msg","to":"on","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1020,"y":360,"wires":[["a122e4d8.6d4938"]]},{"id":"e006e93f.81f6b8","type":"change","z":"98a6e865.a02ea8","name":"Off","rules":[{"t":"set","p":"command","pt":"msg","to":"off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1020,"y":400,"wires":[["b1b0bd6f.3f716"]]},{"id":"a122e4d8.6d4938","type":"hubitat command","z":"98a6e865.a02ea8","name":"Mike Credenza Light","server":"55e4481a.722098","deviceId":"388","command":"off","commandArgs":"","x":1230,"y":360,"wires":[[]]},{"id":"b1b0bd6f.3f716","type":"hubitat command","z":"98a6e865.a02ea8","name":"Mike Credenza Light","server":"55e4481a.722098","deviceId":"388","command":"on","commandArgs":"","x":1230,"y":400,"wires":[[]]},{"id":"d0c066c4.642c18","type":"function","z":"1a0aa13a.9d7b8f","name":"Format for InfluxDB & MQTT Homebridge","func":"/* This function takes input from a hubitat device node and data stored in config node which holds details about the device\n * and creates an properly formated object to be sent to InfluxDB node via output 1 which will in turn write to the InfluxDB\n * It also formats an MQTT topic and the data sending that to output 2 which in turn can be used by an MQTT node to send to \n * MQTT\n * \n * \n */\n//gather the name of the device which had a reading that triggered the flow to be included as a tag (index) sent to InfluxDB\n//note: this is the hubitat device ID\nvar deviceID = msg.payload.deviceId;\n//node.warn(\"11 \"+ deviceID)\n//gather the name of the measurement that was sent by the device to be included as a tag (index) for invalid measurements and as the fieldname for valid measurements sent to InfluxDB\nvar registration = msg.payload.registration;\nvar  flight = msg.payload.flight;\nvar  callsign = msg.payload.callsign;\nvar  origin = msg.payload.origin;\nvar  destination= msg.payload.destination;\nvar altitude = msg.payload.altitude;\nvar  bearing = msg.payload.bearing;\nvar  speed = msg.payload.speed;\nvar  rateOfClimb = msg.payload.rateOfClimb;\nvar  squawkCode = msg.payload.squawkCode;\nvar  model = msg.payload.model;\nvar  lat = msg.payload.lat;\nvar  longitude = msg.payload.lon;\nvar  timestamp = msg.payload.timestamp;\nvar  name = msg.payload.name;\n\nvar measurementsObj = {};\nvar tagsObj = {};\nvar combinedObj;\n\nmeasurementsObj[\"altitude\"] = altitude;\nmeasurementsObj[\"bearing\"] = bearing;\nmeasurementsObj[\"speed\"] = speed;\nmeasurementsObj[\"rateOfClimb\"] = rateOfClimb;\nmeasurementsObj[\"lat\"] = lat;\nmeasurementsObj[\"longitude\"] = longitude;\n//measurementsObj[\"timestamp\"] = timestamp;\ntagsObj[\"registration\"] = registration\ntagsObj[\"flight\"] = flight\ntagsObj[\"callsign\"] = callsign\ntagsObj[\"origin\"] = origin\ntagsObj[\"destination\"] = destination\ntagsObj[\"rateOfClimb\"] = rateOfClimb\ntagsObj[\"squawkCode\"] = squawkCode\ntagsObj[\"model\"] = model\ntagsObj[\"name\"] = name\n\n/*\n\n//create the boolean that will be used to hold the evaluation of whether the measurement is valid or not\nvar validMeasurement;\n\n//create the booleans that will be used to hold whether the reason a measurement is invalid is because it is a non-standard type or\n// if the type of the measurement and the type passed from the device differ or\n// if the value (data) is null\nvar nonStandardType = false;\nvar measurementTypeMismatch = false;\nvar nullData = false;\n\n//create a boolean to keep track of if there are any tags (indices) that should be sent to the InfluxDB \n// it starts false but if any tag is valid then will become true. See below for what to send to InfluxDB based on valid measures and tags\nvar validTag = false;\n\n\n\n\n/*\n//scanning all of the tags from the config node and creating a tag for that item if the entry on the config node has info\ncommonTags = [\"House\", \"Floor\", \"Room\", \"Location\", \"DeviceType\", \"Manufacturer\", \"AccessProtocol\", \"PhysicalVirtualType\", \"PhysicalDigitalRegular\"]\ncommonTags.forEach(element => {\n    //node.warn(\"84 length\")\n    //node.warn(element)\n    //node.warn(deviceID)\n    if (flow.get(deviceID + element).length > 0) {\n        tagsObj[element] = flow.get(deviceID + element)\n        validTag = true\n    }\n}); \n\n\n\n\n\n//Based on whether or not the measurement is \"valid\" it either adds the device id to the tags or it goes to the else portion\nif (validMeasurement) {\n    measurementsObj[typeOfMeasurement] = theData;\n    //node.warn(\"94 length\")\n    if (deviceID.length > 0) {\n        tagsObj[\"DeviceID\"] = deviceID;\n        validTag = true;\n    }\n    if (validTag) {\n        combinedObj = [measurementsObj, tagsObj]\n    } else {\n        //skip tags if none would be valid\n        combinedObj = [measurementsObj]\n    }\n} else {\n\n    //if the measeurement was not \"valid\", then it puts in a Generic measurement of true and tag it as either Non-Standard Type of Measurement Type Mismatch\n    if (nonStandardType) {\n        measurementsObj[\"Generic\"] = true\n        tagsObj[\"ReasonGeneric\"] = \"Non-Standard Type\"\n        tagsObj[\"Measure\"] = typeOfMeasurement\n    }\n    //node.warn(\"113 length\")\n    if (deviceID.length > 0) {\n        tagsObj[\"DeviceID\"] = deviceID\n        validTag = true\n    }\n    if (measurementTypeMismatch) {\n        measurementsObj[\"Generic\"] = true\n        tagsObj[\"ReasonGeneric\"] = \"Measurement Type Mismatch\"\n        tagsObj[\"Measure\"] = typeOfMeasurement\n    }\n    //node.warn(\"123 length\")\n    if (deviceID.length > 0) {\n        tagsObj[\"DeviceID\"] = deviceID\n        validTag = true\n    }\n    combinedObj = [measurementsObj, tagsObj]\n}\n*/\ncombinedObj = [measurementsObj, tagsObj]\nmsg.payload = combinedObj;\n\n\n//build the status to be shown on the status of the subnode\n\n/* MQTT section \n * \n * \n * \n */\n//create the placeholder object\nvar msg2 = {}\n//add the MQTT topic\nmsg2.topic = \"Homebridge/\"\n//add the data to be recorded to MQTT\n\n\n\n//send the created combinedObj downstream (to the InfluxDB node), but only if the measurement is not null\nreturn [msg, msg2]\n","outputs":2,"noerr":0,"x":1660,"y":340,"wires":[["d385232.c1709e"],[]]},{"id":"d385232.c1709e","type":"influxdb out","z":"1a0aa13a.9d7b8f","influxdb":"577b1b11.27d264","name":"","measurement":"Aircraft2","precision":"","retentionPolicy":"","x":2000,"y":260,"wires":[]},{"id":"668f7b94.1eac24","type":"debug","z":"a73af62e.c418b8","name":"Ready to clean for Hubitat","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1990,"y":200,"wires":[]},{"id":"5c6d60df.4daf9","type":"debug","z":"a73af62e.c418b8","name":"Show Influx input","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":3150,"y":120,"wires":[]},{"id":"3a90711b.47f7ce","type":"change","z":"a73af62e.c418b8","name":"Add MQTT Master (different per source)","rules":[{"t":"set","p":"MQTTName","pt":"msg","to":"Hubitat","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1660,"y":40,"wires":[["668f7b94.1eac24"]]},{"id":"67fca0f9.da6f8","type":"function","z":"a73af62e.c418b8","name":"Common function to rename the measurement name (incomplete)","func":"\nreturn msg;","outputs":1,"noerr":0,"x":2320,"y":40,"wires":[["b3e7fb11.52ea28"]]},{"id":"b3e7fb11.52ea28","type":"function","z":"a73af62e.c418b8","name":"Common Function to get translation/scaling label device+pay.name+table = TranslationType (incomplete)","func":"\nreturn msg;","outputs":1,"noerr":0,"x":2440,"y":80,"wires":[["9eaeb6cb.347278","21a5a085.807e9"]]},{"id":"9eaeb6cb.347278","type":"function","z":"a73af62e.c418b8","name":"Translation Path (incomplete)","func":"\nreturn msg;","outputs":1,"noerr":0,"x":2200,"y":120,"wires":[["21a5a085.807e9"]]},{"id":"4eea1052.e1383","type":"function","z":"a73af62e.c418b8","name":"Write to MQTT prep (incomplete)","func":"\nreturn msg;","outputs":1,"noerr":0,"x":2860,"y":200,"wires":[["a469e97f.ec8658"]]},{"id":"502b902f.6756d","type":"function","z":"a73af62e.c418b8","name":"Write to InfluxDB prep (incomplete)","func":"\nreturn msg;","outputs":1,"noerr":0,"x":2860,"y":120,"wires":[["5c6d60df.4daf9"]]},{"id":"21a5a085.807e9","type":"function","z":"a73af62e.c418b8","name":"Gather both types (incomplete","func":"\nreturn msg;","outputs":1,"noerr":0,"x":2510,"y":120,"wires":[["502b902f.6756d","4eea1052.e1383","6a83e86a.f6d388"]]},{"id":"6a83e86a.f6d388","type":"function","z":"a73af62e.c418b8","name":"Write to subflow status prep (incomplete)","func":"\nreturn msg;","outputs":1,"noerr":0,"x":2880,"y":160,"wires":[["a3143829.4bbc58"]]},{"id":"a3143829.4bbc58","type":"debug","z":"a73af62e.c418b8","name":"Show Status input","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":3150,"y":160,"wires":[]},{"id":"a469e97f.ec8658","type":"debug","z":"a73af62e.c418b8","name":"Show MQTT input","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":3150,"y":200,"wires":[]},{"id":"831c7de9.65f3c","type":"change","z":"f9a34738.f12c28","name":"Add MQTT Master (different per source)","rules":[{"t":"set","p":"MQTTName","pt":"msg","to":"Homebridge","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1560,"y":320,"wires":[["bee29f25.e7e95"]]},{"id":"bfdbd6c1.2d3018","type":"debug","z":"f9a34738.f12c28","name":"Show Influx input","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2930,"y":260,"wires":[]},{"id":"b0b291e4.5e00f","type":"function","z":"f9a34738.f12c28","name":"Common function to rename the measurement name (incomplete)","func":"\nreturn msg;","outputs":1,"noerr":0,"x":2100,"y":180,"wires":[["df1261a1.172fd"]]},{"id":"df1261a1.172fd","type":"function","z":"f9a34738.f12c28","name":"Common Function to get translation/scaling label device+pay.name+table = TranslationType (incomplete)","func":"\nreturn msg;","outputs":1,"noerr":0,"x":2220,"y":220,"wires":[["a3efdb98.fa4898","6980ef5d.8b46c"]]},{"id":"a3efdb98.fa4898","type":"function","z":"f9a34738.f12c28","name":"Translation Path (incomplete)","func":"\nreturn msg;","outputs":1,"noerr":0,"x":1980,"y":260,"wires":[["6980ef5d.8b46c"]]},{"id":"abc799ae.c873e8","type":"function","z":"f9a34738.f12c28","name":"Write to MQTT prep (incomplete)","func":"\nreturn msg;","outputs":1,"noerr":0,"x":2640,"y":340,"wires":[["ec4c94c2.bb27b8"]]},{"id":"6c3d76c8.be2408","type":"function","z":"f9a34738.f12c28","name":"Write to InfluxDB prep (incomplete)","func":"\nreturn msg;","outputs":1,"noerr":0,"x":2640,"y":260,"wires":[["bfdbd6c1.2d3018"]]},{"id":"6980ef5d.8b46c","type":"function","z":"f9a34738.f12c28","name":"Gather both types (incomplete)","func":"\nreturn msg;","outputs":1,"noerr":0,"x":2290,"y":260,"wires":[["6c3d76c8.be2408","abc799ae.c873e8","d85541bb.f9609"]]},{"id":"d85541bb.f9609","type":"function","z":"f9a34738.f12c28","name":"Write to subflow status prep (incomplete)","func":"\nreturn msg;","outputs":1,"noerr":0,"x":2660,"y":300,"wires":[["554a29c9.ea75b8"]]},{"id":"554a29c9.ea75b8","type":"debug","z":"f9a34738.f12c28","name":"Show Status input","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2930,"y":300,"wires":[]},{"id":"ec4c94c2.bb27b8","type":"debug","z":"f9a34738.f12c28","name":"Show MQTT input","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2930,"y":340,"wires":[]},{"id":"1263d8e6.0b9287","type":"debug","z":"f14b69ba.8b2da8","name":"MQTT Payloads","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":160,"y":120,"wires":[]},{"id":"193ef5bc.ad23ea","type":"debug","z":"f14b69ba.8b2da8","name":"MQTT Output","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":780,"y":4740,"wires":[]},{"id":"adfca76f.7df238","type":"string","z":"f14b69ba.8b2da8","name":"Remove zigbee2mqtt/ from the topic","methods":[{"name":"chompLeft","params":[{"type":"str","value":"zigbee2mqtt/"}]}],"prop":"topic","propout":"topic","object":"msg","objectout":"msg","x":230,"y":4620,"wires":[["5d083dd4.376254"]]},{"id":"5d083dd4.376254","type":"function","z":"f14b69ba.8b2da8","name":"Put device ID into msg (incomplete use lookup)","func":"\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":4660,"wires":[["6974d333.96eeec"]]},{"id":"6974d333.96eeec","type":"change","z":"f14b69ba.8b2da8","name":"Add MQTT Master (different per source)","rules":[{"t":"set","p":"MQTTName","pt":"msg","to":"zb2mqtt","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":240,"y":4700,"wires":[["a4b99b21.e62628"]]},{"id":"a4b99b21.e62628","type":"function","z":"f14b69ba.8b2da8","name":"5.\tSplit kv pairs (from value) into 1-n msg stream (incomplete)","func":"\nreturn msg;","outputs":1,"noerr":0,"x":300,"y":4740,"wires":[["193ef5bc.ad23ea","b4e074f2.a5d3d8"]]},{"id":"b4e074f2.a5d3d8","type":"function","z":"f14b69ba.8b2da8","name":"Common function to rename the measurement name (incomplete)","func":"\nreturn msg;","outputs":1,"noerr":0,"x":320,"y":4780,"wires":[["102a2801.d77578"]]},{"id":"102a2801.d77578","type":"function","z":"f14b69ba.8b2da8","name":"Common Function to get translation/scaling label device+pay.name+table = TranslationType (incomplete)","func":"\nreturn msg;","outputs":1,"noerr":0,"x":440,"y":4820,"wires":[["e5cbba82.1d9c68","5f5555fd.9a8a8c"]]},{"id":"e5cbba82.1d9c68","type":"function","z":"f14b69ba.8b2da8","name":"Translation Path (incomplete)","func":"\nreturn msg;","outputs":1,"noerr":0,"x":200,"y":4860,"wires":[["5f5555fd.9a8a8c"]]},{"id":"f590b600.ed2bd8","type":"function","z":"f14b69ba.8b2da8","name":"Write to MQTT prep (incomplete)","func":"\nreturn msg;","outputs":1,"noerr":0,"x":860,"y":4940,"wires":[[]]},{"id":"54b95c8a.6ff6d4","type":"function","z":"f14b69ba.8b2da8","name":"Write to InfluxDB prep (incomplete)","func":"\nreturn msg;","outputs":1,"noerr":0,"x":860,"y":4860,"wires":[[]]},{"id":"5f5555fd.9a8a8c","type":"function","z":"f14b69ba.8b2da8","name":"Gather both types (incomplete","func":"\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":4860,"wires":[["54b95c8a.6ff6d4","f590b600.ed2bd8","746d74ff.8e835c"]]},{"id":"746d74ff.8e835c","type":"function","z":"f14b69ba.8b2da8","name":"Write to subflow status prep (incomplete)","func":"\nreturn msg;","outputs":1,"noerr":0,"x":880,"y":4900,"wires":[[]]},{"id":"9392480e.f981f8","type":"debug","z":"f9a34738.f12c28","name":"Ready to be cleaned Homebridge","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2000,"y":180,"wires":[]},{"id":"b36306d5.1140f8","type":"function","z":"32252d88.e55b52","name":"Determine Source For Gsheet lookup properties.","func":"//Read subflow input variables\nif (env.get(\"OverrideEnvVariables\"))\n{\n    //Put inputs and read values into msg properties to be visible downstream\n    msg.sheet = msg.SpreadsheetID;\n    msg.tab = msg.Tab;\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    msg.topic = msg.targetrange\n    delete msg.Tab\n    delete msg.SpreadsheetID\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\n}\nelse if (msg.IgnoreEnvVar)\n{\n    //Put inputs and read values into msg properties to be visible downstream\n    msg.sheet = msg.SpreadsheetID;\n    msg.tab = msg.Tab;\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    msg.topic = msg.targetrange\n    delete msg.Tab\n    delete msg.SpreadsheetID\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\n}\nelse\n{\n    var ColStart = env.get(\"ColStart\");\n    var ColEnd = env.get(\"ColEnd\");\n    var FirstRow = env.get(\"MinRow\");\n    var LastRow = env.get(\"MaxRow\");\n    //Put inputs and read values into msg properties to be visible downstream\n    msg.sheet = env.get(\"Spreadsheet ID\");\n    msg.tab = env.get(\"TabName\");\n    msg.cellstart = ColStart + FirstRow\n    msg.cellend = ColEnd + LastRow\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    msg.topic = msg.targetrange\n    delete msg.Tab\n    delete msg.SpreadsheetID\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\n    //These 2 are needed later to calculate the last populate and first empty rows and columns\n    msg.ColStart = ColStart\n    msg.MinRow = FirstRow\n}\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":20,"wires":[["d4f679ef.4c20e8","5a7c8782.c58018"]],"info":"This node sets up the inputs to the GSheet node.\nThe outputs that make up those inputs are:\n - msg.sheet -the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n - msg.topic - the combination of spreadsheet tab and cell range\n## Note\nThere are 2 very similar booleans evaluated by this node. They are:\n * **OverrideEnvVariables** - This one looks at the environment variable that was set in the flow triggering the subflow\n * **msg.IgnoreEnvVar** - This one is allows the logic to be driven by a message object property and thus can be set at runtime or earlier in the flow based on upstream logic\n\nFirst it checks the boolean value of the **OverrideEnvVariables** environment variable. This is by default false. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming the first was false, it checks the boolean value of the **msg.IgnoreEnvVar** value. This will evaluated as false if not populated, so sending false is unnecessary. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming both are false, then it can build the outputs based on the subflows environment variables. These can either be those set in the calling flow or they may be the default ones built into the subflow.\n\nRegardless of the method used to build the output, the node also removes the input message properties.\n\n\n\nmsg.IgnoreEnvVar"},{"id":"d4f679ef.4c20e8","type":"GSheet","z":"32252d88.e55b52","creds":"adb4e9b8.8beee8","method":"get","action":"","sheet":"","cells":"","name":"Read Input from GSheet","x":610,"y":20,"wires":[["f3abb43f.98f4e8"]],"info":"Use the GSheet node to get the a set of rows from a google spreadsheet.\n\n# **Inputs**\n### **creds**\nThis is the name on the gauth configuration node. How to get the details is beyond the scope of what I am going to put into an individual node instance. Some details are at [node-red-contrib-google-sheets](https://flows.nodered.org/node/node-red-contrib-google-sheets)\n### **Method**\nIn this case using the get cells method to read a set of data.\n### **SpreadsheetID**\nUnused as the spreadsheet ID is passed in as part of the input msg, but if needed it would be the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n### **Cells**\nUnused as the requested cells are passed in as part of the input msg, but if it was being manually built for a static data source the format is made of of 3 parts with specific seperators:\n * **[Sheetname]** like Sheet1\n * **[upper left corner cell address]** like A1\n * **[lower right corner cell address]** like B2\n\nThe format is **[Sheetname]**!**[upper left corner cell address]**:**[lower right corner cell address]** giving an input like **Sheet1!A1:B2**\n "},{"id":"cd9ceb54.45b238","type":"comment","z":"32252d88.e55b52","name":"Error","info":"","x":1090,"y":20,"wires":[]},{"id":"1e96032.0612afd","type":"comment","z":"32252d88.e55b52","name":"Last Populated Row","info":"","x":1130,"y":100,"wires":[]},{"id":"5d994f24.7baba","type":"function","z":"32252d88.e55b52","name":"Prepare Output Parts","func":"/*\n * Row response calculations\n */\nmsg.LastPopulatedRow = msg.payload.length + msg.MinRow - 1\nmsg.FirstEmptyRow = msg.LastPopulatedRow + 1\n\n/*\n *Column response calculation variables\n */\nlet colCount = 1 //number of columns wide from the data retrieved. This will eventually be replace by logic that loops through array find the max width for any given row\nlet index\nlet sheetdata = msg.payload //this is the data that is returned from Google that will then be examined\nlet fCol = msg.ColStart\nlet fColTotal = 0 //to hold the column number\nlet nCol = \"\"   //nCol is new column\nlet lCol = \"\"   //lCol is last column in the range (to be populated from the actual Gsheet calls data)\n\nfCol = fCol.toUpperCase()\n/*\n * validate fCol (done)\n */\nlet validStartCol = false\nvalidStartCol = ((fCol.length == 1) ||\n                ((fCol.substr(0, 1).charCodeAt(0) - 64) < 9) ||\n                (((fCol.substr(0, 1).charCodeAt(0) - 64) == 9) && ((fCol.substr(1, 1).charCodeAt(0) - 64) <= 22)))\n/*\n *Column response calculations\n */\n//look at each row that is an array\nfor (index = 0; index < sheetdata.length; index++)\n{\n    if (Array.isArray(sheetdata[index]))\n    {\n        // when the rows width is greater than any of the previous rows set the column count to the new largest width\n        colCount = Math.max(colCount, sheetdata[index].length)\n    } //if (Array.isArray(sheetdata[index]))\n}  //for (index = 0; index < sheetdata.length; index++)\nswitch (fCol.length) {\n    case 1:\n        fColTotal = (fCol.substr(0, 1).charCodeAt(0) - 64)\n        fColTotal += colCount - 1\n        break\n    case 2:\n        fColTotal = (fCol.substr(1, 1).charCodeAt(0) - 64) + 26 * (fCol.substr(0, 1).charCodeAt(0) - 64)\n        fColTotal += colCount - 1\n        break\n    default:\n        fColTotal = -1\n}\n//Last Populated Column and First Empty Column calculation\nif ((fColTotal <= 25) && (fColTotal >= 1)) {\n    lCol = String.fromCharCode(fColTotal+64)\n    nCol = String.fromCharCode(fColTotal+65)\n} else if (fColTotal == 26) {\n    lCol = \"Z\"\n    nCol = \"AA\"\n} else if (fColTotal >= 27) {\n    lCol = String.fromCharCode((Math.floor(fColTotal / 26)) + 64) + String.fromCharCode((fColTotal % 26) + 64)\n    nCol = String.fromCharCode((Math.floor(fColTotal / 26)) + 64) + String.fromCharCode((fColTotal % 26) + 65)\n} else if (fColTotal == -1) {\n    lCol = \"Error\"\n    nCol = \"Error\"\n    //Probably worth putting real error here, but deferred\n} else if (fColTotal == 256) {\n    lCol = \"IV\"\n    nCol = \"None\"\n}\nmsg.LastPopulatedCol = lCol\nmsg.FirstEmptyCol = nCol\nmsg.SpreadsheetArray = msg.payload\nreturn msg;","outputs":1,"noerr":0,"x":560,"y":540,"wires":[["aa6d1a78.1abaa8","19295ae9.4a7b45","2427fd2f.a3a022","77f0a296.84470c","17bd8e89.be33f1","d2a14166.06197"]],"info":"Takes an input from the Gsheet node and calculates a variety of details about the spreadsheet info.\n### **Output**\nmsg.LastPopulatedRow\nmsg.FirstEmptyRow\nmsg.LastPopulatedCol\nmsg.FirstEmptyCol\nmsg.SpreadsheetArray\n"},{"id":"bfb17bc7.c34478","type":"comment","z":"32252d88.e55b52","name":"First Empty Row","info":"","x":1120,"y":180,"wires":[]},{"id":"705c5.5e792a3bc","type":"comment","z":"32252d88.e55b52","name":"Last Populated Column","info":"","x":1140,"y":260,"wires":[]},{"id":"7758f679.9e0a48","type":"comment","z":"32252d88.e55b52","name":"First Empty Column","info":"","x":1130,"y":340,"wires":[]},{"id":"a5ecb477.d27f78","type":"comment","z":"32252d88.e55b52","name":"Spreadsheet Array","info":"","x":1130,"y":420,"wires":[]},{"id":"56fa6509.45a27c","type":"comment","z":"32252d88.e55b52","name":"Full Data","info":"","x":1100,"y":500,"wires":[]},{"id":"c775a468.fea368","type":"comment","z":"32252d88.e55b52","name":"Full Data with Inputs","info":"","x":1130,"y":580,"wires":[]},{"id":"aa6d1a78.1abaa8","type":"change","z":"32252d88.e55b52","name":"Leave Outputs","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":540,"wires":[[]],"info":"Deletes a variety of message properties, but leaves all of them that were calculated about the Gsheet nodes results to be returned on the designated subflow output."},{"id":"19295ae9.4a7b45","type":"change","z":"32252d88.e55b52","name":"Leave Last Populated Row","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"LastPopulatedRow","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":140,"wires":[[]],"info":"Copies msg.theLastPopulatedRow into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"2427fd2f.a3a022","type":"change","z":"32252d88.e55b52","name":"Leave First Empty Row","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"FirstEmptyRow","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":870,"y":220,"wires":[[]],"info":"Copies msg.FirstEmptyRow into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"77f0a296.84470c","type":"change","z":"32252d88.e55b52","name":"Leave Last Populated Column","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"LastPopulatedCol","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":890,"y":300,"wires":[[]],"info":"Copies msg.LastPopulatedCol into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"17bd8e89.be33f1","type":"change","z":"32252d88.e55b52","name":"Leave First Empty Column","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"FirstEmptyCol","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":380,"wires":[[]],"info":"Copies msg.FirstEmptyCol into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"d2a14166.06197","type":"change","z":"32252d88.e55b52","name":"Leave Spreadsheet Array","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"SpreadsheetArray","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":870,"y":460,"wires":[[]],"info":"Copies msg.SpreadsheetArray into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"49d2751a.53de1c","type":"trigger","z":"32252d88.e55b52","name":"Watchdog","op1":"","op2":"timeout","op1type":"nul","op2type":"str","duration":"10","extend":true,"units":"s","reset":"","bytopic":"all","outputs":1,"x":600,"y":140,"wires":[["77f0a296.84470c","19295ae9.4a7b45","17bd8e89.be33f1","d2a14166.06197","aa6d1a78.1abaa8"]],"info":"This trigger node works as a watchdog to see if the request to see if the read of the Google Sheet that was triggered on the other branch is successful. If it is succeful, then it will receive a reset message (msg.reset) from the Reset Watchdog node. If, however, 10 seconds elapse without receiving the reset message, this node sends a timeout message (msg.timeout)."},{"id":"5a7c8782.c58018","type":"change","z":"32252d88.e55b52","name":"","rules":[{"t":"set","p":"timeout","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":120,"wires":[["49d2751a.53de1c"]],"info":"Labels what the initial input to the watchdog trigger node is."},{"id":"87591b2a.6867c8","type":"change","z":"32252d88.e55b52","name":"","rules":[{"t":"delete","p":"reset","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":350,"y":540,"wires":[["5d994f24.7baba"]],"info":"Removes msg.reset that was only intended for the watchdog trigger node."},{"id":"6b34896c.b7c258","type":"catch","z":"32252d88.e55b52","name":"Catch and Relay Errors","scope":null,"uncaught":false,"x":860,"y":60,"wires":[[]],"info":"Passes any caught error to the error subflows intentially built error output. By intentionally built I mean I created one and labelled it as such. This is not there by default."},{"id":"f3abb43f.98f4e8","type":"change","z":"32252d88.e55b52","name":"Reset Watchdog","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":140,"y":140,"wires":[["49d2751a.53de1c","87591b2a.6867c8"]],"info":"Sends the reset message to the watchdog triger node when there is output from the Gsheet node."},{"id":"9d08adeb.8b976","type":"function","z":"809a2e43.861b6","name":"Determine Source For Gsheet lookup properties.","func":"//Read subflow input variables\nif (env.get(\"OverrideEnvVariables\"))\n{\n    //Put inputs and read values into msg properties to be visible downstream\n    msg.sheet = msg.SpreadsheetID;\n    msg.tab = msg.Tab;\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    msg.topic = msg.targetrange\n    delete msg.Tab\n    delete msg.SpreadsheetID\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\n}\nelse if (msg.IgnoreEnvVar)\n{\n    //Put inputs and read values into msg properties to be visible downstream\n    msg.sheet = msg.SpreadsheetID;\n    msg.tab = msg.Tab;\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    msg.topic = msg.targetrange\n    delete msg.Tab\n    delete msg.SpreadsheetID\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\n}\nelse\n{\n    var ColStart = env.get(\"ColStart\");\n    var ColEnd = env.get(\"ColEnd\");\n    var FirstRow = env.get(\"MinRow\");\n    var LastRow = env.get(\"MaxRow\");\n    //Put inputs and read values into msg properties to be visible downstream\n    msg.sheet = env.get(\"Spreadsheet ID\");\n    msg.tab = env.get(\"TabName\");\n    msg.cellstart = ColStart + FirstRow\n    msg.cellend = ColEnd + LastRow\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    msg.topic = msg.targetrange\n    delete msg.Tab\n    delete msg.SpreadsheetID\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\n    //These 2 are needed later to calculate the last populate and first empty rows and columns\n    msg.ColStart = ColStart\n    msg.MinRow = FirstRow\n}\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":20,"wires":[["6dfd36b5.a00e68","13f6ebeb.275e24"]],"info":"This node sets up the inputs to the GSheet node.\nThe outputs that make up those inputs are:\n - msg.sheet -the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n - msg.topic - the combination of spreadsheet tab and cell range\n## Note\nThere are 2 very similar booleans evaluated by this node. They are:\n * **OverrideEnvVariables** - This one looks at the environment variable that was set in the flow triggering the subflow\n * **msg.IgnoreEnvVar** - This one is allows the logic to be driven by a message object property and thus can be set at runtime or earlier in the flow based on upstream logic\n\nFirst it checks the boolean value of the **OverrideEnvVariables** environment variable. This is by default false. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming the first was false, it checks the boolean value of the **msg.IgnoreEnvVar** value. This will evaluated as false if not populated, so sending false is unnecessary. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming both are false, then it can build the outputs based on the subflows environment variables. These can either be those set in the calling flow or they may be the default ones built into the subflow.\n\nRegardless of the method used to build the output, the node also removes the input message properties.\n\n\n\nmsg.IgnoreEnvVar"},{"id":"6dfd36b5.a00e68","type":"GSheet","z":"809a2e43.861b6","creds":"adb4e9b8.8beee8","method":"get","action":"","sheet":"","cells":"","name":"Read Input from GSheet","x":610,"y":20,"wires":[["6ea04230.b70e1c"]],"info":"Use the GSheet node to get the a set of rows from a google spreadsheet.\n\n# **Inputs**\n### **creds**\nThis is the name on the gauth configuration node. How to get the details is beyond the scope of what I am going to put into an individual node instance. Some details are at [node-red-contrib-google-sheets](https://flows.nodered.org/node/node-red-contrib-google-sheets)\n### **Method**\nIn this case using the get cells method to read a set of data.\n### **SpreadsheetID**\nUnused as the spreadsheet ID is passed in as part of the input msg, but if needed it would be the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n### **Cells**\nUnused as the requested cells are passed in as part of the input msg, but if it was being manually built for a static data source the format is made of of 3 parts with specific seperators:\n * **[Sheetname]** like Sheet1\n * **[upper left corner cell address]** like A1\n * **[lower right corner cell address]** like B2\n\nThe format is **[Sheetname]**!**[upper left corner cell address]**:**[lower right corner cell address]** giving an input like **Sheet1!A1:B2**\n "},{"id":"1ea61fdd.8953a","type":"comment","z":"809a2e43.861b6","name":"Error","info":"","x":1090,"y":20,"wires":[]},{"id":"4895af0.a00af5","type":"comment","z":"809a2e43.861b6","name":"Last Populated Row","info":"","x":1130,"y":100,"wires":[]},{"id":"71231cd6.a786c4","type":"function","z":"809a2e43.861b6","name":"Prepare Output Parts","func":"/*\n * Row response calculations\n */\nmsg.LastPopulatedRow = msg.payload.length + msg.MinRow - 1\nmsg.FirstEmptyRow = msg.LastPopulatedRow + 1\n\n/*\n *Column response calculation variables\n */\nlet colCount = 1 //number of columns wide from the data retrieved. This will eventually be replace by logic that loops through array find the max width for any given row\nlet index\nlet sheetdata = msg.payload //this is the data that is returned from Google that will then be examined\nlet fCol = msg.ColStart\nlet fColTotal = 0 //to hold the column number\nlet nCol = \"\"   //nCol is new column\nlet lCol = \"\"   //lCol is last column in the range (to be populated from the actual Gsheet calls data)\n\nfCol = fCol.toUpperCase()\n/*\n * validate fCol (done)\n */\nlet validStartCol = false\nvalidStartCol = ((fCol.length == 1) ||\n                ((fCol.substr(0, 1).charCodeAt(0) - 64) < 9) ||\n                (((fCol.substr(0, 1).charCodeAt(0) - 64) == 9) && ((fCol.substr(1, 1).charCodeAt(0) - 64) <= 22)))\n/*\n *Column response calculations\n */\n//look at each row that is an array\nfor (index = 0; index < sheetdata.length; index++)\n{\n    if (Array.isArray(sheetdata[index]))\n    {\n        // when the rows width is greater than any of the previous rows set the column count to the new largest width\n        colCount = Math.max(colCount, sheetdata[index].length)\n    } //if (Array.isArray(sheetdata[index]))\n}  //for (index = 0; index < sheetdata.length; index++)\nswitch (fCol.length) {\n    case 1:\n        fColTotal = (fCol.substr(0, 1).charCodeAt(0) - 64)\n        fColTotal += colCount - 1\n        break\n    case 2:\n        fColTotal = (fCol.substr(1, 1).charCodeAt(0) - 64) + 26 * (fCol.substr(0, 1).charCodeAt(0) - 64)\n        fColTotal += colCount - 1\n        break\n    default:\n        fColTotal = -1\n}\n//Last Populated Column and First Empty Column calculation\nif ((fColTotal <= 25) && (fColTotal >= 1)) {\n    lCol = String.fromCharCode(fColTotal+64)\n    nCol = String.fromCharCode(fColTotal+65)\n} else if (fColTotal == 26) {\n    lCol = \"Z\"\n    nCol = \"AA\"\n} else if (fColTotal >= 27) {\n    lCol = String.fromCharCode((Math.floor(fColTotal / 26)) + 64) + String.fromCharCode((fColTotal % 26) + 64)\n    nCol = String.fromCharCode((Math.floor(fColTotal / 26)) + 64) + String.fromCharCode((fColTotal % 26) + 65)\n} else if (fColTotal == -1) {\n    lCol = \"Error\"\n    nCol = \"Error\"\n    //Probably worth putting real error here, but deferred\n} else if (fColTotal == 256) {\n    lCol = \"IV\"\n    nCol = \"None\"\n}\nmsg.LastPopulatedCol = lCol\nmsg.FirstEmptyCol = nCol\nmsg.SpreadsheetArray = msg.payload\nreturn msg;","outputs":1,"noerr":0,"x":560,"y":540,"wires":[["115f090d.01a1c7","d8658c5a.0a5ce","8b790e84.fc65e","1efad89c.adecf7","1fc02d15.67a363","f17df7e0.9c87e8"]],"info":"Takes an input from the Gsheet node and calculates a variety of details about the spreadsheet info.\n### **Output**\nmsg.LastPopulatedRow\nmsg.FirstEmptyRow\nmsg.LastPopulatedCol\nmsg.FirstEmptyCol\nmsg.SpreadsheetArray\n"},{"id":"b6267d87.61dc6","type":"comment","z":"809a2e43.861b6","name":"First Empty Row","info":"","x":1120,"y":180,"wires":[]},{"id":"635e6749.536cf8","type":"comment","z":"809a2e43.861b6","name":"Last Populated Column","info":"","x":1140,"y":260,"wires":[]},{"id":"9cc90293.c61cf","type":"comment","z":"809a2e43.861b6","name":"First Empty Column","info":"","x":1130,"y":340,"wires":[]},{"id":"8734a0f1.c040e","type":"comment","z":"809a2e43.861b6","name":"Spreadsheet Array","info":"","x":1130,"y":420,"wires":[]},{"id":"729d5cd3.4f4974","type":"comment","z":"809a2e43.861b6","name":"Full Data","info":"","x":1100,"y":500,"wires":[]},{"id":"e5cb9e20.de65f","type":"comment","z":"809a2e43.861b6","name":"Full Data with Inputs","info":"","x":1130,"y":580,"wires":[]},{"id":"115f090d.01a1c7","type":"change","z":"809a2e43.861b6","name":"Leave Outputs","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":540,"wires":[[]],"info":"Deletes a variety of message properties, but leaves all of them that were calculated about the Gsheet nodes results to be returned on the designated subflow output."},{"id":"d8658c5a.0a5ce","type":"change","z":"809a2e43.861b6","name":"Leave Last Populated Row","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"LastPopulatedRow","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":140,"wires":[[]],"info":"Copies msg.theLastPopulatedRow into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"8b790e84.fc65e","type":"change","z":"809a2e43.861b6","name":"Leave First Empty Row","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"FirstEmptyRow","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":870,"y":220,"wires":[[]],"info":"Copies msg.FirstEmptyRow into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"1efad89c.adecf7","type":"change","z":"809a2e43.861b6","name":"Leave Last Populated Column","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"LastPopulatedCol","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":890,"y":300,"wires":[[]],"info":"Copies msg.LastPopulatedCol into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"1fc02d15.67a363","type":"change","z":"809a2e43.861b6","name":"Leave First Empty Column","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"FirstEmptyCol","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":380,"wires":[[]],"info":"Copies msg.FirstEmptyCol into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"f17df7e0.9c87e8","type":"change","z":"809a2e43.861b6","name":"Leave Spreadsheet Array","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"SpreadsheetArray","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":870,"y":460,"wires":[[]],"info":"Copies msg.SpreadsheetArray into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"1796c5f3.3f39fa","type":"trigger","z":"809a2e43.861b6","name":"Watchdog","op1":"","op2":"timeout","op1type":"nul","op2type":"str","duration":"10","extend":true,"units":"s","reset":"","bytopic":"all","outputs":1,"x":600,"y":140,"wires":[["1efad89c.adecf7","d8658c5a.0a5ce","1fc02d15.67a363","f17df7e0.9c87e8","115f090d.01a1c7"]],"info":"This trigger node works as a watchdog to see if the request to see if the read of the Google Sheet that was triggered on the other branch is successful. If it is succeful, then it will receive a reset message (msg.reset) from the Reset Watchdog node. If, however, 10 seconds elapse without receiving the reset message, this node sends a timeout message (msg.timeout)."},{"id":"13f6ebeb.275e24","type":"change","z":"809a2e43.861b6","name":"","rules":[{"t":"set","p":"timeout","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":120,"wires":[["1796c5f3.3f39fa"]],"info":"Labels what the initial input to the watchdog trigger node is."},{"id":"4a7df89c.f12b68","type":"change","z":"809a2e43.861b6","name":"","rules":[{"t":"delete","p":"reset","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":350,"y":540,"wires":[["71231cd6.a786c4"]],"info":"Removes msg.reset that was only intended for the watchdog trigger node."},{"id":"3ccf56cb.4c037a","type":"catch","z":"809a2e43.861b6","name":"Catch and Relay Errors","scope":null,"uncaught":false,"x":860,"y":60,"wires":[[]],"info":"Passes any caught error to the error subflows intentially built error output. By intentionally built I mean I created one and labelled it as such. This is not there by default."},{"id":"6ea04230.b70e1c","type":"change","z":"809a2e43.861b6","name":"Reset Watchdog","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":140,"y":140,"wires":[["1796c5f3.3f39fa","4a7df89c.f12b68"]],"info":"Sends the reset message to the watchdog triger node when there is output from the Gsheet node."},{"id":"64e3fe6d.b4a37","type":"function","z":"d078e2a6.ea488","name":"Db Put the payload into a global variable named after the content of msg.globalsource","func":"global.set(msg.globalsource, msg.payload)\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":389,"wires":[["4ca5af11.b84a7"]],"info":"# **What** #\nThis is a simple function node that stores the msg.payload into a global variable. This is done in a function node, however, because the name of that global variable is passed into the function as a the value of msg.globalsource. \n\n## **Why**\nNormally this would be done in a change node, but change nodes could not as of May 2020 take a msg object component as the name of the global variable to be set."},{"id":"a0c44b55.6f2018","type":"subflow:809a2e43.861b6","z":"d078e2a6.ea488","name":"","env":[],"x":580,"y":189,"wires":[[],[],[],[],[],[],["64e3fe6d.b4a37"],[]],"info":"This subflow shows information in the environment variables. These are good for testing purposes, but it is noteworthy that the override boolean is false. Unless that boolean is changed, they have no impact."},{"id":"4ca5af11.b84a7","type":"function","z":"d078e2a6.ea488","name":"Db Use input to lookup info","func":"//Ref. TMS-000001\n\nif(msg.exportableresults.DeviceName !== \"Switch_Ikea\") {return}\n\n\n\n//1 Get must have items: searchKeys, searchValues, searchResultKeys, cachedSearch, cacheTime\nlet searchKeys = Object.keys(msg.keyvalues)\nlet searchValues = Object.values(msg.keyvalues)\nlet searchResultKeys = Object.keys(msg.searchfor)\nlet cachedSearch = global.get(\"LastSearch\")\nlet cacheTime = new Date().getTime()\n//2 create working variables searchKeyIndices, searchResultKeysIndices, index, cacheKey\nlet searchResultKeysIndices = []\nlet index\nlet cacheObject\n//3 build the cache key which is essentially the concatenation of key+value+nextkey+nextvalue+.....etc\ncacheObject = BuildCacheObject(searchKeys, searchValues, searchResultKeys)\n//4\n/*\n * 4.1 t/f cached result is usable\n    *  4.1.true then t/f does it meet criteria\n        * 4.1.true.true\ttrue msg.searchfor = cachedSearch.searchfor\n        * 4.1.true.false do the common lookup\n    *   4.1.false  do the common lookup\n    */\n//4.1\nif (cachedSearch !== undefined)\n{\n    //4.1.true\n    if ((cachedSearch.query == cacheObject.query) && (cachedSearch.time > cacheObject.time - 5000))\n    {\n        //4.1.true.true\n        msg.searchfor = cachedSearch.searchfor\n        return [msg, null, null]\n    } //if ((cachedSearch.query == cacheObject.query) && (cachedSearch.time > cacheObject.time - 5000))\n    //4.1.true.false\n    else\n    {\n        //4.1.true.false\n        lookupResults = CommonLookup(msg, searchKeys, searchResultKeys, searchValues, global.get(msg.globalsource), cacheObject)\n        //return results from the node on 1 of the 3 outputs\n        if (lookupResults[0] !== null)\n        {\n            return [lookupResults[0], null, null]\n        } //if (lookupResults[0] !== null)\n        else if (lookupResults[1] !== null)\n        {\n            return [null, lookupResults[1], null]\n        } //else if (lookupResults[1] !== null)\n        else\n        {\n            return [null, null, lookupResults[2]]\n        } //else if (lookupResults[1] !== null) else\n    } //if ((cachedSearch.query == cacheObject.query) && (cachedSearch.time > cacheObject.time - 5000)) else\n} //if (cachedSearch !== undefined)\n//4.1.false\nelse\n{\n    //4.1.false\n    lookupResults = CommonLookup(msg, searchKeys, searchResultKeys, searchValues, global.get(msg.globalsource), cacheObject)\n    //return results from the node on 1 of the 3 outputs\n    if (lookupResults[0] !== null)\n    {\n        return [lookupResults[0], null, null]\n    } //if (lookupResults[0] !== null)\n    else if (lookupResults[1] !== null)\n    {\n        return [null, lookupResults[1], null]\n    } //else if (lookupResults[1] !== null)\n    else\n    {\n        return [null, null, lookupResults[2]]\n    } //else if (lookupResults[1] !== null) else\n} //if (cachedSearch !== undefined) else\nreturn\n\nfunction BuildCacheObject(searchKeysArray, SearchValuesArray, SearchResultKeysArray) {\n    //3 build the cache key which is essentially the concatenation of key+value+nextkey+nextvalue+.....etc\n    let newCacheKey =\"\"\n    for (index = 0; index < searchKeysArray.length; index++)\n    {\n        newCacheKey = newCacheKey + searchKeysArray[index] + SearchValuesArray[index]\n    } //for (index = 0; index < searchKeysArray.length; index++)\n    //add all fields that will be looked for into the cache key\n    for (index = 0; index < SearchResultKeysArray.length; index++)\n    {\n        newCacheKey = newCacheKey + SearchResultKeysArray[index]\n    } //for (index = 0; index < SearchResultKeysArray.length; index++)\n    //combine the cache key and the cache time into a single object that can be compared with the cached last search\n    let createdCacheObject = \n    {\n        query: newCacheKey,\n        time: cacheTime\n    }\n    return createdCacheObject\n}\nfunction CommonLookup(workingMsg, keysForSearchColumn, keysForResultColumn, valuesSearchedFor, requestedDataTable, passedCacheObject) {\n    let searchKeyIndices = []\n    let searchResultKeysIndices = []\n    let outerIndex\n    let innerLoopCounter\n    let innerIndex\n    let index\n    if (requestedDataTable !== undefined)\n    {\n        // iterate through all search keys.\n        //outer index is the place along the array of search keys\n        for (outerIndex = 0; outerIndex < keysForSearchColumn.length; outerIndex++)\n        {\n            //inner index is the place along the first row of data\n            //The innerLoopCounter must be reset each time a new key is being looked for\n            innerLoopCounter = 0\n            for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n            {\n                //these 2 loops will compare every entry in the top row of the data table to every entry in the array of search keys,\n                if (requestedDataTable[0][innerIndex] == keysForSearchColumn[outerIndex])\n                {\n                    //when they match push the column number on to the array that has just indices for the search keys\n                    searchKeyIndices.push(innerIndex)\n                    //break is used to stop comparing as once the column has been found the remaining aren't relevant\n                    //////////////////////////////////////////////////////////////////////////break may be a problem. Maybe swap inner and outer arrays and then do some if then about getting through the whole data headers without finding. Right now it only looks for 1 failure\n                    break\n                } //if (requestedDataTable[0][innerIndex] == keysForSearchColumn[outerIndex])\n                else\n                {\n                    //when they don't match, then this means there is a search key that does not match any header.\n                    //When properly configured this should not happen, but proper configuration cannot be guaranteed\n                    //this is accumulating how many times the search key did not match one of the data table headers\n                    innerLoopCounter++\n                    //Error messaging should only happen if the search key has been compared with all of the headers\n                    //requestedDataTable[0].length gives the total number of data headers (columns of the spreadsheet)\n                    if (requestedDataTable[0].length == innerLoopCounter)\n                    {\n                        //populate error \n                        //put some details on this configuration into the msg to be output\n                        workingMsg.error = \"Key with value \\\"\" + keysForSearchColumn[outerIndex] + \"\\\" not found amongst the \" + (requestedDataTable[0].length + 1) + \" entries, which include \" + requestedDataTable[0]\n                        //either create and populate the error count at 1 or increment it if it already exists\n                        if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n                        {\n                                workingMsg.searchErrorCount++\n                        }\n                        else\n                        {\n                            workingMsg.searchErrorCount = 1\n                        }\n                        //this retry is in case the column was added to the google sheet since it was last loaded into node red\n                        if (workingMsg.searchErrorCount > 1)\n                        {\n                            //return the error on the bottom because with a count of 2 that means reloading has already been tried\n                            return [null, null, workingMsg]\n                        }\n                        else\n                        {\n                            //return the error on the middle there is an error output,\n                            return [null, workingMsg, null]\n                        }\n                    } //if (requestedDataTable[0].length == innerLoopCounter)\n                } //if (requestedDataTable[0][innerIndex] == keysForSearchColumn[outerIndex]) else\n            } //for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n        } //for (outerIndex = 0; outerIndex < keysForSearchColumn.length; outerIndex++)\n        //if this point is reached, searchKeyIndices has been populated\n        // iterate through all search result keys.\n        //outer index is the place along the array of search keys \n        for (outerIndex = 0; outerIndex < keysForResultColumn.length; outerIndex++)\n        {\n            //inner index is the place along the first row of data\n            //The innerLoopCounter must be reset each time a new key is being looked for\n            innerLoopCounter = 0\n            for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n            {\n                //these 2 loops will compare every entry in the top row of the data table to every entry in the array of search keys,\n                if (requestedDataTable[0][innerIndex] == keysForResultColumn[outerIndex])\n                {\n                    //when they match push the column number on to the array that has just indices for the search keys\n                    searchResultKeysIndices.push(innerIndex)\n                    //break is used to stop comparing as once the column has been found the remaining aren't relevant\n                    break\n                } //if (requestedDataTable[0][innerIndex] == keysForResultColumn[outerIndex])\n                else\n                {\n                    //when they don't match, then this means there is a search key that does not match any header.\n                    //When properly configured this should not happen, but proper configuration cannot be guaranteed\n                    innerLoopCounter++\n                    //Error messaging should only happen if the search key has been compared with all of the headers\n                    //requestedDataTable[0].length gives the total number of data headers (columns of the spreadsheet)\n                    if (requestedDataTable[0].length == innerLoopCounter)\n                    {\n                        //populate error \n                        //put some details on this configuration into the msg to be output\n                        workingMsg.error = \"Key with value \\\"\" + keysForSearchColumn[outerIndex] + \"\\\" not found amongst the \" + (requestedDataTable[0].length + 1) + \" entries, which include \" + requestedDataTable[0]\n                        //either create and populate the error count at 1 or increment it if it already exists\n                        if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n                        {\n                            workingMsg.searchErrorCount++\n                        } //if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n                        else\n                        {\n                            workingMsg.searchErrorCount = 1\n                        } //if ( workingMsg.hasOwnProperty(\"searchErrorCount\")) else\n                        //this retry is in case the column was added to the google sheet since it was last loaded into node red\n                        if (workingMsg.searchErrorCount > 1)\n                        {\n                            //return the error on the bottom because with a count of 2 that means reloading has already been tried\n                            return [null, null, workingMsg]\n                        } //if (workingMsg.searchErrorCount > 1)\n                        else\n                        {\n                            //return the error on the middle there is an error output,\n                            return [null, workingMsg, null]\n                        } //if (workingMsg.searchErrorCount > 1) else\n                    } //if (requestedDataTable[0].length == innerLoopCounter)\n                } //if (requestedDataTable[0][innerIndex] == keysForResultColumn[outerIndex]) else\n            } //for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n        } //for (outerIndex = 0; outerIndex < keysForResultColumn.length; outerIndex++)\n        //if this point is reached, both searchKeyIndices and searchResultKeysIndices have been populated\n        //loop through all search keys, 1 index at a time and filter to a row that has the desired data in the desired column\n        let result = []\n        let pushable\n        pushable = false\n        for (outerIndex = 0; outerIndex < requestedDataTable.length; outerIndex++)\n        {\n            for (innerIndex = 0; innerIndex < searchKeyIndices.length; innerIndex++)\n            {\n                if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex])\n                {\n                    pushable = true\n                } //if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex])\n                else\n                {\n                    pushable = false\n                    break\n                } //if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex]) else\n            } //for (innerIndex = 0; innerIndex < searchKeyIndices.length; innerIndex++)\n            if (pushable)\n            {\n                result.push(requestedDataTable[outerIndex])\n            } //if (pushable)\n    \n    } //for (outerIndex = 0; outerIndex < requestedDataTable.length; outerIndex++)\n        //if this point is reached then there is a filtered table\n        //debugger\n        if (result.length === 0)\n        {\n            workingMsg.error = \"After filtering no data rows were left.\"\n            //either create and populate the error count at 1 or increment it if it already exists\n            if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n            {\n                workingMsg.searchErrorCount++\n            } //( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n            else\n            {\n                workingMsg.searchErrorCount = 1\n            } //( workingMsg.hasOwnProperty(\"searchErrorCount\")) else\n            //return the error on the middle there is an error output,\n            //this retry is in case the column was added to the google sheet since it was last loaded into node red\n            if (workingMsg.searchErrorCount > 1)\n            {\n                //return the error on the bottom because with a count of 2 that means reloading has already been tried\n                return [null, null, workingMsg]\n            } //if (workingMsg.searchErrorCount > 1)\n            else\n            {\n                //return the error on the middle there is an error output,\n                return [null, workingMsg, null]\n            } //if (workingMsg.searchErrorCount > 1) else\n        } //if (result.length === 0)\n        else if (result.length > 1)\n        {\n            //do the warning that multiple were found but will take the first\n            node.warn(\"Multiple rows were found that matched the search criteria. Results are from the first row that was found and matched.\")\n        } //else if (result.length > 1)\n        //look up the data\n        for (index = 0; index < searchResultKeysIndices.length; index++)\n        {\n            //workingMsg.searchfor.keysForSearchColumn[index] = result[0][searchResultKeysIndices]\n            // the almost working version\n            workingMsg.searchfor[keysForResultColumn[index]] = result[0][searchResultKeysIndices[index]]\n        } //for (index = 0; index < searchResultKeysIndices.length; index++)\n        //if this point is reached then work workingMsg contains complete info\n        //build and save the LastSearch obect\n        passedCacheObject.searchfor = workingMsg.searchfor\n        global.set(\"LastSearch\", passedCacheObject)\n        return [workingMsg, null, null]\n    } //if (requestedDataTable !== undefined)\n    else\n    {\n        //return on second output to trigger population of global that feeds datatable\n        //put some details on this configuration into the msg to be output\n        workingMsg.error = \"The data normally loaded from google sheet was not loaded.\"\n        //either create and populate the error count at 1 or increment it if it already exists\n        if (workingMsg.hasOwnProperty('searchErrorCount'))\n        {\n            workingMsg.searchErrorCount++\n        } //if (workingMsg.hasOwnProperty('searchErrorCount'))\n        else\n        {\n            workingMsg.searchErrorCount = 1\n        } //if (workingMsg.hasOwnProperty('searchErrorCount')) else\n        //return the error on the middle there is an error output,\n        //this retry is in case the column was added to the google sheet since it was last loaded into node red\n        if (workingMsg.searchErrorCount > 1)\n        {\n            //return the error on the bottom because with a count of 2 that means reloading has already been tried\n            return [null, null, workingMsg]\n        } //if (workingMsg.searchErrorCount > 1)\n        else\n        {\n            //return the error on the middle there is an error output,\n            return [null, workingMsg, null]\n        } //if (workingMsg.searchErrorCount > 1) else\n    } //if (requestedDataTable !== undefined) else\n}","outputs":3,"noerr":0,"x":240,"y":80,"wires":[[],["a0c44b55.6f2018"],[]],"outputLabels":["Value Found","Error but try reloading from data source","Error despite having tried to reload from data source"],"info":"# **Conceptual Explanation**\nThis node is designed to use a 2-D array of data loaded from a google sheeet to lookup desired data. The data is arrayed with the first row being column headers describing the data in those columns in subsequent rows.\n## **inputs**\n### globalsource \nThe name of the global variable holding the table of data\n### msg.keyvalues\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row.\n### msg.searchfor\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. The value enters the node empty.\n## **outputs**\n### Output1: Value Found \nThis ouput is used when the node has successfully identified the requested data. That data is placed into the value portions of the key value pairs that made up the msg.searchfor input\n### Output 2: Error but try reloading from data source\nThis output is used when either the global variable to contain the data table either does no exist or does not contain a row with all of the requested search criteria. Normally it is used to trigger loading the table from Google sheets under the expectation that either this is the first time a lookup has been tried an the data had not yet been cached in the global variable or potentially the data in the cache has become stale and reloading from the Google sheet will add a row that will match the requested search criteria.\n### Output 3: Error despite having tried to reload from data source\nThis output is used when either the global variable to contain the data table either does no exist or does not contain a row with all of the requested search criteria and at least 1 attempt has already been made to reload the global vairable cache. This is effectively a notification of non-recoverable lookup failure."},{"id":"c2e2345d.446a38","type":"change","z":"d078e2a6.ea488","name":"Devices table, 1 search key with variable input, 1 result","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"exportableresults.DeviceName","tot":"msg"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":980,"y":100,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value pulled from the **msg.exportableresults.DeviceName** object.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** column.\n"},{"id":"1a8cd32a.7b920d","type":"change","z":"d078e2a6.ea488","name":"Devices table, 1 search key, 2 results","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"Motion_Ikea","tot":"str"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.Manufacturer","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":180,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value **\"Motion_Ikea\"**.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** and **\"Manufacturer\"** columns."},{"id":"40a32932.5aa1b8","type":"change","z":"d078e2a6.ea488","name":"Devices table, 1 search key, 1 result","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"Anyone Presence","tot":"str"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":60,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value **\"Anyone Presence\"**. Notice unlike some examples this includes a space in the value. This has no negative impact.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** column."},{"id":"96422911.d26e68","type":"change","z":"d078e2a6.ea488","name":"Devices table, 2 search keys, 1 results","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"Anyone Presence","tot":"str"},{"t":"set","p":"keyvalues.Manufacturer","pt":"msg","to":"homebridge-people-geofence","tot":"str"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":140,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value **\"Anyone Presence\"** and the **\"Manufacturer\"** column for the value **\"homebridge-people-geofence\"**.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** columns."},{"id":"7f2dd6ae.079bd8","type":"comment","z":"d078e2a6.ea488","name":"Examples of preformating the inputs","info":"","x":920,"y":20,"wires":[]},{"id":"df25c86c.b56128","type":"change","z":"d078e2a6.ea488","name":"Spreadsheet Lookup Settings Example","rules":[{"t":"set","p":"IgnoreEnvVar ","pt":"msg","to":"true","tot":"bool"},{"t":"set","p":"SpreadsheetID","pt":"msg","to":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","tot":"str"},{"t":"set","p":"Tab","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"ColStart","pt":"msg","to":"A","tot":"str"},{"t":"set","p":"ColEnd","pt":"msg","to":"Z","tot":"str"},{"t":"set","p":"MinRow","pt":"msg","to":"1","tot":"str"},{"t":"set","p":"MaxRow","pt":"msg","to":"1000","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":260,"wires":[[]],"info":"## **inputs**\n### IgnoreEnvVar \nThis boolean needs to be true to tell that Read Spreadsheet For Details subflow that it should use the specs passed in the msg to determine what spreadsheet to read from and what portion of data to read from.\n### msg.SpreadsheetID\nThis is the very long string that identifies a specific google spreadsheet.\n### msg.Tab\nSpecifies the tab name that contains the data.\n### msg.ColStart\nSpecifies the leftmost column containing the desired data.\n### msg.ColEnd\nSpecifies the rightmost column containing the desired data. \n### msg.MinRow\nSpecifies the top row containing the desired data \n### msg.MaxRow\nSpecifies the bottom row containing the desired data "},{"id":"d02aace0.75997","type":"debug","z":"d078e2a6.ea488","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":160,"y":240,"wires":[]},{"id":"d17934c7.820378","type":"string","z":"f14b69ba.8b2da8","name":"Remove zigbee2mqtt/ from the topic","methods":[{"name":"chompLeft","params":[{"type":"str","value":"zigbee2mqtt/"}]}],"prop":"topic","propout":"topic","object":"msg","objectout":"msg","x":950,"y":60,"wires":[["c2f367a9.6e5a38"]]},{"id":"c712febc.b71e3","type":"change","z":"f14b69ba.8b2da8","name":"Add MQTT Master (different per source)","rules":[{"t":"set","p":"MQTTName","pt":"msg","to":"zb2mqtt","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1320,"y":100,"wires":[["15517c22.4c7e64"]]},{"id":"c2f367a9.6e5a38","type":"change","z":"f14b69ba.8b2da8","name":"Put device ID into msg.deviceID and payload into payload.value","rules":[{"t":"set","p":"deviceID","pt":"msg","to":"topic","tot":"msg"},{"t":"set","p":"temp","pt":"msg","to":"payload","tot":"msg"},{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.value","pt":"msg","to":"temp","tot":"msg"},{"t":"delete","p":"temp","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1390,"y":60,"wires":[["c712febc.b71e3"]]},{"id":"15517c22.4c7e64","type":"function","z":"f14b69ba.8b2da8","name":"Split kv pairs (from value) into 1-n msg stream (ready for testing)","func":"/*\n * Main function node code \n * \n */\n//Check if there is any data. If not, stop processing. At the time this was created, the trackData sent from a Hubitat Elevation device node was always null\nif (msg.payload.value === null) {\n    return null;\n}\n//delete the currentValue portion of the object since it is deprecated\ndelete msg.payload.currentValue\n//initial call into the recursive function\nhandlemsg(msg)\n//send nothing from main code\nreturn\n\n/*\n * Main recursive function code\n *\n */\n\nfunction handlemsg(msg) {\n    //The evaluation part of this switch/case statement determines which type of entity is in the value\n    //  the key idea is that once the value is an atomic item (number, string, bool) then the message should be sent out\n    //  of the node to downstream, but if the value is a splittable, then it should be split into multiple messages. These\n    //  messages are then evaulated individually. They in turn are either found to have atomic entries in the value or have\n    //  values that are themselves splittable.\n    //  For example:\n    //  JSON - each key value pair will be used to create a new msg. The msg.payload.name will be changed to add \":\" and the key\n    //          from the key value pair. The msg.payload.value will become the value from the key value pair\n    //  Array - TBAdded\n    //  Object - TBAdded\n    switch (typeofhubitatvalue(msg.payload.value, \"msg.payload.value\")) {\n        case \"number\":\n        case \"bigint\":\n            //numbers are an atomic type of value and should be sent to downstream nodes\n            msg.payload.dataType = \"Number\"\n            //send the version of the msg with an atomic value to downstream nodes\n            node.send(msg)\n            //do nothing more once msg has been sent\n            break;\n        case \"boolean\":\n            //Booleans are an atomic type of value and should be sent to downstream nodes\n            msg.payload.dataType = \"Boolean\"\n            //send the version of the msg with an atomic value to downstream nodes\n            node.send(msg)\n            //do nothing more once msg has been sent\n            break;\n        case \"string\":\n            //Strings are an atomic type of value and should be sent to downstream nodes\n            msg.payload.dataType = \"String\"\n            //send the version of the msg with an atomic value to downstream nodes\n            node.send(msg)\n            //do nothing more once msg has been sent\n            break;\n        case \"unsplittable array\":\n            //This case is where the item is an array, but with only a single entry. The idea is to move that single\n            //  value out of the array and into the value natively and then to call the recursive function to evaluate\n            //  what type of item it now is and then process (split or send or extract) appropriately\n            msg.payload.value = msg.payload.value[0]\n            handlemsg(msg)\n            break;\n        case \"splittable JSON\":\n            //This is for cases where the JSON is in the form of key:value where there is at least 1 pair\n            //  Examples of \"valid\" JSON that would not be coming to this case would be {} or 100\n            splitJSON(msg)\n            break;\n        case \"splittable array\":\n            //This is for cases where the Array is in the form [\"A\",\"B\",\"C\"] where there is are at least 2 members\n            //  SplitArray function not yet built. TBD\n            splitArray(msg)\n            break;\n        case \"unsplittable JSON\":\n            //This is for handling \"valid\" JSON that does not have key:value pairs.\n            //  Examples of \"valid\" JSON that are handed here are {} or 100 or \"100\"\n            //  This case either treats it as a string (no changes made) or a number where a number in\n            //  a string like \"100\" is changed into an actual number like 100\n\n            //by checking if NaN, if it is a number 100 or \"100\", the ++ followed by -- changes it to a number 100\n            //  without changing its actual value\n            if (isNaN(msg.payload.value)) { } else {\n                ++msg.payload.value;\n                --msg.payload.value;\n            }\n            //Sets the data type for downstream since the incoming message could have been a variety of types\n            //  before JSON, object or array was split\n            msg.payload.dataType = typeof (msg.payload.value)\n            //send the version of the msg with an atomic value to downstream nodes (could probably just recursively call\n            //  handlemsg, but I can't identify a circumstance where that would give a different result to downstream,\n            //  but this would be a place to investigate if downstream results are unexpected.)\n            node.send(msg)\n            break\n        case \"object\":\n            //This is for handling an object. It then calls splitObj to create multiple msgs with the object keys into the names\n            //  and the values from those keys moved into the value of the new object.\n            splitObj(msg)\n            break\n        default:\n            //This is just in case no valid process is found by the typeofhubitatvalue function.\n            //  If you encounter this then you will either need to investigate the function or contact tmichael in\n            //  Hubitat discourse forums https://community.hubitat.com/\n            return\n    }\n}\n\n/*\n * This function is used by the Main recursive function (handlemsg) to decide whether to send the msg on as\n *  the msg.payload.value is atomic or if it needs to split the value into multiple msgs\n *\n */\nfunction typeofhubitatvalue(value, source = \"\") {\n    switch (typeof (value)) {\n        case \"number\":\n            //atomic just return the result of typeof\n            return \"number\"\n            break;\n        case \"bigint\":\n            //atomic just return the result of typeof\n            return \"bigint\"\n            break;\n        case \"boolean\":\n            //atomic just return the result of typeof\n            return \"boolean\"\n            break;\n        case \"string\":\n            //most splittable values are encoded strictly as text and so may be identified as a string\n\n            //Fist check if the string is \"valid\" JSON\n            if (isvalidJSONstring(value)) {\n                //When it is \"valid\" JSON, check if it is splittable\n                if (issplittablevalidJSONstring(value)) {\n                    //When it is splittable, then return type as splittable JSON\n                    return \"splittable JSON\"\n                }\n                else {\n                    //if it is JSON, but not splittable ({}, \"100, 100) return unsplittable JSON\n                    return \"unsplittable JSON\"\n                }\n            }\n            else {\n                //When it isn't \"valid\" JSON, check if it is an array\n                if (isvalidarray(value)) {\n                    //When it is an array, check if it is splittable\n                    if (issplittablearray(value)) {\n                        //When it is splittable, return splittable Array\n                        return \"splittable Array\"\n                    }\n                    else {\n                        //if the array is not splittable ([\"apple\"]) return unsplittable array\n                        return \"unsplittable array\"\n                    }\n                }\n                else {\n                    //When it is neither JSON or Array, then it is really just a string, so return string\n                    return \"string\"\n                }\n            }\n            break;\n        case \"object\":\n            //some  splittable values are identified as objects\n\n            //Fist check if the object is \"valid\" JSON\n            if (isvalidJSONstring(value)) {\n                //When it is \"valid\" JSON, check if it is splittable\n                if (issplittablevalidJSONstring(value)) {\n                    //When it is splittable, then return type as splittable JSON\n                    return \"splittable JSON\"\n                }\n                else {\n                    //if it is JSON, but not splittable ({}, \"100, 100) return unsplittable JSON\n                    return \"unsplittable JSON\"\n                }\n            }\n            else {\n                //When it isn't \"valid\" JSON, check if it is an array\n                if (isvalidarray(value)) {\n                    //When it is an array, check if it is splittable\n                    if (issplittablearray(value)) {\n                        //When it is splittable, return splittable Array\n                        return \"splittable Array\"\n                    }\n                    else {\n                        //if the array is not splittable ([\"apple\"]) return unsplittable array\n                        return \"unsplittable array\"\n                    }\n                }\n                else {\n                    //When it is neither JSON or Array, then I have not accounted for it. If you reach this point during an\n                    //  investigation, it might be worth using the example that triggered your investigation to see if the object\n                    //  is really just a string (without a triggering example I have not investigated)\n                    return \"object\"\n                }\n            }\n            break;\n        default:\n            //When the type is not one that I coded for then return unhandled because the situation is by definition unhandled\n            return \"unhandled\"\n            break;\n    }\n}\n\n//True False functions\n/*\n * This function was found on the internet to check if an input is valid JSON\n * There seems to be a belief that there should be some more elegant method that trying parse and the catching the error,\n * but no one seems to have demonstrated what that more elegant way would be\n */\nfunction isvalidJSONstring(str) {\n    try {\n        JSON.parse(str);\n    } catch (e) {\n        return false;\n    }\n    return true;\n}\n\n/*\n * This function decides where the JSON is made up of at least 1 key:value pair\n */\nfunction issplittablevalidJSONstring(str) {\n    if (str.includes(\":\")) {\n        return true;\n    }\n    else {\n        return false;\n    }\n}\n/*\n * This function is simply wrapping the Array.isArray, to align the function naming with the other true false functions\n */\nfunction isvalidarray(str) {\n    if (Array.isArray(str)) {\n        return true;\n    }\n    else {\n        return false;\n    }\n}\n/*\n * This function identifies if the array has only a single entry or multiple entries i.e. [\"Apple\"] not splittable,\n *  [\"Apple\",\"Pear\"] splittable\n */\nfunction issplittablearray(str) {\n    // If the length is more than 1, then the array has mutliple entries, but if it is just 1, then it is not splittable\n    if (str.length > 1) {\n        return true;\n    }\n    else {\n        return false;\n    }\n}\n\n//Splitting functions\n/*\n * This function takes in a msg where msg.payload.value is splittable JSON and iterates through all key:value pairs and then\n *  recursively calls handlemsg with multiple messages. Each new message retains most of the details of the input message, \n *  but the name and value are changed.\n *  The name has the key from the key:value pair appended with a : as a seperator\n *  The value is replaced with the value from the key:value pair\n *  A new message is created for each key:value pair\n */\nfunction splitJSON(latestMsg) {\n    //put the inputs value into a variable for easier access\n    var valueJSON = JSON.parse(latestMsg.payload.value);\n    //put the inputs name aside for multiple reuses\n    var name = latestMsg.payload.name\n    //Iterative loop\n    Object.keys(valueJSON).forEach(function (key) {\n        //concatenate the original name, a colon and the key from the pair\n        if (typeof name === 'undefined') \n        {\n            latestMsg.payload.name = key;\n        } \n        else \n        {\n            latestMsg.payload.name = name + \"/\" + key;\n        }\n        //move the value from the pair to payload.value\n        latestMsg.payload.value = valueJSON[key];\n        //recursively call this function in case the value is itself splittable\n        handlemsg(latestMsg)\n    }\n    )\n    return\n}\n\n/*\n * This function takes in a msg where msg.payload.value is splittable object\n *  and iterates through all key:value pairs and then\n *  recursively calls handlemsg with multiple messages. Each new message retains most of the details of the input message,\n *  but the name and value are changed.\n *  The name has the key from the key:value pair appended with a : as a seperator\n *  The value is replaced with the value from the key:value pair\n *  A new message is created for each key:value pair\n *  \n *  Note: While working on the splitArray function, I realized that I may not have tested this on an object value with multiple\n *  pairs, so it is possible that the function only handles the first pair\n */\nfunction splitObj(oMsg) {\n    //put the inputs name aside for multiple reuses\n    var name = oMsg.payload.name\n//Iterative loop\n    for (let [key, value] of Object.entries(oMsg.payload.value)) {\n        if ((value !== null) && (key !== null)) {\n            oMsg.payload.name = name + \"/\" + key;\n            oMsg.payload.value = value;\n            //recursively call this function in case the value is itself splittable\n            handlemsg(oMsg)\n        }\n    }\n}\n\n/*\n * Note: At the time of creation, I did not have a live example and had too many other things in the works to construct one.\n * \n * This function takes in a msg where msg.payload.value is splittable array\n *  and iterates through all entries and recursively calls handlemsg with multiple messages. \n *  Each new message retains most of the details of the input message,\n *  but the value is changed.\n *  The value is replaced with the value from the entry in the Array\n *  For example if the input value is [\"Apple\",\"Pear\"], then the first msg will have a value of \"Apple\"\n *  and the second will have a value of \"Pear\"\n */\nfunction splitArray(aMsg) {\n    //Iterative loop\n    for (index = 0; index < aMsg.payload.value.length; index++) {\n        (aMsg.payload.value = aMsg.payload.value[index]);\n        //recursively call this function in case the value is itself splittable\n        handlemsg(aMsg)\n    }\n}","outputs":1,"noerr":0,"x":1390,"y":140,"wires":[["2d0789f6.1eebc6"]]},{"id":"2d0789f6.1eebc6","type":"change","z":"f14b69ba.8b2da8","name":"","rules":[{"t":"delete","p":"qos","pt":"msg"},{"t":"delete","p":"retain","pt":"msg"},{"t":"delete","p":"payload.dataType","pt":"msg"},{"t":"delete","p":"deviceID","pt":"msg"},{"t":"set","p":"exportableresults.MQTTname","pt":"msg","to":"MQTTName","tot":"msg"},{"t":"delete","p":"MQTTName","pt":"msg"},{"t":"set","p":"exportableresults.DeviceName","pt":"msg","to":"topic","tot":"msg"},{"t":"delete","p":"topic","pt":"msg"},{"t":"set","p":"exportableresults.Measure","pt":"msg","to":"payload.name","tot":"msg"},{"t":"set","p":"exportableresults.Reading","pt":"msg","to":"payload.value","tot":"msg"},{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1240,"y":180,"wires":[["f07d3b90.672788"]]},{"id":"f07d3b90.672788","type":"link out","z":"f14b69ba.8b2da8","name":"Get DeviceID","links":["2163d00a.19ea2"],"x":1430,"y":180,"wires":[],"l":true},{"id":"2d499f0.10a2b62","type":"function","z":"88b1bb66.b78488","name":"Determine Source For Gsheet lookup properties.","func":"//Read subflow input variables\nif (env.get(\"OverrideEnvVariables\"))\n{\n    //Put inputs and read values into msg properties to be visible downstream\n    msg.sheet = msg.SpreadsheetID;\n    msg.tab = msg.Tab;\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    msg.topic = msg.targetrange\n    delete msg.Tab\n    delete msg.SpreadsheetID\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\n}\nelse if (msg.IgnoreEnvVar)\n{\n    //Put inputs and read values into msg properties to be visible downstream\n    msg.sheet = msg.SpreadsheetID;\n    msg.tab = msg.Tab;\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    msg.topic = msg.targetrange\n    delete msg.Tab\n    delete msg.SpreadsheetID\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\n}\nelse\n{\n    var ColStart = env.get(\"ColStart\");\n    var ColEnd = env.get(\"ColEnd\");\n    var FirstRow = env.get(\"MinRow\");\n    var LastRow = env.get(\"MaxRow\");\n    //Put inputs and read values into msg properties to be visible downstream\n    msg.sheet = env.get(\"Spreadsheet ID\");\n    msg.tab = env.get(\"TabName\");\n    msg.cellstart = ColStart + FirstRow\n    msg.cellend = ColEnd + LastRow\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    msg.topic = msg.targetrange\n    delete msg.Tab\n    delete msg.SpreadsheetID\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\n    //These 2 are needed later to calculate the last populate and first empty rows and columns\n    msg.ColStart = ColStart\n    msg.MinRow = FirstRow\n}\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":20,"wires":[["cff1ac49.1501e","d6abc01d.b16b7"]],"info":"This node sets up the inputs to the GSheet node.\nThe outputs that make up those inputs are:\n - msg.sheet -the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n - msg.topic - the combination of spreadsheet tab and cell range\n## Note\nThere are 2 very similar booleans evaluated by this node. They are:\n * **OverrideEnvVariables** - This one looks at the environment variable that was set in the flow triggering the subflow\n * **msg.IgnoreEnvVar** - This one is allows the logic to be driven by a message object property and thus can be set at runtime or earlier in the flow based on upstream logic\n\nFirst it checks the boolean value of the **OverrideEnvVariables** environment variable. This is by default false. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming the first was false, it checks the boolean value of the **msg.IgnoreEnvVar** value. This will evaluated as false if not populated, so sending false is unnecessary. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming both are false, then it can build the outputs based on the subflows environment variables. These can either be those set in the calling flow or they may be the default ones built into the subflow.\n\nRegardless of the method used to build the output, the node also removes the input message properties.\n\n\n\nmsg.IgnoreEnvVar"},{"id":"cff1ac49.1501e","type":"GSheet","z":"88b1bb66.b78488","creds":"adb4e9b8.8beee8","method":"get","action":"","sheet":"","cells":"","name":"Read Input from GSheet","x":610,"y":20,"wires":[["94c0f236.ee459"]],"info":"Use the GSheet node to get the a set of rows from a google spreadsheet.\n\n# **Inputs**\n### **creds**\nThis is the name on the gauth configuration node. How to get the details is beyond the scope of what I am going to put into an individual node instance. Some details are at [node-red-contrib-google-sheets](https://flows.nodered.org/node/node-red-contrib-google-sheets)\n### **Method**\nIn this case using the get cells method to read a set of data.\n### **SpreadsheetID**\nUnused as the spreadsheet ID is passed in as part of the input msg, but if needed it would be the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n### **Cells**\nUnused as the requested cells are passed in as part of the input msg, but if it was being manually built for a static data source the format is made of of 3 parts with specific seperators:\n * **[Sheetname]** like Sheet1\n * **[upper left corner cell address]** like A1\n * **[lower right corner cell address]** like B2\n\nThe format is **[Sheetname]**!**[upper left corner cell address]**:**[lower right corner cell address]** giving an input like **Sheet1!A1:B2**\n "},{"id":"6fa0e545.9bcb9c","type":"comment","z":"88b1bb66.b78488","name":"Error","info":"","x":1090,"y":20,"wires":[]},{"id":"7c5285b8.8ae67c","type":"comment","z":"88b1bb66.b78488","name":"Last Populated Row","info":"","x":1130,"y":100,"wires":[]},{"id":"c2f995a2.54ffd8","type":"function","z":"88b1bb66.b78488","name":"Prepare Output Parts","func":"/*\n * Row response calculations\n */\nmsg.LastPopulatedRow = msg.payload.length + msg.MinRow - 1\nmsg.FirstEmptyRow = msg.LastPopulatedRow + 1\n\n/*\n *Column response calculation variables\n */\nlet colCount = 1 //number of columns wide from the data retrieved. This will eventually be replace by logic that loops through array find the max width for any given row\nlet index\nlet sheetdata = msg.payload //this is the data that is returned from Google that will then be examined\nlet fCol = msg.ColStart\nlet fColTotal = 0 //to hold the column number\nlet nCol = \"\"   //nCol is new column\nlet lCol = \"\"   //lCol is last column in the range (to be populated from the actual Gsheet calls data)\n\nfCol = fCol.toUpperCase()\n/*\n * validate fCol (done)\n */\nlet validStartCol = false\nvalidStartCol = ((fCol.length == 1) ||\n                ((fCol.substr(0, 1).charCodeAt(0) - 64) < 9) ||\n                (((fCol.substr(0, 1).charCodeAt(0) - 64) == 9) && ((fCol.substr(1, 1).charCodeAt(0) - 64) <= 22)))\n/*\n *Column response calculations\n */\n//look at each row that is an array\nfor (index = 0; index < sheetdata.length; index++)\n{\n    if (Array.isArray(sheetdata[index]))\n    {\n        // when the rows width is greater than any of the previous rows set the column count to the new largest width\n        colCount = Math.max(colCount, sheetdata[index].length)\n    } //if (Array.isArray(sheetdata[index]))\n}  //for (index = 0; index < sheetdata.length; index++)\nswitch (fCol.length) {\n    case 1:\n        fColTotal = (fCol.substr(0, 1).charCodeAt(0) - 64)\n        fColTotal += colCount - 1\n        break\n    case 2:\n        fColTotal = (fCol.substr(1, 1).charCodeAt(0) - 64) + 26 * (fCol.substr(0, 1).charCodeAt(0) - 64)\n        fColTotal += colCount - 1\n        break\n    default:\n        fColTotal = -1\n}\n//Last Populated Column and First Empty Column calculation\nif ((fColTotal <= 25) && (fColTotal >= 1)) {\n    lCol = String.fromCharCode(fColTotal+64)\n    nCol = String.fromCharCode(fColTotal+65)\n} else if (fColTotal == 26) {\n    lCol = \"Z\"\n    nCol = \"AA\"\n} else if (fColTotal >= 27) {\n    lCol = String.fromCharCode((Math.floor(fColTotal / 26)) + 64) + String.fromCharCode((fColTotal % 26) + 64)\n    nCol = String.fromCharCode((Math.floor(fColTotal / 26)) + 64) + String.fromCharCode((fColTotal % 26) + 65)\n} else if (fColTotal == -1) {\n    lCol = \"Error\"\n    nCol = \"Error\"\n    //Probably worth putting real error here, but deferred\n} else if (fColTotal == 256) {\n    lCol = \"IV\"\n    nCol = \"None\"\n}\nmsg.LastPopulatedCol = lCol\nmsg.FirstEmptyCol = nCol\nmsg.SpreadsheetArray = msg.payload\nreturn msg;","outputs":1,"noerr":0,"x":560,"y":540,"wires":[["d1e7b582.91d168","c7139127.7efa8","e336bdeb.a1ed4","ddb445f3.4541d8","89a29d6e.b7516","dc118d10.32edb"]],"info":"Takes an input from the Gsheet node and calculates a variety of details about the spreadsheet info.\n### **Output**\nmsg.LastPopulatedRow\nmsg.FirstEmptyRow\nmsg.LastPopulatedCol\nmsg.FirstEmptyCol\nmsg.SpreadsheetArray\n"},{"id":"a5f60237.14a49","type":"comment","z":"88b1bb66.b78488","name":"First Empty Row","info":"","x":1120,"y":180,"wires":[]},{"id":"e17e9b0d.00ffc8","type":"comment","z":"88b1bb66.b78488","name":"Last Populated Column","info":"","x":1140,"y":260,"wires":[]},{"id":"2ba9ee87.e6a7f2","type":"comment","z":"88b1bb66.b78488","name":"First Empty Column","info":"","x":1130,"y":340,"wires":[]},{"id":"f0bb356b.465258","type":"comment","z":"88b1bb66.b78488","name":"Spreadsheet Array","info":"","x":1130,"y":420,"wires":[]},{"id":"9581689d.923c18","type":"comment","z":"88b1bb66.b78488","name":"Full Data","info":"","x":1100,"y":500,"wires":[]},{"id":"855709c1.557608","type":"comment","z":"88b1bb66.b78488","name":"Full Data with Inputs","info":"","x":1130,"y":580,"wires":[]},{"id":"d1e7b582.91d168","type":"change","z":"88b1bb66.b78488","name":"Leave Outputs","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":540,"wires":[[]],"info":"Deletes a variety of message properties, but leaves all of them that were calculated about the Gsheet nodes results to be returned on the designated subflow output."},{"id":"c7139127.7efa8","type":"change","z":"88b1bb66.b78488","name":"Leave Last Populated Row","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"LastPopulatedRow","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":140,"wires":[[]],"info":"Copies msg.theLastPopulatedRow into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"e336bdeb.a1ed4","type":"change","z":"88b1bb66.b78488","name":"Leave First Empty Row","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"FirstEmptyRow","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":870,"y":220,"wires":[[]],"info":"Copies msg.FirstEmptyRow into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"ddb445f3.4541d8","type":"change","z":"88b1bb66.b78488","name":"Leave Last Populated Column","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"LastPopulatedCol","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":890,"y":300,"wires":[[]],"info":"Copies msg.LastPopulatedCol into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"89a29d6e.b7516","type":"change","z":"88b1bb66.b78488","name":"Leave First Empty Column","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"FirstEmptyCol","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":380,"wires":[[]],"info":"Copies msg.FirstEmptyCol into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"dc118d10.32edb","type":"change","z":"88b1bb66.b78488","name":"Leave Spreadsheet Array","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"SpreadsheetArray","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":870,"y":460,"wires":[[]],"info":"Copies msg.SpreadsheetArray into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"47e2aa4.95a2354","type":"trigger","z":"88b1bb66.b78488","name":"Watchdog","op1":"","op2":"timeout","op1type":"nul","op2type":"str","duration":"10","extend":true,"units":"s","reset":"","bytopic":"all","outputs":1,"x":600,"y":140,"wires":[["ddb445f3.4541d8","c7139127.7efa8","89a29d6e.b7516","dc118d10.32edb","d1e7b582.91d168"]],"info":"This trigger node works as a watchdog to see if the request to see if the read of the Google Sheet that was triggered on the other branch is successful. If it is succeful, then it will receive a reset message (msg.reset) from the Reset Watchdog node. If, however, 10 seconds elapse without receiving the reset message, this node sends a timeout message (msg.timeout)."},{"id":"d6abc01d.b16b7","type":"change","z":"88b1bb66.b78488","name":"","rules":[{"t":"set","p":"timeout","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":120,"wires":[["47e2aa4.95a2354"]],"info":"Labels what the initial input to the watchdog trigger node is."},{"id":"d9429817.54f548","type":"change","z":"88b1bb66.b78488","name":"","rules":[{"t":"delete","p":"reset","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":350,"y":540,"wires":[["c2f995a2.54ffd8"]],"info":"Removes msg.reset that was only intended for the watchdog trigger node."},{"id":"56c3aeb2.ff1f4","type":"catch","z":"88b1bb66.b78488","name":"Catch and Relay Errors","scope":null,"uncaught":false,"x":860,"y":60,"wires":[[]],"info":"Passes any caught error to the error subflows intentially built error output. By intentionally built I mean I created one and labelled it as such. This is not there by default."},{"id":"94c0f236.ee459","type":"change","z":"88b1bb66.b78488","name":"Reset Watchdog","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":140,"y":140,"wires":[["47e2aa4.95a2354","d9429817.54f548"]],"info":"Sends the reset message to the watchdog triger node when there is output from the Gsheet node."},{"id":"202839c5.35e086","type":"function","z":"2a6ce360.19688c","name":"Db Put the payload into a global variable named after the content of msg.globalsource","func":"global.set(msg.globalsource, msg.payload)\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":389,"wires":[["e81b20c8.9dbf5"]],"info":"# **What** #\nThis is a simple function node that stores the msg.payload into a global variable. This is done in a function node, however, because the name of that global variable is passed into the function as a the value of msg.globalsource. \n\n## **Why**\nNormally this would be done in a change node, but change nodes could not as of May 2020 take a msg object component as the name of the global variable to be set."},{"id":"ac71b231.85d5c","type":"subflow:88b1bb66.b78488","z":"2a6ce360.19688c","name":"","env":[],"x":580,"y":189,"wires":[[],[],[],[],[],[],["202839c5.35e086"],[]],"info":"This subflow shows information in the environment variables. These are good for testing purposes, but it is noteworthy that the override boolean is false. Unless that boolean is changed, they have no impact."},{"id":"e81b20c8.9dbf5","type":"function","z":"2a6ce360.19688c","name":"Db Use input to lookup info","func":"//Ref. TMS-000001\n\n//if(msg.exportableresults.DeviceName !== \"Switch_Ikea\") {return}\n\n\n\n//1 Get must have items: searchKeys, searchValues, searchResultKeys, cachedSearch, cacheTime\nlet searchKeys = Object.keys(msg.keyvalues)\nlet searchValues = Object.values(msg.keyvalues)\nlet searchResultKeys = Object.keys(msg.searchfor)\nlet cachedSearch = global.get(\"LastSearch\")\nlet cacheTime = new Date().getTime()\n//2 create working variables searchKeyIndices, searchResultKeysIndices, index, cacheKey\nlet searchResultKeysIndices = []\nlet index\nlet cacheObject\n//3 build the cache key which is essentially the concatenation of key+value+nextkey+nextvalue+.....etc\ncacheObject = BuildCacheObject(searchKeys, searchValues, searchResultKeys)\n//4\n/*\n * 4.1 t/f cached result is usable\n    *  4.1.true then t/f does it meet criteria\n        * 4.1.true.true\ttrue msg.searchfor = cachedSearch.searchfor\n        * 4.1.true.false do the common lookup\n    *   4.1.false  do the common lookup\n    */\n//4.1\nif (cachedSearch !== undefined)\n{\n    //4.1.true\n    if ((cachedSearch.query == cacheObject.query) && (cachedSearch.time > cacheObject.time - 5000))\n    {\n        //4.1.true.true\n        msg.searchfor = cachedSearch.searchfor\n        return [msg, null, null]\n    } //if ((cachedSearch.query == cacheObject.query) && (cachedSearch.time > cacheObject.time - 5000))\n    //4.1.true.false\n    else\n    {\n        //4.1.true.false\n        lookupResults = CommonLookup(msg, searchKeys, searchResultKeys, searchValues, global.get(msg.globalsource), cacheObject)\n        //return results from the node on 1 of the 3 outputs\n        if (lookupResults[0] !== null)\n        {\n            return [lookupResults[0], null, null]\n        } //if (lookupResults[0] !== null)\n        else if (lookupResults[1] !== null)\n        {\n            return [null, lookupResults[1], null]\n        } //else if (lookupResults[1] !== null)\n        else\n        {\n            return [null, null, lookupResults[2]]\n        } //else if (lookupResults[1] !== null) else\n    } //if ((cachedSearch.query == cacheObject.query) && (cachedSearch.time > cacheObject.time - 5000)) else\n} //if (cachedSearch !== undefined)\n//4.1.false\nelse\n{\n    //4.1.false\n    lookupResults = CommonLookup(msg, searchKeys, searchResultKeys, searchValues, global.get(msg.globalsource), cacheObject)\n    //return results from the node on 1 of the 3 outputs\n    if (lookupResults[0] !== null)\n    {\n        return [lookupResults[0], null, null]\n    } //if (lookupResults[0] !== null)\n    else if (lookupResults[1] !== null)\n    {\n        return [null, lookupResults[1], null]\n    } //else if (lookupResults[1] !== null)\n    else\n    {\n        return [null, null, lookupResults[2]]\n    } //else if (lookupResults[1] !== null) else\n} //if (cachedSearch !== undefined) else\nreturn\n\nfunction BuildCacheObject(searchKeysArray, SearchValuesArray, SearchResultKeysArray) {\n    //3 build the cache key which is essentially the concatenation of key+value+nextkey+nextvalue+.....etc\n    let newCacheKey =\"\"\n    for (index = 0; index < searchKeysArray.length; index++)\n    {\n        newCacheKey = newCacheKey + searchKeysArray[index] + SearchValuesArray[index]\n    } //for (index = 0; index < searchKeysArray.length; index++)\n    //add all fields that will be looked for into the cache key\n    for (index = 0; index < SearchResultKeysArray.length; index++)\n    {\n        newCacheKey = newCacheKey + SearchResultKeysArray[index]\n    } //for (index = 0; index < SearchResultKeysArray.length; index++)\n    //combine the cache key and the cache time into a single object that can be compared with the cached last search\n    let createdCacheObject = \n    {\n        query: newCacheKey,\n        time: cacheTime\n    }\n    return createdCacheObject\n}\nfunction CommonLookup(workingMsg, keysForSearchColumn, keysForResultColumn, valuesSearchedFor, requestedDataTable, passedCacheObject) {\n    let searchKeyIndices = []\n    let searchResultKeysIndices = []\n    let outerIndex\n    let innerLoopCounter\n    let innerIndex\n    let index\n    if (requestedDataTable !== undefined)\n    {\n        // iterate through all search keys.\n        //outer index is the place along the array of search keys\n        for (outerIndex = 0; outerIndex < keysForSearchColumn.length; outerIndex++)\n        {\n            //inner index is the place along the first row of data\n            //The innerLoopCounter must be reset each time a new key is being looked for\n            innerLoopCounter = 0\n            for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n            {\n                //these 2 loops will compare every entry in the top row of the data table to every entry in the array of search keys,\n                if (requestedDataTable[0][innerIndex] == keysForSearchColumn[outerIndex])\n                {\n                    //when they match push the column number on to the array that has just indices for the search keys\n                    searchKeyIndices.push(innerIndex)\n                    //break is used to stop comparing as once the column has been found the remaining aren't relevant\n                    //////////////////////////////////////////////////////////////////////////break may be a problem. Maybe swap inner and outer arrays and then do some if then about getting through the whole data headers without finding. Right now it only looks for 1 failure\n                    break\n                } //if (requestedDataTable[0][innerIndex] == keysForSearchColumn[outerIndex])\n                else\n                {\n                    //when they don't match, then this means there is a search key that does not match any header.\n                    //When properly configured this should not happen, but proper configuration cannot be guaranteed\n                    //this is accumulating how many times the search key did not match one of the data table headers\n                    innerLoopCounter++\n                    //Error messaging should only happen if the search key has been compared with all of the headers\n                    //requestedDataTable[0].length gives the total number of data headers (columns of the spreadsheet)\n                    if (requestedDataTable[0].length == innerLoopCounter)\n                    {\n                        //populate error \n                        //put some details on this configuration into the msg to be output\n                        workingMsg.error = \"Key with value \\\"\" + keysForSearchColumn[outerIndex] + \"\\\" not found amongst the \" + (requestedDataTable[0].length + 1) + \" entries, which include \" + requestedDataTable[0]\n                        //either create and populate the error count at 1 or increment it if it already exists\n                        if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n                        {\n                                workingMsg.searchErrorCount++\n                        }\n                        else\n                        {\n                            workingMsg.searchErrorCount = 1\n                        }\n                        //this retry is in case the column was added to the google sheet since it was last loaded into node red\n                        if (workingMsg.searchErrorCount > 1)\n                        {\n                            //return the error on the bottom because with a count of 2 that means reloading has already been tried\n                            return [null, null, workingMsg]\n                        }\n                        else\n                        {\n                            //return the error on the middle there is an error output,\n                            return [null, workingMsg, null]\n                        }\n                    } //if (requestedDataTable[0].length == innerLoopCounter)\n                } //if (requestedDataTable[0][innerIndex] == keysForSearchColumn[outerIndex]) else\n            } //for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n        } //for (outerIndex = 0; outerIndex < keysForSearchColumn.length; outerIndex++)\n        //if this point is reached, searchKeyIndices has been populated\n        // iterate through all search result keys.\n        //outer index is the place along the array of search keys \n        for (outerIndex = 0; outerIndex < keysForResultColumn.length; outerIndex++)\n        {\n            //inner index is the place along the first row of data\n            //The innerLoopCounter must be reset each time a new key is being looked for\n            innerLoopCounter = 0\n            for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n            {\n                //these 2 loops will compare every entry in the top row of the data table to every entry in the array of search keys,\n                if (requestedDataTable[0][innerIndex] == keysForResultColumn[outerIndex])\n                {\n                    //when they match push the column number on to the array that has just indices for the search keys\n                    searchResultKeysIndices.push(innerIndex)\n                    //break is used to stop comparing as once the column has been found the remaining aren't relevant\n                    break\n                } //if (requestedDataTable[0][innerIndex] == keysForResultColumn[outerIndex])\n                else\n                {\n                    //when they don't match, then this means there is a search key that does not match any header.\n                    //When properly configured this should not happen, but proper configuration cannot be guaranteed\n                    innerLoopCounter++\n                    //Error messaging should only happen if the search key has been compared with all of the headers\n                    //requestedDataTable[0].length gives the total number of data headers (columns of the spreadsheet)\n                    if (requestedDataTable[0].length == innerLoopCounter)\n                    {\n                        //populate error \n                        //put some details on this configuration into the msg to be output\n                        workingMsg.error = \"Key with value \\\"\" + keysForSearchColumn[outerIndex] + \"\\\" not found amongst the \" + (requestedDataTable[0].length + 1) + \" entries, which include \" + requestedDataTable[0]\n                        //either create and populate the error count at 1 or increment it if it already exists\n                        if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n                        {\n                            workingMsg.searchErrorCount++\n                        } //if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n                        else\n                        {\n                            workingMsg.searchErrorCount = 1\n                        } //if ( workingMsg.hasOwnProperty(\"searchErrorCount\")) else\n                        //this retry is in case the column was added to the google sheet since it was last loaded into node red\n                        if (workingMsg.searchErrorCount > 1)\n                        {\n                            //return the error on the bottom because with a count of 2 that means reloading has already been tried\n                            return [null, null, workingMsg]\n                        } //if (workingMsg.searchErrorCount > 1)\n                        else\n                        {\n                            //return the error on the middle there is an error output,\n                            return [null, workingMsg, null]\n                        } //if (workingMsg.searchErrorCount > 1) else\n                    } //if (requestedDataTable[0].length == innerLoopCounter)\n                } //if (requestedDataTable[0][innerIndex] == keysForResultColumn[outerIndex]) else\n            } //for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n        } //for (outerIndex = 0; outerIndex < keysForResultColumn.length; outerIndex++)\n        //if this point is reached, both searchKeyIndices and searchResultKeysIndices have been populated\n        //loop through all search keys, 1 index at a time and filter to a row that has the desired data in the desired column\n        let result = []\n        let pushable\n        pushable = false\n        for (outerIndex = 0; outerIndex < requestedDataTable.length; outerIndex++)\n        {\n            for (innerIndex = 0; innerIndex < searchKeyIndices.length; innerIndex++)\n            {\n                if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex])\n                {\n                    pushable = true\n                } //if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex])\n                else\n                {\n                    pushable = false\n                    break\n                } //if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex]) else\n            } //for (innerIndex = 0; innerIndex < searchKeyIndices.length; innerIndex++)\n            if (pushable)\n            {\n                result.push(requestedDataTable[outerIndex])\n            } //if (pushable)\n    \n    } //for (outerIndex = 0; outerIndex < requestedDataTable.length; outerIndex++)\n        //if this point is reached then there is a filtered table\n        //debugger\n        if (result.length === 0)\n        {\n            workingMsg.error = \"After filtering no data rows were left.\"\n            //either create and populate the error count at 1 or increment it if it already exists\n            if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n            {\n                workingMsg.searchErrorCount++\n            } //( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n            else\n            {\n                workingMsg.searchErrorCount = 1\n            } //( workingMsg.hasOwnProperty(\"searchErrorCount\")) else\n            //return the error on the middle there is an error output,\n            //this retry is in case the column was added to the google sheet since it was last loaded into node red\n            if (workingMsg.searchErrorCount > 1)\n            {\n                //return the error on the bottom because with a count of 2 that means reloading has already been tried\n                return [null, null, workingMsg]\n            } //if (workingMsg.searchErrorCount > 1)\n            else\n            {\n                //return the error on the middle there is an error output,\n                return [null, workingMsg, null]\n            } //if (workingMsg.searchErrorCount > 1) else\n        } //if (result.length === 0)\n        else if (result.length > 1)\n        {\n            //do the warning that multiple were found but will take the first\n            node.warn(\"Multiple rows were found that matched the search criteria. Results are from the first row that was found and matched.\")\n        } //else if (result.length > 1)\n        //look up the data\n        for (index = 0; index < searchResultKeysIndices.length; index++)\n        {\n            //workingMsg.searchfor.keysForSearchColumn[index] = result[0][searchResultKeysIndices]\n            // the almost working version\n            workingMsg.searchfor[keysForResultColumn[index]] = result[0][searchResultKeysIndices[index]]\n        } //for (index = 0; index < searchResultKeysIndices.length; index++)\n        //if this point is reached then work workingMsg contains complete info\n        //build and save the LastSearch obect\n        passedCacheObject.searchfor = workingMsg.searchfor\n        global.set(\"LastSearch\", passedCacheObject)\n        return [workingMsg, null, null]\n    } //if (requestedDataTable !== undefined)\n    else\n    {\n        //return on second output to trigger population of global that feeds datatable\n        //put some details on this configuration into the msg to be output\n        workingMsg.error = \"The data normally loaded from google sheet was not loaded.\"\n        //either create and populate the error count at 1 or increment it if it already exists\n        if (workingMsg.hasOwnProperty('searchErrorCount'))\n        {\n            workingMsg.searchErrorCount++\n        } //if (workingMsg.hasOwnProperty('searchErrorCount'))\n        else\n        {\n            workingMsg.searchErrorCount = 1\n        } //if (workingMsg.hasOwnProperty('searchErrorCount')) else\n        //return the error on the middle there is an error output,\n        //this retry is in case the column was added to the google sheet since it was last loaded into node red\n        if (workingMsg.searchErrorCount > 1)\n        {\n            //return the error on the bottom because with a count of 2 that means reloading has already been tried\n            return [null, null, workingMsg]\n        } //if (workingMsg.searchErrorCount > 1)\n        else\n        {\n            //return the error on the middle there is an error output,\n            return [null, workingMsg, null]\n        } //if (workingMsg.searchErrorCount > 1) else\n    } //if (requestedDataTable !== undefined) else\n}","outputs":3,"noerr":0,"x":240,"y":80,"wires":[[],["ac71b231.85d5c"],[]],"outputLabels":["Value Found","Error but try reloading from data source","Error despite having tried to reload from data source"],"info":"# **Conceptual Explanation**\nThis node is designed to use a 2-D array of data loaded from a google sheeet to lookup desired data. The data is arrayed with the first row being column headers describing the data in those columns in subsequent rows.\n## **inputs**\n### globalsource \nThe name of the global variable holding the table of data\n### msg.keyvalues\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row.\n### msg.searchfor\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. The value enters the node empty.\n## **outputs**\n### Output1: Value Found \nThis ouput is used when the node has successfully identified the requested data. That data is placed into the value portions of the key value pairs that made up the msg.searchfor input\n### Output 2: Error but try reloading from data source\nThis output is used when either the global variable to contain the data table either does no exist or does not contain a row with all of the requested search criteria. Normally it is used to trigger loading the table from Google sheets under the expectation that either this is the first time a lookup has been tried an the data had not yet been cached in the global variable or potentially the data in the cache has become stale and reloading from the Google sheet will add a row that will match the requested search criteria.\n### Output 3: Error despite having tried to reload from data source\nThis output is used when either the global variable to contain the data table either does no exist or does not contain a row with all of the requested search criteria and at least 1 attempt has already been made to reload the global vairable cache. This is effectively a notification of non-recoverable lookup failure."},{"id":"ac6ce7d0.604158","type":"change","z":"2a6ce360.19688c","name":"Devices table, 1 search key with variable input, 1 result","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"exportableresults.DeviceName","tot":"msg"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":980,"y":100,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value pulled from the **msg.exportableresults.DeviceName** object.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** column.\n"},{"id":"bf2101f6.eea8f","type":"change","z":"2a6ce360.19688c","name":"Devices table, 1 search key, 2 results","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"Motion_Ikea","tot":"str"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.Manufacturer","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":180,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value **\"Motion_Ikea\"**.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** and **\"Manufacturer\"** columns."},{"id":"c42217af.1bcde8","type":"change","z":"2a6ce360.19688c","name":"Devices table, 1 search key, 1 result","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"Anyone Presence","tot":"str"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":60,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value **\"Anyone Presence\"**. Notice unlike some examples this includes a space in the value. This has no negative impact.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** column."},{"id":"97b64fd9.d3121","type":"change","z":"2a6ce360.19688c","name":"Devices table, 2 search keys, 1 results","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"Anyone Presence","tot":"str"},{"t":"set","p":"keyvalues.Manufacturer","pt":"msg","to":"homebridge-people-geofence","tot":"str"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":140,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value **\"Anyone Presence\"** and the **\"Manufacturer\"** column for the value **\"homebridge-people-geofence\"**.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** columns."},{"id":"765c424c.1a0b5c","type":"comment","z":"2a6ce360.19688c","name":"Examples of preformating the inputs","info":"","x":920,"y":20,"wires":[]},{"id":"c3207c45.d0e1f","type":"change","z":"2a6ce360.19688c","name":"Spreadsheet Lookup Settings Example","rules":[{"t":"set","p":"IgnoreEnvVar ","pt":"msg","to":"true","tot":"bool"},{"t":"set","p":"SpreadsheetID","pt":"msg","to":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","tot":"str"},{"t":"set","p":"Tab","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"ColStart","pt":"msg","to":"A","tot":"str"},{"t":"set","p":"ColEnd","pt":"msg","to":"Z","tot":"str"},{"t":"set","p":"MinRow","pt":"msg","to":"1","tot":"str"},{"t":"set","p":"MaxRow","pt":"msg","to":"1000","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":260,"wires":[[]],"info":"## **inputs**\n### IgnoreEnvVar \nThis boolean needs to be true to tell that Read Spreadsheet For Details subflow that it should use the specs passed in the msg to determine what spreadsheet to read from and what portion of data to read from.\n### msg.SpreadsheetID\nThis is the very long string that identifies a specific google spreadsheet.\n### msg.Tab\nSpecifies the tab name that contains the data.\n### msg.ColStart\nSpecifies the leftmost column containing the desired data.\n### msg.ColEnd\nSpecifies the rightmost column containing the desired data. \n### msg.MinRow\nSpecifies the top row containing the desired data \n### msg.MaxRow\nSpecifies the bottom row containing the desired data "},{"id":"5886f9dc.9cb3b8","type":"debug","z":"2a6ce360.19688c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":160,"y":240,"wires":[]},{"id":"7d789dce.3f3284","type":"comment","z":"2a6ce360.19688c","name":"Maybe insert check of how long since last Google read and skip step","info":"","x":520,"y":140,"wires":[]},{"id":"2163d00a.19ea2","type":"link in","z":"f14b69ba.8b2da8","name":"Get DeviceID (Homekit, z2m)","links":["f07d3b90.672788"],"x":120,"y":380,"wires":[["38e7b14f.715b3e"]],"l":true},{"id":"25261af3.55cc46","type":"link in","z":"f14b69ba.8b2da8","name":"Got DeviceID","links":["68f00dd3.a8c354"],"x":150,"y":440,"wires":[["29527785.4a75a8"]],"l":true},{"id":"389fa07a.7c31b","type":"change","z":"f14b69ba.8b2da8","name":"Remove Excess Properties","rules":[{"t":"delete","p":"globalsource","pt":"msg"},{"t":"delete","p":"keyname","pt":"msg"},{"t":"delete","p":"searchtarget","pt":"msg"},{"t":"delete","p":"datacolumnname","pt":"msg"},{"t":"delete","p":"_event","pt":"msg"},{"t":"set","p":"exportableresults.DeviceID","pt":"msg","to":"value","tot":"msg"},{"t":"delete","p":"value","pt":"msg"},{"t":"delete","p":"keyvalues","pt":"msg"},{"t":"delete","p":"SpreadsheetID","pt":"msg"},{"t":"delete","p":"Tab","pt":"msg"},{"t":"delete","p":"ColStart","pt":"msg"},{"t":"delete","p":"ColEnd","pt":"msg"},{"t":"delete","p":"MinRow","pt":"msg"},{"t":"delete","p":"MaxRow","pt":"msg"},{"t":"delete","p":"IgnoreEnvVar","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1140,"y":360,"wires":[["2eb01e52.6b4c82"]],"info":"This node is removing properties that were needed for the lookup, but not part of the results."},{"id":"dde18780.d28628","type":"subflow:2a6ce360.19688c","z":"f14b69ba.8b2da8","name":"","env":[],"x":881,"y":380,"wires":[["389fa07a.7c31b","df201aab.b37668"],["df201aab.b37668"],["df201aab.b37668"]]},{"id":"b77e22a4.49718","type":"inject","z":"f14b69ba.8b2da8","name":"Delete Devices for Testing","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":190,"y":320,"wires":[["b102c1b7.89a12"]]},{"id":"b102c1b7.89a12","type":"change","z":"f14b69ba.8b2da8","name":"","rules":[{"t":"delete","p":"Devices","pt":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":320,"wires":[[]]},{"id":"2eb01e52.6b4c82","type":"function","z":"f14b69ba.8b2da8","name":"Move Data from searchfor to exportableresults","func":"//debugger\nlet foundKeys = Object.keys(msg.searchfor)\nlet foundValues = Object.values(msg.searchfor)\n//loop through all keys and a\nfor (index = 0; index < foundKeys.length; index++)\n{\n    if(foundValues[index]!== \"\")\n    {\n    msg.exportableresults[foundKeys[index]] = foundValues[index]\n    }\n}\ndelete msg.searchfor\nreturn msg","outputs":1,"noerr":0,"x":1460,"y":360,"wires":[["68f00dd3.a8c354","9c72d332.eaa6c"]],"info":"This node moves each property under the msg.searchfor property to the msg.exportableresults property."},{"id":"38e7b14f.715b3e","type":"change","z":"f14b69ba.8b2da8","name":"Spreadsheet Lookup Settings","rules":[{"t":"set","p":"IgnoreEnvVar","pt":"msg","to":"true","tot":"bool"},{"t":"set","p":"SpreadsheetID","pt":"msg","to":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","tot":"str"},{"t":"set","p":"Tab","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"ColStart","pt":"msg","to":"A","tot":"str"},{"t":"set","p":"ColEnd","pt":"msg","to":"Z","tot":"str"},{"t":"set","p":"MinRow","pt":"msg","to":"1","tot":"str"},{"t":"set","p":"MaxRow","pt":"msg","to":"1000","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":391,"y":380,"wires":[["d1e7c38f.8ee7a"]],"info":"## **inputs**\n### IgnoreEnvVar \nThis boolean needs to be true to tell that Read Spreadsheet For Details subflow that it should use the specs passed in the msg to determine what spreadsheet to read from and what portion of data to read from.\n### msg.SpreadsheetID\nThis is the very long string that identifies a specific google spreadsheet.\n### msg.Tab\nSpecifies the tab name that contains the data.\n### msg.ColStart\nSpecifies the leftmost column containing the desired data.\n### msg.ColEnd\nSpecifies the rightmost column containing the desired data. \n### msg.MinRow\nSpecifies the top row containing the desired data \n### msg.MaxRow\nSpecifies the bottom row containing the desired data "},{"id":"d1e7c38f.8ee7a","type":"change","z":"f14b69ba.8b2da8","name":"Devices Lookup Settings","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"exportableresults.DeviceName","tot":"msg"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.Floor","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.Location","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.Room","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.DeviceType","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.Manufacturer","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.AccessProtocol","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.PhysicalVirtualType","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.House","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.MQTTDeviceTopic","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.Hub","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":651,"y":380,"wires":[["dde18780.d28628","c2409854.f39c18"]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value pulled from the **msg.exportableresults.DeviceName** object.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** column.\n"},{"id":"3a8c25a7.ddbb7a","type":"link in","z":"f14b69ba.8b2da8","name":"Get Measurement Name Update (All 3)","links":["29527785.4a75a8"],"x":190,"y":480,"wires":[["8f1f43f6.1adb9"]],"l":true},{"id":"29527785.4a75a8","type":"link out","z":"f14b69ba.8b2da8","name":"Get Measurement Name Update","links":["3a8c25a7.ddbb7a"],"x":550,"y":440,"wires":[],"l":true},{"id":"a82ae378.41468","type":"link in","z":"f14b69ba.8b2da8","name":"Got Measurement Name Update","links":["2ab7224c.ed015e"],"x":210,"y":520,"wires":[["58bc8ff3.b42fe"]],"l":true},{"id":"68f00dd3.a8c354","type":"link out","z":"f14b69ba.8b2da8","name":"Got Device ID","links":["25261af3.55cc46"],"x":1760,"y":360,"wires":[],"l":true},{"id":"87d75a8e.93d158","type":"comment","z":"f14b69ba.8b2da8","name":"DeviceID lookup is needed for MQTT (and Homebridge?), but not Hubitat devices","info":"","x":360,"y":280,"wires":[]},{"id":"283ffd8f.097ac2","type":"change","z":"f14b69ba.8b2da8","name":"Remove Excess Properties","rules":[{"t":"delete","p":"globalsource","pt":"msg"},{"t":"delete","p":"keyname","pt":"msg"},{"t":"delete","p":"searchtarget","pt":"msg"},{"t":"delete","p":"datacolumnname","pt":"msg"},{"t":"delete","p":"_event","pt":"msg"},{"t":"delete","p":"value","pt":"msg"},{"t":"delete","p":"keyvalues","pt":"msg"},{"t":"delete","p":"SpreadsheetID","pt":"msg"},{"t":"delete","p":"Tab","pt":"msg"},{"t":"delete","p":"ColStart","pt":"msg"},{"t":"delete","p":"ColEnd","pt":"msg"},{"t":"delete","p":"MinRow","pt":"msg"},{"t":"delete","p":"MaxRow","pt":"msg"},{"t":"delete","p":"IgnoreEnvVar","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1360,"y":420,"wires":[["8b8d8b11.23ec48"]],"info":"This node is removing properties that were needed for the lookup, but not part of the results."},{"id":"5df479e4.db1db8","type":"subflow:2a6ce360.19688c","z":"f14b69ba.8b2da8","name":"","env":[],"x":1080,"y":480,"wires":[["283ffd8f.097ac2"],["b379ff4a.96f98"],["84eb4558.3c11b8","faaec494.aaa018"]]},{"id":"8f1f43f6.1adb9","type":"change","z":"f14b69ba.8b2da8","name":"Spreadsheet Lookup Settings","rules":[{"t":"set","p":"IgnoreEnvVar","pt":"msg","to":"true","tot":"bool"},{"t":"set","p":"SpreadsheetID","pt":"msg","to":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","tot":"str"},{"t":"set","p":"Tab","pt":"msg","to":"MeasurementTranslations","tot":"str"},{"t":"set","p":"ColStart","pt":"msg","to":"A","tot":"str"},{"t":"set","p":"ColEnd","pt":"msg","to":"E","tot":"str"},{"t":"set","p":"MinRow","pt":"msg","to":"1","tot":"str"},{"t":"set","p":"MaxRow","pt":"msg","to":"100","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":480,"wires":[["8a2e1eb2.006dc"]],"info":"## **inputs**\n### IgnoreEnvVar \nThis boolean needs to be true to tell that Read Spreadsheet For Details subflow that it should use the specs passed in the msg to determine what spreadsheet to read from and what portion of data to read from.\n### msg.SpreadsheetID\nThis is the very long string that identifies a specific google spreadsheet.\n### msg.Tab\nSpecifies the tab name that contains the data.\n### msg.ColStart\nSpecifies the leftmost column containing the desired data.\n### msg.ColEnd\nSpecifies the rightmost column containing the desired data. \n### msg.MinRow\nSpecifies the top row containing the desired data \n### msg.MaxRow\nSpecifies the bottom row containing the desired data "},{"id":"8a2e1eb2.006dc","type":"change","z":"f14b69ba.8b2da8","name":"Measurement Translation Lookup Settings","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"MeasurementTranslations","tot":"str"},{"t":"set","p":"keyvalues.SourceDevice","pt":"msg","to":"exportableresults.DeviceName","tot":"msg"},{"t":"set","p":"keyvalues.DeviceID","pt":"msg","to":"exportableresults.DeviceID","tot":"msg"},{"t":"set","p":"keyvalues.Measurement","pt":"msg","to":"exportableresults.Measure","tot":"msg"},{"t":"set","p":"searchfor.ChangeNameTo","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":800,"y":480,"wires":[["5df479e4.db1db8"]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value pulled from the **msg.exportableresults.DeviceName** object.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** column.\n"},{"id":"9c72d332.eaa6c","type":"debug","z":"f14b69ba.8b2da8","name":"1 DevID Lookup Success","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1790,"y":320,"wires":[]},{"id":"b379ff4a.96f98","type":"debug","z":"f14b69ba.8b2da8","name":"flow 2 temp no find","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1330,"y":460,"wires":[]},{"id":"84eb4558.3c11b8","type":"debug","z":"f14b69ba.8b2da8","name":"flow 2 perm no find","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1330,"y":540,"wires":[]},{"id":"87317361.c073b","type":"debug","z":"f14b69ba.8b2da8","name":"2 rename lookup success","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2090,"y":420,"wires":[]},{"id":"8b8d8b11.23ec48","type":"function","z":"f14b69ba.8b2da8","name":"Move Name Change from searchfor to exportableresults","func":"msg.exportableresults.Measure = msg.searchfor.ChangeNameTo\ndelete msg.searchfor\nreturn msg;","outputs":1,"noerr":0,"x":1710,"y":420,"wires":[["87317361.c073b","2ab7224c.ed015e"]]},{"id":"2ab7224c.ed015e","type":"link out","z":"f14b69ba.8b2da8","name":"Got Measurement Name Update","links":["a82ae378.41468"],"x":2110,"y":500,"wires":[],"l":true},{"id":"58bc8ff3.b42fe","type":"link out","z":"f14b69ba.8b2da8","name":"Get Potential Translation Update","links":["78034414.999e2c"],"x":550,"y":520,"wires":[],"l":true},{"id":"78034414.999e2c","type":"link in","z":"f14b69ba.8b2da8","name":"Get Potential Translation Update (Homebridge Only)","links":["58bc8ff3.b42fe"],"x":210,"y":600,"wires":[["65bde5e7.3658fc"]],"l":true},{"id":"2cca7c19.be84f4","type":"link in","z":"f14b69ba.8b2da8","name":"Got Potential Translation Update","links":["4fb57237.a90b2c","4391ddc7.30a294","edc2ac7a.b3006","22aae31a.d0e07c","719d677e.7901d8"],"x":210,"y":760,"wires":[["33a8efe8.1fc5c"]],"l":true},{"id":"4fb57237.a90b2c","type":"link out","z":"f14b69ba.8b2da8","name":"Got Potential Translation Update","links":["2cca7c19.be84f4"],"x":2950,"y":520,"wires":[],"l":true},{"id":"38d336b8.1f3f2a","type":"function","z":"f14b69ba.8b2da8","name":"Move Name Change from searchfor to exportableresults","func":"msg.TranslationType = msg.searchfor.TranslationType\ndelete msg.searchfor\nreturn msg;","outputs":1,"noerr":0,"x":1810,"y":580,"wires":[["94cdf9f3.672d38"]]},{"id":"a7767fa0.788ab","type":"change","z":"f14b69ba.8b2da8","name":"Remove Excess Properties","rules":[{"t":"delete","p":"globalsource","pt":"msg"},{"t":"delete","p":"keyname","pt":"msg"},{"t":"delete","p":"searchtarget","pt":"msg"},{"t":"delete","p":"datacolumnname","pt":"msg"},{"t":"delete","p":"_event","pt":"msg"},{"t":"delete","p":"value","pt":"msg"},{"t":"delete","p":"keyvalues","pt":"msg"},{"t":"delete","p":"SpreadsheetID","pt":"msg"},{"t":"delete","p":"Tab","pt":"msg"},{"t":"delete","p":"ColStart","pt":"msg"},{"t":"delete","p":"ColEnd","pt":"msg"},{"t":"delete","p":"MinRow","pt":"msg"},{"t":"delete","p":"MaxRow","pt":"msg"},{"t":"delete","p":"IgnoreEnvVar","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1460,"y":580,"wires":[["38d336b8.1f3f2a"]],"info":"This node is removing properties that were needed for the lookup, but not part of the results."},{"id":"43b27bb8.eb4824","type":"subflow:2a6ce360.19688c","z":"f14b69ba.8b2da8","name":"","env":[],"x":1200,"y":600,"wires":[["a7767fa0.788ab"],[],["13c3ab1a.8dc805"]]},{"id":"d541de63.360e3","type":"change","z":"f14b69ba.8b2da8","name":"Measurement Translation Lookup Settings","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"DataTranslations","tot":"str"},{"t":"set","p":"keyvalues.DeviceID","pt":"msg","to":"exportableresults.DeviceID","tot":"msg"},{"t":"set","p":"keyvalues.Measurement","pt":"msg","to":"exportableresults.Measure","tot":"msg"},{"t":"set","p":"searchfor.TranslationType","pt":"msg","to":"","tot":"str"},{"t":"delete","p":"searchErrorCount","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":920,"y":600,"wires":[["43b27bb8.eb4824"]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value pulled from the **msg.exportableresults.DeviceName** object.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** column.\n"},{"id":"65bde5e7.3658fc","type":"change","z":"f14b69ba.8b2da8","name":"Spreadsheet Lookup Settings","rules":[{"t":"set","p":"IgnoreEnvVar","pt":"msg","to":"true","tot":"bool"},{"t":"set","p":"SpreadsheetID","pt":"msg","to":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","tot":"str"},{"t":"set","p":"Tab","pt":"msg","to":"DataTranslations","tot":"str"},{"t":"set","p":"ColStart","pt":"msg","to":"A","tot":"str"},{"t":"set","p":"ColEnd","pt":"msg","to":"C","tot":"str"},{"t":"set","p":"MinRow","pt":"msg","to":"1","tot":"str"},{"t":"set","p":"MaxRow","pt":"msg","to":"100","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":610,"y":600,"wires":[["d541de63.360e3"]],"info":"## **inputs**\n### IgnoreEnvVar \nThis boolean needs to be true to tell that Read Spreadsheet For Details subflow that it should use the specs passed in the msg to determine what spreadsheet to read from and what portion of data to read from.\n### msg.SpreadsheetID\nThis is the very long string that identifies a specific google spreadsheet.\n### msg.Tab\nSpecifies the tab name that contains the data.\n### msg.ColStart\nSpecifies the leftmost column containing the desired data.\n### msg.ColEnd\nSpecifies the rightmost column containing the desired data. \n### msg.MinRow\nSpecifies the top row containing the desired data \n### msg.MaxRow\nSpecifies the bottom row containing the desired data "},{"id":"faaec494.aaa018","type":"change","z":"f14b69ba.8b2da8","name":"Remove Excess Properties when No Name Change Found","rules":[{"t":"delete","p":"globalsource","pt":"msg"},{"t":"delete","p":"keyname","pt":"msg"},{"t":"delete","p":"searchtarget","pt":"msg"},{"t":"delete","p":"datacolumnname","pt":"msg"},{"t":"delete","p":"_event","pt":"msg"},{"t":"delete","p":"value","pt":"msg"},{"t":"delete","p":"keyvalues","pt":"msg"},{"t":"delete","p":"SpreadsheetID","pt":"msg"},{"t":"delete","p":"Tab","pt":"msg"},{"t":"delete","p":"ColStart","pt":"msg"},{"t":"delete","p":"ColEnd","pt":"msg"},{"t":"delete","p":"MinRow","pt":"msg"},{"t":"delete","p":"MaxRow","pt":"msg"},{"t":"delete","p":"IgnoreEnvVar","pt":"msg"},{"t":"delete","p":"payload","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"delete","p":"searchfor","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1460,"y":500,"wires":[["2ab7224c.ed015e"]],"info":"This node is removing properties that were needed for the lookup, but not part of the results."},{"id":"13c3ab1a.8dc805","type":"change","z":"f14b69ba.8b2da8","name":"Remove Excess Properties when No Name Change Found","rules":[{"t":"delete","p":"globalsource","pt":"msg"},{"t":"delete","p":"keyname","pt":"msg"},{"t":"delete","p":"searchtarget","pt":"msg"},{"t":"delete","p":"datacolumnname","pt":"msg"},{"t":"delete","p":"_event","pt":"msg"},{"t":"delete","p":"value","pt":"msg"},{"t":"delete","p":"keyvalues","pt":"msg"},{"t":"delete","p":"SpreadsheetID","pt":"msg"},{"t":"delete","p":"Tab","pt":"msg"},{"t":"delete","p":"ColStart","pt":"msg"},{"t":"delete","p":"ColEnd","pt":"msg"},{"t":"delete","p":"MinRow","pt":"msg"},{"t":"delete","p":"MaxRow","pt":"msg"},{"t":"delete","p":"IgnoreEnvVar","pt":"msg"},{"t":"delete","p":"payload","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"delete","p":"searchfor","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1560,"y":620,"wires":[["719d677e.7901d8"]],"info":"This node is removing properties that were needed for the lookup, but not part of the results."},{"id":"7d098329.4c269c","type":"switch","z":"f14b69ba.8b2da8","name":"10TF Translate","property":"exportableresults.Reading","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":2720,"y":460,"wires":[["78e1a02c.de9d2"],["9ecd4936.ac0468"]],"outputLabels":["True","False"]},{"id":"78e1a02c.de9d2","type":"change","z":"f14b69ba.8b2da8","name":"Value True","rules":[{"t":"set","p":"exportableresults.Reading","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":2890,"y":440,"wires":[["4391ddc7.30a294"]]},{"id":"9ecd4936.ac0468","type":"change","z":"f14b69ba.8b2da8","name":"Value False","rules":[{"t":"set","p":"exportableresults.Reading","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":2890,"y":480,"wires":[["4391ddc7.30a294"]]},{"id":"491f4073.1aa5c","type":"change","z":"f14b69ba.8b2da8","name":"CtoF Translate","rules":[{"t":"set","p":"exportableresults.Measure","pt":"msg","to":"msg.name&\"F\"\t","tot":"jsonata"},{"t":"set","p":"exportableresults.Reading","pt":"msg","to":"payload*9/5+32","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":2720,"y":520,"wires":[["4fb57237.a90b2c"]]},{"id":"363318cb.159428","type":"switch","z":"f14b69ba.8b2da8","name":"CurrentHeatingCoolingState Translate","property":"exportableresults.Reading","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"str"},{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"str"},{"t":"eq","v":"3","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":2790,"y":620,"wires":[["8361cdf9.17f3e"],["616211a8.ffda1"],["16a789ea.31a1b6"],["a9d801bc.916c3"]],"outputLabels":["off","heat","cool","heat-cool"]},{"id":"8361cdf9.17f3e","type":"change","z":"f14b69ba.8b2da8","name":"Value Off","rules":[{"t":"set","p":"exportableresults.Reading","pt":"msg","to":"off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":3040,"y":560,"wires":[["edc2ac7a.b3006"]]},{"id":"616211a8.ffda1","type":"change","z":"f14b69ba.8b2da8","name":"Value Heat","rules":[{"t":"set","p":"exportableresults.Reading","pt":"msg","to":"heat","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":3050,"y":600,"wires":[["edc2ac7a.b3006"]]},{"id":"16a789ea.31a1b6","type":"change","z":"f14b69ba.8b2da8","name":"Value Cool","rules":[{"t":"set","p":"exportableresults.Reading","pt":"msg","to":"cool","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":3050,"y":640,"wires":[["edc2ac7a.b3006"]]},{"id":"a9d801bc.916c3","type":"change","z":"f14b69ba.8b2da8","name":"Value Heat-Cool","rules":[{"t":"set","p":"exportableresults.Reading","pt":"msg","to":"heat-cool","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":3060,"y":680,"wires":[["edc2ac7a.b3006"]]},{"id":"43da177.80afbe8","type":"switch","z":"f14b69ba.8b2da8","name":"","property":"TranslationType","propertyType":"msg","rules":[{"t":"eq","v":"10TF","vt":"str"},{"t":"eq","v":"C2F","vt":"str"},{"t":"eq","v":"NestThMap","vt":"str"},{"t":"eq","v":"012CF","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":2510,"y":560,"wires":[["7d098329.4c269c"],["491f4073.1aa5c"],["363318cb.159428"],["d953d8e9.9309c8"]],"outputLabels":["1 or 0 to True or False Map","Celcius to Fahrenheit Conversion","Nest Thermostat Map","Celcius or Fahrenheit Map"]},{"id":"d953d8e9.9309c8","type":"switch","z":"f14b69ba.8b2da8","name":"10TF Translate","property":"exportableresults.Reading","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":2720,"y":740,"wires":[["397cf3c8.ec4cac"],["54ccc16a.7267e"]],"outputLabels":["True","False"]},{"id":"397cf3c8.ec4cac","type":"change","z":"f14b69ba.8b2da8","name":"Value Fahrenheit","rules":[{"t":"set","p":"exportableresults.Reading","pt":"msg","to":"Fahrenheit","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2910,"y":720,"wires":[["22aae31a.d0e07c"]]},{"id":"54ccc16a.7267e","type":"change","z":"f14b69ba.8b2da8","name":"Value Celcius","rules":[{"t":"set","p":"exportableresults.Reading","pt":"msg","to":"Celcius","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2900,"y":760,"wires":[["22aae31a.d0e07c"]]},{"id":"94cdf9f3.672d38","type":"switch","z":"f14b69ba.8b2da8","name":"Translation Needed?","property":"TranslationType","propertyType":"msg","rules":[{"t":"nnull"},{"t":"null"}],"checkall":"false","repair":false,"outputs":2,"x":2140,"y":580,"wires":[["43da177.80afbe8"],["719d677e.7901d8"]]},{"id":"33a8efe8.1fc5c","type":"change","z":"f14b69ba.8b2da8","name":"","rules":[{"t":"delete","p":"searchErrorCount","pt":"msg"},{"t":"delete","p":"error","pt":"msg"},{"t":"delete","p":"TranslationType","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":760,"wires":[["93037869.397808","aacb33f4.4e70f"]]},{"id":"93037869.397808","type":"debug","z":"f14b69ba.8b2da8","name":"4 After change","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":700,"y":800,"wires":[]},{"id":"4391ddc7.30a294","type":"link out","z":"f14b69ba.8b2da8","name":"Got Potential Translation Update","links":["2cca7c19.be84f4"],"x":3110,"y":460,"wires":[],"l":true},{"id":"edc2ac7a.b3006","type":"link out","z":"f14b69ba.8b2da8","name":"Got Potential Translation Update","links":["2cca7c19.be84f4"],"x":3330,"y":620,"wires":[],"l":true},{"id":"22aae31a.d0e07c","type":"link out","z":"f14b69ba.8b2da8","name":"Got Potential Translation Update","links":["2cca7c19.be84f4"],"x":3150,"y":740,"wires":[],"l":true},{"id":"719d677e.7901d8","type":"link out","z":"f14b69ba.8b2da8","name":"Got Potential Translation Update","links":["2cca7c19.be84f4"],"x":2410,"y":620,"wires":[],"l":true},{"id":"aacb33f4.4e70f","type":"function","z":"f14b69ba.8b2da8","name":"Format for InfluxDB & MQTT","func":"//Ref. TMS-000002\n/* This function takes input from a hubitat device node and data stored in config node which holds details about the device\n * and creates an properly formated object to be sent to InfluxDB node via output 1 which will in turn write to the InfluxDB\n * It also formats an MQTT topic and the data sending that to output 2 which in turn can be used by an MQTT node to send to \n * MQTT\n * \n * \n */\n//gather the name of the device which had a reading that triggered the flow to be included as a tag (index) sent to InfluxDB\n//note: this is the hubitat device ID\nvar deviceID = msg.exportableresults.DeviceID;\n//node.warn(\"11 \"+ deviceID)\n//gather the name of the measurement that was sent by the device to be included as a tag (index) for invalid measurements and as the fieldname for valid measurements sent to InfluxDB\nvar typeOfMeasurement = msg.exportableresults.Measure;\n\n//gather the actual measurement value that was sent by the device to be included as the data for the field (when the measurement is valid) sent to InfluxDB\nvar theData = msg.exportableresults.Reading;\n//initialize the measurements object\nvar measurementsObj = {};\n\n//initialize the tags (indices) object\nvar tagsObj = {};\n\n//create the object that will later be used to combine the measurementsObj and tagsObj\nvar combinedObj;\n\n//create the boolean that will be used to hold the evaluation of whether the measurement is valid or not\nvar validMeasurement;\n\n//create the booleans that will be used to hold whether the reason a measurement is invalid is because it is a non-standard type or\n// if the type of the measurement and the type passed from the device differ or\n// if the value (data) is null\nvar nonStandardType = false;\nvar measurementTypeMismatch = false;\nvar nullData = false;\n\n//create a boolean to keep track of if there are any tags (indices) that should be sent to the InfluxDB \n// it starts false but if any tag is valid then will become true. See below for what to send to InfluxDB based on valid measures and tags\nvar validTag = false;\nif (msg.exportableresults.hasOwnProperty('dataType'))\n{\n    if ((typeof theData == msg.exportableresults.dataType.toLowerCase()) || (msg.exportableresults.dataType == 'ENUM') || (theData === null))\n    {\n        if (typeof theData == 'number')\n        {\n            node.status({ fill: \"red\", shape: \"ring\", text: \"matched number\" });\n            if (!theData.isNaN)\n            {\n                validMeasurement = true;\n            }\n        }\n        else if (typeof theData == 'string')\n        {\n            node.status({ fill: \"red\", shape: \"ring\", text: \"matched string\" });\n            if (theData.length >= 0)\n            {\n                validMeasurement = true;\n            }\n        } \n        else if (typeof theData == 'boolean')\n        {\n            node.status({ fill: \"red\", shape: \"ring\", text: \"matched boolean\" });\n            validMeasurement = true;\n        }\n        else if (msg.exportableresults.dataType == 'ENUM')\n        { //This is checking to make sure the value matches one of the values in the ENUM from the device \n            node.status({ fill: \"red\", shape: \"ring\", text: msg.exportableresults.dataType + \" matched ENUM\" });\n            msg.exportableresults.values.forEach(element => {\n                if (flow.get(deviceID + element) == theData)\n                {\n                    validMeasurement = true;\n                }\n            })\n        }\n        else if (theData === null)\n        {\n            node.status({ fill: \"red\", shape: \"ring\", text: \"matched null data\" });\n            nullData = true;\n        }\n        else\n        {\n            node.status({ fill: \"red\", shape: \"ring\", text: \"matched nonstandardtype\" });\n            nonStandardType = true;\n        }\n    } //if ((typeof theData == msg.exportableresults.dataType.toLowerCase()) || (msg.exportableresults.dataType == 'ENUM') || (theData === null))\n    else\n    {\n        node.status({ fill: \"red\", shape: \"ring\", text: \"measurement type mismatch\" });\n        measurementTypeMismatch = true;\n    } //else  if ((typeof theData == msg.exportableresults.dataType.toLowerCase()) || (msg.exportableresults.dataType == 'ENUM') || (theData === null))\n}//if(msg.exportableresults.hasOwnProperty('dataType'))\nelse\n{\n    validMeasurement = true;\n}// else      if(msg.exportableresults.hasOwnProperty('dataType')) else\n\n//scanning all of the tags from the config node and creating a tag for that item if the entry on the config node has info\ncommonTags = [\"House\", \"Floor\", \"Room\", \"Location\", \"DeviceType\", \"Manufacturer\", \"AccessProtocol\", \"PhysicalVirtualType\", \"PhysicalDigitalRegular\"]\nfor (innerIndex = 0; innerIndex < commonTags.length; innerIndex++)\n{\n    if (msg.exportableresults.hasOwnProperty(commonTags[innerIndex]))\n    {\n        tagsObj[commonTags[innerIndex]] = msg.exportableresults[commonTags[innerIndex]]\n    } //if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex]) else\n} //for (innerIndex = 0; innerIndex < searchKeyIndices.length; innerIndex++)\n\n//Based on whether or not the measurement is \"valid\" it either adds the device id to the tags or it goes to the else portion\nif (validMeasurement) {\n    measurementsObj[typeOfMeasurement] = theData;\n    //node.warn(\"94 length\")\n    if (deviceID.length > 0) {\n        tagsObj[\"DeviceID\"] = deviceID;\n        validTag = true;\n    }\n    if (validTag) {\n        combinedObj = [measurementsObj, tagsObj]\n    } else {\n        //skip tags if none would be valid\n        combinedObj = [measurementsObj]\n    }\n} else {\n\n    //if the measeurement was not \"valid\", then it puts in a Generic measurement of true and tag it as either Non-Standard Type of Measurement Type Mismatch\n    if (nonStandardType) {\n        measurementsObj[\"Generic\"] = true\n        tagsObj[\"ReasonGeneric\"] = \"Non-Standard Type\"\n        tagsObj[\"Measure\"] = typeOfMeasurement\n    }\n    //node.warn(\"113 length\")\n    if (deviceID.length > 0) {\n        tagsObj[\"DeviceID\"] = deviceID\n        validTag = true\n    }\n    if (measurementTypeMismatch) {\n        measurementsObj[\"Generic\"] = true\n        tagsObj[\"ReasonGeneric\"] = \"Measurement Type Mismatch\"\n        tagsObj[\"Measure\"] = typeOfMeasurement\n    }\n    //node.warn(\"123 length\")\n    if (deviceID.length > 0) {\n        tagsObj[\"DeviceID\"] = deviceID\n        validTag = true\n    }\n    combinedObj = [measurementsObj, tagsObj]\n}\n\n//put the object into the payload\nmsg.payload = combinedObj;\n\n//build the status to be shown on the status of the subnode\nmsg.status = msg.exportableresults.DeviceName + \": \" + typeOfMeasurement + \": \" + theData;\n\n/* MQTT section \n * \n * \n * \n */\n//create the placeholder object\nvar msg2 = {}\n//add the MQTT topic\nmsg2.topic = msg.exportableresults.MQTTname +\"/\"+msg.exportableresults.DeviceName+\"/\"+ msg.exportableresults.Measure\n//add the data to be recorded to MQTT\nmsg2.payload = theData\n\n\n\n//send the created combinedObj downstream (to the InfluxDB node), but only if the measurement is not null\nif (!nullData) {\n    return [msg, msg2]\n}\ndebugger\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////\n","outputs":2,"noerr":0,"x":740,"y":760,"wires":[["4d210d2d.a14734","151ee38f.19fffc","e90820c6.94152"],["9f2808f1.e56388","8eff26e6.443808"]]},{"id":"4d210d2d.a14734","type":"debug","z":"f14b69ba.8b2da8","name":"4.1 Output 1","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1010,"y":680,"wires":[]},{"id":"9f2808f1.e56388","type":"debug","z":"f14b69ba.8b2da8","name":"4.2 Output 2","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1010,"y":860,"wires":[]},{"id":"151ee38f.19fffc","type":"influxdb out","z":"f14b69ba.8b2da8","influxdb":"e95739a9.f90a28","name":"","measurement":"Smarthome","precision":"","retentionPolicy":"","x":1130,"y":720,"wires":[]},{"id":"e90820c6.94152","type":"change","z":"f14b69ba.8b2da8","name":"Move Status to Payload for Consumption by Status Node","rules":[{"t":"set","p":"payload","pt":"msg","to":"status","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1150,"y":760,"wires":[["18a1baff.947c45"]]},{"id":"8eff26e6.443808","type":"mqtt out","z":"f14b69ba.8b2da8","name":"Write reading to MQTT","topic":"","qos":"1","retain":"true","broker":"a5bf81ee.27852","x":1040,"y":800,"wires":[]},{"id":"18a1baff.947c45","type":"debug","z":"f14b69ba.8b2da8","name":"4.3 Output  For Status node","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1520,"y":720,"wires":[]},{"id":"ffe3afda.74d5c","type":"comment","z":"f9a34738.f12c28","name":"before major overhaul version","info":"","x":1500,"y":80,"wires":[]},{"id":"e09f04a.9d506f8","type":"comment","z":"f9a34738.f12c28","name":"after major overhaul version","info":"","x":1660,"y":680,"wires":[]},{"id":"74eef5f0.8ccdbc","type":"function","z":"c5ccb11d.87221","name":"Determine Source For Gsheet lookup properties.","func":"//Read subflow input variables\nif (env.get(\"OverrideEnvVariables\"))\n{\n    //Put inputs and read values into msg properties to be visible downstream\n    msg.sheet = msg.SpreadsheetID;\n    msg.tab = msg.Tab;\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    msg.topic = msg.targetrange\n    delete msg.Tab\n    delete msg.SpreadsheetID\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\n}\nelse if (msg.IgnoreEnvVar)\n{\n    //Put inputs and read values into msg properties to be visible downstream\n    msg.sheet = msg.SpreadsheetID;\n    msg.tab = msg.Tab;\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    msg.topic = msg.targetrange\n    delete msg.Tab\n    delete msg.SpreadsheetID\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\n}\nelse\n{\n    var ColStart = env.get(\"ColStart\");\n    var ColEnd = env.get(\"ColEnd\");\n    var FirstRow = env.get(\"MinRow\");\n    var LastRow = env.get(\"MaxRow\");\n    //Put inputs and read values into msg properties to be visible downstream\n    msg.sheet = env.get(\"Spreadsheet ID\");\n    msg.tab = env.get(\"TabName\");\n    msg.cellstart = ColStart + FirstRow\n    msg.cellend = ColEnd + LastRow\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    msg.topic = msg.targetrange\n    delete msg.Tab\n    delete msg.SpreadsheetID\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\n    //These 2 are needed later to calculate the last populate and first empty rows and columns\n    msg.ColStart = ColStart\n    msg.MinRow = FirstRow\n}\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":20,"wires":[["603c205a.b0331","9fe2a10e.aae73"]],"info":"This node sets up the inputs to the GSheet node.\nThe outputs that make up those inputs are:\n - msg.sheet -the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n - msg.topic - the combination of spreadsheet tab and cell range\n## Note\nThere are 2 very similar booleans evaluated by this node. They are:\n * **OverrideEnvVariables** - This one looks at the environment variable that was set in the flow triggering the subflow\n * **msg.IgnoreEnvVar** - This one is allows the logic to be driven by a message object property and thus can be set at runtime or earlier in the flow based on upstream logic\n\nFirst it checks the boolean value of the **OverrideEnvVariables** environment variable. This is by default false. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming the first was false, it checks the boolean value of the **msg.IgnoreEnvVar** value. This will evaluated as false if not populated, so sending false is unnecessary. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming both are false, then it can build the outputs based on the subflows environment variables. These can either be those set in the calling flow or they may be the default ones built into the subflow.\n\nRegardless of the method used to build the output, the node also removes the input message properties.\n\n\n\nmsg.IgnoreEnvVar"},{"id":"603c205a.b0331","type":"GSheet","z":"c5ccb11d.87221","creds":"adb4e9b8.8beee8","method":"get","action":"","sheet":"","cells":"","name":"Read Input from GSheet","x":610,"y":20,"wires":[["dbd52898.8d0788"]],"info":"Use the GSheet node to get the a set of rows from a google spreadsheet.\n\n# **Inputs**\n### **creds**\nThis is the name on the gauth configuration node. How to get the details is beyond the scope of what I am going to put into an individual node instance. Some details are at [node-red-contrib-google-sheets](https://flows.nodered.org/node/node-red-contrib-google-sheets)\n### **Method**\nIn this case using the get cells method to read a set of data.\n### **SpreadsheetID**\nUnused as the spreadsheet ID is passed in as part of the input msg, but if needed it would be the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n### **Cells**\nUnused as the requested cells are passed in as part of the input msg, but if it was being manually built for a static data source the format is made of of 3 parts with specific seperators:\n * **[Sheetname]** like Sheet1\n * **[upper left corner cell address]** like A1\n * **[lower right corner cell address]** like B2\n\nThe format is **[Sheetname]**!**[upper left corner cell address]**:**[lower right corner cell address]** giving an input like **Sheet1!A1:B2**\n "},{"id":"7397c4cf.169e5c","type":"comment","z":"c5ccb11d.87221","name":"Error","info":"","x":1090,"y":20,"wires":[]},{"id":"7d4ee29.f631f1c","type":"comment","z":"c5ccb11d.87221","name":"Last Populated Row","info":"","x":1130,"y":100,"wires":[]},{"id":"4a364e2.bc44db","type":"function","z":"c5ccb11d.87221","name":"Prepare Output Parts","func":"/*\n * Row response calculations\n */\nmsg.LastPopulatedRow = msg.payload.length + msg.MinRow - 1\nmsg.FirstEmptyRow = msg.LastPopulatedRow + 1\n\n/*\n *Column response calculation variables\n */\nlet colCount = 1 //number of columns wide from the data retrieved. This will eventually be replace by logic that loops through array find the max width for any given row\nlet index\nlet sheetdata = msg.payload //this is the data that is returned from Google that will then be examined\nlet fCol = msg.ColStart\nlet fColTotal = 0 //to hold the column number\nlet nCol = \"\"   //nCol is new column\nlet lCol = \"\"   //lCol is last column in the range (to be populated from the actual Gsheet calls data)\n\nfCol = fCol.toUpperCase()\n/*\n * validate fCol (done)\n */\nlet validStartCol = false\nvalidStartCol = ((fCol.length == 1) ||\n                ((fCol.substr(0, 1).charCodeAt(0) - 64) < 9) ||\n                (((fCol.substr(0, 1).charCodeAt(0) - 64) == 9) && ((fCol.substr(1, 1).charCodeAt(0) - 64) <= 22)))\n/*\n *Column response calculations\n */\n//look at each row that is an array\nfor (index = 0; index < sheetdata.length; index++)\n{\n    if (Array.isArray(sheetdata[index]))\n    {\n        // when the rows width is greater than any of the previous rows set the column count to the new largest width\n        colCount = Math.max(colCount, sheetdata[index].length)\n    } //if (Array.isArray(sheetdata[index]))\n}  //for (index = 0; index < sheetdata.length; index++)\nswitch (fCol.length) {\n    case 1:\n        fColTotal = (fCol.substr(0, 1).charCodeAt(0) - 64)\n        fColTotal += colCount - 1\n        break\n    case 2:\n        fColTotal = (fCol.substr(1, 1).charCodeAt(0) - 64) + 26 * (fCol.substr(0, 1).charCodeAt(0) - 64)\n        fColTotal += colCount - 1\n        break\n    default:\n        fColTotal = -1\n}\n//Last Populated Column and First Empty Column calculation\nif ((fColTotal <= 25) && (fColTotal >= 1)) {\n    lCol = String.fromCharCode(fColTotal+64)\n    nCol = String.fromCharCode(fColTotal+65)\n} else if (fColTotal == 26) {\n    lCol = \"Z\"\n    nCol = \"AA\"\n} else if (fColTotal >= 27) {\n    lCol = String.fromCharCode((Math.floor(fColTotal / 26)) + 64) + String.fromCharCode((fColTotal % 26) + 64)\n    nCol = String.fromCharCode((Math.floor(fColTotal / 26)) + 64) + String.fromCharCode((fColTotal % 26) + 65)\n} else if (fColTotal == -1) {\n    lCol = \"Error\"\n    nCol = \"Error\"\n    //Probably worth putting real error here, but deferred\n} else if (fColTotal == 256) {\n    lCol = \"IV\"\n    nCol = \"None\"\n}\nmsg.LastPopulatedCol = lCol\nmsg.FirstEmptyCol = nCol\nmsg.SpreadsheetArray = msg.payload\nreturn msg;","outputs":1,"noerr":0,"x":560,"y":540,"wires":[["b383d4a7.b31098","99ff283b.587b38","5d7a9aee.af6c34","2fa1add7.1958f2","5b88e253.4c4f2c","e965d93a.aff398"]],"info":"Takes an input from the Gsheet node and calculates a variety of details about the spreadsheet info.\n### **Output**\nmsg.LastPopulatedRow\nmsg.FirstEmptyRow\nmsg.LastPopulatedCol\nmsg.FirstEmptyCol\nmsg.SpreadsheetArray\n"},{"id":"27accc4a.8ee1a4","type":"comment","z":"c5ccb11d.87221","name":"First Empty Row","info":"","x":1120,"y":180,"wires":[]},{"id":"325a9a23.77eb66","type":"comment","z":"c5ccb11d.87221","name":"Last Populated Column","info":"","x":1140,"y":260,"wires":[]},{"id":"724d8cd0.055314","type":"comment","z":"c5ccb11d.87221","name":"First Empty Column","info":"","x":1130,"y":340,"wires":[]},{"id":"a98a82.7ccf658","type":"comment","z":"c5ccb11d.87221","name":"Spreadsheet Array","info":"","x":1130,"y":420,"wires":[]},{"id":"d7356d4b.cb6f7","type":"comment","z":"c5ccb11d.87221","name":"Full Data","info":"","x":1100,"y":500,"wires":[]},{"id":"370583c1.fb1a5c","type":"comment","z":"c5ccb11d.87221","name":"Full Data with Inputs","info":"","x":1130,"y":580,"wires":[]},{"id":"b383d4a7.b31098","type":"change","z":"c5ccb11d.87221","name":"Leave Outputs","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":540,"wires":[[]],"info":"Deletes a variety of message properties, but leaves all of them that were calculated about the Gsheet nodes results to be returned on the designated subflow output."},{"id":"99ff283b.587b38","type":"change","z":"c5ccb11d.87221","name":"Leave Last Populated Row","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"LastPopulatedRow","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":140,"wires":[[]],"info":"Copies msg.theLastPopulatedRow into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"5d7a9aee.af6c34","type":"change","z":"c5ccb11d.87221","name":"Leave First Empty Row","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"FirstEmptyRow","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":870,"y":220,"wires":[[]],"info":"Copies msg.FirstEmptyRow into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"2fa1add7.1958f2","type":"change","z":"c5ccb11d.87221","name":"Leave Last Populated Column","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"LastPopulatedCol","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":890,"y":300,"wires":[[]],"info":"Copies msg.LastPopulatedCol into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"5b88e253.4c4f2c","type":"change","z":"c5ccb11d.87221","name":"Leave First Empty Column","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"FirstEmptyCol","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":380,"wires":[[]],"info":"Copies msg.FirstEmptyCol into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"e965d93a.aff398","type":"change","z":"c5ccb11d.87221","name":"Leave Spreadsheet Array","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"SpreadsheetArray","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":870,"y":460,"wires":[[]],"info":"Copies msg.SpreadsheetArray into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"f1a21086.ad433","type":"trigger","z":"c5ccb11d.87221","name":"Watchdog","op1":"","op2":"timeout","op1type":"nul","op2type":"str","duration":"10","extend":true,"units":"s","reset":"","bytopic":"all","outputs":1,"x":600,"y":140,"wires":[["2fa1add7.1958f2","99ff283b.587b38","5b88e253.4c4f2c","e965d93a.aff398","b383d4a7.b31098"]],"info":"This trigger node works as a watchdog to see if the request to see if the read of the Google Sheet that was triggered on the other branch is successful. If it is succeful, then it will receive a reset message (msg.reset) from the Reset Watchdog node. If, however, 10 seconds elapse without receiving the reset message, this node sends a timeout message (msg.timeout)."},{"id":"9fe2a10e.aae73","type":"change","z":"c5ccb11d.87221","name":"","rules":[{"t":"set","p":"timeout","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":120,"wires":[["f1a21086.ad433"]],"info":"Labels what the initial input to the watchdog trigger node is."},{"id":"f32c273a.e61738","type":"change","z":"c5ccb11d.87221","name":"","rules":[{"t":"delete","p":"reset","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":350,"y":540,"wires":[["4a364e2.bc44db"]],"info":"Removes msg.reset that was only intended for the watchdog trigger node."},{"id":"64cd2a10.a267c4","type":"catch","z":"c5ccb11d.87221","name":"Catch and Relay Errors","scope":null,"uncaught":false,"x":860,"y":60,"wires":[[]],"info":"Passes any caught error to the error subflows intentially built error output. By intentionally built I mean I created one and labelled it as such. This is not there by default."},{"id":"dbd52898.8d0788","type":"change","z":"c5ccb11d.87221","name":"Reset Watchdog","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":140,"y":140,"wires":[["f1a21086.ad433","f32c273a.e61738"]],"info":"Sends the reset message to the watchdog triger node when there is output from the Gsheet node."},{"id":"eb5300a8.ab683","type":"function","z":"20c22900.896628","name":"Db Put the payload into a global variable named after the content of msg.globalsource","func":"global.set(msg.globalsource, msg.payload)\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":389,"wires":[["dbf60bd1.e6d018"]],"info":"# **What** #\nThis is a simple function node that stores the msg.payload into a global variable. This is done in a function node, however, because the name of that global variable is passed into the function as a the value of msg.globalsource. \n\n## **Why**\nNormally this would be done in a change node, but change nodes could not as of May 2020 take a msg object component as the name of the global variable to be set."},{"id":"d84471d1.ac3ec","type":"subflow:c5ccb11d.87221","z":"20c22900.896628","name":"","env":[],"x":580,"y":189,"wires":[[],[],[],[],[],[],["eb5300a8.ab683"],[]],"info":"This subflow shows information in the environment variables. These are good for testing purposes, but it is noteworthy that the override boolean is false. Unless that boolean is changed, they have no impact."},{"id":"dbf60bd1.e6d018","type":"function","z":"20c22900.896628","name":"Db Use input to lookup info","func":"//Ref. TMS-000001\n\n//if(msg.exportableresults.DeviceName !== \"Switch_Ikea\") {return}\n\n\n\n//1 Get must have items: searchKeys, searchValues, searchResultKeys, cachedSearch, cacheTime\n\nlet searchKeys = Object.keys(msg.keyvalues)\nlet searchValues = Object.values(msg.keyvalues)\nlet searchResultKeys = Object.keys(msg.searchfor)\nlet cachedSearch = global.get(\"LastSearch\")\nlet cacheTime = new Date().getTime()\n//2 create working variables searchKeyIndices, searchResultKeysIndices, index, cacheKey\nlet searchResultKeysIndices = []\nlet index\nlet cacheObject\n//3 build the cache key which is essentially the concatenation of key+value+nextkey+nextvalue+.....etc\ncacheObject = BuildCacheObject(searchKeys, searchValues, searchResultKeys)\n//4\n/*\n * 4.1 t/f cached result is usable\n    *  4.1.true then t/f does it meet criteria\n        * 4.1.true.true\ttrue msg.searchfor = cachedSearch.searchfor\n        * 4.1.true.false do the common lookup\n    *   4.1.false  do the common lookup\n    */\n//4.1\nif (cachedSearch !== undefined)\n{\n    //4.1.true\n    if ((cachedSearch.query == cacheObject.query) && (cachedSearch.time > cacheObject.time - 5000))\n    {\n        //4.1.true.true\n        msg.searchfor = cachedSearch.searchfor\n        return [msg, null, null]\n    } //if ((cachedSearch.query == cacheObject.query) && (cachedSearch.time > cacheObject.time - 5000))\n    //4.1.true.false\n    else\n    {\n        //4.1.true.false\n        lookupResults = CommonLookup(msg, searchKeys, searchResultKeys, searchValues, global.get(msg.globalsource), cacheObject)\n        //return results from the node on 1 of the 3 outputs\n        if (lookupResults[0] !== null)\n        {\n            return [lookupResults[0], null, null]\n        } //if (lookupResults[0] !== null)\n        else if (lookupResults[1] !== null)\n        {\n            return [null, lookupResults[1], null]\n        } //else if (lookupResults[1] !== null)\n        else\n        {\n            return [null, null, lookupResults[2]]\n        } //else if (lookupResults[1] !== null) else\n    } //if ((cachedSearch.query == cacheObject.query) && (cachedSearch.time > cacheObject.time - 5000)) else\n} //if (cachedSearch !== undefined)\n//4.1.false\nelse\n{\n    //4.1.false\n    lookupResults = CommonLookup(msg, searchKeys, searchResultKeys, searchValues, global.get(msg.globalsource), cacheObject)\n    //return results from the node on 1 of the 3 outputs\n    if (lookupResults[0] !== null)\n    {\n        return [lookupResults[0], null, null]\n    } //if (lookupResults[0] !== null)\n    else if (lookupResults[1] !== null)\n    {\n        return [null, lookupResults[1], null]\n    } //else if (lookupResults[1] !== null)\n    else\n    {\n        return [null, null, lookupResults[2]]\n    } //else if (lookupResults[1] !== null) else\n} //if (cachedSearch !== undefined) else\nreturn\n\nfunction BuildCacheObject(searchKeysArray, SearchValuesArray, SearchResultKeysArray) {\n    //3 build the cache key which is essentially the concatenation of key+value+nextkey+nextvalue+.....etc\n    let newCacheKey =\"\"\n    for (index = 0; index < searchKeysArray.length; index++)\n    {\n        newCacheKey = newCacheKey + searchKeysArray[index] + SearchValuesArray[index]\n    } //for (index = 0; index < searchKeysArray.length; index++)\n    //add all fields that will be looked for into the cache key\n    for (index = 0; index < SearchResultKeysArray.length; index++)\n    {\n        newCacheKey = newCacheKey + SearchResultKeysArray[index]\n    } //for (index = 0; index < SearchResultKeysArray.length; index++)\n    //combine the cache key and the cache time into a single object that can be compared with the cached last search\n    let createdCacheObject = \n    {\n        query: newCacheKey,\n        time: cacheTime\n    }\n    return createdCacheObject\n}\nfunction CommonLookup(workingMsg, keysForSearchColumn, keysForResultColumn, valuesSearchedFor, requestedDataTable, passedCacheObject) {\n    let searchKeyIndices = []\n    let searchResultKeysIndices = []\n    let outerIndex\n    let innerLoopCounter\n    let innerIndex\n    let index\n    if (requestedDataTable !== undefined)\n    {\n        // iterate through all search keys.\n        //outer index is the place along the array of search keys\n        for (outerIndex = 0; outerIndex < keysForSearchColumn.length; outerIndex++)\n        {\n            //inner index is the place along the first row of data\n            //The innerLoopCounter must be reset each time a new key is being looked for\n            innerLoopCounter = 0\n            for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n            {\n                //these 2 loops will compare every entry in the top row of the data table to every entry in the array of search keys,\n                if (requestedDataTable[0][innerIndex] == keysForSearchColumn[outerIndex])\n                {\n                    //when they match push the column number on to the array that has just indices for the search keys\n                    searchKeyIndices.push(innerIndex)\n                    //break is used to stop comparing as once the column has been found the remaining aren't relevant\n                    //////////////////////////////////////////////////////////////////////////break may be a problem. Maybe swap inner and outer arrays and then do some if then about getting through the whole data headers without finding. Right now it only looks for 1 failure\n                    break\n                } //if (requestedDataTable[0][innerIndex] == keysForSearchColumn[outerIndex])\n                else\n                {\n                    //when they don't match, then this means there is a search key that does not match any header.\n                    //When properly configured this should not happen, but proper configuration cannot be guaranteed\n                    //this is accumulating how many times the search key did not match one of the data table headers\n                    innerLoopCounter++\n                    //Error messaging should only happen if the search key has been compared with all of the headers\n                    //requestedDataTable[0].length gives the total number of data headers (columns of the spreadsheet)\n                    if (requestedDataTable[0].length == innerLoopCounter)\n                    {\n                        //populate error \n                        //put some details on this configuration into the msg to be output\n                        workingMsg.error = \"Key with value \\\"\" + keysForSearchColumn[outerIndex] + \"\\\" not found amongst the \" + (requestedDataTable[0].length + 1) + \" entries, which include \" + requestedDataTable[0]\n                        //either create and populate the error count at 1 or increment it if it already exists\n                        if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n                        {\n                                workingMsg.searchErrorCount++\n                        }\n                        else\n                        {\n                            workingMsg.searchErrorCount = 1\n                        }\n                        //this retry is in case the column was added to the google sheet since it was last loaded into node red\n                        if (workingMsg.searchErrorCount > 1)\n                        {\n                            //return the error on the bottom because with a count of 2 that means reloading has already been tried\n                            return [null, null, workingMsg]\n                        }\n                        else\n                        {\n                            //return the error on the middle there is an error output,\n                            return [null, workingMsg, null]\n                        }\n                    } //if (requestedDataTable[0].length == innerLoopCounter)\n                } //if (requestedDataTable[0][innerIndex] == keysForSearchColumn[outerIndex]) else\n            } //for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n        } //for (outerIndex = 0; outerIndex < keysForSearchColumn.length; outerIndex++)\n        //if this point is reached, searchKeyIndices has been populated\n        // iterate through all search result keys.\n        //outer index is the place along the array of search keys \n        for (outerIndex = 0; outerIndex < keysForResultColumn.length; outerIndex++)\n        {\n            //inner index is the place along the first row of data\n            //The innerLoopCounter must be reset each time a new key is being looked for\n            innerLoopCounter = 0\n            for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n            {\n                //these 2 loops will compare every entry in the top row of the data table to every entry in the array of search keys,\n                if (requestedDataTable[0][innerIndex] == keysForResultColumn[outerIndex])\n                {\n                    //when they match push the column number on to the array that has just indices for the search keys\n                    searchResultKeysIndices.push(innerIndex)\n                    //break is used to stop comparing as once the column has been found the remaining aren't relevant\n                    break\n                } //if (requestedDataTable[0][innerIndex] == keysForResultColumn[outerIndex])\n                else\n                {\n                    //when they don't match, then this means there is a search key that does not match any header.\n                    //When properly configured this should not happen, but proper configuration cannot be guaranteed\n                    innerLoopCounter++\n                    //Error messaging should only happen if the search key has been compared with all of the headers\n                    //requestedDataTable[0].length gives the total number of data headers (columns of the spreadsheet)\n                    if (requestedDataTable[0].length == innerLoopCounter)\n                    {\n                        //populate error \n                        //put some details on this configuration into the msg to be output\n                        workingMsg.error = \"Key with value \\\"\" + keysForSearchColumn[outerIndex] + \"\\\" not found amongst the \" + (requestedDataTable[0].length + 1) + \" entries, which include \" + requestedDataTable[0]\n                        //either create and populate the error count at 1 or increment it if it already exists\n                        if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n                        {\n                            workingMsg.searchErrorCount++\n                        } //if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n                        else\n                        {\n                            workingMsg.searchErrorCount = 1\n                        } //if ( workingMsg.hasOwnProperty(\"searchErrorCount\")) else\n                        //this retry is in case the column was added to the google sheet since it was last loaded into node red\n                        if (workingMsg.searchErrorCount > 1)\n                        {\n                            //return the error on the bottom because with a count of 2 that means reloading has already been tried\n                            return [null, null, workingMsg]\n                        } //if (workingMsg.searchErrorCount > 1)\n                        else\n                        {\n                            //return the error on the middle there is an error output,\n                            return [null, workingMsg, null]\n                        } //if (workingMsg.searchErrorCount > 1) else\n                    } //if (requestedDataTable[0].length == innerLoopCounter)\n                } //if (requestedDataTable[0][innerIndex] == keysForResultColumn[outerIndex]) else\n            } //for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n        } //for (outerIndex = 0; outerIndex < keysForResultColumn.length; outerIndex++)\n        //if this point is reached, both searchKeyIndices and searchResultKeysIndices have been populated\n        //loop through all search keys, 1 index at a time and filter to a row that has the desired data in the desired column\n        let result = []\n        let pushable\n        pushable = false\n        for (outerIndex = 0; outerIndex < requestedDataTable.length; outerIndex++)\n        {\n            for (innerIndex = 0; innerIndex < searchKeyIndices.length; innerIndex++)\n            {\n                if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex])\n                {\n                    pushable = true\n                } //if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex])\n                else\n                {\n                    pushable = false\n                    break\n                } //if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex]) else\n            } //for (innerIndex = 0; innerIndex < searchKeyIndices.length; innerIndex++)\n            if (pushable)\n            {\n                result.push(requestedDataTable[outerIndex])\n            } //if (pushable)\n    \n    } //for (outerIndex = 0; outerIndex < requestedDataTable.length; outerIndex++)\n        //if this point is reached then there is a filtered table\n        //debugger\n        if (result.length === 0)\n        {\n            workingMsg.error = \"After filtering no data rows were left.\"\n            //either create and populate the error count at 1 or increment it if it already exists\n            if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n            {\n                workingMsg.searchErrorCount++\n            } //( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n            else\n            {\n                workingMsg.searchErrorCount = 1\n            } //( workingMsg.hasOwnProperty(\"searchErrorCount\")) else\n            //return the error on the middle there is an error output,\n            //this retry is in case the column was added to the google sheet since it was last loaded into node red\n            if (workingMsg.searchErrorCount > 1)\n            {\n                //return the error on the bottom because with a count of 2 that means reloading has already been tried\n                return [null, null, workingMsg]\n            } //if (workingMsg.searchErrorCount > 1)\n            else\n            {\n                //return the error on the middle there is an error output,\n                return [null, workingMsg, null]\n            } //if (workingMsg.searchErrorCount > 1) else\n        } //if (result.length === 0)\n        else if (result.length > 1)\n        {\n            //do the warning that multiple were found but will take the first\n            node.warn(\"Multiple rows were found that matched the search criteria. Results are from the first row that was found and matched.\")\n        } //else if (result.length > 1)\n        //look up the data\n        for (index = 0; index < searchResultKeysIndices.length; index++)\n        {\n            //workingMsg.searchfor.keysForSearchColumn[index] = result[0][searchResultKeysIndices]\n            // the almost working version\n            workingMsg.searchfor[keysForResultColumn[index]] = result[0][searchResultKeysIndices[index]]\n        } //for (index = 0; index < searchResultKeysIndices.length; index++)\n        //if this point is reached then work workingMsg contains complete info\n        //build and save the LastSearch obect\n        passedCacheObject.searchfor = workingMsg.searchfor\n        global.set(\"LastSearch\", passedCacheObject)\n        return [workingMsg, null, null]\n    } //if (requestedDataTable !== undefined)\n    else\n    {\n        //return on second output to trigger population of global that feeds datatable\n        //put some details on this configuration into the msg to be output\n        workingMsg.error = \"The data normally loaded from google sheet was not loaded.\"\n        //either create and populate the error count at 1 or increment it if it already exists\n        if (workingMsg.hasOwnProperty('searchErrorCount'))\n        {\n            workingMsg.searchErrorCount++\n        } //if (workingMsg.hasOwnProperty('searchErrorCount'))\n        else\n        {\n            workingMsg.searchErrorCount = 1\n        } //if (workingMsg.hasOwnProperty('searchErrorCount')) else\n        //return the error on the middle there is an error output,\n        //this retry is in case the column was added to the google sheet since it was last loaded into node red\n        if (workingMsg.searchErrorCount > 1)\n        {\n            //return the error on the bottom because with a count of 2 that means reloading has already been tried\n            return [null, null, workingMsg]\n        } //if (workingMsg.searchErrorCount > 1)\n        else\n        {\n            //return the error on the middle there is an error output,\n            return [null, workingMsg, null]\n        } //if (workingMsg.searchErrorCount > 1) else\n    } //if (requestedDataTable !== undefined) else\n}","outputs":3,"noerr":0,"x":240,"y":80,"wires":[[],["d84471d1.ac3ec"],[]],"outputLabels":["Value Found","Error but try reloading from data source","Error despite having tried to reload from data source"],"info":"# **Conceptual Explanation**\nThis node is designed to use a 2-D array of data loaded from a google sheeet to lookup desired data. The data is arrayed with the first row being column headers describing the data in those columns in subsequent rows.\n## **inputs**\n### globalsource \nThe name of the global variable holding the table of data\n### msg.keyvalues\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row.\n### msg.searchfor\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. The value enters the node empty.\n## **outputs**\n### Output1: Value Found \nThis ouput is used when the node has successfully identified the requested data. That data is placed into the value portions of the key value pairs that made up the msg.searchfor input\n### Output 2: Error but try reloading from data source\nThis output is used when either the global variable to contain the data table either does no exist or does not contain a row with all of the requested search criteria. Normally it is used to trigger loading the table from Google sheets under the expectation that either this is the first time a lookup has been tried an the data had not yet been cached in the global variable or potentially the data in the cache has become stale and reloading from the Google sheet will add a row that will match the requested search criteria.\n### Output 3: Error despite having tried to reload from data source\nThis output is used when either the global variable to contain the data table either does no exist or does not contain a row with all of the requested search criteria and at least 1 attempt has already been made to reload the global vairable cache. This is effectively a notification of non-recoverable lookup failure."},{"id":"ff4aa3f9.f2658","type":"change","z":"20c22900.896628","name":"Devices table, 1 search key with variable input, 1 result","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"exportableresults.DeviceName","tot":"msg"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":980,"y":100,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value pulled from the **msg.exportableresults.DeviceName** object.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** column.\n"},{"id":"89e3875b.349698","type":"change","z":"20c22900.896628","name":"Devices table, 1 search key, 2 results","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"Motion_Ikea","tot":"str"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.Manufacturer","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":180,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value **\"Motion_Ikea\"**.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** and **\"Manufacturer\"** columns."},{"id":"dc7c3f55.cdc4c","type":"change","z":"20c22900.896628","name":"Devices table, 1 search key, 1 result","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"Anyone Presence","tot":"str"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":60,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value **\"Anyone Presence\"**. Notice unlike some examples this includes a space in the value. This has no negative impact.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** column."},{"id":"eae5f57f.09e918","type":"change","z":"20c22900.896628","name":"Devices table, 2 search keys, 1 results","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"Anyone Presence","tot":"str"},{"t":"set","p":"keyvalues.Manufacturer","pt":"msg","to":"homebridge-people-geofence","tot":"str"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":140,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value **\"Anyone Presence\"** and the **\"Manufacturer\"** column for the value **\"homebridge-people-geofence\"**.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** columns."},{"id":"ea88bfb8.3855","type":"comment","z":"20c22900.896628","name":"Examples of preformating the inputs","info":"","x":920,"y":20,"wires":[]},{"id":"72a166e6.25b6e8","type":"change","z":"20c22900.896628","name":"Spreadsheet Lookup Settings Example","rules":[{"t":"set","p":"IgnoreEnvVar ","pt":"msg","to":"true","tot":"bool"},{"t":"set","p":"SpreadsheetID","pt":"msg","to":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","tot":"str"},{"t":"set","p":"Tab","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"ColStart","pt":"msg","to":"A","tot":"str"},{"t":"set","p":"ColEnd","pt":"msg","to":"Z","tot":"str"},{"t":"set","p":"MinRow","pt":"msg","to":"1","tot":"str"},{"t":"set","p":"MaxRow","pt":"msg","to":"1000","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":260,"wires":[[]],"info":"## **inputs**\n### IgnoreEnvVar \nThis boolean needs to be true to tell that Read Spreadsheet For Details subflow that it should use the specs passed in the msg to determine what spreadsheet to read from and what portion of data to read from.\n### msg.SpreadsheetID\nThis is the very long string that identifies a specific google spreadsheet.\n### msg.Tab\nSpecifies the tab name that contains the data.\n### msg.ColStart\nSpecifies the leftmost column containing the desired data.\n### msg.ColEnd\nSpecifies the rightmost column containing the desired data. \n### msg.MinRow\nSpecifies the top row containing the desired data \n### msg.MaxRow\nSpecifies the bottom row containing the desired data "},{"id":"82a0ae35.8fd61","type":"debug","z":"20c22900.896628","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":160,"y":240,"wires":[]},{"id":"d3a38e47.70d9d","type":"comment","z":"20c22900.896628","name":"Maybe insert check of how long since last Google read and skip step","info":"","x":520,"y":140,"wires":[]},{"id":"585a8652.004658","type":"change","z":"f9a34738.f12c28","name":"Put device ID into msg.deviceID and payload into payload.value","rules":[{"t":"set","p":"temp","pt":"msg","to":"payload","tot":"msg"},{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.value","pt":"msg","to":"temp","tot":"msg"},{"t":"delete","p":"temp","pt":"msg"},{"t":"set","p":"exportableresults.MQTTname","pt":"msg","to":"homebridge","tot":"str"},{"t":"set","p":"exportableresults.DeviceName","pt":"msg","to":"name","tot":"msg"},{"t":"set","p":"payload.name","pt":"msg","to":"name","tot":"msg"},{"t":"set","p":"MQTTName","pt":"msg","to":"homebridge","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1850,"y":960,"wires":[["b1becd5e.a8ea1","59751680.d64758"]]},{"id":"59751680.d64758","type":"function","z":"f9a34738.f12c28","name":"Split kv pairs (from value) into 1-n msg stream (ready for testing)","func":"///////////////////////////////////////////////////////////////////\n//debugger\n///////////////////////////////////////////////////////////////////\n/*\n * Main function node code \n * \n */\n//Check if there is any data. If not, stop processing. At the time this was created, the trackData sent from a Hubitat Elevation device node was always null\nif (msg.payload.value === null) {\n    return null;\n}\n//delete the currentValue portion of the object since it is deprecated\ndelete msg.payload.currentValue\n//initial call into the recursive function\nhandlemsg(msg)\n//send nothing from main code\nreturn\n\n/*\n * Main recursive function code\n *\n */\n\nfunction handlemsg(msg) {\n    //The evaluation part of this switch/case statement determines which type of entity is in the value\n    //  the key idea is that once the value is an atomic item (number, string, bool) then the message should be sent out\n    //  of the node to downstream, but if the value is a splittable, then it should be split into multiple messages. These\n    //  messages are then evaulated individually. They in turn are either found to have atomic entries in the value or have\n    //  values that are themselves splittable.\n    //  For example:\n    //  JSON - each key value pair will be used to create a new msg. The msg.payload.name will be changed to add \":\" and the key\n    //          from the key value pair. The msg.payload.value will become the value from the key value pair\n    //  Array - TBAdded\n    //  Object - TBAdded\n    switch (typeofhubitatvalue(msg.payload.value, \"msg.payload.value\")) {\n        case \"number\":\n        case \"bigint\":\n            //numbers are an atomic type of value and should be sent to downstream nodes\n            msg.payload.dataType = \"Number\"\n            //send the version of the msg with an atomic value to downstream nodes\n            node.send(msg)\n            //do nothing more once msg has been sent\n            break;\n        case \"boolean\":\n            //Booleans are an atomic type of value and should be sent to downstream nodes\n            msg.payload.dataType = \"Boolean\"\n            //send the version of the msg with an atomic value to downstream nodes\n            node.send(msg)\n            //do nothing more once msg has been sent\n            break;\n        case \"string\":\n            //Strings are an atomic type of value and should be sent to downstream nodes\n            msg.payload.dataType = \"String\"\n            //send the version of the msg with an atomic value to downstream nodes\n            node.send(msg)\n            //do nothing more once msg has been sent\n            break;\n        case \"unsplittable array\":\n            //This case is where the item is an array, but with only a single entry. The idea is to move that single\n            //  value out of the array and into the value natively and then to call the recursive function to evaluate\n            //  what type of item it now is and then process (split or send or extract) appropriately\n            msg.payload.value = msg.payload.value[0]\n            handlemsg(msg)\n            break;\n        case \"splittable JSON\":\n            //This is for cases where the JSON is in the form of key:value where there is at least 1 pair\n            //  Examples of \"valid\" JSON that would not be coming to this case would be {} or 100\n            splitJSON(msg)\n            break;\n        case \"splittable array\":\n            //This is for cases where the Array is in the form [\"A\",\"B\",\"C\"] where there is are at least 2 members\n            //  SplitArray function not yet built. TBD\n            splitArray(msg)\n            break;\n        case \"unsplittable JSON\":\n            //This is for handling \"valid\" JSON that does not have key:value pairs.\n            //  Examples of \"valid\" JSON that are handed here are {} or 100 or \"100\"\n            //  This case either treats it as a string (no changes made) or a number where a number in\n            //  a string like \"100\" is changed into an actual number like 100\n\n            //by checking if NaN, if it is a number 100 or \"100\", the ++ followed by -- changes it to a number 100\n            //  without changing its actual value\n            if (isNaN(msg.payload.value)) { } else {\n                ++msg.payload.value;\n                --msg.payload.value;\n            }\n            //Sets the data type for downstream since the incoming message could have been a variety of types\n            //  before JSON, object or array was split\n            msg.payload.dataType = typeof (msg.payload.value)\n            //send the version of the msg with an atomic value to downstream nodes (could probably just recursively call\n            //  handlemsg, but I can't identify a circumstance where that would give a different result to downstream,\n            //  but this would be a place to investigate if downstream results are unexpected.)\n            node.send(msg)\n            break\n        case \"object\":\n            //This is for handling an object. It then calls splitObj to create multiple msgs with the object keys into the names\n            //  and the values from those keys moved into the value of the new object.\n            splitObj(msg)\n            break\n        default:\n            //This is just in case no valid process is found by the typeofhubitatvalue function.\n            //  If you encounter this then you will either need to investigate the function or contact tmichael in\n            //  Hubitat discourse forums https://community.hubitat.com/\n            return\n    }\n}\n\n/*\n * This function is used by the Main recursive function (handlemsg) to decide whether to send the msg on as\n *  the msg.payload.value is atomic or if it needs to split the value into multiple msgs\n *\n */\nfunction typeofhubitatvalue(value, source = \"\") {\n    switch (typeof (value)) {\n        case \"number\":\n            //atomic just return the result of typeof\n            return \"number\"\n            break;\n        case \"bigint\":\n            //atomic just return the result of typeof\n            return \"bigint\"\n            break;\n        case \"boolean\":\n            //atomic just return the result of typeof\n            return \"boolean\"\n            break;\n        case \"string\":\n            //most splittable values are encoded strictly as text and so may be identified as a string\n\n            //Fist check if the string is \"valid\" JSON\n            if (isvalidJSONstring(value)) {\n                //When it is \"valid\" JSON, check if it is splittable\n                if (issplittablevalidJSONstring(value)) {\n                    //When it is splittable, then return type as splittable JSON\n                    return \"splittable JSON\"\n                }\n                else {\n                    //if it is JSON, but not splittable ({}, \"100, 100) return unsplittable JSON\n                    return \"unsplittable JSON\"\n                }\n            }\n            else {\n                //When it isn't \"valid\" JSON, check if it is an array\n                if (isvalidarray(value)) {\n                    //When it is an array, check if it is splittable\n                    if (issplittablearray(value)) {\n                        //When it is splittable, return splittable Array\n                        return \"splittable Array\"\n                    }\n                    else {\n                        //if the array is not splittable ([\"apple\"]) return unsplittable array\n                        return \"unsplittable array\"\n                    }\n                }\n                else {\n                    //When it is neither JSON or Array, then it is really just a string, so return string\n                    return \"string\"\n                }\n            }\n            break;\n        case \"object\":\n            //some  splittable values are identified as objects\n\n            //Fist check if the object is \"valid\" JSON\n            if (isvalidJSONstring(value)) {\n                //When it is \"valid\" JSON, check if it is splittable\n                if (issplittablevalidJSONstring(value)) {\n                    //When it is splittable, then return type as splittable JSON\n                    return \"splittable JSON\"\n                }\n                else {\n                    //if it is JSON, but not splittable ({}, \"100, 100) return unsplittable JSON\n                    return \"unsplittable JSON\"\n                }\n            }\n            else {\n                //When it isn't \"valid\" JSON, check if it is an array\n                if (isvalidarray(value)) {\n                    //When it is an array, check if it is splittable\n                    if (issplittablearray(value)) {\n                        //When it is splittable, return splittable Array\n                        return \"splittable Array\"\n                    }\n                    else {\n                        //if the array is not splittable ([\"apple\"]) return unsplittable array\n                        return \"unsplittable array\"\n                    }\n                }\n                else {\n                    //When it is neither JSON or Array, then I have not accounted for it. If you reach this point during an\n                    //  investigation, it might be worth using the example that triggered your investigation to see if the object\n                    //  is really just a string (without a triggering example I have not investigated)\n                    return \"object\"\n                }\n            }\n            break;\n        default:\n            //When the type is not one that I coded for then return unhandled because the situation is by definition unhandled\n            return \"unhandled\"\n            break;\n    }\n}\n\n//True False functions\n/*\n * This function was found on the internet to check if an input is valid JSON\n * There seems to be a belief that there should be some more elegant method that trying parse and the catching the error,\n * but no one seems to have demonstrated what that more elegant way would be\n */\nfunction isvalidJSONstring(str) {\n    try {\n        JSON.parse(str);\n    } catch (e) {\n        return false;\n    }\n    return true;\n}\n\n/*\n * This function decides where the JSON is made up of at least 1 key:value pair\n */\nfunction issplittablevalidJSONstring(str) {\n    if (str.includes(\":\")) {\n        return true;\n    }\n    else {\n        return false;\n    }\n}\n/*\n * This function is simply wrapping the Array.isArray, to align the function naming with the other true false functions\n */\nfunction isvalidarray(str) {\n    if (Array.isArray(str)) {\n        return true;\n    }\n    else {\n        return false;\n    }\n}\n/*\n * This function identifies if the array has only a single entry or multiple entries i.e. [\"Apple\"] not splittable,\n *  [\"Apple\",\"Pear\"] splittable\n */\nfunction issplittablearray(str) {\n    // If the length is more than 1, then the array has mutliple entries, but if it is just 1, then it is not splittable\n    if (str.length > 1) {\n        return true;\n    }\n    else {\n        return false;\n    }\n}\n\n//Splitting functions\n/*\n * This function takes in a msg where msg.payload.value is splittable JSON and iterates through all key:value pairs and then\n *  recursively calls handlemsg with multiple messages. Each new message retains most of the details of the input message, \n *  but the name and value are changed.\n *  The name has the key from the key:value pair appended with a : as a seperator\n *  The value is replaced with the value from the key:value pair\n *  A new message is created for each key:value pair\n */\nfunction splitJSON(latestMsg) {\n    //put the inputs value into a variable for easier access\n    var valueJSON = JSON.parse(latestMsg.payload.value);\n    //put the inputs name aside for multiple reuses\n    var name = latestMsg.payload.name\n    //Iterative loop\n    Object.keys(valueJSON).forEach(function (key) {\n        //concatenate the original name, a colon and the key from the pair\n        if (typeof name === 'undefined') \n        {\n            latestMsg.payload.name = key;\n        } \n        else \n        {\n            latestMsg.payload.name = name + \"/\" + key;\n        }\n        //move the value from the pair to payload.value\n        latestMsg.payload.value = valueJSON[key];\n        //recursively call this function in case the value is itself splittable\n        handlemsg(latestMsg)\n    }\n    )\n    return\n}\n\n/*\n * This function takes in a msg where msg.payload.value is splittable object\n *  and iterates through all key:value pairs and then\n *  recursively calls handlemsg with multiple messages. Each new message retains most of the details of the input message,\n *  but the name and value are changed.\n *  The name has the key from the key:value pair appended with a : as a seperator\n *  The value is replaced with the value from the key:value pair\n *  A new message is created for each key:value pair\n *  \n *  Note: While working on the splitArray function, I realized that I may not have tested this on an object value with multiple\n *  pairs, so it is possible that the function only handles the first pair\n */\nfunction splitObj(oMsg) {\n    //put the inputs name aside for multiple reuses\n    var name = oMsg.payload.name\n//Iterative loop\n    for (let [key, value] of Object.entries(oMsg.payload.value)) {\n        if ((value !== null) && (key !== null)) {\n            oMsg.payload.name = name + \"/\" + key;\n            oMsg.payload.value = value;\n            //recursively call this function in case the value is itself splittable\n            handlemsg(oMsg)\n        }\n    }\n}\n\n/*\n * Note: At the time of creation, I did not have a live example and had too many other things in the works to construct one.\n * \n * This function takes in a msg where msg.payload.value is splittable array\n *  and iterates through all entries and recursively calls handlemsg with multiple messages. \n *  Each new message retains most of the details of the input message,\n *  but the value is changed.\n *  The value is replaced with the value from the entry in the Array\n *  For example if the input value is [\"Apple\",\"Pear\"], then the first msg will have a value of \"Apple\"\n *  and the second will have a value of \"Pear\"\n */\nfunction splitArray(aMsg) {\n    //Iterative loop\n    for (index = 0; index < aMsg.payload.value.length; index++) {\n        (aMsg.payload.value = aMsg.payload.value[index]);\n        //recursively call this function in case the value is itself splittable\n        handlemsg(aMsg)\n    }\n}","outputs":1,"noerr":0,"x":1850,"y":1000,"wires":[["7a3228f6.c13f18","6e959977.a66a68"]]},{"id":"7a3228f6.c13f18","type":"change","z":"f9a34738.f12c28","name":"","rules":[{"t":"delete","p":"qos","pt":"msg"},{"t":"delete","p":"retain","pt":"msg"},{"t":"delete","p":"payload.dataType","pt":"msg"},{"t":"delete","p":"deviceID","pt":"msg"},{"t":"set","p":"exportableresults.MQTTname","pt":"msg","to":"MQTTName","tot":"msg"},{"t":"delete","p":"MQTTName","pt":"msg"},{"t":"set","p":"exportableresults.DeviceName","pt":"msg","to":"topic","tot":"msg"},{"t":"delete","p":"topic","pt":"msg"},{"t":"set","p":"exportableresults.Measure","pt":"msg","to":"payload.name","tot":"msg"},{"t":"set","p":"exportableresults.Reading","pt":"msg","to":"payload.value","tot":"msg"},{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"exportableresults.DeviceName","pt":"msg","to":"name","tot":"msg"},{"t":"delete","p":"Manufacturer","pt":"msg"},{"t":"delete","p":"_device","pt":"msg"},{"t":"delete","p":"_confId","pt":"msg"},{"t":"delete","p":"Homebridge","pt":"msg"},{"t":"delete","p":"_rawMessage","pt":"msg"},{"t":"delete","p":"name","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1710,"y":1040,"wires":[["4c16b527.2f064c","64a1be90.6880c"]]},{"id":"64a1be90.6880c","type":"link out","z":"f9a34738.f12c28","name":"Get DeviceID","links":["cd8ee5de.4e22c8"],"x":1990,"y":1040,"wires":[],"l":true},{"id":"b1becd5e.a8ea1","type":"debug","z":"f9a34738.f12c28","name":"Catch Post change 1","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2240,"y":960,"wires":[]},{"id":"6e959977.a66a68","type":"debug","z":"f9a34738.f12c28","name":"Catch Stream Split","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2230,"y":1000,"wires":[]},{"id":"4c16b527.2f064c","type":"debug","z":"f9a34738.f12c28","name":"Catch to send to get device","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2080,"y":1160,"wires":[]},{"id":"cd8ee5de.4e22c8","type":"link in","z":"f9a34738.f12c28","name":"Get DeviceID (Homekit, z2m)","links":["64a1be90.6880c"],"x":1640,"y":1440,"wires":[["2ce96cca.686084"]],"l":true},{"id":"10ef9b23.de26a5","type":"link in","z":"f9a34738.f12c28","name":"Got DeviceID","links":["9334307.c3c62d"],"x":1670,"y":1500,"wires":[["8009a52c.cd3bc8"]],"l":true},{"id":"bf85a2c6.09df7","type":"change","z":"f9a34738.f12c28","name":"Remove Excess Properties","rules":[{"t":"delete","p":"globalsource","pt":"msg"},{"t":"delete","p":"keyname","pt":"msg"},{"t":"delete","p":"searchtarget","pt":"msg"},{"t":"delete","p":"datacolumnname","pt":"msg"},{"t":"delete","p":"_event","pt":"msg"},{"t":"set","p":"exportableresults.DeviceID","pt":"msg","to":"value","tot":"msg"},{"t":"delete","p":"value","pt":"msg"},{"t":"delete","p":"keyvalues","pt":"msg"},{"t":"delete","p":"SpreadsheetID","pt":"msg"},{"t":"delete","p":"Tab","pt":"msg"},{"t":"delete","p":"ColStart","pt":"msg"},{"t":"delete","p":"ColEnd","pt":"msg"},{"t":"delete","p":"MinRow","pt":"msg"},{"t":"delete","p":"MaxRow","pt":"msg"},{"t":"delete","p":"IgnoreEnvVar","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2660,"y":1420,"wires":[["deac7af9.eb82d8"]],"info":"This node is removing properties that were needed for the lookup, but not part of the results."},{"id":"d7ff7cf1.52259","type":"subflow:20c22900.896628","z":"f9a34738.f12c28","name":"","env":[],"x":2401,"y":1440,"wires":[["bf85a2c6.09df7"],["59213915.3a4ac8"],["9ced7b16.74d468"]]},{"id":"34c6aaba.43ba56","type":"inject","z":"f9a34738.f12c28","name":"Delete Devices for Testing","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1710,"y":1380,"wires":[["968f96eb.d5d2c8"]]},{"id":"968f96eb.d5d2c8","type":"change","z":"f9a34738.f12c28","name":"","rules":[{"t":"delete","p":"Devices","pt":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1980,"y":1380,"wires":[[]]},{"id":"deac7af9.eb82d8","type":"function","z":"f9a34738.f12c28","name":"Move Data from searchfor to exportableresults","func":"//debugger\nlet foundKeys = Object.keys(msg.searchfor)\nlet foundValues = Object.values(msg.searchfor)\n//loop through all keys and a\nfor (index = 0; index < foundKeys.length; index++)\n{\n    msg.exportableresults[foundKeys[index]] = foundValues[index]\n}\ndelete msg.searchfor\nreturn msg","outputs":1,"noerr":0,"x":2980,"y":1420,"wires":[["8a986ea5.9cf49","9334307.c3c62d"]],"info":"This node moves each property under the msg.searchfor property to the msg.exportableresults property."},{"id":"2ce96cca.686084","type":"change","z":"f9a34738.f12c28","name":"Spreadsheet Lookup Settings","rules":[{"t":"set","p":"IgnoreEnvVar","pt":"msg","to":"true","tot":"bool"},{"t":"set","p":"SpreadsheetID","pt":"msg","to":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","tot":"str"},{"t":"set","p":"Tab","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"ColStart","pt":"msg","to":"A","tot":"str"},{"t":"set","p":"ColEnd","pt":"msg","to":"Z","tot":"str"},{"t":"set","p":"MinRow","pt":"msg","to":"1","tot":"str"},{"t":"set","p":"MaxRow","pt":"msg","to":"1000","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1911,"y":1440,"wires":[["23b8b7a4.d7f8b8"]],"info":"## **inputs**\n### IgnoreEnvVar \nThis boolean needs to be true to tell that Read Spreadsheet For Details subflow that it should use the specs passed in the msg to determine what spreadsheet to read from and what portion of data to read from.\n### msg.SpreadsheetID\nThis is the very long string that identifies a specific google spreadsheet.\n### msg.Tab\nSpecifies the tab name that contains the data.\n### msg.ColStart\nSpecifies the leftmost column containing the desired data.\n### msg.ColEnd\nSpecifies the rightmost column containing the desired data. \n### msg.MinRow\nSpecifies the top row containing the desired data \n### msg.MaxRow\nSpecifies the bottom row containing the desired data "},{"id":"23b8b7a4.d7f8b8","type":"change","z":"f9a34738.f12c28","name":"Devices Lookup Settings","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"exportableresults.DeviceName","tot":"msg"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.Floor","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.Location","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.Room","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.DeviceType","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.Manufacturer","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.AccessProtocol","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.PhysicalVirtualType","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.House","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.MQTTDeviceTopic","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.Hub","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2171,"y":1440,"wires":[["d7ff7cf1.52259"]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value pulled from the **msg.exportableresults.DeviceName** object.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** column.\n"},{"id":"579a7b7a.920b84","type":"link in","z":"f9a34738.f12c28","name":"Get Measurement Name Update (All 3)","links":["8009a52c.cd3bc8"],"x":1710,"y":1540,"wires":[["7feb289f.232c78"]],"l":true},{"id":"8009a52c.cd3bc8","type":"link out","z":"f9a34738.f12c28","name":"Get Measurement Name Update","links":["579a7b7a.920b84"],"x":2070,"y":1500,"wires":[],"l":true},{"id":"a5cdfbc.9477208","type":"link in","z":"f9a34738.f12c28","name":"Got Measurement Name Update","links":["320bd13a.63e02e"],"x":1730,"y":1580,"wires":[["79e101d4.e115b"]],"l":true},{"id":"9334307.c3c62d","type":"link out","z":"f9a34738.f12c28","name":"Got Device ID","links":["10ef9b23.de26a5"],"x":3280,"y":1420,"wires":[],"l":true},{"id":"f21ee1e2.f0daf","type":"comment","z":"f9a34738.f12c28","name":"DeviceID lookup is needed for MQTT (and Homebridge?), but not Hubitat devices","info":"","x":1880,"y":1340,"wires":[]},{"id":"a37190b1.152e6","type":"change","z":"f9a34738.f12c28","name":"Remove Excess Properties","rules":[{"t":"delete","p":"globalsource","pt":"msg"},{"t":"delete","p":"keyname","pt":"msg"},{"t":"delete","p":"searchtarget","pt":"msg"},{"t":"delete","p":"datacolumnname","pt":"msg"},{"t":"delete","p":"_event","pt":"msg"},{"t":"delete","p":"value","pt":"msg"},{"t":"delete","p":"keyvalues","pt":"msg"},{"t":"delete","p":"SpreadsheetID","pt":"msg"},{"t":"delete","p":"Tab","pt":"msg"},{"t":"delete","p":"ColStart","pt":"msg"},{"t":"delete","p":"ColEnd","pt":"msg"},{"t":"delete","p":"MinRow","pt":"msg"},{"t":"delete","p":"MaxRow","pt":"msg"},{"t":"delete","p":"IgnoreEnvVar","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2880,"y":1480,"wires":[["a1c7e258.b7636"]],"info":"This node is removing properties that were needed for the lookup, but not part of the results."},{"id":"93cb2b85.b51968","type":"subflow:20c22900.896628","z":"f9a34738.f12c28","name":"","env":[],"x":2600,"y":1540,"wires":[["a37190b1.152e6"],["99906d6a.38631"],["82eda324.4864f","4adfd8be.4f6798"]]},{"id":"7feb289f.232c78","type":"change","z":"f9a34738.f12c28","name":"Spreadsheet Lookup Settings","rules":[{"t":"set","p":"IgnoreEnvVar","pt":"msg","to":"true","tot":"bool"},{"t":"set","p":"SpreadsheetID","pt":"msg","to":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","tot":"str"},{"t":"set","p":"Tab","pt":"msg","to":"MeasurementTranslations","tot":"str"},{"t":"set","p":"ColStart","pt":"msg","to":"A","tot":"str"},{"t":"set","p":"ColEnd","pt":"msg","to":"E","tot":"str"},{"t":"set","p":"MinRow","pt":"msg","to":"1","tot":"str"},{"t":"set","p":"MaxRow","pt":"msg","to":"100","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2010,"y":1540,"wires":[["a7e0ec97.d9521"]],"info":"## **inputs**\n### IgnoreEnvVar \nThis boolean needs to be true to tell that Read Spreadsheet For Details subflow that it should use the specs passed in the msg to determine what spreadsheet to read from and what portion of data to read from.\n### msg.SpreadsheetID\nThis is the very long string that identifies a specific google spreadsheet.\n### msg.Tab\nSpecifies the tab name that contains the data.\n### msg.ColStart\nSpecifies the leftmost column containing the desired data.\n### msg.ColEnd\nSpecifies the rightmost column containing the desired data. \n### msg.MinRow\nSpecifies the top row containing the desired data \n### msg.MaxRow\nSpecifies the bottom row containing the desired data "},{"id":"a7e0ec97.d9521","type":"change","z":"f9a34738.f12c28","name":"Measurement Translation Lookup Settings","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"MeasurementTranslations","tot":"str"},{"t":"set","p":"keyvalues.SourceDevice","pt":"msg","to":"exportableresults.DeviceName","tot":"msg"},{"t":"set","p":"keyvalues.DeviceID","pt":"msg","to":"exportableresults.DeviceID","tot":"msg"},{"t":"set","p":"keyvalues.Measurement","pt":"msg","to":"exportableresults.Measure","tot":"msg"},{"t":"set","p":"searchfor.ChangeNameTo","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2320,"y":1540,"wires":[["1bdba9bd.133746","b160c06c.fb41f"]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value pulled from the **msg.exportableresults.DeviceName** object.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** column.\n"},{"id":"8a986ea5.9cf49","type":"debug","z":"f9a34738.f12c28","name":"1 DevID Lookup Success","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":3310,"y":1380,"wires":[]},{"id":"99906d6a.38631","type":"debug","z":"f9a34738.f12c28","name":"flow 2 temp no find","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2850,"y":1520,"wires":[]},{"id":"82eda324.4864f","type":"debug","z":"f9a34738.f12c28","name":"flow 2 perm no find","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2850,"y":1600,"wires":[]},{"id":"f069229.e79d5e","type":"debug","z":"f9a34738.f12c28","name":"2 rename lookup success","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":3570,"y":1440,"wires":[]},{"id":"a1c7e258.b7636","type":"function","z":"f9a34738.f12c28","name":"Move Name Change from searchfor to exportableresults","func":"msg.exportableresults.Measure = msg.searchfor.ChangeNameTo\ndelete msg.searchfor\nreturn msg;","outputs":1,"noerr":0,"x":3230,"y":1480,"wires":[["f069229.e79d5e","320bd13a.63e02e"]]},{"id":"320bd13a.63e02e","type":"link out","z":"f9a34738.f12c28","name":"Got Measurement Name Update","links":["a5cdfbc.9477208"],"x":3610,"y":1480,"wires":[],"l":true},{"id":"79e101d4.e115b","type":"link out","z":"f9a34738.f12c28","name":"Get Potential Translation Update","links":["a30a59d2.1e4f48"],"x":2070,"y":1580,"wires":[],"l":true},{"id":"a30a59d2.1e4f48","type":"link in","z":"f9a34738.f12c28","name":"Get Potential Translation Update (Homebridge Only)","links":["79e101d4.e115b"],"x":1730,"y":1660,"wires":[["ee4b5532.f22c78"]],"l":true},{"id":"37f6ffdb.039e","type":"link in","z":"f9a34738.f12c28","name":"Got Potential Translation Update","links":["71b44bcb.1f9b14","d644fcba.8ac25","e3a1e105.d6ea3","68d5dbb2.dba074","aca44224.bdd06"],"x":1730,"y":1820,"wires":[["e0d5c4b0.096618","332acefe.132602"]],"l":true},{"id":"71b44bcb.1f9b14","type":"link out","z":"f9a34738.f12c28","name":"Got Potential Translation Update","links":["37f6ffdb.039e"],"x":4470,"y":1580,"wires":[],"l":true},{"id":"45aa7808.8c33d8","type":"function","z":"f9a34738.f12c28","name":"Move Name Change from searchfor to exportableresults","func":"msg.TranslationType = msg.searchfor.TranslationType\ndelete msg.searchfor\nreturn msg;","outputs":1,"noerr":0,"x":3330,"y":1640,"wires":[["cfdc8e29.5620b"]]},{"id":"767e5a85.4a6844","type":"change","z":"f9a34738.f12c28","name":"Remove Excess Properties","rules":[{"t":"delete","p":"globalsource","pt":"msg"},{"t":"delete","p":"keyname","pt":"msg"},{"t":"delete","p":"searchtarget","pt":"msg"},{"t":"delete","p":"datacolumnname","pt":"msg"},{"t":"delete","p":"_event","pt":"msg"},{"t":"delete","p":"value","pt":"msg"},{"t":"delete","p":"keyvalues","pt":"msg"},{"t":"delete","p":"SpreadsheetID","pt":"msg"},{"t":"delete","p":"Tab","pt":"msg"},{"t":"delete","p":"ColStart","pt":"msg"},{"t":"delete","p":"ColEnd","pt":"msg"},{"t":"delete","p":"MinRow","pt":"msg"},{"t":"delete","p":"MaxRow","pt":"msg"},{"t":"delete","p":"IgnoreEnvVar","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2980,"y":1640,"wires":[["45aa7808.8c33d8"]],"info":"This node is removing properties that were needed for the lookup, but not part of the results."},{"id":"8d62f17d.e0312","type":"subflow:20c22900.896628","z":"f9a34738.f12c28","name":"","env":[],"x":2720,"y":1660,"wires":[["767e5a85.4a6844"],[],["1845097a.8b6847"]]},{"id":"fa59a402.908af8","type":"change","z":"f9a34738.f12c28","name":"Measurement Translation Lookup Settings","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"DataTranslations","tot":"str"},{"t":"set","p":"keyvalues.DeviceID","pt":"msg","to":"exportableresults.DeviceID","tot":"msg"},{"t":"set","p":"keyvalues.Measurement","pt":"msg","to":"exportableresults.Measure","tot":"msg"},{"t":"set","p":"searchfor.TranslationType","pt":"msg","to":"","tot":"str"},{"t":"delete","p":"searchErrorCount","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2440,"y":1660,"wires":[["8d62f17d.e0312"]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value pulled from the **msg.exportableresults.DeviceName** object.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** column.\n"},{"id":"ee4b5532.f22c78","type":"change","z":"f9a34738.f12c28","name":"Spreadsheet Lookup Settings","rules":[{"t":"set","p":"IgnoreEnvVar","pt":"msg","to":"true","tot":"bool"},{"t":"set","p":"SpreadsheetID","pt":"msg","to":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","tot":"str"},{"t":"set","p":"Tab","pt":"msg","to":"DataTranslations","tot":"str"},{"t":"set","p":"ColStart","pt":"msg","to":"A","tot":"str"},{"t":"set","p":"ColEnd","pt":"msg","to":"C","tot":"str"},{"t":"set","p":"MinRow","pt":"msg","to":"1","tot":"str"},{"t":"set","p":"MaxRow","pt":"msg","to":"100","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2070,"y":1660,"wires":[["fa59a402.908af8"]],"info":"## **inputs**\n### IgnoreEnvVar \nThis boolean needs to be true to tell that Read Spreadsheet For Details subflow that it should use the specs passed in the msg to determine what spreadsheet to read from and what portion of data to read from.\n### msg.SpreadsheetID\nThis is the very long string that identifies a specific google spreadsheet.\n### msg.Tab\nSpecifies the tab name that contains the data.\n### msg.ColStart\nSpecifies the leftmost column containing the desired data.\n### msg.ColEnd\nSpecifies the rightmost column containing the desired data. \n### msg.MinRow\nSpecifies the top row containing the desired data \n### msg.MaxRow\nSpecifies the bottom row containing the desired data "},{"id":"4adfd8be.4f6798","type":"change","z":"f9a34738.f12c28","name":"Remove Excess Properties when No Name Change Found","rules":[{"t":"delete","p":"globalsource","pt":"msg"},{"t":"delete","p":"keyname","pt":"msg"},{"t":"delete","p":"searchtarget","pt":"msg"},{"t":"delete","p":"datacolumnname","pt":"msg"},{"t":"delete","p":"_event","pt":"msg"},{"t":"delete","p":"value","pt":"msg"},{"t":"delete","p":"keyvalues","pt":"msg"},{"t":"delete","p":"SpreadsheetID","pt":"msg"},{"t":"delete","p":"Tab","pt":"msg"},{"t":"delete","p":"ColStart","pt":"msg"},{"t":"delete","p":"ColEnd","pt":"msg"},{"t":"delete","p":"MinRow","pt":"msg"},{"t":"delete","p":"MaxRow","pt":"msg"},{"t":"delete","p":"IgnoreEnvVar","pt":"msg"},{"t":"delete","p":"payload","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"delete","p":"searchfor","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2980,"y":1560,"wires":[["711cd60d.0fd568"]],"info":"This node is removing properties that were needed for the lookup, but not part of the results."},{"id":"1845097a.8b6847","type":"change","z":"f9a34738.f12c28","name":"Remove Excess Properties when No Data Translation Found","rules":[{"t":"delete","p":"globalsource","pt":"msg"},{"t":"delete","p":"keyname","pt":"msg"},{"t":"delete","p":"searchtarget","pt":"msg"},{"t":"delete","p":"datacolumnname","pt":"msg"},{"t":"delete","p":"_event","pt":"msg"},{"t":"delete","p":"value","pt":"msg"},{"t":"delete","p":"keyvalues","pt":"msg"},{"t":"delete","p":"SpreadsheetID","pt":"msg"},{"t":"delete","p":"Tab","pt":"msg"},{"t":"delete","p":"ColStart","pt":"msg"},{"t":"delete","p":"ColEnd","pt":"msg"},{"t":"delete","p":"MinRow","pt":"msg"},{"t":"delete","p":"MaxRow","pt":"msg"},{"t":"delete","p":"IgnoreEnvVar","pt":"msg"},{"t":"delete","p":"payload","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"delete","p":"searchfor","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":3080,"y":1680,"wires":[["aca44224.bdd06"]],"info":"This node is removing properties that were needed for the lookup, but not part of the results."},{"id":"e0b84f64.64b78","type":"switch","z":"f9a34738.f12c28","name":"10TF Translate","property":"exportableresults.Reading","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":4240,"y":1520,"wires":[["eb240427.c758e8","72c499c6.a8c2d8"],["3ab9ea63.108fb6","72c499c6.a8c2d8"]],"outputLabels":["True","False"]},{"id":"eb240427.c758e8","type":"change","z":"f9a34738.f12c28","name":"Value True","rules":[{"t":"set","p":"exportableresults.Reading","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":4410,"y":1500,"wires":[["e3a1e105.d6ea3","72c499c6.a8c2d8"]]},{"id":"3ab9ea63.108fb6","type":"change","z":"f9a34738.f12c28","name":"Value False","rules":[{"t":"set","p":"exportableresults.Reading","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":4410,"y":1540,"wires":[["e3a1e105.d6ea3","72c499c6.a8c2d8"]]},{"id":"d3284005.9864c","type":"change","z":"f9a34738.f12c28","name":"CtoF Translate","rules":[{"t":"set","p":"exportableresults.Measure","pt":"msg","to":"msg.exportableresults.Measure&\"F\"\t","tot":"jsonata"},{"t":"set","p":"exportableresults.Reading","pt":"msg","to":"payload*9/5+32","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":4240,"y":1580,"wires":[["71b44bcb.1f9b14"]]},{"id":"ee20520f.74f8d","type":"switch","z":"f9a34738.f12c28","name":"CurrentHeatingCoolingState Translate","property":"exportableresults.Reading","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"str"},{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"str"},{"t":"eq","v":"3","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":4310,"y":1680,"wires":[["fdaaa181.47afc"],["67eed2e9.60625c"],["4d3b53e.2a431ac"],["a31d9180.9e72"]],"outputLabels":["off","heat","cool","heat-cool"]},{"id":"fdaaa181.47afc","type":"change","z":"f9a34738.f12c28","name":"Value Off","rules":[{"t":"set","p":"exportableresults.Reading","pt":"msg","to":"off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":4560,"y":1620,"wires":[["68d5dbb2.dba074"]]},{"id":"67eed2e9.60625c","type":"change","z":"f9a34738.f12c28","name":"Value Heat","rules":[{"t":"set","p":"exportableresults.Reading","pt":"msg","to":"heat","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":4570,"y":1660,"wires":[["68d5dbb2.dba074"]]},{"id":"4d3b53e.2a431ac","type":"change","z":"f9a34738.f12c28","name":"Value Cool","rules":[{"t":"set","p":"exportableresults.Reading","pt":"msg","to":"cool","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":4570,"y":1700,"wires":[["68d5dbb2.dba074"]]},{"id":"a31d9180.9e72","type":"change","z":"f9a34738.f12c28","name":"Value Heat-Cool","rules":[{"t":"set","p":"exportableresults.Reading","pt":"msg","to":"heat-cool","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":4580,"y":1740,"wires":[["68d5dbb2.dba074"]]},{"id":"6741544.6e504ac","type":"switch","z":"f9a34738.f12c28","name":"","property":"TranslationType","propertyType":"msg","rules":[{"t":"eq","v":"10TF","vt":"str"},{"t":"eq","v":"C2F","vt":"str"},{"t":"eq","v":"NestThMap","vt":"str"},{"t":"eq","v":"012CF","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":4030,"y":1620,"wires":[["e0b84f64.64b78"],["d3284005.9864c"],["ee20520f.74f8d"],["fffe6cb5.2f771"]],"outputLabels":["1 or 0 to True or False Map","Celcius to Fahrenheit Conversion","Nest Thermostat Map","Celcius or Fahrenheit Map"]},{"id":"fffe6cb5.2f771","type":"switch","z":"f9a34738.f12c28","name":"10TF Translate","property":"exportableresults.Reading","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":4240,"y":1800,"wires":[["591b5341.c9913c"],["82554e49.ddf06"]],"outputLabels":["True","False"]},{"id":"591b5341.c9913c","type":"change","z":"f9a34738.f12c28","name":"Value Fahrenheit","rules":[{"t":"set","p":"exportableresults.Reading","pt":"msg","to":"Fahrenheit","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":4430,"y":1780,"wires":[["d644fcba.8ac25"]]},{"id":"82554e49.ddf06","type":"change","z":"f9a34738.f12c28","name":"Value Celcius","rules":[{"t":"set","p":"exportableresults.Reading","pt":"msg","to":"Celcius","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":4420,"y":1820,"wires":[["d644fcba.8ac25"]]},{"id":"cfdc8e29.5620b","type":"switch","z":"f9a34738.f12c28","name":"Translation Needed?","property":"TranslationType","propertyType":"msg","rules":[{"t":"neq","v":"null","vt":"str"},{"t":"eq","v":"null","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":3660,"y":1640,"wires":[["6741544.6e504ac"],["aca44224.bdd06"]]},{"id":"332acefe.132602","type":"change","z":"f9a34738.f12c28","name":"","rules":[{"t":"delete","p":"searchErrorCount","pt":"msg"},{"t":"delete","p":"error","pt":"msg"},{"t":"delete","p":"TranslationType","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2020,"y":1820,"wires":[["5256595d.ee7998","e81c4326.11658"]]},{"id":"5256595d.ee7998","type":"debug","z":"f9a34738.f12c28","name":"4 After change","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2220,"y":1860,"wires":[]},{"id":"e3a1e105.d6ea3","type":"link out","z":"f9a34738.f12c28","name":"Got Potential Translation Update","links":["37f6ffdb.039e"],"x":4630,"y":1520,"wires":[],"l":true},{"id":"68d5dbb2.dba074","type":"link out","z":"f9a34738.f12c28","name":"Got Potential Translation Update","links":["37f6ffdb.039e"],"x":4850,"y":1680,"wires":[],"l":true},{"id":"d644fcba.8ac25","type":"link out","z":"f9a34738.f12c28","name":"Got Potential Translation Update","links":["37f6ffdb.039e"],"x":4670,"y":1800,"wires":[],"l":true},{"id":"aca44224.bdd06","type":"link out","z":"f9a34738.f12c28","name":"Got Potential Translation Update","links":["37f6ffdb.039e"],"x":3930,"y":1680,"wires":[],"l":true},{"id":"e81c4326.11658","type":"function","z":"f9a34738.f12c28","name":"Format for InfluxDB & MQTT","func":"//Ref. TMS-000002\n/* This function takes input from a hubitat device node and data stored in config node which holds details about the device\n * and creates an properly formated object to be sent to InfluxDB node via output 1 which will in turn write to the InfluxDB\n * It also formats an MQTT topic and the data sending that to output 2 which in turn can be used by an MQTT node to send to \n * MQTT\n * \n * \n */\n//gather the name of the device which had a reading that triggered the flow to be included as a tag (index) sent to InfluxDB\n//note: this is the hubitat device ID\nvar deviceID = msg.exportableresults.DeviceID;\n//node.warn(\"11 \"+ deviceID)\n//gather the name of the measurement that was sent by the device to be included as a tag (index) for invalid measurements and as the fieldname for valid measurements sent to InfluxDB\nvar typeOfMeasurement = msg.exportableresults.Measure;\n\n//gather the actual measurement value that was sent by the device to be included as the data for the field (when the measurement is valid) sent to InfluxDB\nvar theData = msg.exportableresults.Reading;\n//initialize the measurements object\nvar measurementsObj = {};\n\n//initialize the tags (indices) object\nvar tagsObj = {};\n\n//create the object that will later be used to combine the measurementsObj and tagsObj\nvar combinedObj;\n\n//create the boolean that will be used to hold the evaluation of whether the measurement is valid or not\nvar validMeasurement;\n\n//create the booleans that will be used to hold whether the reason a measurement is invalid is because it is a non-standard type or\n// if the type of the measurement and the type passed from the device differ or\n// if the value (data) is null\nvar nonStandardType = false;\nvar measurementTypeMismatch = false;\nvar nullData = false;\n\n//create a boolean to keep track of if there are any tags (indices) that should be sent to the InfluxDB \n// it starts false but if any tag is valid then will become true. See below for what to send to InfluxDB based on valid measures and tags\nvar validTag = false;\nif (msg.exportableresults.hasOwnProperty('dataType'))\n{\n    if ((typeof theData == msg.exportableresults.dataType.toLowerCase()) || (msg.exportableresults.dataType == 'ENUM') || (theData === null))\n    {\n        if (typeof theData == 'number')\n        {\n            node.status({ fill: \"red\", shape: \"ring\", text: \"matched number\" });\n            if (!theData.isNaN)\n            {\n                validMeasurement = true;\n            }\n        }\n        else if (typeof theData == 'string')\n        {\n            node.status({ fill: \"red\", shape: \"ring\", text: \"matched string\" });\n            if (theData.length >= 0)\n            {\n                validMeasurement = true;\n            }\n        } \n        else if (typeof theData == 'boolean')\n        {\n            node.status({ fill: \"red\", shape: \"ring\", text: \"matched boolean\" });\n            validMeasurement = true;\n        }\n        else if (msg.exportableresults.dataType == 'ENUM')\n        { //This is checking to make sure the value matches one of the values in the ENUM from the device \n            node.status({ fill: \"red\", shape: \"ring\", text: msg.exportableresults.dataType + \" matched ENUM\" });\n            msg.exportableresults.values.forEach(element => {\n                if (flow.get(deviceID + element) == theData)\n                {\n                    validMeasurement = true;\n                }\n            })\n        }\n        else if (theData === null)\n        {\n            node.status({ fill: \"red\", shape: \"ring\", text: \"matched null data\" });\n            nullData = true;\n        }\n        else\n        {\n            node.status({ fill: \"red\", shape: \"ring\", text: \"matched nonstandardtype\" });\n            nonStandardType = true;\n        }\n    } //if ((typeof theData == msg.exportableresults.dataType.toLowerCase()) || (msg.exportableresults.dataType == 'ENUM') || (theData === null))\n    else\n    {\n        node.status({ fill: \"red\", shape: \"ring\", text: \"measurement type mismatch\" });\n        measurementTypeMismatch = true;\n    } //else  if ((typeof theData == msg.exportableresults.dataType.toLowerCase()) || (msg.exportableresults.dataType == 'ENUM') || (theData === null))\n}//if(msg.exportableresults.hasOwnProperty('dataType'))\nelse\n{\n    validMeasurement = true;\n}// else      if(msg.exportableresults.hasOwnProperty('dataType')) else\n\n//scanning all of the tags from the config node and creating a tag for that item if the entry on the config node has info\ncommonTags = [\"House\", \"Floor\", \"Room\", \"Location\", \"DeviceType\", \"Manufacturer\", \"AccessProtocol\", \"PhysicalVirtualType\", \"PhysicalDigitalRegular\"]\nfor (innerIndex = 0; innerIndex < commonTags.length; innerIndex++)\n{\n    if (msg.exportableresults.hasOwnProperty(commonTags[innerIndex]))\n    {\n        tagsObj[commonTags[innerIndex]] = msg.exportableresults[commonTags[innerIndex]]\n    } //if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex]) else\n} //for (innerIndex = 0; innerIndex < searchKeyIndices.length; innerIndex++)\n\n//Based on whether or not the measurement is \"valid\" it either adds the device id to the tags or it goes to the else portion\nif (validMeasurement) {\n    measurementsObj[typeOfMeasurement] = theData;\n    //node.warn(\"94 length\")\n    if (deviceID.length > 0) {\n        tagsObj[\"DeviceID\"] = deviceID;\n        validTag = true;\n    }\n    if (validTag) {\n        combinedObj = [measurementsObj, tagsObj]\n    } else {\n        //skip tags if none would be valid\n        combinedObj = [measurementsObj]\n    }\n} else {\n\n    //if the measeurement was not \"valid\", then it puts in a Generic measurement of true and tag it as either Non-Standard Type of Measurement Type Mismatch\n    if (nonStandardType) {\n        measurementsObj[\"Generic\"] = true\n        tagsObj[\"ReasonGeneric\"] = \"Non-Standard Type\"\n        tagsObj[\"Measure\"] = typeOfMeasurement\n    }\n    //node.warn(\"113 length\")\n    if (deviceID.length > 0) {\n        tagsObj[\"DeviceID\"] = deviceID\n        validTag = true\n    }\n    if (measurementTypeMismatch) {\n        measurementsObj[\"Generic\"] = true\n        tagsObj[\"ReasonGeneric\"] = \"Measurement Type Mismatch\"\n        tagsObj[\"Measure\"] = typeOfMeasurement\n    }\n    //node.warn(\"123 length\")\n    if (deviceID.length > 0) {\n        tagsObj[\"DeviceID\"] = deviceID\n        validTag = true\n    }\n    combinedObj = [measurementsObj, tagsObj]\n}\n\n//put the object into the payload\nmsg.payload = combinedObj;\n\n//build the status to be shown on the status of the subnode\nmsg.status = msg.exportableresults.DeviceName + \": \" + typeOfMeasurement + \": \" + theData;\n\n/* MQTT section \n * \n * \n * \n */\n//create the placeholder object\nvar msg2 = {}\n//add the MQTT topic\nmsg2.topic = msg.exportableresults.MQTTname +\"/\"+msg.exportableresults.DeviceName+\"/\"+ msg.exportableresults.Measure\n//add the data to be recorded to MQTT\nmsg2.payload = theData\n\n\n\n//send the created combinedObj downstream (to the InfluxDB node), but only if the measurement is not null\nif (!nullData) {\n    return [msg, msg2]\n}\ndebugger\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////\n","outputs":2,"noerr":0,"x":2260,"y":1820,"wires":[["6d73c854.2a6298","1565ca4c.3889e6","59e8cc23.21b694"],["5db0edb2.6097e4","9dac4fa2.a532e"]]},{"id":"6d73c854.2a6298","type":"debug","z":"f9a34738.f12c28","name":"4.1 Output 1","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2530,"y":1740,"wires":[]},{"id":"5db0edb2.6097e4","type":"debug","z":"f9a34738.f12c28","name":"4.2 Output 2","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2530,"y":1920,"wires":[]},{"id":"1565ca4c.3889e6","type":"influxdb out","z":"f9a34738.f12c28","influxdb":"39dac4b7.0333ac","name":"","measurement":"Smarthome","precision":"","retentionPolicy":"","x":2650,"y":1780,"wires":[]},{"id":"59e8cc23.21b694","type":"change","z":"f9a34738.f12c28","name":"Move Status to Payload for Consumption by Status Node","rules":[{"t":"set","p":"payload","pt":"msg","to":"status","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2670,"y":1820,"wires":[["4ec4a915.b1cc78"]]},{"id":"9dac4fa2.a532e","type":"mqtt out","z":"f9a34738.f12c28","name":"Write reading to MQTT","topic":"","qos":"1","retain":"true","broker":"a5bf81ee.27852","x":2560,"y":1860,"wires":[]},{"id":"4ec4a915.b1cc78","type":"debug","z":"f9a34738.f12c28","name":"4.3 Output  For Status node","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":3040,"y":1820,"wires":[]},{"id":"59213915.3a4ac8","type":"debug","z":"f9a34738.f12c28","name":"flow 1 temp no find","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2650,"y":1220,"wires":[]},{"id":"9ced7b16.74d468","type":"debug","z":"f9a34738.f12c28","name":"flow 1 Need to update the Devices Table","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2720,"y":1300,"wires":[]},{"id":"1bdba9bd.133746","type":"function","z":"f9a34738.f12c28","name":"Give Descriptive name to this function node","func":"if (msg.keyvalues.Measurement.includes(\"/\"))\n{msg.keyvalues.Measurement = msg.keyvalues.Measurement.substring(msg.keyvalues.Measurement.lastIndexOf(\"/\") + 1);\n}\nreturn msg;","outputs":1,"noerr":0,"x":2470,"y":1480,"wires":[["93cb2b85.b51968","c63c54d9.489498"]]},{"id":"b160c06c.fb41f","type":"debug","z":"f9a34738.f12c28","name":"before","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2310,"y":1320,"wires":[]},{"id":"c63c54d9.489498","type":"debug","z":"f9a34738.f12c28","name":"after","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2390,"y":1380,"wires":[]},{"id":"711cd60d.0fd568","type":"debug","z":"f9a34738.f12c28","name":"2 Need to update MeasurementTranslations Table","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":3670,"y":1560,"wires":[]},{"id":"e0d5c4b0.096618","type":"debug","z":"f9a34738.f12c28","name":"flow 3 output","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1930,"y":1760,"wires":[]},{"id":"72c499c6.a8c2d8","type":"debug","z":"f9a34738.f12c28","name":"flow 3 SS settings","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":4010,"y":1480,"wires":[]},{"id":"ab6529c.1531ed8","type":"function","z":"d663491c.25a828","name":"Determine Source For Gsheet lookup properties.","func":"//Read subflow input variables\nif (env.get(\"OverrideEnvVariables\"))\n{\n    //Put inputs and read values into msg properties to be visible downstream\n    msg.sheet = msg.SpreadsheetID;\n    msg.tab = msg.Tab;\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    msg.topic = msg.targetrange\n    delete msg.Tab\n    delete msg.SpreadsheetID\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\n}\nelse if (msg.IgnoreEnvVar)\n{\n    //Put inputs and read values into msg properties to be visible downstream\n    msg.sheet = msg.SpreadsheetID;\n    msg.tab = msg.Tab;\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    msg.topic = msg.targetrange\n    delete msg.Tab\n    delete msg.SpreadsheetID\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\n}\nelse\n{\n    var ColStart = env.get(\"ColStart\");\n    var ColEnd = env.get(\"ColEnd\");\n    var FirstRow = env.get(\"MinRow\");\n    var LastRow = env.get(\"MaxRow\");\n    //Put inputs and read values into msg properties to be visible downstream\n    msg.sheet = env.get(\"Spreadsheet ID\");\n    msg.tab = env.get(\"TabName\");\n    msg.cellstart = ColStart + FirstRow\n    msg.cellend = ColEnd + LastRow\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    msg.topic = msg.targetrange\n    delete msg.Tab\n    delete msg.SpreadsheetID\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\n    //These 2 are needed later to calculate the last populate and first empty rows and columns\n    msg.ColStart = ColStart\n    msg.MinRow = FirstRow\n}\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":20,"wires":[["d5c913da.267c4","28b6a2fb.e1756e"]],"info":"This node sets up the inputs to the GSheet node.\nThe outputs that make up those inputs are:\n - msg.sheet -the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n - msg.topic - the combination of spreadsheet tab and cell range\n## Note\nThere are 2 very similar booleans evaluated by this node. They are:\n * **OverrideEnvVariables** - This one looks at the environment variable that was set in the flow triggering the subflow\n * **msg.IgnoreEnvVar** - This one is allows the logic to be driven by a message object property and thus can be set at runtime or earlier in the flow based on upstream logic\n\nFirst it checks the boolean value of the **OverrideEnvVariables** environment variable. This is by default false. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming the first was false, it checks the boolean value of the **msg.IgnoreEnvVar** value. This will evaluated as false if not populated, so sending false is unnecessary. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming both are false, then it can build the outputs based on the subflows environment variables. These can either be those set in the calling flow or they may be the default ones built into the subflow.\n\nRegardless of the method used to build the output, the node also removes the input message properties.\n\n\n\nmsg.IgnoreEnvVar"},{"id":"d5c913da.267c4","type":"GSheet","z":"d663491c.25a828","creds":"adb4e9b8.8beee8","method":"get","action":"","sheet":"","cells":"","name":"Read Input from GSheet","x":610,"y":20,"wires":[["f99ba293.afaa9"]],"info":"Use the GSheet node to get the a set of rows from a google spreadsheet.\n\n# **Inputs**\n### **creds**\nThis is the name on the gauth configuration node. How to get the details is beyond the scope of what I am going to put into an individual node instance. Some details are at [node-red-contrib-google-sheets](https://flows.nodered.org/node/node-red-contrib-google-sheets)\n### **Method**\nIn this case using the get cells method to read a set of data.\n### **SpreadsheetID**\nUnused as the spreadsheet ID is passed in as part of the input msg, but if needed it would be the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n### **Cells**\nUnused as the requested cells are passed in as part of the input msg, but if it was being manually built for a static data source the format is made of of 3 parts with specific seperators:\n * **[Sheetname]** like Sheet1\n * **[upper left corner cell address]** like A1\n * **[lower right corner cell address]** like B2\n\nThe format is **[Sheetname]**!**[upper left corner cell address]**:**[lower right corner cell address]** giving an input like **Sheet1!A1:B2**\n "},{"id":"c158a83c.8db538","type":"comment","z":"d663491c.25a828","name":"Error","info":"","x":1090,"y":20,"wires":[]},{"id":"d1e8278b.2143f8","type":"comment","z":"d663491c.25a828","name":"Last Populated Row","info":"","x":1130,"y":100,"wires":[]},{"id":"a4266569.899ef8","type":"function","z":"d663491c.25a828","name":"Prepare Output Parts","func":"/*\n * Row response calculations\n */\nmsg.LastPopulatedRow = msg.payload.length + msg.MinRow - 1\nmsg.FirstEmptyRow = msg.LastPopulatedRow + 1\n\n/*\n *Column response calculation variables\n */\nlet colCount = 1 //number of columns wide from the data retrieved. This will eventually be replace by logic that loops through array find the max width for any given row\nlet index\nlet sheetdata = msg.payload //this is the data that is returned from Google that will then be examined\nlet fCol = msg.ColStart\nlet fColTotal = 0 //to hold the column number\nlet nCol = \"\"   //nCol is new column\nlet lCol = \"\"   //lCol is last column in the range (to be populated from the actual Gsheet calls data)\n\nfCol = fCol.toUpperCase()\n/*\n * validate fCol (done)\n */\nlet validStartCol = false\nvalidStartCol = ((fCol.length == 1) ||\n                ((fCol.substr(0, 1).charCodeAt(0) - 64) < 9) ||\n                (((fCol.substr(0, 1).charCodeAt(0) - 64) == 9) && ((fCol.substr(1, 1).charCodeAt(0) - 64) <= 22)))\n/*\n *Column response calculations\n */\n//look at each row that is an array\nfor (index = 0; index < sheetdata.length; index++)\n{\n    if (Array.isArray(sheetdata[index]))\n    {\n        // when the rows width is greater than any of the previous rows set the column count to the new largest width\n        colCount = Math.max(colCount, sheetdata[index].length)\n    } //if (Array.isArray(sheetdata[index]))\n}  //for (index = 0; index < sheetdata.length; index++)\nswitch (fCol.length) {\n    case 1:\n        fColTotal = (fCol.substr(0, 1).charCodeAt(0) - 64)\n        fColTotal += colCount - 1\n        break\n    case 2:\n        fColTotal = (fCol.substr(1, 1).charCodeAt(0) - 64) + 26 * (fCol.substr(0, 1).charCodeAt(0) - 64)\n        fColTotal += colCount - 1\n        break\n    default:\n        fColTotal = -1\n}\n//Last Populated Column and First Empty Column calculation\nif ((fColTotal <= 25) && (fColTotal >= 1)) {\n    lCol = String.fromCharCode(fColTotal+64)\n    nCol = String.fromCharCode(fColTotal+65)\n} else if (fColTotal == 26) {\n    lCol = \"Z\"\n    nCol = \"AA\"\n} else if (fColTotal >= 27) {\n    lCol = String.fromCharCode((Math.floor(fColTotal / 26)) + 64) + String.fromCharCode((fColTotal % 26) + 64)\n    nCol = String.fromCharCode((Math.floor(fColTotal / 26)) + 64) + String.fromCharCode((fColTotal % 26) + 65)\n} else if (fColTotal == -1) {\n    lCol = \"Error\"\n    nCol = \"Error\"\n    //Probably worth putting real error here, but deferred\n} else if (fColTotal == 256) {\n    lCol = \"IV\"\n    nCol = \"None\"\n}\nmsg.LastPopulatedCol = lCol\nmsg.FirstEmptyCol = nCol\nmsg.SpreadsheetArray = msg.payload\nreturn msg;","outputs":1,"noerr":0,"x":560,"y":540,"wires":[["4d35b8ed.52e478","33c4567d.d9c6ca","1aa4aac9.9051a5","b6ba033f.ff1c7","c4235ad0.b726a8","c4d8e16c.be2b1"]],"info":"Takes an input from the Gsheet node and calculates a variety of details about the spreadsheet info.\n### **Output**\nmsg.LastPopulatedRow\nmsg.FirstEmptyRow\nmsg.LastPopulatedCol\nmsg.FirstEmptyCol\nmsg.SpreadsheetArray\n"},{"id":"daf68b5e.96f058","type":"comment","z":"d663491c.25a828","name":"First Empty Row","info":"","x":1120,"y":180,"wires":[]},{"id":"aecc8ba0.89e908","type":"comment","z":"d663491c.25a828","name":"Last Populated Column","info":"","x":1140,"y":260,"wires":[]},{"id":"6bbd303f.a258b","type":"comment","z":"d663491c.25a828","name":"First Empty Column","info":"","x":1130,"y":340,"wires":[]},{"id":"e199a049.ef594","type":"comment","z":"d663491c.25a828","name":"Spreadsheet Array","info":"","x":1130,"y":420,"wires":[]},{"id":"7b1285e2.f18eec","type":"comment","z":"d663491c.25a828","name":"Full Data","info":"","x":1100,"y":500,"wires":[]},{"id":"40772db6.b81354","type":"comment","z":"d663491c.25a828","name":"Full Data with Inputs","info":"","x":1130,"y":580,"wires":[]},{"id":"4d35b8ed.52e478","type":"change","z":"d663491c.25a828","name":"Leave Outputs","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":540,"wires":[[]],"info":"Deletes a variety of message properties, but leaves all of them that were calculated about the Gsheet nodes results to be returned on the designated subflow output."},{"id":"33c4567d.d9c6ca","type":"change","z":"d663491c.25a828","name":"Leave Last Populated Row","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"LastPopulatedRow","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":140,"wires":[[]],"info":"Copies msg.theLastPopulatedRow into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"1aa4aac9.9051a5","type":"change","z":"d663491c.25a828","name":"Leave First Empty Row","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"FirstEmptyRow","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":870,"y":220,"wires":[[]],"info":"Copies msg.FirstEmptyRow into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"b6ba033f.ff1c7","type":"change","z":"d663491c.25a828","name":"Leave Last Populated Column","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"LastPopulatedCol","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":890,"y":300,"wires":[[]],"info":"Copies msg.LastPopulatedCol into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"c4235ad0.b726a8","type":"change","z":"d663491c.25a828","name":"Leave First Empty Column","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"FirstEmptyCol","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":380,"wires":[[]],"info":"Copies msg.FirstEmptyCol into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"c4d8e16c.be2b1","type":"change","z":"d663491c.25a828","name":"Leave Spreadsheet Array","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"SpreadsheetArray","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":870,"y":460,"wires":[[]],"info":"Copies msg.SpreadsheetArray into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"91eb7f22.8f9e2","type":"trigger","z":"d663491c.25a828","name":"Watchdog","op1":"","op2":"timeout","op1type":"nul","op2type":"str","duration":"10","extend":true,"units":"s","reset":"","bytopic":"all","outputs":1,"x":600,"y":140,"wires":[["b6ba033f.ff1c7","33c4567d.d9c6ca","c4235ad0.b726a8","c4d8e16c.be2b1","4d35b8ed.52e478"]],"info":"This trigger node works as a watchdog to see if the request to see if the read of the Google Sheet that was triggered on the other branch is successful. If it is succeful, then it will receive a reset message (msg.reset) from the Reset Watchdog node. If, however, 10 seconds elapse without receiving the reset message, this node sends a timeout message (msg.timeout)."},{"id":"28b6a2fb.e1756e","type":"change","z":"d663491c.25a828","name":"","rules":[{"t":"set","p":"timeout","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":120,"wires":[["91eb7f22.8f9e2"]],"info":"Labels what the initial input to the watchdog trigger node is."},{"id":"fdc51889.336ec8","type":"change","z":"d663491c.25a828","name":"","rules":[{"t":"delete","p":"reset","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":350,"y":540,"wires":[["a4266569.899ef8"]],"info":"Removes msg.reset that was only intended for the watchdog trigger node."},{"id":"4d8a4132.a5994","type":"catch","z":"d663491c.25a828","name":"Catch and Relay Errors","scope":null,"uncaught":false,"x":860,"y":60,"wires":[[]],"info":"Passes any caught error to the error subflows intentially built error output. By intentionally built I mean I created one and labelled it as such. This is not there by default."},{"id":"f99ba293.afaa9","type":"change","z":"d663491c.25a828","name":"Reset Watchdog","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":140,"y":140,"wires":[["91eb7f22.8f9e2","fdc51889.336ec8"]],"info":"Sends the reset message to the watchdog triger node when there is output from the Gsheet node."},{"id":"a63fda24.b68788","type":"function","z":"cddaccaf.e0a04","name":"Db Put the payload into a global variable named after the content of msg.globalsource","func":"global.set(msg.globalsource, msg.payload)\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":389,"wires":[["1e91ae7e.712612"]],"info":"# **What** #\nThis is a simple function node that stores the msg.payload into a global variable. This is done in a function node, however, because the name of that global variable is passed into the function as a the value of msg.globalsource. \n\n## **Why**\nNormally this would be done in a change node, but change nodes could not as of May 2020 take a msg object component as the name of the global variable to be set."},{"id":"8669bfb4.15683","type":"subflow:d663491c.25a828","z":"cddaccaf.e0a04","name":"","env":[],"x":580,"y":189,"wires":[[],[],[],[],[],[],["a63fda24.b68788"],[]],"info":"This subflow shows information in the environment variables. These are good for testing purposes, but it is noteworthy that the override boolean is false. Unless that boolean is changed, they have no impact."},{"id":"1e91ae7e.712612","type":"function","z":"cddaccaf.e0a04","name":"Db Use input to lookup info","func":"//Ref. TMS-000001\n\n//if(msg.exportableresults.DeviceName !== \"Switch_Ikea\") {return}\n\n\n\n//1 Get must have items: searchKeys, searchValues, searchResultKeys, cachedSearch, cacheTime\n\nlet searchKeys = Object.keys(msg.keyvalues)\nlet searchValues = Object.values(msg.keyvalues)\nlet searchResultKeys = Object.keys(msg.searchfor)\nlet cachedSearch = global.get(\"LastSearch\")\nlet cacheTime = new Date().getTime()\n//2 create working variables searchKeyIndices, searchResultKeysIndices, index, cacheKey\nlet searchResultKeysIndices = []\nlet index\nlet cacheObject\n//3 build the cache key which is essentially the concatenation of key+value+nextkey+nextvalue+.....etc\ncacheObject = BuildCacheObject(searchKeys, searchValues, searchResultKeys)\n//4\n/*\n * 4.1 t/f cached result is usable\n    *  4.1.true then t/f does it meet criteria\n        * 4.1.true.true\ttrue msg.searchfor = cachedSearch.searchfor\n        * 4.1.true.false do the common lookup\n    *   4.1.false  do the common lookup\n    */\n//4.1\nif (cachedSearch !== undefined)\n{\n    //4.1.true\n    if ((cachedSearch.query == cacheObject.query) && (cachedSearch.time > cacheObject.time - 5000))\n    {\n        //4.1.true.true\n        msg.searchfor = cachedSearch.searchfor\n        return [msg, null, null]\n    } //if ((cachedSearch.query == cacheObject.query) && (cachedSearch.time > cacheObject.time - 5000))\n    //4.1.true.false\n    else\n    {\n        //4.1.true.false\n        lookupResults = CommonLookup(msg, searchKeys, searchResultKeys, searchValues, global.get(msg.globalsource), cacheObject)\n        //return results from the node on 1 of the 3 outputs\n        if (lookupResults[0] !== null)\n        {\n            return [lookupResults[0], null, null]\n        } //if (lookupResults[0] !== null)\n        else if (lookupResults[1] !== null)\n        {\n            return [null, lookupResults[1], null]\n        } //else if (lookupResults[1] !== null)\n        else\n        {\n            return [null, null, lookupResults[2]]\n        } //else if (lookupResults[1] !== null) else\n    } //if ((cachedSearch.query == cacheObject.query) && (cachedSearch.time > cacheObject.time - 5000)) else\n} //if (cachedSearch !== undefined)\n//4.1.false\nelse\n{\n    //4.1.false\n    lookupResults = CommonLookup(msg, searchKeys, searchResultKeys, searchValues, global.get(msg.globalsource), cacheObject)\n    //return results from the node on 1 of the 3 outputs\n    if (lookupResults[0] !== null)\n    {\n        return [lookupResults[0], null, null]\n    } //if (lookupResults[0] !== null)\n    else if (lookupResults[1] !== null)\n    {\n        return [null, lookupResults[1], null]\n    } //else if (lookupResults[1] !== null)\n    else\n    {\n        return [null, null, lookupResults[2]]\n    } //else if (lookupResults[1] !== null) else\n} //if (cachedSearch !== undefined) else\nreturn\n\nfunction BuildCacheObject(searchKeysArray, SearchValuesArray, SearchResultKeysArray) {\n    //3 build the cache key which is essentially the concatenation of key+value+nextkey+nextvalue+.....etc\n    let newCacheKey =\"\"\n    for (index = 0; index < searchKeysArray.length; index++)\n    {\n        newCacheKey = newCacheKey + searchKeysArray[index] + SearchValuesArray[index]\n    } //for (index = 0; index < searchKeysArray.length; index++)\n    //add all fields that will be looked for into the cache key\n    for (index = 0; index < SearchResultKeysArray.length; index++)\n    {\n        newCacheKey = newCacheKey + SearchResultKeysArray[index]\n    } //for (index = 0; index < SearchResultKeysArray.length; index++)\n    //combine the cache key and the cache time into a single object that can be compared with the cached last search\n    let createdCacheObject = \n    {\n        query: newCacheKey,\n        time: cacheTime\n    }\n    return createdCacheObject\n}\nfunction CommonLookup(workingMsg, keysForSearchColumn, keysForResultColumn, valuesSearchedFor, requestedDataTable, passedCacheObject) {\n    let searchKeyIndices = []\n    let searchResultKeysIndices = []\n    let outerIndex\n    let innerLoopCounter\n    let innerIndex\n    let index\n    if (requestedDataTable !== undefined)\n    {\n        // iterate through all search keys.\n        //outer index is the place along the array of search keys\n        for (outerIndex = 0; outerIndex < keysForSearchColumn.length; outerIndex++)\n        {\n            //inner index is the place along the first row of data\n            //The innerLoopCounter must be reset each time a new key is being looked for\n            innerLoopCounter = 0\n            for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n            {\n                //these 2 loops will compare every entry in the top row of the data table to every entry in the array of search keys,\n                if (requestedDataTable[0][innerIndex] == keysForSearchColumn[outerIndex])\n                {\n                    //when they match push the column number on to the array that has just indices for the search keys\n                    searchKeyIndices.push(innerIndex)\n                    //break is used to stop comparing as once the column has been found the remaining aren't relevant\n                    //////////////////////////////////////////////////////////////////////////break may be a problem. Maybe swap inner and outer arrays and then do some if then about getting through the whole data headers without finding. Right now it only looks for 1 failure\n                    break\n                } //if (requestedDataTable[0][innerIndex] == keysForSearchColumn[outerIndex])\n                else\n                {\n                    //when they don't match, then this means there is a search key that does not match any header.\n                    //When properly configured this should not happen, but proper configuration cannot be guaranteed\n                    //this is accumulating how many times the search key did not match one of the data table headers\n                    innerLoopCounter++\n                    //Error messaging should only happen if the search key has been compared with all of the headers\n                    //requestedDataTable[0].length gives the total number of data headers (columns of the spreadsheet)\n                    if (requestedDataTable[0].length == innerLoopCounter)\n                    {\n                        //populate error \n                        //put some details on this configuration into the msg to be output\n                        workingMsg.error = \"Key with value \\\"\" + keysForSearchColumn[outerIndex] + \"\\\" not found amongst the \" + (requestedDataTable[0].length + 1) + \" entries, which include \" + requestedDataTable[0]\n                        //either create and populate the error count at 1 or increment it if it already exists\n                        if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n                        {\n                                workingMsg.searchErrorCount++\n                        }\n                        else\n                        {\n                            workingMsg.searchErrorCount = 1\n                        }\n                        //this retry is in case the column was added to the google sheet since it was last loaded into node red\n                        if (workingMsg.searchErrorCount > 1)\n                        {\n                            //return the error on the bottom because with a count of 2 that means reloading has already been tried\n                            return [null, null, workingMsg]\n                        }\n                        else\n                        {\n                            //return the error on the middle there is an error output,\n                            return [null, workingMsg, null]\n                        }\n                    } //if (requestedDataTable[0].length == innerLoopCounter)\n                } //if (requestedDataTable[0][innerIndex] == keysForSearchColumn[outerIndex]) else\n            } //for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n        } //for (outerIndex = 0; outerIndex < keysForSearchColumn.length; outerIndex++)\n        //if this point is reached, searchKeyIndices has been populated\n        // iterate through all search result keys.\n        //outer index is the place along the array of search keys \n        for (outerIndex = 0; outerIndex < keysForResultColumn.length; outerIndex++)\n        {\n            //inner index is the place along the first row of data\n            //The innerLoopCounter must be reset each time a new key is being looked for\n            innerLoopCounter = 0\n            for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n            {\n                //these 2 loops will compare every entry in the top row of the data table to every entry in the array of search keys,\n                if (requestedDataTable[0][innerIndex] == keysForResultColumn[outerIndex])\n                {\n                    //when they match push the column number on to the array that has just indices for the search keys\n                    searchResultKeysIndices.push(innerIndex)\n                    //break is used to stop comparing as once the column has been found the remaining aren't relevant\n                    break\n                } //if (requestedDataTable[0][innerIndex] == keysForResultColumn[outerIndex])\n                else\n                {\n                    //when they don't match, then this means there is a search key that does not match any header.\n                    //When properly configured this should not happen, but proper configuration cannot be guaranteed\n                    innerLoopCounter++\n                    //Error messaging should only happen if the search key has been compared with all of the headers\n                    //requestedDataTable[0].length gives the total number of data headers (columns of the spreadsheet)\n                    if (requestedDataTable[0].length == innerLoopCounter)\n                    {\n                        //populate error \n                        //put some details on this configuration into the msg to be output\n                        workingMsg.error = \"Key with value \\\"\" + keysForSearchColumn[outerIndex] + \"\\\" not found amongst the \" + (requestedDataTable[0].length + 1) + \" entries, which include \" + requestedDataTable[0]\n                        //either create and populate the error count at 1 or increment it if it already exists\n                        if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n                        {\n                            workingMsg.searchErrorCount++\n                        } //if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n                        else\n                        {\n                            workingMsg.searchErrorCount = 1\n                        } //if ( workingMsg.hasOwnProperty(\"searchErrorCount\")) else\n                        //this retry is in case the column was added to the google sheet since it was last loaded into node red\n                        if (workingMsg.searchErrorCount > 1)\n                        {\n                            //return the error on the bottom because with a count of 2 that means reloading has already been tried\n                            return [null, null, workingMsg]\n                        } //if (workingMsg.searchErrorCount > 1)\n                        else\n                        {\n                            //return the error on the middle there is an error output,\n                            return [null, workingMsg, null]\n                        } //if (workingMsg.searchErrorCount > 1) else\n                    } //if (requestedDataTable[0].length == innerLoopCounter)\n                } //if (requestedDataTable[0][innerIndex] == keysForResultColumn[outerIndex]) else\n            } //for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n        } //for (outerIndex = 0; outerIndex < keysForResultColumn.length; outerIndex++)\n        //if this point is reached, both searchKeyIndices and searchResultKeysIndices have been populated\n        //loop through all search keys, 1 index at a time and filter to a row that has the desired data in the desired column\n        let result = []\n        let pushable\n        pushable = false\n        for (outerIndex = 0; outerIndex < requestedDataTable.length; outerIndex++)\n        {\n            for (innerIndex = 0; innerIndex < searchKeyIndices.length; innerIndex++)\n            {\n                if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex])\n                {\n                    pushable = true\n                } //if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex])\n                else\n                {\n                    pushable = false\n                    break\n                } //if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex]) else\n            } //for (innerIndex = 0; innerIndex < searchKeyIndices.length; innerIndex++)\n            if (pushable)\n            {\n                result.push(requestedDataTable[outerIndex])\n            } //if (pushable)\n    \n    } //for (outerIndex = 0; outerIndex < requestedDataTable.length; outerIndex++)\n        //if this point is reached then there is a filtered table\n        //debugger\n        if (result.length === 0)\n        {\n            workingMsg.error = \"After filtering no data rows were left.\"\n            //either create and populate the error count at 1 or increment it if it already exists\n            if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n            {\n                workingMsg.searchErrorCount++\n            } //( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n            else\n            {\n                workingMsg.searchErrorCount = 1\n            } //( workingMsg.hasOwnProperty(\"searchErrorCount\")) else\n            //return the error on the middle there is an error output,\n            //this retry is in case the column was added to the google sheet since it was last loaded into node red\n            if (workingMsg.searchErrorCount > 1)\n            {\n                //return the error on the bottom because with a count of 2 that means reloading has already been tried\n                return [null, null, workingMsg]\n            } //if (workingMsg.searchErrorCount > 1)\n            else\n            {\n                //return the error on the middle there is an error output,\n                return [null, workingMsg, null]\n            } //if (workingMsg.searchErrorCount > 1) else\n        } //if (result.length === 0)\n        else if (result.length > 1)\n        {\n            //do the warning that multiple were found but will take the first\n            node.warn(\"Multiple rows were found that matched the search criteria. Results are from the first row that was found and matched.\")\n        } //else if (result.length > 1)\n        //look up the data\n        for (index = 0; index < searchResultKeysIndices.length; index++)\n        {\n            //workingMsg.searchfor.keysForSearchColumn[index] = result[0][searchResultKeysIndices]\n            // the almost working version\n            workingMsg.searchfor[keysForResultColumn[index]] = result[0][searchResultKeysIndices[index]]\n        } //for (index = 0; index < searchResultKeysIndices.length; index++)\n        //if this point is reached then work workingMsg contains complete info\n        //build and save the LastSearch obect\n        passedCacheObject.searchfor = workingMsg.searchfor\n        global.set(\"LastSearch\", passedCacheObject)\n        return [workingMsg, null, null]\n    } //if (requestedDataTable !== undefined)\n    else\n    {\n        //return on second output to trigger population of global that feeds datatable\n        //put some details on this configuration into the msg to be output\n        workingMsg.error = \"The data normally loaded from google sheet was not loaded.\"\n        //either create and populate the error count at 1 or increment it if it already exists\n        if (workingMsg.hasOwnProperty('searchErrorCount'))\n        {\n            workingMsg.searchErrorCount++\n        } //if (workingMsg.hasOwnProperty('searchErrorCount'))\n        else\n        {\n            workingMsg.searchErrorCount = 1\n        } //if (workingMsg.hasOwnProperty('searchErrorCount')) else\n        //return the error on the middle there is an error output,\n        //this retry is in case the column was added to the google sheet since it was last loaded into node red\n        if (workingMsg.searchErrorCount > 1)\n        {\n            //return the error on the bottom because with a count of 2 that means reloading has already been tried\n            return [null, null, workingMsg]\n        } //if (workingMsg.searchErrorCount > 1)\n        else\n        {\n            //return the error on the middle there is an error output,\n            return [null, workingMsg, null]\n        } //if (workingMsg.searchErrorCount > 1) else\n    } //if (requestedDataTable !== undefined) else\n}","outputs":3,"noerr":0,"x":240,"y":80,"wires":[[],["8669bfb4.15683"],[]],"outputLabels":["Value Found","Error but try reloading from data source","Error despite having tried to reload from data source"],"info":"# **Conceptual Explanation**\nThis node is designed to use a 2-D array of data loaded from a google sheeet to lookup desired data. The data is arrayed with the first row being column headers describing the data in those columns in subsequent rows.\n## **inputs**\n### globalsource \nThe name of the global variable holding the table of data\n### msg.keyvalues\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row.\n### msg.searchfor\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. The value enters the node empty.\n## **outputs**\n### Output1: Value Found \nThis ouput is used when the node has successfully identified the requested data. That data is placed into the value portions of the key value pairs that made up the msg.searchfor input\n### Output 2: Error but try reloading from data source\nThis output is used when either the global variable to contain the data table either does no exist or does not contain a row with all of the requested search criteria. Normally it is used to trigger loading the table from Google sheets under the expectation that either this is the first time a lookup has been tried an the data had not yet been cached in the global variable or potentially the data in the cache has become stale and reloading from the Google sheet will add a row that will match the requested search criteria.\n### Output 3: Error despite having tried to reload from data source\nThis output is used when either the global variable to contain the data table either does no exist or does not contain a row with all of the requested search criteria and at least 1 attempt has already been made to reload the global vairable cache. This is effectively a notification of non-recoverable lookup failure."},{"id":"99a43603.1f3328","type":"change","z":"cddaccaf.e0a04","name":"Devices table, 1 search key with variable input, 1 result","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"exportableresults.DeviceName","tot":"msg"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":980,"y":100,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value pulled from the **msg.exportableresults.DeviceName** object.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** column.\n"},{"id":"5b511db9.6e3bd4","type":"change","z":"cddaccaf.e0a04","name":"Devices table, 1 search key, 2 results","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"Motion_Ikea","tot":"str"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.Manufacturer","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":180,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value **\"Motion_Ikea\"**.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** and **\"Manufacturer\"** columns."},{"id":"5459312e.049ec","type":"change","z":"cddaccaf.e0a04","name":"Devices table, 1 search key, 1 result","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"Anyone Presence","tot":"str"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":60,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value **\"Anyone Presence\"**. Notice unlike some examples this includes a space in the value. This has no negative impact.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** column."},{"id":"cdd33185.e861d","type":"change","z":"cddaccaf.e0a04","name":"Devices table, 2 search keys, 1 results","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"Anyone Presence","tot":"str"},{"t":"set","p":"keyvalues.Manufacturer","pt":"msg","to":"homebridge-people-geofence","tot":"str"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":140,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value **\"Anyone Presence\"** and the **\"Manufacturer\"** column for the value **\"homebridge-people-geofence\"**.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** columns."},{"id":"c4351cbb.ba6ca","type":"comment","z":"cddaccaf.e0a04","name":"Examples of preformating the inputs","info":"","x":920,"y":20,"wires":[]},{"id":"946fff3b.7f3d8","type":"change","z":"cddaccaf.e0a04","name":"Spreadsheet Lookup Settings Example","rules":[{"t":"set","p":"IgnoreEnvVar ","pt":"msg","to":"true","tot":"bool"},{"t":"set","p":"SpreadsheetID","pt":"msg","to":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","tot":"str"},{"t":"set","p":"Tab","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"ColStart","pt":"msg","to":"A","tot":"str"},{"t":"set","p":"ColEnd","pt":"msg","to":"Z","tot":"str"},{"t":"set","p":"MinRow","pt":"msg","to":"1","tot":"str"},{"t":"set","p":"MaxRow","pt":"msg","to":"1000","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":260,"wires":[[]],"info":"## **inputs**\n### IgnoreEnvVar \nThis boolean needs to be true to tell that Read Spreadsheet For Details subflow that it should use the specs passed in the msg to determine what spreadsheet to read from and what portion of data to read from.\n### msg.SpreadsheetID\nThis is the very long string that identifies a specific google spreadsheet.\n### msg.Tab\nSpecifies the tab name that contains the data.\n### msg.ColStart\nSpecifies the leftmost column containing the desired data.\n### msg.ColEnd\nSpecifies the rightmost column containing the desired data. \n### msg.MinRow\nSpecifies the top row containing the desired data \n### msg.MaxRow\nSpecifies the bottom row containing the desired data "},{"id":"7484904a.4832f","type":"debug","z":"cddaccaf.e0a04","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":160,"y":240,"wires":[]},{"id":"aa70c695.8d4248","type":"comment","z":"cddaccaf.e0a04","name":"Maybe insert check of how long since last Google read and skip step","info":"","x":520,"y":140,"wires":[]},{"id":"9226bcdd.22d13","type":"hb-status","z":"ff6040a4.0af3a","name":"Downstairs Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestDownstairs Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":710,"y":1480,"wires":[["813e3d4b.f9652"]]},{"id":"1f1110a2.bc948f","type":"config","z":"ff6040a4.0af3a","name":"HB001 Anyone Presence","properties":[{"p":"HB001Floor","pt":"flow","to":"","tot":"str"},{"p":"HB001Location","pt":"flow","to":"","tot":"str"},{"p":"HB001Room","pt":"flow","to":"","tot":"str"},{"p":"HB001DeviceType","pt":"flow","to":"Presence","tot":"str"},{"p":"HB001Manufacturer","pt":"flow","to":"homebridge-people-geofence","tot":"str"},{"p":"HB001AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB001PhysicalVirtualType","pt":"flow","to":"Virtual","tot":"str"},{"p":"HB001PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB001House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB001MQTTDeviceTopic","pt":"flow","to":"Anyone Present","tot":"str"},{"p":"HB001OccupancyDetected","pt":"flow","to":"10TF","tot":"str"}],"active":true,"x":170,"y":720,"wires":[]},{"id":"fe56f119.8e86b","type":"config","z":"ff6040a4.0af3a","name":"HB002 Downstairs Carbon Monoxide","properties":[{"p":"HB002Floor","pt":"flow","to":"1","tot":"str"},{"p":"HB002Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB002Room","pt":"flow","to":"Mini-Hall","tot":"str"},{"p":"HB002DeviceType","pt":"flow","to":"CO","tot":"str"},{"p":"HB002Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB002AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB002PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB002PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB002House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB002MQTTDeviceTopic","pt":"flow","to":"Downwstair Hall Nest Protect","tot":"str"},{"p":"HB002CarbonMonoxideDetected","pt":"flow","to":"10TF","tot":"str"},{"p":"HB002StatusLowBattery","pt":"flow","to":"10TF","tot":"str"},{"p":"HB002StatusActive","pt":"flow","to":"null","tot":"str"},{"p":"HB002ManualTestActive","pt":"flow","to":"null","tot":"str"}],"active":true,"x":210,"y":1479,"wires":[]},{"id":"e0063a02.a35008","type":"comment","z":"ff6040a4.0af3a","name":"Presence Sensors","info":"","x":150,"y":680,"wires":[]},{"id":"2f798463.23074c","type":"comment","z":"ff6040a4.0af3a","name":"Placeholder Kathy Home","info":"","x":170,"y":960,"wires":[]},{"id":"6faf09e5.95e288","type":"link in","z":"ff6040a4.0af3a","name":"Jump In","links":["3264f899.8879a8","33682101.3212be","415e85f.bbf397c","813e3d4b.f9652","91fbb3e.bdc265"],"x":1430,"y":780,"wires":[[]],"l":true},{"id":"38f45a8.5354ba6","type":"hb-status","z":"ff6040a4.0af3a","name":"Anyone","Homebridge":"Homebridge","Manufacturer":"Default-Manufacturer","Service":"Occupancy Sensor","device":"HomebridgeCC:22:3D:E3:CE:30Default-ManufacturerAnyone00000086","conf":"df59aa47.b26148","x":680,"y":700,"wires":[["3264f899.8879a8"]]},{"id":"415e85f.bbf397c","type":"link out","z":"ff6040a4.0af3a","name":"Go To Jump In","links":["6faf09e5.95e288"],"x":1020,"y":2260,"wires":[],"l":true},{"id":"ce3795c5.e37728","type":"hb-status","z":"ff6040a4.0af3a","name":"Downstairs Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestDownstairs Motion00000085","conf":"df59aa47.b26148","x":690,"y":2520,"wires":[["33682101.3212be"]]},{"id":"26c717da.a357a8","type":"config","z":"ff6040a4.0af3a","name":"HB003 Downstairs Motion Sensor","properties":[{"p":"HB003Floor","pt":"flow","to":"1","tot":"str"},{"p":"HB003Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB003Room","pt":"flow","to":"Mini-Hall","tot":"str"},{"p":"HB003DeviceType","pt":"flow","to":"Motion Sensor","tot":"str"},{"p":"HB003Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB003AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB003PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB003PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB003House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB003MQTTDeviceTopic","pt":"flow","to":"Downwstair Hall Nest Protect","tot":"str"},{"p":"HB003MotionDetected","pt":"flow","to":"null","tot":"str"}],"active":true,"x":200,"y":2520,"wires":[]},{"id":"46f0a2ef.c5843c","type":"hb-status","z":"ff6040a4.0af3a","name":"Downstairs Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestDownstairs Smoke00000087","conf":"df59aa47.b26148","x":690,"y":3200,"wires":[["91fbb3e.bdc265"]]},{"id":"b29d097e.0d9208","type":"config","z":"ff6040a4.0af3a","name":"HB004 Downstairs Smoke","properties":[{"p":"HB004Floor","pt":"flow","to":"1","tot":"str"},{"p":"HB004Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB004Room","pt":"flow","to":"Mini-Hall","tot":"str"},{"p":"HB004DeviceType","pt":"flow","to":"CO","tot":"str"},{"p":"HB004Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB004AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB004PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB004PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB004House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB004MQTTDeviceTopic","pt":"flow","to":"Downwstair Hall Nest Protect","tot":"str"},{"p":"HB004SmokeDetected","pt":"flow","to":"10TF","tot":"str"},{"p":"HB004StatusLowBattery","pt":"flow","to":"10TF","tot":"str"},{"p":"HB004StatusActive","pt":"flow","to":"null","tot":"str"},{"p":"HB004ManualTestActive","pt":"flow","to":"null","tot":"str"}],"active":true,"x":170,"y":3200,"wires":[]},{"id":"49c85fa.13f89a","type":"hb-status","z":"ff6040a4.0af3a","name":"Gratuity Thermostat - Eco Mode","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Switch","device":"HomebridgeCC:22:3D:E3:CE:30NestGratuity Thermostat - Eco Mode00000049","conf":"df59aa47.b26148","x":730,"y":2160,"wires":[["415e85f.bbf397c"]]},{"id":"6da09ee0.35225","type":"config","z":"ff6040a4.0af3a","name":"HB005 Gratuity Thermostat Eco ","properties":[{"p":"HB005Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB005Location","pt":"flow","to":"North","tot":"str"},{"p":"HB005Room","pt":"flow","to":"Upstairs Hall","tot":"str"},{"p":"HB005DeviceType","pt":"flow","to":"Thermostat","tot":"str"},{"p":"HB005Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB005AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB005PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB005PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB005House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB005MQTTDeviceTopic","pt":"flow","to":"Nest Thermostat Eco Mode","tot":"str"},{"p":"HB005On","pt":"flow","to":"null","tot":"str"}],"active":true,"x":190,"y":2160,"wires":[]},{"id":"3548cebc.d4f4a2","type":"hb-status","z":"ff6040a4.0af3a","name":"Gratuity Thermostat - Fan","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Fan","device":"HomebridgeCC:22:3D:E3:CE:30NestGratuity Thermostat - Fan00000040","conf":"df59aa47.b26148","x":710,"y":2240,"wires":[["415e85f.bbf397c"]]},{"id":"38e9e817.f85d68","type":"config","z":"ff6040a4.0af3a","name":"HB006 Gratuity Thermostat Fan","properties":[{"p":"HB006Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB006Location","pt":"flow","to":"North","tot":"str"},{"p":"HB006Room","pt":"flow","to":"Upstairs Hall","tot":"str"},{"p":"HB006DeviceType","pt":"flow","to":"Thermostat","tot":"str"},{"p":"HB006Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB006AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB006PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB006PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB006House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB006MQTTDeviceTopic","pt":"flow","to":"Nest Thermostat Fan Mode","tot":"str"},{"p":"HB006On","pt":"flow","to":"null","tot":"str"}],"active":true,"x":190,"y":2240,"wires":[]},{"id":"4e24a6e2.9b75a8","type":"hb-status","z":"ff6040a4.0af3a","name":"Gratuity Thermostat","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Thermostat","device":"HomebridgeCC:22:3D:E3:CE:30NestGratuity Thermostat0000004A","conf":"df59aa47.b26148","x":690,"y":2320,"wires":[["415e85f.bbf397c"]]},{"id":"31e93136.abf15e","type":"config","z":"ff6040a4.0af3a","name":"HB007 Gratuity Thermostat","properties":[{"p":"HB007Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB007Location","pt":"flow","to":"North","tot":"str"},{"p":"HB007Room","pt":"flow","to":"Upstairs Hall","tot":"str"},{"p":"HB007DeviceType","pt":"flow","to":"Thermostat","tot":"str"},{"p":"HB007Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB007AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB007PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB007PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB007House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB007MQTTDeviceTopic","pt":"flow","to":"Nest Thermostat","tot":"str"},{"p":"HB007CurrentHeatingCoolingState","pt":"flow","to":"NestThMap","tot":"str"},{"p":"HB007TargetHeatingCoolingState","pt":"flow","to":"NestThMap","tot":"str"},{"p":"HB007CurrentTemperature","pt":"flow","to":"C2F","tot":"str"},{"p":"HB007TargetTemperature","pt":"flow","to":"C2F","tot":"str"},{"p":"HB007TemperatureDisplayUnits","pt":"flow","to":"012CF","tot":"str"},{"p":"HB007CurrentRelativeHumidity","pt":"flow","to":"null","tot":"str"},{"p":"HB007CoolingThresholdTemperature","pt":"flow","to":"C2F","tot":"str"},{"p":"HB007HeatingThresholdTemperature","pt":"flow","to":"C2F","tot":"str"},{"p":"HB007StatusActive","pt":"flow","to":"null","tot":"str"},{"p":"HB007FanTimerActive","pt":"flow","to":"null","tot":"str"},{"p":"HB007FanTimerDuration","pt":"flow","to":"null","tot":"str"},{"p":"HB007HasLeaf","pt":"flow","to":"null","tot":"str"},{"p":"HB007SunlightCorrectionEnabled","pt":"flow","to":"null","tot":"str"},{"p":"HB007SunlightCorrectionActive","pt":"flow","to":"null","tot":"str"},{"p":"HB007UsingEmergencyHeat","pt":"flow","to":"null","tot":"str"}],"active":true,"x":180,"y":2320,"wires":[]},{"id":"f4ffc67c.e30ea8","type":"config","z":"ff6040a4.0af3a","name":"HB009 Mike Home Presence","properties":[{"p":"HB009Floor","pt":"flow","to":"","tot":"str"},{"p":"HB009Location","pt":"flow","to":"","tot":"str"},{"p":"HB009Room","pt":"flow","to":"","tot":"str"},{"p":"HB009DeviceType","pt":"flow","to":"Presence","tot":"str"},{"p":"HB009Manufacturer","pt":"flow","to":"homebridge-people-geofence","tot":"str"},{"p":"HB009AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB009PhysicalVirtualType","pt":"flow","to":"Virtual","tot":"str"},{"p":"HB009PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB009House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB009MQTTDeviceTopic","pt":"flow","to":"Mike Home","tot":"str"},{"p":"HB009OccupancyDetected","pt":"flow","to":"10TF","tot":"str"}],"active":true,"x":180,"y":800,"wires":[]},{"id":"a42d087f.d2b358","type":"hb-status","z":"ff6040a4.0af3a","name":"Mike iPhone Home","Homebridge":"Homebridge","Manufacturer":"Default-Manufacturer","Service":"Occupancy Sensor","device":"HomebridgeCC:22:3D:E3:CE:30Default-ManufacturerMike iPhone Home00000086","conf":"df59aa47.b26148","x":710,"y":780,"wires":[["3264f899.8879a8"]]},{"id":"a5b3ac13.2f71b","type":"comment","z":"ff6040a4.0af3a","name":"Placeholder Eva Home","info":"","x":160,"y":1040,"wires":[]},{"id":"5f2771e5.62b02","type":"comment","z":"ff6040a4.0af3a","name":"Placeholder Eva LTHS","info":"","x":160,"y":1120,"wires":[]},{"id":"7f6b1d0c.801024","type":"comment","z":"ff6040a4.0af3a","name":"Placeholder Eva CTE","info":"","x":160,"y":1200,"wires":[]},{"id":"769bbcae.38e534","type":"comment","z":"ff6040a4.0af3a","name":"Placeholder Eva Dance","info":"","x":160,"y":1280,"wires":[]},{"id":"fbed7fe4.3fc7c","type":"comment","z":"ff6040a4.0af3a","name":"Placeholder Kathy Dance","info":"","x":170,"y":1360,"wires":[]},{"id":"7ee703e7.a4254c","type":"comment","z":"ff6040a4.0af3a","name":"Placeholder Mike Work","info":"","x":160,"y":880,"wires":[]},{"id":"86296406.c08bc8","type":"comment","z":"ff6040a4.0af3a","name":"Nest Protect CO","info":"","x":140,"y":1440,"wires":[]},{"id":"cd66026b.82cd9","type":"hb-status","z":"ff6040a4.0af3a","name":"Eva Hallway Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestEva Hallway Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":710,"y":1560,"wires":[["813e3d4b.f9652"]]},{"id":"5773e9d.6b83818","type":"config","z":"ff6040a4.0af3a","name":"HB010 Eva Hallway Carbon Monoxide","properties":[{"p":"HB010Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB010Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB010Room","pt":"flow","to":"Upstairs Hallway","tot":"str"},{"p":"HB010DeviceType","pt":"flow","to":"CO","tot":"str"},{"p":"HB010Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB010AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB010PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB010PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB010House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB010MQTTDeviceTopic","pt":"flow","to":"Eva Hallway Nest Protect","tot":"str"},{"p":"HB010CarbonMonoxideDetected","pt":"flow","to":"10TF","tot":"str"},{"p":"HB010StatusLowBattery","pt":"flow","to":"10TF","tot":"str"},{"p":"HB010StatusActive","pt":"flow","to":"null","tot":"str"},{"p":"HB010ManualTestActive","pt":"flow","to":"null","tot":"str"}],"active":true,"x":210,"y":1560,"wires":[]},{"id":"534c050d.261e4c","type":"hb-status","z":"ff6040a4.0af3a","name":"Evas Bedroom Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestEvas Bedroom Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":720,"y":1640,"wires":[["813e3d4b.f9652"]]},{"id":"ce8d8a9b.bdc698","type":"config","z":"ff6040a4.0af3a","name":"HB011 Eva's Bedroom Carbon Monoxide","properties":[{"p":"HB011Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB011Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB011Room","pt":"flow","to":"Eva's Room","tot":"str"},{"p":"HB011DeviceType","pt":"flow","to":"CO","tot":"str"},{"p":"HB011Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB011AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB011PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB011PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB011House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB011MQTTDeviceTopic","pt":"flow","to":"Eva's Bedroom Nest Protect","tot":"str"},{"p":"HB011CarbonMonoxideDetected","pt":"flow","to":"10TF","tot":"str"},{"p":"HB011StatusLowBattery","pt":"flow","to":"10TF","tot":"str"},{"p":"HB011StatusActive","pt":"flow","to":"null","tot":"str"},{"p":"HB011ManualTestActive","pt":"flow","to":"null","tot":"str"}],"active":true,"x":220,"y":1640,"wires":[]},{"id":"3a5ed4d3.c1351c","type":"hb-status","z":"ff6040a4.0af3a","name":"Game Room Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestGame Room Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":710,"y":1720,"wires":[["813e3d4b.f9652"]]},{"id":"a0622033.a679f","type":"config","z":"ff6040a4.0af3a","name":"HB012 Game Room Carbon Monoxide","properties":[{"p":"HB012Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB012Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB012Room","pt":"flow","to":"Game Room","tot":"str"},{"p":"HB012DeviceType","pt":"flow","to":"CO","tot":"str"},{"p":"HB012Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB012AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB012PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB012PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB012House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB012MQTTDeviceTopic","pt":"flow","to":"Game Room Nest Protect","tot":"str"},{"p":"HB012CarbonMonoxideDetected","pt":"flow","to":"10TF","tot":"str"},{"p":"HB012StatusLowBattery","pt":"flow","to":"10TF","tot":"str"},{"p":"HB012StatusActive","pt":"flow","to":"null","tot":"str"},{"p":"HB012ManualTestActive","pt":"flow","to":"null","tot":"str"}],"active":true,"x":210,"y":1720,"wires":[]},{"id":"3cd984ea.0880dc","type":"hb-status","z":"ff6040a4.0af3a","name":"Guest Bedroom Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestGuest Bedroom Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":720,"y":1800,"wires":[["813e3d4b.f9652"]]},{"id":"ac1fd4f2.120f58","type":"config","z":"ff6040a4.0af3a","name":"HB013 Guest Bedroom Carbon Monoxide","properties":[{"p":"HB013Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB013Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB013Room","pt":"flow","to":"Guest Room","tot":"str"},{"p":"HB013DeviceType","pt":"flow","to":"CO","tot":"str"},{"p":"HB013Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB013AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB013PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB013PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB013House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB013MQTTDeviceTopic","pt":"flow","to":"Guest Room Nest Protect","tot":"str"},{"p":"HB013CarbonMonoxideDetected","pt":"flow","to":"10TF","tot":"str"},{"p":"HB013StatusLowBattery","pt":"flow","to":"10TF","tot":"str"},{"p":"HB013StatusActive","pt":"flow","to":"null","tot":"str"},{"p":"HB013ManualTestActive","pt":"flow","to":"null","tot":"str"}],"active":true,"x":220,"y":1800,"wires":[]},{"id":"a0086d61.d3f3","type":"hb-status","z":"ff6040a4.0af3a","name":"Master Bedroom Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestMaster Bedroom Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":720,"y":1880,"wires":[["813e3d4b.f9652"]]},{"id":"e6d81bf5.159148","type":"config","z":"ff6040a4.0af3a","name":"HB014 Master Bedroom Carbon Monoxide","properties":[{"p":"HB014Floor","pt":"flow","to":"1","tot":"str"},{"p":"HB014Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB014Room","pt":"flow","to":"Master Bedroom","tot":"str"},{"p":"HB014DeviceType","pt":"flow","to":"CO","tot":"str"},{"p":"HB014Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB014AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB014PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB014PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB014House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB014MQTTDeviceTopic","pt":"flow","to":"Master Bedroom Nest Protect","tot":"str"},{"p":"HB014CarbonMonoxideDetected","pt":"flow","to":"10TF","tot":"str"},{"p":"HB014StatusLowBattery","pt":"flow","to":"10TF","tot":"str"},{"p":"HB014StatusActive","pt":"flow","to":"null","tot":"str"},{"p":"HB014ManualTestActive","pt":"flow","to":"null","tot":"str"}],"active":true,"x":230,"y":1880,"wires":[]},{"id":"8c6f74ef.9f8928","type":"hb-status","z":"ff6040a4.0af3a","name":"Toy Room Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestToy Room Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":700,"y":1960,"wires":[["813e3d4b.f9652"]]},{"id":"8442cc2a.99fb1","type":"config","z":"ff6040a4.0af3a","name":"HB015 Toy Room Carbon Monoxide","properties":[{"p":"HB015Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB015Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB015Room","pt":"flow","to":"Toy Room","tot":"str"},{"p":"HB015DeviceType","pt":"flow","to":"CO","tot":"str"},{"p":"HB015Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB015AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB015PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB015PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB015House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB015MQTTDeviceTopic","pt":"flow","to":"Toy Room Nest Protect","tot":"str"},{"p":"HB015CarbonMonoxideDetected","pt":"flow","to":"10TF","tot":"str"},{"p":"HB015StatusLowBattery","pt":"flow","to":"10TF","tot":"str"},{"p":"HB015StatusActive","pt":"flow","to":"null","tot":"str"},{"p":"HB015ManualTestActive","pt":"flow","to":"null","tot":"str"}],"active":true,"x":200,"y":1960,"wires":[]},{"id":"f8e3a581.85b9d8","type":"hb-status","z":"ff6040a4.0af3a","name":"Toy Room Hallway Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestToy Room Hallway Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":730,"y":2040,"wires":[["813e3d4b.f9652"]]},{"id":"db84eb3f.172a38","type":"config","z":"ff6040a4.0af3a","name":"HB016 Toy Room Hallway Carbon Monoxide","properties":[{"p":"HB016Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB016Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB016Room","pt":"flow","to":"Upstairs Hallway","tot":"str"},{"p":"HB016DeviceType","pt":"flow","to":"CO","tot":"str"},{"p":"HB016Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB016AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB016PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB016PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB016House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB016MQTTDeviceTopic","pt":"flow","to":"Toy Room Hallway Nest Protect","tot":"str"},{"p":"HB016CarbonMonoxideDetected","pt":"flow","to":"10TF","tot":"str"},{"p":"HB016StatusLowBattery","pt":"flow","to":"10TF","tot":"str"},{"p":"HB016StatusActive","pt":"flow","to":"null","tot":"str"},{"p":"HB016ManualTestActive","pt":"flow","to":"null","tot":"str"}],"active":true,"x":230,"y":2040,"wires":[]},{"id":"813e3d4b.f9652","type":"link out","z":"ff6040a4.0af3a","name":"Go To Jump In","links":["6faf09e5.95e288"],"x":1140,"y":1800,"wires":[],"l":true},{"id":"3264f899.8879a8","type":"link out","z":"ff6040a4.0af3a","name":"Go To Jump In","links":["6faf09e5.95e288"],"x":940,"y":760,"wires":[],"l":true},{"id":"33682101.3212be","type":"link out","z":"ff6040a4.0af3a","name":"Go To Jump In","links":["6faf09e5.95e288"],"x":1040,"y":2800,"wires":[],"l":true},{"id":"c7e14b8e.1343e8","type":"hb-status","z":"ff6040a4.0af3a","name":"Eva Hallway Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestEva Hallway Motion00000085","conf":"df59aa47.b26148","x":690,"y":2600,"wires":[["33682101.3212be"]]},{"id":"245b547a.2b1c7c","type":"hb-status","z":"ff6040a4.0af3a","name":"Evas Bedroom Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestEvas Bedroom Motion00000085","conf":"df59aa47.b26148","x":700,"y":2680,"wires":[["33682101.3212be"]]},{"id":"b3ea379b.64c0c8","type":"hb-status","z":"ff6040a4.0af3a","name":"Guest Bedroom Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestGuest Bedroom Motion00000085","conf":"df59aa47.b26148","x":710,"y":2840,"wires":[["33682101.3212be"]]},{"id":"7c74e84f.1b53f8","type":"hb-status","z":"ff6040a4.0af3a","name":"Master Bedroom Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestMaster Bedroom Motion00000085","conf":"df59aa47.b26148","x":710,"y":2920,"wires":[["33682101.3212be"]]},{"id":"2de8623c.341f8e","type":"hb-status","z":"ff6040a4.0af3a","name":"Toy Room Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestToy Room Motion00000085","conf":"df59aa47.b26148","x":690,"y":3000,"wires":[["33682101.3212be"]]},{"id":"4cab8d95.958f64","type":"hb-status","z":"ff6040a4.0af3a","name":"Toy Room Hallway Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestToy Room Hallway Motion00000085","conf":"df59aa47.b26148","x":710,"y":3080,"wires":[["33682101.3212be"]]},{"id":"572711c0.50553","type":"config","z":"ff6040a4.0af3a","name":"HB017 Eva Hallway Motion Sensor","properties":[{"p":"HB017Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB017Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB017Room","pt":"flow","to":"Upstairs Hallway","tot":"str"},{"p":"HB017DeviceType","pt":"flow","to":"Motion Sensor","tot":"str"},{"p":"HB017Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB017AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB017PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB017PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB017House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB017MQTTDeviceTopic","pt":"flow","to":"Eva Hallway Nest Protect","tot":"str"},{"p":"HB017MotionDetected","pt":"flow","to":"null","tot":"str"}],"active":true,"x":200,"y":2600,"wires":[]},{"id":"40869fa8.bcbd4","type":"config","z":"ff6040a4.0af3a","name":"HB018 Eva's Bedroom Motion Sensor","properties":[{"p":"HB018Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB018Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB018Room","pt":"flow","to":"Eva's Room","tot":"str"},{"p":"HB018DeviceType","pt":"flow","to":"Motion Sensor","tot":"str"},{"p":"HB018Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB018AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB018PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB018PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB018House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB018MQTTDeviceTopic","pt":"flow","to":"Eva's Bedroom Nest Protect","tot":"str"},{"p":"HB018MotionDetected","pt":"flow","to":"null","tot":"str"}],"active":true,"x":210,"y":2680,"wires":[]},{"id":"fe68bfd3.940b5","type":"config","z":"ff6040a4.0af3a","name":"HB020 Guest Room Motion Sensor","properties":[{"p":"HB020Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB020Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB020Room","pt":"flow","to":"Guest Room","tot":"str"},{"p":"HB020DeviceType","pt":"flow","to":"Motion Sensor","tot":"str"},{"p":"HB020Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB020AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB020PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB020PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB020House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB020MQTTDeviceTopic","pt":"flow","to":"Guest Room Nest Protect","tot":"str"},{"p":"HB020MotionDetected","pt":"flow","to":"null","tot":"str"}],"active":true,"x":200,"y":2840,"wires":[]},{"id":"ba773c09.780f2","type":"config","z":"ff6040a4.0af3a","name":"HB021 Master Bedroom Motion Sensor","properties":[{"p":"HB021Floor","pt":"flow","to":"1","tot":"str"},{"p":"HB021Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB021Room","pt":"flow","to":"Master Bedroom","tot":"str"},{"p":"HB021DeviceType","pt":"flow","to":"Motion Sensor","tot":"str"},{"p":"HB021Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB021AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB021PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB021PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB021House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB021MQTTDeviceTopic","pt":"flow","to":"Master Bedroom Nest Protect","tot":"str"},{"p":"HB021MotionDetected","pt":"flow","to":"null","tot":"str"}],"active":true,"x":220,"y":2920,"wires":[]},{"id":"9babc1bf.cd14c","type":"config","z":"ff6040a4.0af3a","name":"HB022 Toy Room Motion Sensor","properties":[{"p":"HB022Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB022Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB022Room","pt":"flow","to":"Toy Room","tot":"str"},{"p":"HB022DeviceType","pt":"flow","to":"Motion Sensor","tot":"str"},{"p":"HB022Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB022AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB022PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB022PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB022House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB022MQTTDeviceTopic","pt":"flow","to":"Toy Room Nest Protect","tot":"str"},{"p":"HB022MotionDetected","pt":"flow","to":"null","tot":"str"}],"active":true,"x":190,"y":3000,"wires":[]},{"id":"e536e989.eed2f8","type":"config","z":"ff6040a4.0af3a","name":"HB023 Toy Room Hallway Motion Sensor","properties":[{"p":"HB023Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB023Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB023Room","pt":"flow","to":"Upstairs Hallway","tot":"str"},{"p":"HB023DeviceType","pt":"flow","to":"Motion Sensor","tot":"str"},{"p":"HB023Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB023AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB023PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB023PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB023House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB023MQTTDeviceTopic","pt":"flow","to":"Toy Room Hallway Nest Protect","tot":"str"},{"p":"HB023MotionDetected","pt":"flow","to":"null","tot":"str"}],"active":true,"x":220,"y":3080,"wires":[]},{"id":"302cfe9e.33a6b2","type":"hb-status","z":"ff6040a4.0af3a","name":"Game Room Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestGame Room Motion00000085","conf":"df59aa47.b26148","x":700,"y":2760,"wires":[["33682101.3212be"]]},{"id":"56c46b6a.f4d804","type":"config","z":"ff6040a4.0af3a","name":"HB019 GameRoom Motion Sensor","properties":[{"p":"HB019Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB019Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB019Room","pt":"flow","to":"Game Room","tot":"str"},{"p":"HB019DeviceType","pt":"flow","to":"Motion Sensor","tot":"str"},{"p":"HB019Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB019AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB019PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB019PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB019House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB019MQTTDeviceTopic","pt":"flow","to":"Game Room Nest Protect","tot":"str"},{"p":"HB019MotionDetected","pt":"flow","to":"null","tot":"str"}],"active":true,"x":200,"y":2760,"wires":[]},{"id":"c138ea88.a29a08","type":"comment","z":"ff6040a4.0af3a","name":"Nest Protect Smoke","info":"","x":150,"y":3160,"wires":[]},{"id":"91fbb3e.bdc265","type":"link out","z":"ff6040a4.0af3a","name":"Go To Jump In","links":["6faf09e5.95e288"],"x":1260,"y":3500,"wires":[],"l":true},{"id":"117f33b3.9e8cec","type":"hb-status","z":"ff6040a4.0af3a","name":"Eva Hallway Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestEva Hallway Smoke00000087","conf":"df59aa47.b26148","x":700,"y":3280,"wires":[["91fbb3e.bdc265"]]},{"id":"b82b5a72.cdf928","type":"config","z":"ff6040a4.0af3a","name":"HB024 Eva Hallway Smoke","properties":[{"p":"HB024Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB024Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB024Room","pt":"flow","to":"Upstairs Hallway","tot":"str"},{"p":"HB024DeviceType","pt":"flow","to":"CO","tot":"str"},{"p":"HB024Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB024AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB024PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB024PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB024House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB024MQTTDeviceTopic","pt":"flow","to":"Eva Hallway Nest Protect","tot":"str"},{"p":"HB024SmokeDetected","pt":"flow","to":"10TF","tot":"str"},{"p":"HB024StatusLowBattery","pt":"flow","to":"10TF","tot":"str"},{"p":"HB024StatusActive","pt":"flow","to":"null","tot":"str"},{"p":"HB024ManualTestActive","pt":"flow","to":"null","tot":"str"}],"active":true,"x":180,"y":3280,"wires":[]},{"id":"98a26761.a381f8","type":"hb-status","z":"ff6040a4.0af3a","name":"Evas Bedroom Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestEvas Bedroom Smoke00000087","conf":"df59aa47.b26148","x":700,"y":3360,"wires":[["91fbb3e.bdc265"]]},{"id":"2b556a8a.1eb996","type":"config","z":"ff6040a4.0af3a","name":"HB025 Evas Bedroom Smoke","properties":[{"p":"HB025Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB025Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB025Room","pt":"flow","to":"Eva's Room","tot":"str"},{"p":"HB025DeviceType","pt":"flow","to":"CO","tot":"str"},{"p":"HB025Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB025AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB025PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB025PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB025House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB025MQTTDeviceTopic","pt":"flow","to":"Eva's Bedroom Nest Protect","tot":"str"},{"p":"HB025SmokeDetected","pt":"flow","to":"10TF","tot":"str"},{"p":"HB025StatusLowBattery","pt":"flow","to":"10TF","tot":"str"},{"p":"HB025StatusActive","pt":"flow","to":"null","tot":"str"},{"p":"HB025ManualTestActive","pt":"flow","to":"null","tot":"str"}],"active":true,"x":190,"y":3360,"wires":[]},{"id":"bbbd08cf.b8a6b8","type":"hb-status","z":"ff6040a4.0af3a","name":"Game Room Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestGame Room Smoke00000087","conf":"df59aa47.b26148","x":700,"y":3440,"wires":[["91fbb3e.bdc265"]]},{"id":"973baf2e.84ff5","type":"config","z":"ff6040a4.0af3a","name":"HB026 Game Room Smoke","properties":[{"p":"HB026Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB026Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB026Room","pt":"flow","to":"Game Room","tot":"str"},{"p":"HB026DeviceType","pt":"flow","to":"CO","tot":"str"},{"p":"HB026Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB026AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB026PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB026PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB026House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB026MQTTDeviceTopic","pt":"flow","to":"Game Room Nest Protect","tot":"str"},{"p":"HB026SmokeDetected","pt":"flow","to":"10TF","tot":"str"},{"p":"HB026StatusLowBattery","pt":"flow","to":"10TF","tot":"str"},{"p":"HB026StatusActive","pt":"flow","to":"null","tot":"str"},{"p":"HB026ManualTestActive","pt":"flow","to":"null","tot":"str"}],"active":true,"x":180,"y":3440,"wires":[]},{"id":"2a9e3a0d.2fd3d6","type":"hb-status","z":"ff6040a4.0af3a","name":"Guest Bedroom Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestGuest Bedroom Smoke00000087","conf":"df59aa47.b26148","x":710,"y":3520,"wires":[["91fbb3e.bdc265"]]},{"id":"cc747607.780658","type":"config","z":"ff6040a4.0af3a","name":"HB027 Guest Bedroom Smoke","properties":[{"p":"HB027Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB027Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB027Room","pt":"flow","to":"Guest Room","tot":"str"},{"p":"HB027DeviceType","pt":"flow","to":"CO","tot":"str"},{"p":"HB027Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB027AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB027PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB027PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB027House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB027MQTTDeviceTopic","pt":"flow","to":"Guest Room Nest Protect","tot":"str"},{"p":"HB027SmokeDetected","pt":"flow","to":"10TF","tot":"str"},{"p":"HB027StatusLowBattery","pt":"flow","to":"10TF","tot":"str"},{"p":"HB027StatusActive","pt":"flow","to":"null","tot":"str"},{"p":"HB027ManualTestActive","pt":"flow","to":"null","tot":"str"}],"active":true,"x":190,"y":3520,"wires":[]},{"id":"22389c16.e79774","type":"hb-status","z":"ff6040a4.0af3a","name":"Master Bedroom Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestMaster Bedroom Smoke00000087","conf":"df59aa47.b26148","x":710,"y":3600,"wires":[["91fbb3e.bdc265"]]},{"id":"46469130.281cf","type":"config","z":"ff6040a4.0af3a","name":"HB028 Master Bedroom Smoke","properties":[{"p":"HB028Floor","pt":"flow","to":"1","tot":"str"},{"p":"HB028Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB028Room","pt":"flow","to":"Master Bedroom","tot":"str"},{"p":"HB028DeviceType","pt":"flow","to":"CO","tot":"str"},{"p":"HB028Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB028AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB028PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB028PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB028House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB028MQTTDeviceTopic","pt":"flow","to":"Master Bedroom Nest Protect","tot":"str"},{"p":"HB028SmokeDetected","pt":"flow","to":"10TF","tot":"str"},{"p":"HB028StatusLowBattery","pt":"flow","to":"10TF","tot":"str"},{"p":"HB028StatusActive","pt":"flow","to":"null","tot":"str"},{"p":"HB028ManualTestActive","pt":"flow","to":"null","tot":"str"}],"active":true,"x":190,"y":3600,"wires":[]},{"id":"607645ac.933e8c","type":"hb-status","z":"ff6040a4.0af3a","name":"Toy Room Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestToy Room Smoke00000087","conf":"df59aa47.b26148","x":690,"y":3680,"wires":[["91fbb3e.bdc265"]]},{"id":"f93c936.40f367","type":"config","z":"ff6040a4.0af3a","name":"HB029 Toy Room Smoke","properties":[{"p":"HB029Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB029Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB029Room","pt":"flow","to":"Toy Room","tot":"str"},{"p":"HB029DeviceType","pt":"flow","to":"CO","tot":"str"},{"p":"HB029Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB029AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB029PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB029PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB029House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB029MQTTDeviceTopic","pt":"flow","to":"Toy Room Nest Protect","tot":"str"},{"p":"HB029SmokeDetected","pt":"flow","to":"10TF","tot":"str"},{"p":"HB029StatusLowBattery","pt":"flow","to":"10TF","tot":"str"},{"p":"HB029StatusActive","pt":"flow","to":"null","tot":"str"},{"p":"HB029ManualTestActive","pt":"flow","to":"null","tot":"str"}],"active":true,"x":170,"y":3680,"wires":[]},{"id":"a18ab6b7.0783d8","type":"hb-status","z":"ff6040a4.0af3a","name":"Toy Room Hallway Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestToy Room Hallway Smoke00000087","conf":"df59aa47.b26148","x":710,"y":3760,"wires":[["91fbb3e.bdc265"]]},{"id":"6d8fa1a7.a2274","type":"config","z":"ff6040a4.0af3a","name":"HB030 Toy Room Hallway Smoke","properties":[{"p":"HB030Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB030Location","pt":"flow","to":"Ceiling","tot":"str"},{"p":"HB030Room","pt":"flow","to":"Upstairs Hallway","tot":"str"},{"p":"HB030DeviceType","pt":"flow","to":"CO","tot":"str"},{"p":"HB030Manufacturer","pt":"flow","to":"Nest","tot":"str"},{"p":"HB030AccessProtocol","pt":"flow","to":"WIFI","tot":"str"},{"p":"HB030PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB030PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB030House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB030MQTTDeviceTopic","pt":"flow","to":"Toy Room Hallway Nest Protect","tot":"str"},{"p":"HB030SmokeDetected","pt":"flow","to":"10TF","tot":"str"},{"p":"HB030StatusLowBattery","pt":"flow","to":"10TF","tot":"str"},{"p":"HB030StatusActive","pt":"flow","to":"null","tot":"str"},{"p":"HB030ManualTestActive","pt":"flow","to":"null","tot":"str"}],"active":true,"x":200,"y":3760,"wires":[]},{"id":"e5f02930.1455b8","type":"comment","z":"ff6040a4.0af3a","name":"Nest Thermostat","info":"","x":140,"y":2120,"wires":[]},{"id":"53f413b7.c3ca5c","type":"hb-status","z":"ff6040a4.0af3a","name":"Eve Motion Passthrough","Homebridge":"Homebridge","Manufacturer":"Default-Manufacturer","Service":"Switch","device":"HomebridgeCC:22:3D:E3:CE:30Default-ManufacturerEve Motion Passthrough00000049","conf":"df59aa47.b26148","x":710,"y":2440,"wires":[["33682101.3212be"]]},{"id":"bceb7f20.10bbf","type":"config","z":"ff6040a4.0af3a","name":"HB031 Eve Motion Passthrough","properties":[{"p":"HB031Floor","pt":"flow","to":"2","tot":"str"},{"p":"HB031Location","pt":"flow","to":"South by Doorway","tot":"str"},{"p":"HB031Room","pt":"flow","to":"Game Room","tot":"str"},{"p":"HB031DeviceType","pt":"flow","to":"Motion Sensor","tot":"str"},{"p":"HB031Manufacturer","pt":"flow","to":"Eve","tot":"str"},{"p":"HB031AccessProtocol","pt":"flow","to":"Bluetooth","tot":"str"},{"p":"HB031PhysicalVirtualType","pt":"flow","to":"Physical","tot":"str"},{"p":"HB031PhysicalDigitalRegular","pt":"flow","to":"","tot":"str"},{"p":"HB031House","pt":"flow","to":"Ashmont","tot":"str"},{"p":"HB031MQTTDeviceTopic","pt":"flow","to":"Eve Motion Sensor","tot":"str"},{"p":"HB031On","pt":"flow","to":"null","tot":"str"}],"active":true,"x":190,"y":2440,"wires":[]},{"id":"8f457a2c.105938","type":"comment","z":"ff6040a4.0af3a","name":"Motion Sensors","info":"","x":140,"y":2400,"wires":[]},{"id":"912e5f45.6f58a","type":"hb-event","z":"ff6040a4.0af3a","name":"Eve Motion Passthrough","Homebridge":"Homebridge","Manufacturer":"Default-Manufacturer","Service":"Switch","device":"HomebridgeCC:22:3D:E3:CE:30Default-ManufacturerEve Motion Passthrough00000049","conf":"df59aa47.b26148","x":710,"y":2480,"wires":[["33682101.3212be"]]},{"id":"534db29a.f9e40c","type":"hb-event","z":"ff6040a4.0af3a","name":"Gratuity Thermostat","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Thermostat","device":"HomebridgeCC:22:3D:E3:CE:30NestGratuity Thermostat0000004A","conf":"df59aa47.b26148","x":690,"y":2360,"wires":[["415e85f.bbf397c"]]},{"id":"6dbf5f60.4be7e","type":"hb-event","z":"ff6040a4.0af3a","name":"Gratuity Thermostat - Fan","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Fan","device":"HomebridgeCC:22:3D:E3:CE:30NestGratuity Thermostat - Fan00000040","conf":"df59aa47.b26148","x":710,"y":2280,"wires":[["415e85f.bbf397c"]]},{"id":"c4ccfbf4.b745a8","type":"hb-event","z":"ff6040a4.0af3a","name":"Gratuity Thermostat - Eco Mode","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Switch","device":"HomebridgeCC:22:3D:E3:CE:30NestGratuity Thermostat - Eco Mode00000049","conf":"df59aa47.b26148","x":730,"y":2200,"wires":[["415e85f.bbf397c"]]},{"id":"1d5fbd69.3b3ad3","type":"hb-event","z":"ff6040a4.0af3a","name":"Downstairs Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestDownstairs Motion00000085","conf":"df59aa47.b26148","x":690,"y":2560,"wires":[["33682101.3212be"]]},{"id":"76c84d5f.4005c4","type":"hb-event","z":"ff6040a4.0af3a","name":"Eva Hallway Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestEva Hallway Motion00000085","conf":"df59aa47.b26148","x":690,"y":2640,"wires":[["33682101.3212be"]]},{"id":"7a765e24.48c12","type":"hb-event","z":"ff6040a4.0af3a","name":"Evas Bedroom Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestEvas Bedroom Motion00000085","conf":"df59aa47.b26148","x":700,"y":2720,"wires":[["33682101.3212be"]]},{"id":"8b3bed0f.80b47","type":"hb-event","z":"ff6040a4.0af3a","name":"Game Room Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestGame Room Motion00000085","conf":"df59aa47.b26148","x":690,"y":2800,"wires":[["33682101.3212be"]]},{"id":"11fbffc2.5a6cd","type":"hb-event","z":"ff6040a4.0af3a","name":"Guest Bedroom Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestGuest Bedroom Motion00000085","conf":"df59aa47.b26148","x":700,"y":2880,"wires":[["33682101.3212be"]]},{"id":"d828c685.f90988","type":"hb-event","z":"ff6040a4.0af3a","name":"Master Bedroom Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestMaster Bedroom Motion00000085","conf":"df59aa47.b26148","x":700,"y":2960,"wires":[["33682101.3212be"]]},{"id":"ac024ecb.f6245","type":"hb-event","z":"ff6040a4.0af3a","name":"Toy Room Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestToy Room Motion00000085","conf":"df59aa47.b26148","x":680,"y":3040,"wires":[["33682101.3212be"]]},{"id":"9a7c2ddd.12c32","type":"hb-event","z":"ff6040a4.0af3a","name":"Toy Room Hallway Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestToy Room Hallway Motion00000085","conf":"df59aa47.b26148","x":710,"y":3120,"wires":[["33682101.3212be"]]},{"id":"477e32e2.b9179c","type":"hb-event","z":"ff6040a4.0af3a","name":"Downstairs Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestDownstairs Smoke00000087","conf":"df59aa47.b26148","x":690,"y":3240,"wires":[["91fbb3e.bdc265"]]},{"id":"4d4c8921.50a488","type":"hb-event","z":"ff6040a4.0af3a","name":"Eva Hallway Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestEva Hallway Smoke00000087","conf":"df59aa47.b26148","x":690,"y":3320,"wires":[["91fbb3e.bdc265"]]},{"id":"df6a6faa.d2385","type":"hb-event","z":"ff6040a4.0af3a","name":"Evas Bedroom Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestEvas Bedroom Smoke00000087","conf":"df59aa47.b26148","x":700,"y":3400,"wires":[["91fbb3e.bdc265"]]},{"id":"9d85201f.a99a4","type":"hb-event","z":"ff6040a4.0af3a","name":"Game Room Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestGame Room Smoke00000087","conf":"df59aa47.b26148","x":690,"y":3480,"wires":[["91fbb3e.bdc265"]]},{"id":"fc78ed7d.328e4","type":"hb-event","z":"ff6040a4.0af3a","name":"Guest Bedroom Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestGuest Bedroom Smoke00000087","conf":"df59aa47.b26148","x":700,"y":3560,"wires":[["91fbb3e.bdc265"]]},{"id":"201c4c8.f670fb4","type":"hb-event","z":"ff6040a4.0af3a","name":"Master Bedroom Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestMaster Bedroom Smoke00000087","conf":"df59aa47.b26148","x":710,"y":3640,"wires":[["91fbb3e.bdc265"]]},{"id":"50cfb55e.1cf7fc","type":"hb-event","z":"ff6040a4.0af3a","name":"Toy Room Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestToy Room Smoke00000087","conf":"df59aa47.b26148","x":680,"y":3720,"wires":[["91fbb3e.bdc265"]]},{"id":"1d688ea0.304451","type":"hb-event","z":"ff6040a4.0af3a","name":"Toy Room Hallway Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestToy Room Hallway Smoke00000087","conf":"df59aa47.b26148","x":710,"y":3800,"wires":[["91fbb3e.bdc265"]]},{"id":"271afcd6.54a884","type":"hb-event","z":"ff6040a4.0af3a","name":"Downstairs Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestDownstairs Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":700,"y":1520,"wires":[["813e3d4b.f9652"]]},{"id":"c80f99e5.33dd98","type":"hb-event","z":"ff6040a4.0af3a","name":"Eva Hallway Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestEva Hallway Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":710,"y":1600,"wires":[["813e3d4b.f9652"]]},{"id":"ba5794aa.cab4a8","type":"hb-event","z":"ff6040a4.0af3a","name":"Evas Bedroom Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestEvas Bedroom Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":710,"y":1680,"wires":[["813e3d4b.f9652"]]},{"id":"de752558.7bacf8","type":"hb-event","z":"ff6040a4.0af3a","name":"Game Room Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestGame Room Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":710,"y":1760,"wires":[["813e3d4b.f9652"]]},{"id":"c0450549.0ec828","type":"hb-event","z":"ff6040a4.0af3a","name":"Guest Bedroom Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestGuest Bedroom Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":720,"y":1840,"wires":[["813e3d4b.f9652"]]},{"id":"b8963e.10b969c","type":"hb-event","z":"ff6040a4.0af3a","name":"Master Bedroom Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestMaster Bedroom Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":720,"y":1920,"wires":[["813e3d4b.f9652"]]},{"id":"8b34dc98.072a5","type":"hb-event","z":"ff6040a4.0af3a","name":"Toy Room Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestToy Room Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":700,"y":2000,"wires":[["813e3d4b.f9652"]]},{"id":"606ad1d8.6d526","type":"hb-event","z":"ff6040a4.0af3a","name":"Toy Room Hallway Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestToy Room Hallway Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":720,"y":2080,"wires":[["813e3d4b.f9652"]]},{"id":"e0346e16.f3f95","type":"hb-event","z":"ff6040a4.0af3a","name":"Anyone","Homebridge":"Homebridge","Manufacturer":"Default-Manufacturer","Service":"Occupancy Sensor","device":"HomebridgeCC:22:3D:E3:CE:30Default-ManufacturerAnyone00000086","conf":"df59aa47.b26148","x":670,"y":740,"wires":[["3264f899.8879a8"]]},{"id":"7b7e8ff6.c561b","type":"hb-event","z":"ff6040a4.0af3a","name":"Mike iPhone Home","Homebridge":"Homebridge","Manufacturer":"Default-Manufacturer","Service":"Occupancy Sensor","device":"HomebridgeCC:22:3D:E3:CE:30Default-ManufacturerMike iPhone Home00000086","conf":"df59aa47.b26148","x":710,"y":820,"wires":[["3264f899.8879a8"]]},{"id":"4acb0da3.b878e4","type":"link out","z":"ff6040a4.0af3a","name":"Go To Prepopulate When Triggered","links":["37b4b528.bf198a","5df71ba.d86bee4","c90c2460.01ede8","e3365ba2.d7d5b8","ee848dbe.73a9b"],"x":240,"y":40,"wires":[],"l":true},{"id":"ee848dbe.73a9b","type":"link in","z":"ff6040a4.0af3a","name":"Prepopulate","links":["4acb0da3.b878e4"],"x":510,"y":740,"wires":[["38f45a8.5354ba6","a42d087f.d2b358"]],"l":true},{"id":"37b4b528.bf198a","type":"link in","z":"ff6040a4.0af3a","name":"Prepopulate","links":["4acb0da3.b878e4"],"x":430,"y":1760,"wires":[["9226bcdd.22d13","cd66026b.82cd9","534c050d.261e4c","3a5ed4d3.c1351c","3cd984ea.0880dc","a0086d61.d3f3","8c6f74ef.9f8928","f8e3a581.85b9d8"]],"l":true},{"id":"5df71ba.d86bee4","type":"link in","z":"ff6040a4.0af3a","name":"Prepopulate","links":["4acb0da3.b878e4"],"x":450,"y":2240,"wires":[["49c85fa.13f89a","3548cebc.d4f4a2","4e24a6e2.9b75a8"]],"l":true},{"id":"e3365ba2.d7d5b8","type":"link in","z":"ff6040a4.0af3a","name":"Prepopulate","links":["4acb0da3.b878e4"],"x":450,"y":2800,"wires":[["53f413b7.c3ca5c","ce3795c5.e37728","c7e14b8e.1343e8","245b547a.2b1c7c","302cfe9e.33a6b2","b3ea379b.64c0c8","7c74e84f.1b53f8","2de8623c.341f8e","4cab8d95.958f64"]],"l":true},{"id":"c90c2460.01ede8","type":"link in","z":"ff6040a4.0af3a","name":"Prepopulate","links":["4acb0da3.b878e4"],"x":450,"y":3480,"wires":[["46f0a2ef.c5843c","117f33b3.9e8cec","98a26761.a381f8","bbbd08cf.b8a6b8","2a9e3a0d.2fd3d6","22389c16.e79774","607645ac.933e8c","a18ab6b7.0783d8"]],"l":true},{"id":"f4d270e1.7080e","type":"comment","z":"ff6040a4.0af3a","name":"after major overhaul version","info":"","x":1660,"y":680,"wires":[]},{"id":"50982242.373c1c","type":"debug","z":"ff6040a4.0af3a","name":"Homebridge Everything","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1630,"y":780,"wires":[]},{"id":"daba477c.d0b948","type":"function","z":"b6874b18.031658","name":"Determine Source For Gsheet lookup properties.","func":"//Read subflow input variables\nif (env.get(\"OverrideEnvVariables\"))\n{\n    //Put inputs and read values into msg properties to be visible downstream\n    msg.sheet = msg.SpreadsheetID;\n    msg.tab = msg.Tab;\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    msg.topic = msg.targetrange\n    delete msg.Tab\n    delete msg.SpreadsheetID\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\n}\nelse if (msg.IgnoreEnvVar)\n{\n    //Put inputs and read values into msg properties to be visible downstream\n    msg.sheet = msg.SpreadsheetID;\n    msg.tab = msg.Tab;\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    msg.topic = msg.targetrange\n    delete msg.Tab\n    delete msg.SpreadsheetID\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\n}\nelse\n{\n    var ColStart = env.get(\"ColStart\");\n    var ColEnd = env.get(\"ColEnd\");\n    var FirstRow = env.get(\"MinRow\");\n    var LastRow = env.get(\"MaxRow\");\n    //Put inputs and read values into msg properties to be visible downstream\n    msg.sheet = env.get(\"Spreadsheet ID\");\n    msg.tab = env.get(\"TabName\");\n    msg.cellstart = ColStart + FirstRow\n    msg.cellend = ColEnd + LastRow\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    msg.topic = msg.targetrange\n    delete msg.Tab\n    delete msg.SpreadsheetID\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\n    //These 2 are needed later to calculate the last populate and first empty rows and columns\n    msg.ColStart = ColStart\n    msg.MinRow = FirstRow\n}\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":20,"wires":[["9f2afd8e.d93aa","1bb2c264.b76e9e"]],"info":"This node sets up the inputs to the GSheet node.\nThe outputs that make up those inputs are:\n - msg.sheet -the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n - msg.topic - the combination of spreadsheet tab and cell range\n## Note\nThere are 2 very similar booleans evaluated by this node. They are:\n * **OverrideEnvVariables** - This one looks at the environment variable that was set in the flow triggering the subflow\n * **msg.IgnoreEnvVar** - This one is allows the logic to be driven by a message object property and thus can be set at runtime or earlier in the flow based on upstream logic\n\nFirst it checks the boolean value of the **OverrideEnvVariables** environment variable. This is by default false. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming the first was false, it checks the boolean value of the **msg.IgnoreEnvVar** value. This will evaluated as false if not populated, so sending false is unnecessary. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming both are false, then it can build the outputs based on the subflows environment variables. These can either be those set in the calling flow or they may be the default ones built into the subflow.\n\nRegardless of the method used to build the output, the node also removes the input message properties.\n\n\n\nmsg.IgnoreEnvVar"},{"id":"9f2afd8e.d93aa","type":"GSheet","z":"b6874b18.031658","creds":"adb4e9b8.8beee8","method":"get","action":"","sheet":"","cells":"","name":"Read Input from GSheet","x":610,"y":20,"wires":[["9490535.22439b"]],"info":"Use the GSheet node to get the a set of rows from a google spreadsheet.\n\n# **Inputs**\n### **creds**\nThis is the name on the gauth configuration node. How to get the details is beyond the scope of what I am going to put into an individual node instance. Some details are at [node-red-contrib-google-sheets](https://flows.nodered.org/node/node-red-contrib-google-sheets)\n### **Method**\nIn this case using the get cells method to read a set of data.\n### **SpreadsheetID**\nUnused as the spreadsheet ID is passed in as part of the input msg, but if needed it would be the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n### **Cells**\nUnused as the requested cells are passed in as part of the input msg, but if it was being manually built for a static data source the format is made of of 3 parts with specific seperators:\n * **[Sheetname]** like Sheet1\n * **[upper left corner cell address]** like A1\n * **[lower right corner cell address]** like B2\n\nThe format is **[Sheetname]**!**[upper left corner cell address]**:**[lower right corner cell address]** giving an input like **Sheet1!A1:B2**\n "},{"id":"b4f70be3.1a30e8","type":"comment","z":"b6874b18.031658","name":"Error","info":"","x":1090,"y":20,"wires":[]},{"id":"39bfc825.8a9748","type":"comment","z":"b6874b18.031658","name":"Last Populated Row","info":"","x":1130,"y":100,"wires":[]},{"id":"7c39f16.0e7151","type":"function","z":"b6874b18.031658","name":"Prepare Output Parts","func":"/*\n * Row response calculations\n */\nmsg.LastPopulatedRow = msg.payload.length + Number(msg.MinRow) - 1\nmsg.FirstEmptyRow = msg.LastPopulatedRow + 1\n\n/*\n *Column response calculation variables\n */\nlet colCount = 1 //number of columns wide from the data retrieved. This will eventually be replace by logic that loops through array find the max width for any given row\nlet index\nlet sheetdata = msg.payload //this is the data that is returned from Google that will then be examined\nlet fCol = msg.ColStart\nlet fColTotal = 0 //to hold the column number\nlet nCol = \"\"   //nCol is new column\nlet lCol = \"\"   //lCol is last column in the range (to be populated from the actual Gsheet calls data)\n\nfCol = fCol.toUpperCase()\n/*\n * validate fCol (done)\n */\nlet validStartCol = false\nvalidStartCol = ((fCol.length == 1) ||\n                ((fCol.substr(0, 1).charCodeAt(0) - 64) < 9) ||\n                (((fCol.substr(0, 1).charCodeAt(0) - 64) == 9) && ((fCol.substr(1, 1).charCodeAt(0) - 64) <= 22)))\n/*\n *Column response calculations\n */\n//look at each row that is an array\nfor (index = 0; index < sheetdata.length; index++)\n{\n    if (Array.isArray(sheetdata[index]))\n    {\n        // when the rows width is greater than any of the previous rows set the column count to the new largest width\n        colCount = Math.max(colCount, sheetdata[index].length)\n    } //if (Array.isArray(sheetdata[index]))\n}  //for (index = 0; index < sheetdata.length; index++)\nswitch (fCol.length) {\n    case 1:\n        fColTotal = (fCol.substr(0, 1).charCodeAt(0) - 64)\n        fColTotal += colCount - 1\n        break\n    case 2:\n        fColTotal = (fCol.substr(1, 1).charCodeAt(0) - 64) + 26 * (fCol.substr(0, 1).charCodeAt(0) - 64)\n        fColTotal += colCount - 1\n        break\n    default:\n        fColTotal = -1\n}\n//Last Populated Column and First Empty Column calculation\nif ((fColTotal <= 25) && (fColTotal >= 1)) {\n    lCol = String.fromCharCode(fColTotal+64)\n    nCol = String.fromCharCode(fColTotal+65)\n} else if (fColTotal == 26) {\n    lCol = \"Z\"\n    nCol = \"AA\"\n} else if (fColTotal >= 27) {\n    lCol = String.fromCharCode((Math.floor(fColTotal / 26)) + 64) + String.fromCharCode((fColTotal % 26) + 64)\n    nCol = String.fromCharCode((Math.floor(fColTotal / 26)) + 64) + String.fromCharCode((fColTotal % 26) + 65)\n} else if (fColTotal == -1) {\n    lCol = \"Error\"\n    nCol = \"Error\"\n    //Probably worth putting real error here, but deferred\n} else if (fColTotal == 256) {\n    lCol = \"IV\"\n    nCol = \"None\"\n}\nmsg.LastPopulatedCol = lCol\nmsg.FirstEmptyCol = nCol\nmsg.SpreadsheetArray = msg.payload\nreturn msg;","outputs":1,"noerr":0,"x":560,"y":540,"wires":[["a801b477.ec11b8","79b3124e.18036c","56be010e.c2e1e","1a59a46b.8ee7cc","1ad4dcad.4bea93","d23fbda5.934a8"]],"info":"Takes an input from the Gsheet node and calculates a variety of details about the spreadsheet info.\n### **Output**\nmsg.LastPopulatedRow\nmsg.FirstEmptyRow\nmsg.LastPopulatedCol\nmsg.FirstEmptyCol\nmsg.SpreadsheetArray\n"},{"id":"f1b9899f.99c998","type":"comment","z":"b6874b18.031658","name":"First Empty Row","info":"","x":1120,"y":180,"wires":[]},{"id":"269ce5a2.a6736a","type":"comment","z":"b6874b18.031658","name":"Last Populated Column","info":"","x":1140,"y":260,"wires":[]},{"id":"2e057bf3.12f324","type":"comment","z":"b6874b18.031658","name":"First Empty Column","info":"","x":1130,"y":340,"wires":[]},{"id":"1b7f8428.b0bcdc","type":"comment","z":"b6874b18.031658","name":"Spreadsheet Array","info":"","x":1130,"y":420,"wires":[]},{"id":"36332c07.5d5fa4","type":"comment","z":"b6874b18.031658","name":"Full Data","info":"","x":1100,"y":500,"wires":[]},{"id":"f77a52ec.51d4a","type":"comment","z":"b6874b18.031658","name":"Full Data with Inputs","info":"","x":1130,"y":580,"wires":[]},{"id":"a801b477.ec11b8","type":"change","z":"b6874b18.031658","name":"Leave Outputs","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":540,"wires":[[]],"info":"Deletes a variety of message properties, but leaves all of them that were calculated about the Gsheet nodes results to be returned on the designated subflow output."},{"id":"79b3124e.18036c","type":"change","z":"b6874b18.031658","name":"Leave Last Populated Row","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"LastPopulatedRow","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":140,"wires":[[]],"info":"Copies msg.theLastPopulatedRow into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"56be010e.c2e1e","type":"change","z":"b6874b18.031658","name":"Leave First Empty Row","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"FirstEmptyRow","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":870,"y":220,"wires":[[]],"info":"Copies msg.FirstEmptyRow into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"1a59a46b.8ee7cc","type":"change","z":"b6874b18.031658","name":"Leave Last Populated Column","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"LastPopulatedCol","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":890,"y":300,"wires":[[]],"info":"Copies msg.LastPopulatedCol into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"1ad4dcad.4bea93","type":"change","z":"b6874b18.031658","name":"Leave First Empty Column","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"FirstEmptyCol","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":380,"wires":[[]],"info":"Copies msg.FirstEmptyCol into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"d23fbda5.934a8","type":"change","z":"b6874b18.031658","name":"Leave Spreadsheet Array","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"SpreadsheetArray","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":870,"y":460,"wires":[[]],"info":"Copies msg.SpreadsheetArray into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"f864fa61.279958","type":"trigger","z":"b6874b18.031658","name":"Watchdog","op1":"","op2":"timeout","op1type":"nul","op2type":"str","duration":"10","extend":true,"units":"s","reset":"","bytopic":"all","outputs":1,"x":600,"y":140,"wires":[["1a59a46b.8ee7cc","79b3124e.18036c","1ad4dcad.4bea93","d23fbda5.934a8","a801b477.ec11b8"]],"info":"This trigger node works as a watchdog to see if the request to see if the read of the Google Sheet that was triggered on the other branch is successful. If it is succeful, then it will receive a reset message (msg.reset) from the Reset Watchdog node. If, however, 10 seconds elapse without receiving the reset message, this node sends a timeout message (msg.timeout)."},{"id":"1bb2c264.b76e9e","type":"change","z":"b6874b18.031658","name":"","rules":[{"t":"set","p":"timeout","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":120,"wires":[["f864fa61.279958"]],"info":"Labels what the initial input to the watchdog trigger node is."},{"id":"1c7e4600.3399da","type":"change","z":"b6874b18.031658","name":"","rules":[{"t":"delete","p":"reset","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":350,"y":540,"wires":[["7c39f16.0e7151"]],"info":"Removes msg.reset that was only intended for the watchdog trigger node."},{"id":"8f22cf12.4d74","type":"catch","z":"b6874b18.031658","name":"Catch and Relay Errors","scope":null,"uncaught":false,"x":860,"y":60,"wires":[["a892cfb8.e6e4e"]],"info":"Passes any caught error to the error subflows intentially built error output. By intentionally built I mean I created one and labelled it as such. This is not there by default."},{"id":"9490535.22439b","type":"change","z":"b6874b18.031658","name":"Reset Watchdog","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":140,"y":140,"wires":[["f864fa61.279958","1c7e4600.3399da"]],"info":"Sends the reset message to the watchdog triger node when there is output from the Gsheet node."},{"id":"421be18e.abf21","type":"function","z":"11c4fe96.587e41","name":"Db Put the payload into a global variable named after the content of msg.globalsource","func":"global.set(msg.globalsource, msg.payload)\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":400,"wires":[["36c11796.981068"]],"info":"# **What** #\nThis is a simple function node that stores the msg.payload into a global variable. This is done in a function node, however, because the name of that global variable is passed into the function as a the value of msg.globalsource. \n\n## **Why**\nNormally this would be done in a change node, but change nodes could not as of May 2020 take a msg object component as the name of the global variable to be set."},{"id":"be3de0e3.494f8","type":"subflow:b6874b18.031658","z":"11c4fe96.587e41","name":"","env":[],"x":580,"y":189,"wires":[[],[],[],[],[],[],["421be18e.abf21"],[]],"info":"This subflow shows information in the environment variables. These are good for testing purposes, but it is noteworthy that the override boolean is false. Unless that boolean is changed, they have no impact."},{"id":"36c11796.981068","type":"function","z":"11c4fe96.587e41","name":"Db Use input to lookup info","func":"//Ref. TMS-000001\n\n//if(msg.exportableresults.DeviceName !== \"Switch_Ikea\") {return}\n\n\n\n//1 Get must have items: searchKeys, searchValues, searchResultKeys, cachedSearch, cacheTime\n//debugger\nlet searchKeys = Object.keys(msg.keyvalues)\nlet searchValues = Object.values(msg.keyvalues)\nlet searchResultKeys = Object.keys(msg.searchfor)\nlet cachedSearch = global.get(\"LastSearch\")\nlet cacheTime = new Date().getTime()\n//2 create working variables searchKeyIndices, searchResultKeysIndices, index, cacheKey\nlet searchResultKeysIndices = []\nlet index\nlet cacheObject\n//3 build the cache key which is essentially the concatenation of key+value+nextkey+nextvalue+.....etc\ncacheObject = BuildCacheObject(searchKeys, searchValues, searchResultKeys)\n//4\n/*\n * 4.1 t/f cached result is usable\n    *  4.1.true then t/f does it meet criteria\n        * 4.1.true.true\ttrue msg.searchfor = cachedSearch.searchfor\n        * 4.1.true.false do the common lookup\n    *   4.1.false  do the common lookup\n    */\n//4.1\nif (cachedSearch !== undefined)\n{\n    //4.1.true\n    if ((cachedSearch.query == cacheObject.query) && (cachedSearch.time > cacheObject.time - 5000))\n    {\n        //4.1.true.true\n        msg.searchfor = cachedSearch.searchfor\n        return [msg, null, null]\n    } //if ((cachedSearch.query == cacheObject.query) && (cachedSearch.time > cacheObject.time - 5000))\n    //4.1.true.false\n    else\n    {\n        //4.1.true.false\n        lookupResults = CommonLookup(msg, searchKeys, searchResultKeys, searchValues, global.get(msg.globalsource), cacheObject)\n        //return results from the node on 1 of the 3 outputs\n        if (lookupResults[0] !== null)\n        {\n            return [lookupResults[0], null, null]\n        } //if (lookupResults[0] !== null)\n        else if (lookupResults[1] !== null)\n        {\n            return [null, lookupResults[1], null]\n        } //else if (lookupResults[1] !== null)\n        else\n        {\n            return [null, null, lookupResults[2]]\n        } //else if (lookupResults[1] !== null) else\n    } //if ((cachedSearch.query == cacheObject.query) && (cachedSearch.time > cacheObject.time - 5000)) else\n} //if (cachedSearch !== undefined)\n//4.1.false\nelse\n{\n    //4.1.false\n    lookupResults = CommonLookup(msg, searchKeys, searchResultKeys, searchValues, global.get(msg.globalsource), cacheObject)\n    //return results from the node on 1 of the 3 outputs\n    if (lookupResults[0] !== null)\n    {\n        return [lookupResults[0], null, null]\n    } //if (lookupResults[0] !== null)\n    else if (lookupResults[1] !== null)\n    {\n        return [null, lookupResults[1], null]\n    } //else if (lookupResults[1] !== null)\n    else\n    {\n        return [null, null, lookupResults[2]]\n    } //else if (lookupResults[1] !== null) else\n} //if (cachedSearch !== undefined) else\nreturn\n\nfunction BuildCacheObject(searchKeysArray, SearchValuesArray, SearchResultKeysArray) {\n    //3 build the cache key which is essentially the concatenation of key+value+nextkey+nextvalue+.....etc\n    let newCacheKey =\"\"\n    for (index = 0; index < searchKeysArray.length; index++)\n    {\n        newCacheKey = newCacheKey + searchKeysArray[index] + SearchValuesArray[index]\n    } //for (index = 0; index < searchKeysArray.length; index++)\n    //add all fields that will be looked for into the cache key\n    for (index = 0; index < SearchResultKeysArray.length; index++)\n    {\n        newCacheKey = newCacheKey + SearchResultKeysArray[index]\n    } //for (index = 0; index < SearchResultKeysArray.length; index++)\n    //combine the cache key and the cache time into a single object that can be compared with the cached last search\n    let createdCacheObject = \n    {\n        query: newCacheKey,\n        time: cacheTime\n    }\n    return createdCacheObject\n}\nfunction CommonLookup(workingMsg, keysForSearchColumn, keysForResultColumn, valuesSearchedFor, requestedDataTable, passedCacheObject) {\n    let searchKeyIndices = []\n    let searchResultKeysIndices = []\n    let outerIndex\n    let innerLoopCounter\n    let innerIndex\n    let index\n    if (requestedDataTable !== undefined)\n    {\n        // iterate through all search keys.\n        //outer index is the place along the array of search keys\n        for (outerIndex = 0; outerIndex < keysForSearchColumn.length; outerIndex++)\n        {\n            //inner index is the place along the first row of data\n            //The innerLoopCounter must be reset each time a new key is being looked for\n            innerLoopCounter = 0\n            for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n            {\n                //these 2 loops will compare every entry in the top row of the data table to every entry in the array of search keys,\n                if (requestedDataTable[0][innerIndex] == keysForSearchColumn[outerIndex])\n                {\n                    //when they match push the column number on to the array that has just indices for the search keys\n                    searchKeyIndices.push(innerIndex)\n                    //break is used to stop comparing as once the column has been found the remaining aren't relevant\n                    //////////////////////////////////////////////////////////////////////////break may be a problem. Maybe swap inner and outer arrays and then do some if then about getting through the whole data headers without finding. Right now it only looks for 1 failure\n                    break\n                } //if (requestedDataTable[0][innerIndex] == keysForSearchColumn[outerIndex])\n                else\n                {\n                    //when they don't match, then this means there is a search key that does not match any header.\n                    //When properly configured this should not happen, but proper configuration cannot be guaranteed\n                    //this is accumulating how many times the search key did not match one of the data table headers\n                    innerLoopCounter++\n                    //Error messaging should only happen if the search key has been compared with all of the headers\n                    //requestedDataTable[0].length gives the total number of data headers (columns of the spreadsheet)\n                    if (requestedDataTable[0].length == innerLoopCounter)\n                    {\n                        //populate error \n                        //put some details on this configuration into the msg to be output\n                        workingMsg.error = \"Key with value \\\"\" + keysForSearchColumn[outerIndex] + \"\\\" not found amongst the \" + (requestedDataTable[0].length + 1) + \" entries, which include \" + requestedDataTable[0]\n                        //either create and populate the error count at 1 or increment it if it already exists\n                        if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n                        {\n                                workingMsg.searchErrorCount++\n                        }\n                        else\n                        {\n                            workingMsg.searchErrorCount = 1\n                        }\n                        //this retry is in case the column was added to the google sheet since it was last loaded into node red\n                        if (workingMsg.searchErrorCount > 1)\n                        {\n                            //return the error on the bottom because with a count of 2 that means reloading has already been tried\n                            return [null, null, workingMsg]\n                        }\n                        else\n                        {\n                            //return the error on the middle there is an error output,\n                            return [null, workingMsg, null]\n                        }\n                    } //if (requestedDataTable[0].length == innerLoopCounter)\n                } //if (requestedDataTable[0][innerIndex] == keysForSearchColumn[outerIndex]) else\n            } //for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n        } //for (outerIndex = 0; outerIndex < keysForSearchColumn.length; outerIndex++)\n        //if this point is reached, searchKeyIndices has been populated\n        // iterate through all search result keys.\n        //outer index is the place along the array of search keys \n        for (outerIndex = 0; outerIndex < keysForResultColumn.length; outerIndex++)\n        {\n            //inner index is the place along the first row of data\n            //The innerLoopCounter must be reset each time a new key is being looked for\n            innerLoopCounter = 0\n            for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n            {\n                //these 2 loops will compare every entry in the top row of the data table to every entry in the array of search keys,\n                if (requestedDataTable[0][innerIndex] == keysForResultColumn[outerIndex])\n                {\n                    //when they match push the column number on to the array that has just indices for the search keys\n                    searchResultKeysIndices.push(innerIndex)\n                    //break is used to stop comparing as once the column has been found the remaining aren't relevant\n                    break\n                } //if (requestedDataTable[0][innerIndex] == keysForResultColumn[outerIndex])\n                else\n                {\n                    //when they don't match, then this means there is a search key that does not match any header.\n                    //When properly configured this should not happen, but proper configuration cannot be guaranteed\n                    innerLoopCounter++\n                    //Error messaging should only happen if the search key has been compared with all of the headers\n                    //requestedDataTable[0].length gives the total number of data headers (columns of the spreadsheet)\n                    if (requestedDataTable[0].length == innerLoopCounter)\n                    {\n                        //populate error \n                        //put some details on this configuration into the msg to be output\n                        workingMsg.error = \"Key with value \\\"\" + keysForSearchColumn[outerIndex] + \"\\\" not found amongst the \" + (requestedDataTable[0].length + 1) + \" entries, which include \" + requestedDataTable[0]\n                        //either create and populate the error count at 1 or increment it if it already exists\n                        if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n                        {\n                            workingMsg.searchErrorCount++\n                        } //if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n                        else\n                        {\n                            workingMsg.searchErrorCount = 1\n                        } //if ( workingMsg.hasOwnProperty(\"searchErrorCount\")) else\n                        //this retry is in case the column was added to the google sheet since it was last loaded into node red\n                        if (workingMsg.searchErrorCount > 1)\n                        {\n                            //return the error on the bottom because with a count of 2 that means reloading has already been tried\n                            return [null, null, workingMsg]\n                        } //if (workingMsg.searchErrorCount > 1)\n                        else\n                        {\n                            //return the error on the middle there is an error output,\n                            return [null, workingMsg, null]\n                        } //if (workingMsg.searchErrorCount > 1) else\n                    } //if (requestedDataTable[0].length == innerLoopCounter)\n                } //if (requestedDataTable[0][innerIndex] == keysForResultColumn[outerIndex]) else\n            } //for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n        } //for (outerIndex = 0; outerIndex < keysForResultColumn.length; outerIndex++)\n        //if this point is reached, both searchKeyIndices and searchResultKeysIndices have been populated\n        //loop through all search keys, 1 index at a time and filter to a row that has the desired data in the desired column\n        let result = []\n        let pushable\n        pushable = false\n        for (outerIndex = 0; outerIndex < requestedDataTable.length; outerIndex++)\n        {\n            for (innerIndex = 0; innerIndex < searchKeyIndices.length; innerIndex++)\n            {\n                if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex])\n                {\n                    pushable = true\n                } //if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex])\n                else\n                {\n                    pushable = false\n                    break\n                } //if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex]) else\n            } //for (innerIndex = 0; innerIndex < searchKeyIndices.length; innerIndex++)\n            if (pushable)\n            {\n                result.push(requestedDataTable[outerIndex])\n            } //if (pushable)\n    \n    } //for (outerIndex = 0; outerIndex < requestedDataTable.length; outerIndex++)\n        //if this point is reached then there is a filtered table\n        //debugger\n        if (result.length === 0)\n        {\n            workingMsg.error = \"After filtering no data rows were left.\"\n            //either create and populate the error count at 1 or increment it if it already exists\n            if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n            {\n                workingMsg.searchErrorCount++\n            } //( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n            else\n            {\n                workingMsg.searchErrorCount = 1\n            } //( workingMsg.hasOwnProperty(\"searchErrorCount\")) else\n            //return the error on the middle there is an error output,\n            //this retry is in case the column was added to the google sheet since it was last loaded into node red\n            if (workingMsg.searchErrorCount > 1)\n            {\n                //return the error on the bottom because with a count of 2 that means reloading has already been tried\n                return [null, null, workingMsg]\n            } //if (workingMsg.searchErrorCount > 1)\n            else\n            {\n                //return the error on the middle there is an error output,\n                return [null, workingMsg, null]\n            } //if (workingMsg.searchErrorCount > 1) else\n        } //if (result.length === 0)\n        else if (result.length > 1)\n        {\n            //do the warning that multiple were found but will take the first\n            node.warn(\"Multiple rows were found that matched the search criteria. Results are from the first row that was found and matched.\")\n        } //else if (result.length > 1)\n        //look up the data\n        for (index = 0; index < searchResultKeysIndices.length; index++)\n        {\n            //workingMsg.searchfor.keysForSearchColumn[index] = result[0][searchResultKeysIndices]\n            // the almost working version\n            workingMsg.searchfor[keysForResultColumn[index]] = result[0][searchResultKeysIndices[index]]\n        } //for (index = 0; index < searchResultKeysIndices.length; index++)\n        //if this point is reached then work workingMsg contains complete info\n        //build and save the LastSearch obect\n        passedCacheObject.searchfor = workingMsg.searchfor\n        global.set(\"LastSearch\", passedCacheObject)\n        return [workingMsg, null, null]\n    } //if (requestedDataTable !== undefined)\n    else\n    {\n        //return on second output to trigger population of global that feeds datatable\n        //put some details on this configuration into the msg to be output\n        workingMsg.error = \"The data normally loaded from google sheet was not loaded.\"\n        //either create and populate the error count at 1 or increment it if it already exists\n        if (workingMsg.hasOwnProperty('searchErrorCount'))\n        {\n            workingMsg.searchErrorCount++\n        } //if (workingMsg.hasOwnProperty('searchErrorCount'))\n        else\n        {\n            workingMsg.searchErrorCount = 1\n        } //if (workingMsg.hasOwnProperty('searchErrorCount')) else\n        //return the error on the middle there is an error output,\n        //this retry is in case the column was added to the google sheet since it was last loaded into node red\n        if (workingMsg.searchErrorCount > 1)\n        {\n            //return the error on the bottom because with a count of 2 that means reloading has already been tried\n            return [null, null, workingMsg]\n        } //if (workingMsg.searchErrorCount > 1)\n        else\n        {\n            //return the error on the middle there is an error output,\n            return [null, workingMsg, null]\n        } //if (workingMsg.searchErrorCount > 1) else\n    } //if (requestedDataTable !== undefined) else\n}","outputs":3,"noerr":0,"x":240,"y":80,"wires":[[],["be3de0e3.494f8"],[]],"outputLabels":["Value Found","Error but try reloading from data source","Error despite having tried to reload from data source"],"info":"# **Conceptual Explanation**\nThis node is designed to use a 2-D array of data loaded from a google sheeet to lookup desired data. The data is arrayed with the first row being column headers describing the data in those columns in subsequent rows.\n## **inputs**\n### globalsource \nThe name of the global variable holding the table of data\n### msg.keyvalues\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row.\n### msg.searchfor\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. The value enters the node empty.\n## **outputs**\n### Output1: Value Found \nThis ouput is used when the node has successfully identified the requested data. That data is placed into the value portions of the key value pairs that made up the msg.searchfor input\n### Output 2: Error but try reloading from data source\nThis output is used when either the global variable to contain the data table either does no exist or does not contain a row with all of the requested search criteria. Normally it is used to trigger loading the table from Google sheets under the expectation that either this is the first time a lookup has been tried an the data had not yet been cached in the global variable or potentially the data in the cache has become stale and reloading from the Google sheet will add a row that will match the requested search criteria.\n### Output 3: Error despite having tried to reload from data source\nThis output is used when either the global variable to contain the data table either does no exist or does not contain a row with all of the requested search criteria and at least 1 attempt has already been made to reload the global vairable cache. This is effectively a notification of non-recoverable lookup failure."},{"id":"ef98bece.d882d","type":"change","z":"11c4fe96.587e41","name":"Devices table, 1 search key with variable input, 1 result","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"exportableresults.DeviceName","tot":"msg"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":980,"y":100,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value pulled from the **msg.exportableresults.DeviceName** object.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** column.\n"},{"id":"d5cb8419.4eb818","type":"change","z":"11c4fe96.587e41","name":"Devices table, 1 search key, 2 results","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"Motion_Ikea","tot":"str"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.Manufacturer","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":180,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value **\"Motion_Ikea\"**.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** and **\"Manufacturer\"** columns."},{"id":"f0932995.8f8988","type":"change","z":"11c4fe96.587e41","name":"Devices table, 1 search key, 1 result","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"Anyone Presence","tot":"str"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":60,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value **\"Anyone Presence\"**. Notice unlike some examples this includes a space in the value. This has no negative impact.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** column."},{"id":"6c419292.c6197c","type":"change","z":"11c4fe96.587e41","name":"Devices table, 2 search keys, 1 results","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"Anyone Presence","tot":"str"},{"t":"set","p":"keyvalues.Manufacturer","pt":"msg","to":"homebridge-people-geofence","tot":"str"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":140,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value **\"Anyone Presence\"** and the **\"Manufacturer\"** column for the value **\"homebridge-people-geofence\"**.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** columns."},{"id":"5c3eb982.7c5b28","type":"comment","z":"11c4fe96.587e41","name":"Examples of preformating the inputs","info":"","x":920,"y":20,"wires":[]},{"id":"e7340bae.af3d18","type":"change","z":"11c4fe96.587e41","name":"Spreadsheet Lookup Settings Example","rules":[{"t":"set","p":"IgnoreEnvVar ","pt":"msg","to":"true","tot":"bool"},{"t":"set","p":"SpreadsheetID","pt":"msg","to":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","tot":"str"},{"t":"set","p":"Tab","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"ColStart","pt":"msg","to":"A","tot":"str"},{"t":"set","p":"ColEnd","pt":"msg","to":"Z","tot":"str"},{"t":"set","p":"MinRow","pt":"msg","to":"1","tot":"str"},{"t":"set","p":"MaxRow","pt":"msg","to":"1000","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":260,"wires":[[]],"info":"## **inputs**\n### IgnoreEnvVar \nThis boolean needs to be true to tell that Read Spreadsheet For Details subflow that it should use the specs passed in the msg to determine what spreadsheet to read from and what portion of data to read from.\n### msg.SpreadsheetID\nThis is the very long string that identifies a specific google spreadsheet.\n### msg.Tab\nSpecifies the tab name that contains the data.\n### msg.ColStart\nSpecifies the leftmost column containing the desired data.\n### msg.ColEnd\nSpecifies the rightmost column containing the desired data. \n### msg.MinRow\nSpecifies the top row containing the desired data \n### msg.MaxRow\nSpecifies the bottom row containing the desired data "},{"id":"d9481b76.8ba9e8","type":"inject","z":"ff6040a4.0af3a","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1480,"y":1120,"wires":[["62252422.94e54c"]]},{"id":"62252422.94e54c","type":"function","z":"ff6040a4.0af3a","name":"Rertrieve My HomebridgeTestingSample ","func":"msg = global.get(\"HomebridgeTestingSample\")\nreturn msg","outputs":1,"noerr":0,"x":1880,"y":1160,"wires":[["b73d3afd.66b528","3e29fad3.a58da6"]]},{"id":"b73d3afd.66b528","type":"debug","z":"ff6040a4.0af3a","name":"Catch My Testing Sample","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2250,"y":1160,"wires":[]},{"id":"3e29fad3.a58da6","type":"change","z":"ff6040a4.0af3a","name":"Put device ID into msg.deviceID and payload into payload.value","rules":[{"t":"set","p":"temp","pt":"msg","to":"payload","tot":"msg"},{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.value","pt":"msg","to":"temp","tot":"msg"},{"t":"delete","p":"temp","pt":"msg"},{"t":"set","p":"exportableresults.MQTTname","pt":"msg","to":"homebridge","tot":"str"},{"t":"set","p":"exportableresults.DeviceName","pt":"msg","to":"name","tot":"msg"},{"t":"set","p":"payload.name","pt":"msg","to":"name","tot":"msg"},{"t":"set","p":"MQTTName","pt":"msg","to":"homebridgedev","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1870,"y":1240,"wires":[["1af3722c.e251de","60c7617d.b6c27"]]},{"id":"60c7617d.b6c27","type":"function","z":"ff6040a4.0af3a","name":"Split kv pairs (from value) into 1-n msg stream (ready for testing)","func":"///////////////////////////////////////////////////////////////////\n//debugger\n///////////////////////////////////////////////////////////////////\n/*\n * Main function node code \n * \n */\n//Check if there is any data. If not, stop processing. At the time this was created, the trackData sent from a Hubitat Elevation device node was always null\nif (msg.payload.value === null) {\n    return null;\n}\n//delete the currentValue portion of the object since it is deprecated\ndelete msg.payload.currentValue\n//initial call into the recursive function\nhandlemsg(msg)\n//send nothing from main code\nreturn\n\n/*\n * Main recursive function code\n *\n */\n\nfunction handlemsg(msg) {\n    //The evaluation part of this switch/case statement determines which type of entity is in the value\n    //  the key idea is that once the value is an atomic item (number, string, bool) then the message should be sent out\n    //  of the node to downstream, but if the value is a splittable, then it should be split into multiple messages. These\n    //  messages are then evaulated individually. They in turn are either found to have atomic entries in the value or have\n    //  values that are themselves splittable.\n    //  For example:\n    //  JSON - each key value pair will be used to create a new msg. The msg.payload.name will be changed to add \":\" and the key\n    //          from the key value pair. The msg.payload.value will become the value from the key value pair\n    //  Array - TBAdded\n    //  Object - TBAdded\n    switch (typeofhubitatvalue(msg.payload.value, \"msg.payload.value\")) {\n        case \"number\":\n        case \"bigint\":\n            //numbers are an atomic type of value and should be sent to downstream nodes\n            msg.payload.dataType = \"Number\"\n            //send the version of the msg with an atomic value to downstream nodes\n            node.send(msg)\n            //do nothing more once msg has been sent\n            break;\n        case \"boolean\":\n            //Booleans are an atomic type of value and should be sent to downstream nodes\n            msg.payload.dataType = \"Boolean\"\n            //send the version of the msg with an atomic value to downstream nodes\n            node.send(msg)\n            //do nothing more once msg has been sent\n            break;\n        case \"string\":\n            //Strings are an atomic type of value and should be sent to downstream nodes\n            msg.payload.dataType = \"String\"\n            //send the version of the msg with an atomic value to downstream nodes\n            node.send(msg)\n            //do nothing more once msg has been sent\n            break;\n        case \"unsplittable array\":\n            //This case is where the item is an array, but with only a single entry. The idea is to move that single\n            //  value out of the array and into the value natively and then to call the recursive function to evaluate\n            //  what type of item it now is and then process (split or send or extract) appropriately\n            msg.payload.value = msg.payload.value[0]\n            handlemsg(msg)\n            break;\n        case \"splittable JSON\":\n            //This is for cases where the JSON is in the form of key:value where there is at least 1 pair\n            //  Examples of \"valid\" JSON that would not be coming to this case would be {} or 100\n            splitJSON(msg)\n            break;\n        case \"splittable array\":\n            //This is for cases where the Array is in the form [\"A\",\"B\",\"C\"] where there is are at least 2 members\n            //  SplitArray function not yet built. TBD\n            splitArray(msg)\n            break;\n        case \"unsplittable JSON\":\n            //This is for handling \"valid\" JSON that does not have key:value pairs.\n            //  Examples of \"valid\" JSON that are handed here are {} or 100 or \"100\"\n            //  This case either treats it as a string (no changes made) or a number where a number in\n            //  a string like \"100\" is changed into an actual number like 100\n\n            //by checking if NaN, if it is a number 100 or \"100\", the ++ followed by -- changes it to a number 100\n            //  without changing its actual value\n            if (isNaN(msg.payload.value)) { } else {\n                ++msg.payload.value;\n                --msg.payload.value;\n            }\n            //Sets the data type for downstream since the incoming message could have been a variety of types\n            //  before JSON, object or array was split\n            msg.payload.dataType = typeof (msg.payload.value)\n            //send the version of the msg with an atomic value to downstream nodes (could probably just recursively call\n            //  handlemsg, but I can't identify a circumstance where that would give a different result to downstream,\n            //  but this would be a place to investigate if downstream results are unexpected.)\n            node.send(msg)\n            break\n        case \"object\":\n            //This is for handling an object. It then calls splitObj to create multiple msgs with the object keys into the names\n            //  and the values from those keys moved into the value of the new object.\n            splitObj(msg)\n            break\n        default:\n            //This is just in case no valid process is found by the typeofhubitatvalue function.\n            //  If you encounter this then you will either need to investigate the function or contact tmichael in\n            //  Hubitat discourse forums https://community.hubitat.com/\n            return\n    }\n}\n\n/*\n * This function is used by the Main recursive function (handlemsg) to decide whether to send the msg on as\n *  the msg.payload.value is atomic or if it needs to split the value into multiple msgs\n *\n */\nfunction typeofhubitatvalue(value, source = \"\") {\n    switch (typeof (value)) {\n        case \"number\":\n            //atomic just return the result of typeof\n            return \"number\"\n            break;\n        case \"bigint\":\n            //atomic just return the result of typeof\n            return \"bigint\"\n            break;\n        case \"boolean\":\n            //atomic just return the result of typeof\n            return \"boolean\"\n            break;\n        case \"string\":\n            //most splittable values are encoded strictly as text and so may be identified as a string\n\n            //Fist check if the string is \"valid\" JSON\n            if (isvalidJSONstring(value)) {\n                //When it is \"valid\" JSON, check if it is splittable\n                if (issplittablevalidJSONstring(value)) {\n                    //When it is splittable, then return type as splittable JSON\n                    return \"splittable JSON\"\n                }\n                else {\n                    //if it is JSON, but not splittable ({}, \"100, 100) return unsplittable JSON\n                    return \"unsplittable JSON\"\n                }\n            }\n            else {\n                //When it isn't \"valid\" JSON, check if it is an array\n                if (isvalidarray(value)) {\n                    //When it is an array, check if it is splittable\n                    if (issplittablearray(value)) {\n                        //When it is splittable, return splittable Array\n                        return \"splittable Array\"\n                    }\n                    else {\n                        //if the array is not splittable ([\"apple\"]) return unsplittable array\n                        return \"unsplittable array\"\n                    }\n                }\n                else {\n                    //When it is neither JSON or Array, then it is really just a string, so return string\n                    return \"string\"\n                }\n            }\n            break;\n        case \"object\":\n            //some  splittable values are identified as objects\n\n            //Fist check if the object is \"valid\" JSON\n            if (isvalidJSONstring(value)) {\n                //When it is \"valid\" JSON, check if it is splittable\n                if (issplittablevalidJSONstring(value)) {\n                    //When it is splittable, then return type as splittable JSON\n                    return \"splittable JSON\"\n                }\n                else {\n                    //if it is JSON, but not splittable ({}, \"100, 100) return unsplittable JSON\n                    return \"unsplittable JSON\"\n                }\n            }\n            else {\n                //When it isn't \"valid\" JSON, check if it is an array\n                if (isvalidarray(value)) {\n                    //When it is an array, check if it is splittable\n                    if (issplittablearray(value)) {\n                        //When it is splittable, return splittable Array\n                        return \"splittable Array\"\n                    }\n                    else {\n                        //if the array is not splittable ([\"apple\"]) return unsplittable array\n                        return \"unsplittable array\"\n                    }\n                }\n                else {\n                    //When it is neither JSON or Array, then I have not accounted for it. If you reach this point during an\n                    //  investigation, it might be worth using the example that triggered your investigation to see if the object\n                    //  is really just a string (without a triggering example I have not investigated)\n                    return \"object\"\n                }\n            }\n            break;\n        default:\n            //When the type is not one that I coded for then return unhandled because the situation is by definition unhandled\n            return \"unhandled\"\n            break;\n    }\n}\n\n//True False functions\n/*\n * This function was found on the internet to check if an input is valid JSON\n * There seems to be a belief that there should be some more elegant method that trying parse and the catching the error,\n * but no one seems to have demonstrated what that more elegant way would be\n */\nfunction isvalidJSONstring(str) {\n    try {\n        JSON.parse(str);\n    } catch (e) {\n        return false;\n    }\n    return true;\n}\n\n/*\n * This function decides where the JSON is made up of at least 1 key:value pair\n */\nfunction issplittablevalidJSONstring(str) {\n    if (str.includes(\":\")) {\n        return true;\n    }\n    else {\n        return false;\n    }\n}\n/*\n * This function is simply wrapping the Array.isArray, to align the function naming with the other true false functions\n */\nfunction isvalidarray(str) {\n    if (Array.isArray(str)) {\n        return true;\n    }\n    else {\n        return false;\n    }\n}\n/*\n * This function identifies if the array has only a single entry or multiple entries i.e. [\"Apple\"] not splittable,\n *  [\"Apple\",\"Pear\"] splittable\n */\nfunction issplittablearray(str) {\n    // If the length is more than 1, then the array has mutliple entries, but if it is just 1, then it is not splittable\n    if (str.length > 1) {\n        return true;\n    }\n    else {\n        return false;\n    }\n}\n\n//Splitting functions\n/*\n * This function takes in a msg where msg.payload.value is splittable JSON and iterates through all key:value pairs and then\n *  recursively calls handlemsg with multiple messages. Each new message retains most of the details of the input message, \n *  but the name and value are changed.\n *  The name has the key from the key:value pair appended with a : as a seperator\n *  The value is replaced with the value from the key:value pair\n *  A new message is created for each key:value pair\n */\nfunction splitJSON(latestMsg) {\n    //put the inputs value into a variable for easier access\n    var valueJSON = JSON.parse(latestMsg.payload.value);\n    //put the inputs name aside for multiple reuses\n    var name = latestMsg.payload.name\n    //Iterative loop\n    Object.keys(valueJSON).forEach(function (key) {\n        //concatenate the original name, a colon and the key from the pair\n        if (typeof name === 'undefined') \n        {\n            latestMsg.payload.name = key;\n        } \n        else \n        {\n            latestMsg.payload.name = name + \"/\" + key;\n        }\n        //move the value from the pair to payload.value\n        latestMsg.payload.value = valueJSON[key];\n        //recursively call this function in case the value is itself splittable\n        handlemsg(latestMsg)\n    }\n    )\n    return\n}\n\n/*\n * This function takes in a msg where msg.payload.value is splittable object\n *  and iterates through all key:value pairs and then\n *  recursively calls handlemsg with multiple messages. Each new message retains most of the details of the input message,\n *  but the name and value are changed.\n *  The name has the key from the key:value pair appended with a : as a seperator\n *  The value is replaced with the value from the key:value pair\n *  A new message is created for each key:value pair\n *  \n *  Note: While working on the splitArray function, I realized that I may not have tested this on an object value with multiple\n *  pairs, so it is possible that the function only handles the first pair\n */\nfunction splitObj(oMsg) {\n    //put the inputs name aside for multiple reuses\n    var name = oMsg.payload.name\n//Iterative loop\n    for (let [key, value] of Object.entries(oMsg.payload.value)) {\n        if ((value !== null) && (key !== null)) {\n            oMsg.payload.name = name + \"/\" + key;\n            oMsg.payload.value = value;\n            //recursively call this function in case the value is itself splittable\n            handlemsg(oMsg)\n        }\n    }\n}\n\n/*\n * Note: At the time of creation, I did not have a live example and had too many other things in the works to construct one.\n * \n * This function takes in a msg where msg.payload.value is splittable array\n *  and iterates through all entries and recursively calls handlemsg with multiple messages. \n *  Each new message retains most of the details of the input message,\n *  but the value is changed.\n *  The value is replaced with the value from the entry in the Array\n *  For example if the input value is [\"Apple\",\"Pear\"], then the first msg will have a value of \"Apple\"\n *  and the second will have a value of \"Pear\"\n */\nfunction splitArray(aMsg) {\n    //Iterative loop\n    for (index = 0; index < aMsg.payload.value.length; index++) {\n        (aMsg.payload.value = aMsg.payload.value[index]);\n        //recursively call this function in case the value is itself splittable\n        handlemsg(aMsg)\n    }\n}","outputs":1,"noerr":0,"x":1870,"y":1280,"wires":[["a46d77f5.6318e8","affc9c3d.2e2f6"]]},{"id":"a46d77f5.6318e8","type":"change","z":"ff6040a4.0af3a","name":"18 rule large cleanup","rules":[{"t":"delete","p":"qos","pt":"msg"},{"t":"delete","p":"retain","pt":"msg"},{"t":"delete","p":"payload.dataType","pt":"msg"},{"t":"delete","p":"deviceID","pt":"msg"},{"t":"set","p":"exportableresults.MQTTname","pt":"msg","to":"MQTTName","tot":"msg"},{"t":"delete","p":"MQTTName","pt":"msg"},{"t":"set","p":"exportableresults.DeviceName","pt":"msg","to":"topic","tot":"msg"},{"t":"delete","p":"topic","pt":"msg"},{"t":"set","p":"exportableresults.Measure","pt":"msg","to":"payload.name","tot":"msg"},{"t":"set","p":"exportableresults.Reading","pt":"msg","to":"payload.value","tot":"msg"},{"t":"delete","p":"payload","pt":"msg"},{"t":"delete","p":"Manufacturer","pt":"msg"},{"t":"delete","p":"_device","pt":"msg"},{"t":"delete","p":"_confId","pt":"msg"},{"t":"delete","p":"Homebridge","pt":"msg"},{"t":"delete","p":"_rawMessage","pt":"msg"},{"t":"set","p":"exportableresults.DeviceName","pt":"msg","to":"name","tot":"msg"},{"t":"delete","p":"name","pt":"msg"},{"t":"delete","p":"_rawEvent","pt":"msg"},{"t":"delete","p":"DeviceID","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1740,"y":1320,"wires":[["1ecb3d58.6a4893","6fe8076f.ff40f8"]]},{"id":"ab60a0df.ea47b","type":"link out","z":"ff6040a4.0af3a","name":"Get DeviceID","links":["8942bc71.61484"],"x":3130,"y":1320,"wires":[],"l":true},{"id":"1af3722c.e251de","type":"debug","z":"ff6040a4.0af3a","name":"Catch Post change 1","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2260,"y":1240,"wires":[]},{"id":"affc9c3d.2e2f6","type":"debug","z":"ff6040a4.0af3a","name":"Catch Stream Split","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2250,"y":1280,"wires":[]},{"id":"1ecb3d58.6a4893","type":"debug","z":"ff6040a4.0af3a","name":"Catch to send to get device","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2060,"y":1360,"wires":[]},{"id":"8942bc71.61484","type":"link in","z":"ff6040a4.0af3a","name":"Get DeviceID (Homekit, z2m)","links":["ab60a0df.ea47b"],"x":1640,"y":1520,"wires":[["1005c5c7.c1c29a"]],"l":true},{"id":"3f18e151.e33e3e","type":"link in","z":"ff6040a4.0af3a","name":"Got DeviceID","links":["c00689fc.2f30a8"],"x":1670,"y":1580,"wires":[["7503cb3f.483b14"]],"l":true},{"id":"c8f1b4fd.8e7438","type":"change","z":"ff6040a4.0af3a","name":"Remove Excess Properties","rules":[{"t":"delete","p":"globalsource","pt":"msg"},{"t":"delete","p":"keyname","pt":"msg"},{"t":"delete","p":"searchtarget","pt":"msg"},{"t":"delete","p":"datacolumnname","pt":"msg"},{"t":"delete","p":"_event","pt":"msg"},{"t":"set","p":"exportableresults.DeviceID","pt":"msg","to":"value","tot":"msg"},{"t":"delete","p":"value","pt":"msg"},{"t":"delete","p":"keyvalues","pt":"msg"},{"t":"delete","p":"SpreadsheetID","pt":"msg"},{"t":"delete","p":"Tab","pt":"msg"},{"t":"delete","p":"ColStart","pt":"msg"},{"t":"delete","p":"ColEnd","pt":"msg"},{"t":"delete","p":"MinRow","pt":"msg"},{"t":"delete","p":"MaxRow","pt":"msg"},{"t":"delete","p":"IgnoreEnvVar","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2660,"y":1500,"wires":[["4aa90e73.789da","c1da6109.d506e"]],"info":"This node is removing properties that were needed for the lookup, but not part of the results."},{"id":"61c95b2c.df2124","type":"subflow:11c4fe96.587e41","z":"ff6040a4.0af3a","name":"","env":[],"x":2401,"y":1520,"wires":[["c8f1b4fd.8e7438","e87ac34e.6fe1c"],["754dba52.e43a84"],["55e9094c.a6ea38"]]},{"id":"ca0cc2c6.9ee66","type":"inject","z":"ff6040a4.0af3a","name":"Delete Devices for Testing","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1710,"y":1460,"wires":[["b9c45624.496fd8"]]},{"id":"b9c45624.496fd8","type":"change","z":"ff6040a4.0af3a","name":"","rules":[{"t":"delete","p":"Devices","pt":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1980,"y":1460,"wires":[[]]},{"id":"4aa90e73.789da","type":"function","z":"ff6040a4.0af3a","name":"Move Data from searchfor to exportableresults","func":"//debugger\nlet foundKeys = Object.keys(msg.searchfor)\nlet foundValues = Object.values(msg.searchfor)\n//loop through all keys and a\nfor (index = 0; index < foundKeys.length; index++)\n{\n    if(foundValues[index]!== \"\")\n    {\n    msg.exportableresults[foundKeys[index]] = foundValues[index]\n    }\n}\ndelete msg.searchfor\nreturn msg","outputs":1,"noerr":0,"x":2980,"y":1500,"wires":[["ffd226b7.783578","c00689fc.2f30a8"]],"info":"This node moves each property under the msg.searchfor property to the msg.exportableresults property."},{"id":"1005c5c7.c1c29a","type":"change","z":"ff6040a4.0af3a","name":"Spreadsheet Lookup Settings","rules":[{"t":"set","p":"IgnoreEnvVar","pt":"msg","to":"true","tot":"bool"},{"t":"set","p":"SpreadsheetID","pt":"msg","to":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","tot":"str"},{"t":"set","p":"Tab","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"ColStart","pt":"msg","to":"A","tot":"str"},{"t":"set","p":"ColEnd","pt":"msg","to":"Z","tot":"str"},{"t":"set","p":"MinRow","pt":"msg","to":"1","tot":"str"},{"t":"set","p":"MaxRow","pt":"msg","to":"1000","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1911,"y":1520,"wires":[["eb220a9.2eda6f8","e23d3ad8.60c298"]],"info":"## **inputs**\n### IgnoreEnvVar \nThis boolean needs to be true to tell that Read Spreadsheet For Details subflow that it should use the specs passed in the msg to determine what spreadsheet to read from and what portion of data to read from.\n### msg.SpreadsheetID\nThis is the very long string that identifies a specific google spreadsheet.\n### msg.Tab\nSpecifies the tab name that contains the data.\n### msg.ColStart\nSpecifies the leftmost column containing the desired data.\n### msg.ColEnd\nSpecifies the rightmost column containing the desired data. \n### msg.MinRow\nSpecifies the top row containing the desired data \n### msg.MaxRow\nSpecifies the bottom row containing the desired data "},{"id":"eb220a9.2eda6f8","type":"change","z":"ff6040a4.0af3a","name":"Devices Lookup Settings","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"exportableresults.DeviceName","tot":"msg"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.Floor","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.Location","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.Room","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.DeviceType","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.Manufacturer","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.AccessProtocol","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.PhysicalVirtualType","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.House","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.MQTTDeviceTopic","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.Hub","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2171,"y":1520,"wires":[["61c95b2c.df2124","ad6bf055.286d2"]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value pulled from the **msg.exportableresults.DeviceName** object.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** column.\n"},{"id":"e4ef01f4.cce88","type":"link in","z":"ff6040a4.0af3a","name":"Get Measurement Name Update (All 3)","links":["7503cb3f.483b14"],"x":1710,"y":1880,"wires":[["c3fee5a0.037088"]],"l":true},{"id":"7503cb3f.483b14","type":"link out","z":"ff6040a4.0af3a","name":"Get Measurement Name Update","links":["e4ef01f4.cce88"],"x":2070,"y":1580,"wires":[],"l":true},{"id":"48f2c7b2.f39858","type":"link in","z":"ff6040a4.0af3a","name":"Got Measurement Name Update","links":["699d4d76.12d884"],"x":1730,"y":1920,"wires":[["c30a5118.52cda"]],"l":true},{"id":"c00689fc.2f30a8","type":"link out","z":"ff6040a4.0af3a","name":"Got Device ID","links":["3f18e151.e33e3e"],"x":3280,"y":1500,"wires":[],"l":true},{"id":"6b37c5c8.1c67bc","type":"comment","z":"ff6040a4.0af3a","name":"DeviceID lookup is needed for MQTT (and Homebridge?), but not Hubitat devices","info":"","x":1880,"y":1420,"wires":[]},{"id":"c1a89ad5.715e38","type":"change","z":"ff6040a4.0af3a","name":"Remove Excess Properties","rules":[{"t":"delete","p":"globalsource","pt":"msg"},{"t":"delete","p":"keyname","pt":"msg"},{"t":"delete","p":"searchtarget","pt":"msg"},{"t":"delete","p":"datacolumnname","pt":"msg"},{"t":"delete","p":"_event","pt":"msg"},{"t":"delete","p":"value","pt":"msg"},{"t":"delete","p":"keyvalues","pt":"msg"},{"t":"delete","p":"SpreadsheetID","pt":"msg"},{"t":"delete","p":"Tab","pt":"msg"},{"t":"delete","p":"ColStart","pt":"msg"},{"t":"delete","p":"ColEnd","pt":"msg"},{"t":"delete","p":"MinRow","pt":"msg"},{"t":"delete","p":"MaxRow","pt":"msg"},{"t":"delete","p":"IgnoreEnvVar","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":3300,"y":1820,"wires":[["269dd010.b1636"]],"info":"This node is removing properties that were needed for the lookup, but not part of the results."},{"id":"cdb5cece.87d37","type":"subflow:11c4fe96.587e41","z":"ff6040a4.0af3a","name":"","env":[],"x":3020,"y":1880,"wires":[["c1a89ad5.715e38","cf1e77d3.dbf1b8"],["27b61f80.c217e"],["d4cf0e19.81e8c","d1fc32e3.cdb3a","cf1e77d3.dbf1b8"]]},{"id":"c3fee5a0.037088","type":"change","z":"ff6040a4.0af3a","name":"Spreadsheet Lookup Settings","rules":[{"t":"set","p":"IgnoreEnvVar","pt":"msg","to":"true","tot":"bool"},{"t":"set","p":"SpreadsheetID","pt":"msg","to":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","tot":"str"},{"t":"set","p":"Tab","pt":"msg","to":"MeasurementTranslations","tot":"str"},{"t":"set","p":"ColStart","pt":"msg","to":"A","tot":"str"},{"t":"set","p":"ColEnd","pt":"msg","to":"E","tot":"str"},{"t":"set","p":"MinRow","pt":"msg","to":"1","tot":"str"},{"t":"set","p":"MaxRow","pt":"msg","to":"100","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2010,"y":1880,"wires":[["679092d4.4fec8c","e7118d9d.7b64e"]],"info":"## **inputs**\n### IgnoreEnvVar \nThis boolean needs to be true to tell that Read Spreadsheet For Details subflow that it should use the specs passed in the msg to determine what spreadsheet to read from and what portion of data to read from.\n### msg.SpreadsheetID\nThis is the very long string that identifies a specific google spreadsheet.\n### msg.Tab\nSpecifies the tab name that contains the data.\n### msg.ColStart\nSpecifies the leftmost column containing the desired data.\n### msg.ColEnd\nSpecifies the rightmost column containing the desired data. \n### msg.MinRow\nSpecifies the top row containing the desired data \n### msg.MaxRow\nSpecifies the bottom row containing the desired data "},{"id":"679092d4.4fec8c","type":"change","z":"ff6040a4.0af3a","name":"Measurement Translation Lookup Settings","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"MeasurementTranslations","tot":"str"},{"t":"set","p":"keyvalues.SourceDevice","pt":"msg","to":"exportableresults.DeviceName","tot":"msg"},{"t":"set","p":"keyvalues.DeviceID","pt":"msg","to":"exportableresults.DeviceID","tot":"msg"},{"t":"set","p":"keyvalues.Measurement","pt":"msg","to":"exportableresults.Measure","tot":"msg"},{"t":"set","p":"searchfor.ChangeNameTo","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2340,"y":1880,"wires":[["b497858.d06c978","7390505a.ec8bd"]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value pulled from the **msg.exportableresults.DeviceName** object.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** column.\n"},{"id":"ffd226b7.783578","type":"debug","z":"ff6040a4.0af3a","name":"1.1 DevID Lookup Success","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":3320,"y":1460,"wires":[]},{"id":"27b61f80.c217e","type":"debug","z":"ff6040a4.0af3a","name":"flow 2.2 temp no find","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":3280,"y":1860,"wires":[]},{"id":"d4cf0e19.81e8c","type":"debug","z":"ff6040a4.0af3a","name":"2 Need to update MeasurementTranslations Table","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":3370,"y":1940,"wires":[]},{"id":"f5bece0d.998ef","type":"debug","z":"ff6040a4.0af3a","name":"2.1 rename lookup success","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":3720,"y":1780,"wires":[]},{"id":"269dd010.b1636","type":"function","z":"ff6040a4.0af3a","name":"Move Name Change from searchfor to exportableresults","func":"msg.exportableresults.Measure = msg.searchfor.ChangeNameTo\ndelete msg.searchfor\nreturn msg;","outputs":1,"noerr":0,"x":3650,"y":1820,"wires":[["f5bece0d.998ef","699d4d76.12d884"]]},{"id":"699d4d76.12d884","type":"link out","z":"ff6040a4.0af3a","name":"Got Measurement Name Update","links":["48f2c7b2.f39858"],"x":4050,"y":1840,"wires":[],"l":true},{"id":"c30a5118.52cda","type":"link out","z":"ff6040a4.0af3a","name":"Get Potential Translation Update","links":["7a3857a1.e40508"],"x":2070,"y":1920,"wires":[],"l":true},{"id":"7a3857a1.e40508","type":"link in","z":"ff6040a4.0af3a","name":"Get Potential Translation Update (Homebridge Only)","links":["c30a5118.52cda"],"x":1710,"y":2400,"wires":[["dd03c2c1.bb879"]],"l":true},{"id":"a6a2ea3f.7abd18","type":"link in","z":"ff6040a4.0af3a","name":"Got Potential Translation Update","links":["8eb89ea4.b5e21","bc6b491c.9bf308","e9844d0e.f2eb8","dbc3322d.12238","d9b20f7c.5add5"],"x":1650,"y":2940,"wires":[["eb20679d.2cdb68","4adba703.326ba8"]],"l":true},{"id":"8eb89ea4.b5e21","type":"link out","z":"ff6040a4.0af3a","name":"Got Potential Translation Update","links":["a6a2ea3f.7abd18"],"x":4470,"y":2320,"wires":[],"l":true},{"id":"4f61b6eb.2797a8","type":"function","z":"ff6040a4.0af3a","name":"Move Name Change from searchfor to exportableresults","func":"msg.TranslationType = msg.searchfor.TranslationType\ndelete msg.searchfor\nreturn msg;","outputs":1,"noerr":0,"x":3310,"y":2380,"wires":[["215ce914.b80f86","5c32f20a.33125c"]]},{"id":"c0ffae74.7473a","type":"change","z":"ff6040a4.0af3a","name":"Remove Excess Properties","rules":[{"t":"delete","p":"globalsource","pt":"msg"},{"t":"delete","p":"keyname","pt":"msg"},{"t":"delete","p":"searchtarget","pt":"msg"},{"t":"delete","p":"datacolumnname","pt":"msg"},{"t":"delete","p":"_event","pt":"msg"},{"t":"delete","p":"value","pt":"msg"},{"t":"delete","p":"keyvalues","pt":"msg"},{"t":"delete","p":"SpreadsheetID","pt":"msg"},{"t":"delete","p":"Tab","pt":"msg"},{"t":"delete","p":"ColStart","pt":"msg"},{"t":"delete","p":"ColEnd","pt":"msg"},{"t":"delete","p":"MinRow","pt":"msg"},{"t":"delete","p":"MaxRow","pt":"msg"},{"t":"delete","p":"IgnoreEnvVar","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2960,"y":2380,"wires":[["4f61b6eb.2797a8","5d87789c.9f13f8"]],"info":"This node is removing properties that were needed for the lookup, but not part of the results."},{"id":"7d3077e5.df2088","type":"change","z":"ff6040a4.0af3a","name":"Measurement Translation Lookup Settings","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"DataTranslations","tot":"str"},{"t":"set","p":"keyvalues.DeviceID","pt":"msg","to":"exportableresults.DeviceID","tot":"msg"},{"t":"set","p":"keyvalues.Measurement","pt":"msg","to":"exportableresults.Measure","tot":"msg"},{"t":"set","p":"searchfor.TranslationType","pt":"msg","to":"","tot":"str"},{"t":"delete","p":"searchErrorCount","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2380,"y":2400,"wires":[["217ab694.acf5ba","3f8ecb73.b05844"]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value pulled from the **msg.exportableresults.DeviceName** object.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** column.\n"},{"id":"dd03c2c1.bb879","type":"change","z":"ff6040a4.0af3a","name":"Spreadsheet Lookup Settings","rules":[{"t":"set","p":"IgnoreEnvVar","pt":"msg","to":"true","tot":"bool"},{"t":"set","p":"SpreadsheetID","pt":"msg","to":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","tot":"str"},{"t":"set","p":"Tab","pt":"msg","to":"DataTranslations","tot":"str"},{"t":"set","p":"ColStart","pt":"msg","to":"A","tot":"str"},{"t":"set","p":"ColEnd","pt":"msg","to":"C","tot":"str"},{"t":"set","p":"MinRow","pt":"msg","to":"1","tot":"str"},{"t":"set","p":"MaxRow","pt":"msg","to":"100","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2050,"y":2400,"wires":[["7d3077e5.df2088","a783cd1f.70c2f"]],"info":"## **inputs**\n### IgnoreEnvVar \nThis boolean needs to be true to tell that Read Spreadsheet For Details subflow that it should use the specs passed in the msg to determine what spreadsheet to read from and what portion of data to read from.\n### msg.SpreadsheetID\nThis is the very long string that identifies a specific google spreadsheet.\n### msg.Tab\nSpecifies the tab name that contains the data.\n### msg.ColStart\nSpecifies the leftmost column containing the desired data.\n### msg.ColEnd\nSpecifies the rightmost column containing the desired data. \n### msg.MinRow\nSpecifies the top row containing the desired data \n### msg.MaxRow\nSpecifies the bottom row containing the desired data "},{"id":"d1fc32e3.cdb3a","type":"change","z":"ff6040a4.0af3a","name":"Remove Excess Properties when No Name Change Found","rules":[{"t":"delete","p":"globalsource","pt":"msg"},{"t":"delete","p":"keyname","pt":"msg"},{"t":"delete","p":"searchtarget","pt":"msg"},{"t":"delete","p":"datacolumnname","pt":"msg"},{"t":"delete","p":"_event","pt":"msg"},{"t":"delete","p":"value","pt":"msg"},{"t":"delete","p":"keyvalues","pt":"msg"},{"t":"delete","p":"SpreadsheetID","pt":"msg"},{"t":"delete","p":"Tab","pt":"msg"},{"t":"delete","p":"ColStart","pt":"msg"},{"t":"delete","p":"ColEnd","pt":"msg"},{"t":"delete","p":"MinRow","pt":"msg"},{"t":"delete","p":"MaxRow","pt":"msg"},{"t":"delete","p":"IgnoreEnvVar","pt":"msg"},{"t":"delete","p":"payload","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"delete","p":"searchfor","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":3400,"y":1900,"wires":[["699d4d76.12d884","5279dcad.253bc4"]],"info":"This node is removing properties that were needed for the lookup, but not part of the results."},{"id":"6afb815.99ed38","type":"change","z":"ff6040a4.0af3a","name":"Remove Excess Properties when No Data Translation Found","rules":[{"t":"delete","p":"globalsource","pt":"msg"},{"t":"delete","p":"keyname","pt":"msg"},{"t":"delete","p":"searchtarget","pt":"msg"},{"t":"delete","p":"datacolumnname","pt":"msg"},{"t":"delete","p":"_event","pt":"msg"},{"t":"delete","p":"value","pt":"msg"},{"t":"delete","p":"keyvalues","pt":"msg"},{"t":"delete","p":"SpreadsheetID","pt":"msg"},{"t":"delete","p":"Tab","pt":"msg"},{"t":"delete","p":"ColStart","pt":"msg"},{"t":"delete","p":"ColEnd","pt":"msg"},{"t":"delete","p":"MinRow","pt":"msg"},{"t":"delete","p":"MaxRow","pt":"msg"},{"t":"delete","p":"IgnoreEnvVar","pt":"msg"},{"t":"delete","p":"payload","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"delete","p":"searchfor","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":3060,"y":2420,"wires":[["d9b20f7c.5add5"]],"info":"This node is removing properties that were needed for the lookup, but not part of the results."},{"id":"df40d810.4731b8","type":"switch","z":"ff6040a4.0af3a","name":"10TF Translate","property":"exportableresults.Reading","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":4240,"y":2260,"wires":[["39a291c1.61976e","653c65b9.65c7cc"],["719c672f.8b1e98","653c65b9.65c7cc"]],"outputLabels":["True","False"]},{"id":"39a291c1.61976e","type":"change","z":"ff6040a4.0af3a","name":"Value True","rules":[{"t":"set","p":"exportableresults.Reading","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":4410,"y":2240,"wires":[["e9844d0e.f2eb8","653c65b9.65c7cc"]]},{"id":"719c672f.8b1e98","type":"change","z":"ff6040a4.0af3a","name":"Value False","rules":[{"t":"set","p":"exportableresults.Reading","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":4410,"y":2280,"wires":[["e9844d0e.f2eb8","653c65b9.65c7cc"]]},{"id":"a3e7e5d8.0e8688","type":"change","z":"ff6040a4.0af3a","name":"CtoF Translate","rules":[{"t":"set","p":"exportableresults.Measure","pt":"msg","to":"msg.exportableresults.Measure&\"F\"\t","tot":"jsonata"},{"t":"set","p":"exportableresults.Reading","pt":"msg","to":"msg.exportableresults.Reading*9/5+32","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":4240,"y":2320,"wires":[["8eb89ea4.b5e21"]]},{"id":"ac8d06fe.414d18","type":"switch","z":"ff6040a4.0af3a","name":"CurrentHeatingCoolingState Translate","property":"exportableresults.Reading","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"str"},{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"str"},{"t":"eq","v":"3","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":4310,"y":2420,"wires":[["aedcf343.bd52f"],["a2757f40.a6a27"],["2dcb2643.978d4a"],["bec9e863.312378"]],"outputLabels":["off","heat","cool","heat-cool"]},{"id":"aedcf343.bd52f","type":"change","z":"ff6040a4.0af3a","name":"Value Off","rules":[{"t":"set","p":"exportableresults.Reading","pt":"msg","to":"off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":4560,"y":2360,"wires":[["dbc3322d.12238"]]},{"id":"a2757f40.a6a27","type":"change","z":"ff6040a4.0af3a","name":"Value Heat","rules":[{"t":"set","p":"exportableresults.Reading","pt":"msg","to":"heat","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":4570,"y":2400,"wires":[["dbc3322d.12238"]]},{"id":"2dcb2643.978d4a","type":"change","z":"ff6040a4.0af3a","name":"Value Cool","rules":[{"t":"set","p":"exportableresults.Reading","pt":"msg","to":"cool","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":4570,"y":2440,"wires":[["dbc3322d.12238"]]},{"id":"bec9e863.312378","type":"change","z":"ff6040a4.0af3a","name":"Value Heat-Cool","rules":[{"t":"set","p":"exportableresults.Reading","pt":"msg","to":"heat-cool","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":4580,"y":2480,"wires":[["dbc3322d.12238"]]},{"id":"4df3c3be.94949c","type":"switch","z":"ff6040a4.0af3a","name":"","property":"TranslationType","propertyType":"msg","rules":[{"t":"eq","v":"10TF","vt":"str"},{"t":"eq","v":"C2F","vt":"str"},{"t":"eq","v":"NestThMap","vt":"str"},{"t":"eq","v":"012CF","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":4030,"y":2360,"wires":[["df40d810.4731b8"],["a3e7e5d8.0e8688","f560d861.3efce8"],["ac8d06fe.414d18"],["88cc4cf8.6370f"]],"outputLabels":["1 or 0 to True or False Map","Celcius to Fahrenheit Conversion","Nest Thermostat Map","Celcius or Fahrenheit Map"]},{"id":"88cc4cf8.6370f","type":"switch","z":"ff6040a4.0af3a","name":"10TF Translate","property":"exportableresults.Reading","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":4240,"y":2540,"wires":[["4209830f.2ad46c"],["eab98841.0d8c08"]],"outputLabels":["True","False"]},{"id":"4209830f.2ad46c","type":"change","z":"ff6040a4.0af3a","name":"Value Fahrenheit","rules":[{"t":"set","p":"exportableresults.Reading","pt":"msg","to":"Fahrenheit","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":4430,"y":2520,"wires":[["bc6b491c.9bf308"]]},{"id":"eab98841.0d8c08","type":"change","z":"ff6040a4.0af3a","name":"Value Celcius","rules":[{"t":"set","p":"exportableresults.Reading","pt":"msg","to":"Celcius","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":4420,"y":2560,"wires":[["bc6b491c.9bf308"]]},{"id":"215ce914.b80f86","type":"switch","z":"ff6040a4.0af3a","name":"Translation Needed?","property":"TranslationType","propertyType":"msg","rules":[{"t":"neq","v":"null","vt":"str"},{"t":"eq","v":"null","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":3640,"y":2380,"wires":[["4df3c3be.94949c","724d6ce8.7f8004"],["d9b20f7c.5add5","aa129309.3022f"]]},{"id":"4adba703.326ba8","type":"change","z":"ff6040a4.0af3a","name":"Excess Properties Removal","rules":[{"t":"delete","p":"searchErrorCount","pt":"msg"},{"t":"delete","p":"error","pt":"msg"},{"t":"delete","p":"TranslationType","pt":"msg"},{"t":"delete","p":"_event","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1980,"y":2940,"wires":[["2431eaa0.48f0c6","d64c3367.54438"]]},{"id":"2431eaa0.48f0c6","type":"debug","z":"ff6040a4.0af3a","name":"Catch Excess Properties Removal","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2200,"y":2840,"wires":[]},{"id":"e9844d0e.f2eb8","type":"link out","z":"ff6040a4.0af3a","name":"Got Potential Translation Update","links":["a6a2ea3f.7abd18"],"x":4630,"y":2260,"wires":[],"l":true},{"id":"dbc3322d.12238","type":"link out","z":"ff6040a4.0af3a","name":"Got Potential Translation Update","links":["a6a2ea3f.7abd18"],"x":4850,"y":2420,"wires":[],"l":true},{"id":"bc6b491c.9bf308","type":"link out","z":"ff6040a4.0af3a","name":"Got Potential Translation Update","links":["a6a2ea3f.7abd18"],"x":4670,"y":2540,"wires":[],"l":true},{"id":"d9b20f7c.5add5","type":"link out","z":"ff6040a4.0af3a","name":"Got Potential Translation Update","links":["a6a2ea3f.7abd18"],"x":3930,"y":2420,"wires":[],"l":true},{"id":"d64c3367.54438","type":"function","z":"ff6040a4.0af3a","name":"Format for InfluxDB & MQTT","func":"//Ref. TMS-000002\n/* This function takes input from a hubitat device node and data stored in config node which holds details about the device\n * and creates an properly formated object to be sent to InfluxDB node via output 1 which will in turn write to the InfluxDB\n * It also formats an MQTT topic and the data sending that to output 2 which in turn can be used by an MQTT node to send to \n * MQTT\n * \n * \n */\n//gather the name of the device which had a reading that triggered the flow to be included as a tag (index) sent to InfluxDB\n//note: this is the hubitat device ID\nvar deviceID = msg.exportableresults.DeviceID;\n//node.warn(\"11 \"+ deviceID)\n//gather the name of the measurement that was sent by the device to be included as a tag (index) for invalid measurements and as the fieldname for valid measurements sent to InfluxDB\nvar typeOfMeasurement = msg.exportableresults.Measure;\n\n//gather the actual measurement value that was sent by the device to be included as the data for the field (when the measurement is valid) sent to InfluxDB\nvar theData = msg.exportableresults.Reading;\n//initialize the measurements object\nvar measurementsObj = {};\n\n//initialize the tags (indices) object\nvar tagsObj = {};\n\n//create the object that will later be used to combine the measurementsObj and tagsObj\nvar combinedObj;\n\n//create the boolean that will be used to hold the evaluation of whether the measurement is valid or not\nvar validMeasurement;\n\n//create the booleans that will be used to hold whether the reason a measurement is invalid is because it is a non-standard type or\n// if the type of the measurement and the type passed from the device differ or\n// if the value (data) is null\nvar nonStandardType = false;\nvar measurementTypeMismatch = false;\nvar nullData = false;\n\n//create a boolean to keep track of if there are any tags (indices) that should be sent to the InfluxDB \n// it starts false but if any tag is valid then will become true. See below for what to send to InfluxDB based on valid measures and tags\nvar validTag = false;\nif (msg.exportableresults.hasOwnProperty('dataType'))\n{\n    if ((typeof theData == msg.exportableresults.dataType.toLowerCase()) || (msg.exportableresults.dataType == 'ENUM') || (theData === null))\n    {\n        if (typeof theData == 'number')\n        {\n            node.status({ fill: \"red\", shape: \"ring\", text: \"matched number\" });\n            if (!theData.isNaN)\n            {\n                validMeasurement = true;\n            }\n        }\n        else if (typeof theData == 'string')\n        {\n            node.status({ fill: \"red\", shape: \"ring\", text: \"matched string\" });\n            if (theData.length >= 0)\n            {\n                validMeasurement = true;\n            }\n        } \n        else if (typeof theData == 'boolean')\n        {\n            node.status({ fill: \"red\", shape: \"ring\", text: \"matched boolean\" });\n            validMeasurement = true;\n        }\n        else if (msg.exportableresults.dataType == 'ENUM')\n        { //This is checking to make sure the value matches one of the values in the ENUM from the device \n            node.status({ fill: \"red\", shape: \"ring\", text: msg.exportableresults.dataType + \" matched ENUM\" });\n            msg.exportableresults.values.forEach(element => {\n                if (flow.get(deviceID + element) == theData)\n                {\n                    validMeasurement = true;\n                }\n            })\n        }\n        else if (theData === null)\n        {\n            node.status({ fill: \"red\", shape: \"ring\", text: \"matched null data\" });\n            nullData = true;\n        }\n        else\n        {\n            node.status({ fill: \"red\", shape: \"ring\", text: \"matched nonstandardtype\" });\n            nonStandardType = true;\n        }\n    } //if ((typeof theData == msg.exportableresults.dataType.toLowerCase()) || (msg.exportableresults.dataType == 'ENUM') || (theData === null))\n    else\n    {\n        node.status({ fill: \"red\", shape: \"ring\", text: \"measurement type mismatch\" });\n        measurementTypeMismatch = true;\n    } //else  if ((typeof theData == msg.exportableresults.dataType.toLowerCase()) || (msg.exportableresults.dataType == 'ENUM') || (theData === null))\n}//if(msg.exportableresults.hasOwnProperty('dataType'))\nelse\n{\n    validMeasurement = true;\n}// else      if(msg.exportableresults.hasOwnProperty('dataType')) else\n\n//scanning all of the tags from the config node and creating a tag for that item if the entry on the config node has info\ncommonTags = [\"House\", \"Floor\", \"Room\", \"Location\", \"DeviceType\", \"Manufacturer\", \"AccessProtocol\", \"PhysicalVirtualType\", \"PhysicalDigitalRegular\"]\nfor (innerIndex = 0; innerIndex < commonTags.length; innerIndex++)\n{\n    if (msg.exportableresults.hasOwnProperty(commonTags[innerIndex]))\n    {\n        tagsObj[commonTags[innerIndex]] = msg.exportableresults[commonTags[innerIndex]]\n    } //if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex]) else\n} //for (innerIndex = 0; innerIndex < searchKeyIndices.length; innerIndex++)\n\n//Based on whether or not the measurement is \"valid\" it either adds the device id to the tags or it goes to the else portion\nif (validMeasurement) {\n    measurementsObj[typeOfMeasurement] = theData;\n    //node.warn(\"94 length\")\n    if (deviceID.length > 0) {\n        tagsObj[\"DeviceID\"] = deviceID;\n        validTag = true;\n    }\n    if (validTag) {\n        combinedObj = [measurementsObj, tagsObj]\n    } else {\n        //skip tags if none would be valid\n        combinedObj = [measurementsObj]\n    }\n} else {\n\n    //if the measeurement was not \"valid\", then it puts in a Generic measurement of true and tag it as either Non-Standard Type of Measurement Type Mismatch\n    if (nonStandardType) {\n        measurementsObj[\"Generic\"] = true\n        tagsObj[\"ReasonGeneric\"] = \"Non-Standard Type\"\n        tagsObj[\"Measure\"] = typeOfMeasurement\n    }\n    //node.warn(\"113 length\")\n    if (deviceID.length > 0) {\n        tagsObj[\"DeviceID\"] = deviceID\n        validTag = true\n    }\n    if (measurementTypeMismatch) {\n        measurementsObj[\"Generic\"] = true\n        tagsObj[\"ReasonGeneric\"] = \"Measurement Type Mismatch\"\n        tagsObj[\"Measure\"] = typeOfMeasurement\n    }\n    //node.warn(\"123 length\")\n    if (deviceID.length > 0) {\n        tagsObj[\"DeviceID\"] = deviceID\n        validTag = true\n    }\n    combinedObj = [measurementsObj, tagsObj]\n}\n\n//put the object into the payload\nmsg.payload = combinedObj;\n\n//build the status to be shown on the status of the subnode\nmsg.status = msg.exportableresults.DeviceName + \": \" + typeOfMeasurement + \": \" + theData;\n\n/* MQTT section \n * \n * \n * \n */\n//create the placeholder object\nvar msg2 = {}\n//add the MQTT topic\nmsg2.topic = msg.exportableresults.MQTTname +\"/\"+msg.exportableresults.DeviceName+\"/\"+ msg.exportableresults.Measure\n//add the data to be recorded to MQTT\nmsg2.payload = theData\n\n\n\n//send the created combinedObj downstream (to the InfluxDB node), but only if the measurement is not null\nif (!nullData) {\n    return [msg, msg2]\n}\ndebugger\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////\n","outputs":2,"noerr":0,"x":2260,"y":2940,"wires":[["d64fc9b3.8d94f8","b58898a7.a65038","b0b991e.c80e67"],["306ace61.a1fe32","d93bf2cf.981c7"]]},{"id":"d64fc9b3.8d94f8","type":"debug","z":"ff6040a4.0af3a","name":"4.1 Output 1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2530,"y":2860,"wires":[]},{"id":"306ace61.a1fe32","type":"debug","z":"ff6040a4.0af3a","name":"4.2 Output 2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2530,"y":3040,"wires":[]},{"id":"b58898a7.a65038","type":"influxdb out","z":"ff6040a4.0af3a","influxdb":"82aca41a.30fed8","name":"","measurement":"Smarthome","precision":"","retentionPolicy":"","x":2650,"y":2900,"wires":[]},{"id":"b0b991e.c80e67","type":"change","z":"ff6040a4.0af3a","name":"Move Status to Payload for Consumption by Status Node","rules":[{"t":"set","p":"payload","pt":"msg","to":"status","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2670,"y":2940,"wires":[["855aa2af.4fe6"]]},{"id":"d93bf2cf.981c7","type":"mqtt out","z":"ff6040a4.0af3a","name":"Write reading to MQTT","topic":"","qos":"1","retain":"true","broker":"a5bf81ee.27852","x":2560,"y":2980,"wires":[]},{"id":"855aa2af.4fe6","type":"debug","z":"ff6040a4.0af3a","name":"4.3 Output  For Status node","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":3040,"y":2940,"wires":[]},{"id":"754dba52.e43a84","type":"debug","z":"ff6040a4.0af3a","name":"flow 1.2 temp no find","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2640,"y":1540,"wires":[]},{"id":"55e9094c.a6ea38","type":"debug","z":"ff6040a4.0af3a","name":"flow 1.3 Need to update the Devices Table","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2700,"y":1580,"wires":[]},{"id":"b497858.d06c978","type":"function","z":"ff6040a4.0af3a","name":"Optionally Simplify msg.keyvalues.Measurement","func":"if (msg.keyvalues.Measurement.includes(\"/\"))\n{msg.keyvalues.Measurement = msg.keyvalues.Measurement.substring(msg.keyvalues.Measurement.lastIndexOf(\"/\") + 1);\n}\nreturn msg;","outputs":1,"noerr":0,"x":2720,"y":1880,"wires":[["77d2541e.9eae6c","cdb5cece.87d37"]]},{"id":"7390505a.ec8bd","type":"debug","z":"ff6040a4.0af3a","name":"before","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2450,"y":1840,"wires":[]},{"id":"77d2541e.9eae6c","type":"debug","z":"ff6040a4.0af3a","name":"after","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2810,"y":1840,"wires":[]},{"id":"5279dcad.253bc4","type":"debug","z":"ff6040a4.0af3a","name":"flow 2.3 If translation desired fail, otherwise succes Table?","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":3990,"y":1900,"wires":[]},{"id":"eb20679d.2cdb68","type":"debug","z":"ff6040a4.0af3a","name":"flow 3 output","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1850,"y":2880,"wires":[]},{"id":"653c65b9.65c7cc","type":"debug","z":"ff6040a4.0af3a","name":"flow 3 SS settings","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":4410,"y":2160,"wires":[]},{"id":"e23d3ad8.60c298","type":"debug","z":"ff6040a4.0af3a","name":"Catch Spread Lookup","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2240,"y":1460,"wires":[]},{"id":"ad6bf055.286d2","type":"debug","z":"ff6040a4.0af3a","name":"Catch Devices Lookup Settings","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2450,"y":1420,"wires":[]},{"id":"e87ac34e.6fe1c","type":"debug","z":"ff6040a4.0af3a","name":"Catch Lookup Desired Data","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2660,"y":1460,"wires":[]},{"id":"c1da6109.d506e","type":"debug","z":"ff6040a4.0af3a","name":"Catch Remove Excess Properties","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2980,"y":1460,"wires":[]},{"id":"e7118d9d.7b64e","type":"debug","z":"ff6040a4.0af3a","name":"Catch Spreadsheet Lookup Settings","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2010,"y":1840,"wires":[]},{"id":"cf1e77d3.dbf1b8","type":"debug","z":"ff6040a4.0af3a","name":"Catch Lookup Desired Data","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":3080,"y":1740,"wires":[]},{"id":"a783cd1f.70c2f","type":"debug","z":"ff6040a4.0af3a","name":"Catch Spreadsheet Lookup Settings","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2030,"y":2360,"wires":[]},{"id":"217ab694.acf5ba","type":"debug","z":"ff6040a4.0af3a","name":"Catch Measurement Translation Lookup Settings","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2460,"y":2340,"wires":[]},{"id":"3f8ecb73.b05844","type":"function","z":"ff6040a4.0af3a","name":"Optionally Simplify msg.keyvalues.Measurement","func":"if (msg.keyvalues.Measurement.includes(\"/\"))\n{msg.keyvalues.Measurement = msg.keyvalues.Measurement.substring(msg.keyvalues.Measurement.lastIndexOf(\"/\") + 1);\n}\nreturn msg;","outputs":1,"noerr":0,"x":2840,"y":2160,"wires":[["a59a0577.3755b8","5720455.ac5f3bc"]]},{"id":"a59a0577.3755b8","type":"subflow:11c4fe96.587e41","z":"ff6040a4.0af3a","name":"","env":[],"x":3160,"y":2160,"wires":[["881e4e24.8d7bb","c0ffae74.7473a"],["3a21c230.111d6e"],["150b394f.54cd67","6afb815.99ed38"]]},{"id":"881e4e24.8d7bb","type":"debug","z":"ff6040a4.0af3a","name":"3.1 Catch Translation Lookup Success","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":3810,"y":2080,"wires":[]},{"id":"3a21c230.111d6e","type":"debug","z":"ff6040a4.0af3a","name":"3.2 Catch Translation Lookup Partial Failure","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":3850,"y":2120,"wires":[]},{"id":"150b394f.54cd67","type":"debug","z":"ff6040a4.0af3a","name":"3.3 Catch Translation Lookup Repeated Failure","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":3860,"y":2160,"wires":[]},{"id":"5720455.ac5f3bc","type":"debug","z":"ff6040a4.0af3a","name":"catch Optionally Simplify msg.keyvalues.Measurement","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2900,"y":2120,"wires":[]},{"id":"5d87789c.9f13f8","type":"debug","z":"ff6040a4.0af3a","name":"Catch Remove Excess Properties","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2960,"y":2340,"wires":[]},{"id":"5c32f20a.33125c","type":"debug","z":"ff6040a4.0af3a","name":"Catch Move Name Change from searchfor to exportableresults","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":3350,"y":2340,"wires":[]},{"id":"724d6ce8.7f8004","type":"debug","z":"ff6040a4.0af3a","name":"1","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":3710,"y":2260,"wires":[]},{"id":"aa129309.3022f","type":"debug","z":"ff6040a4.0af3a","name":"2","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":3690,"y":2300,"wires":[]},{"id":"6fe8076f.ff40f8","type":"function","z":"ff6040a4.0af3a","name":"Optionally Simplify msg.exportableresults.Measure","func":"if (msg.exportableresults.Measure.includes(\"/\"))\n{msg.exportableresults.Measure = msg.exportableresults.Measure.substring(msg.exportableresults.Measure.lastIndexOf(\"/\") + 1);\n}\nreturn msg;","outputs":1,"noerr":0,"x":2090,"y":1320,"wires":[["ab60a0df.ea47b"]]},{"id":"f560d861.3efce8","type":"debug","z":"ff6040a4.0af3a","name":"Catch C2F translation input","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":4610,"y":2680,"wires":[]},{"id":"c2409854.f39c18","type":"debug","z":"f14b69ba.8b2da8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":820,"y":220,"wires":[]},{"id":"df201aab.b37668","type":"debug","z":"f14b69ba.8b2da8","name":"after","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1040,"y":280,"wires":[]},{"id":"a892cfb8.e6e4e","type":"debug","z":"b6874b18.031658","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1480,"y":80,"wires":[]},{"id":"c18dfe4e.73cfd","type":"debug","z":"b6874b18.031658","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":780,"y":740,"wires":[]},{"id":"91982798.e64cd8","type":"debug","z":"b6874b18.031658","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1360,"y":180,"wires":[]},{"id":"1f6ce0c6.78a11f","type":"function","z":"7210fbae.22d8e4","name":"Determine Source For Gsheet lookup properties.","func":"//Read subflow input variables\nif (env.get(\"OverrideEnvVariables\"))\n{\n    //Put inputs and read values into msg properties to be visible downstream\n    msg.sheet = msg.SpreadsheetID;\n    msg.tab = msg.Tab;\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    msg.topic = msg.targetrange\n    delete msg.Tab\n    delete msg.SpreadsheetID\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\n}\nelse if (msg.IgnoreEnvVar)\n{\n    //Put inputs and read values into msg properties to be visible downstream\n    msg.sheet = msg.SpreadsheetID;\n    msg.tab = msg.Tab;\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    msg.topic = msg.targetrange\n    delete msg.Tab\n    delete msg.SpreadsheetID\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\n}\nelse\n{\n    var ColStart = env.get(\"ColStart\");\n    var ColEnd = env.get(\"ColEnd\");\n    var FirstRow = env.get(\"MinRow\");\n    var LastRow = env.get(\"MaxRow\");\n    //Put inputs and read values into msg properties to be visible downstream\n    msg.sheet = env.get(\"Spreadsheet ID\");\n    msg.tab = env.get(\"TabName\");\n    msg.cellstart = ColStart + FirstRow\n    msg.cellend = ColEnd + LastRow\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    msg.topic = msg.targetrange\n    delete msg.Tab\n    delete msg.SpreadsheetID\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\n    //These 2 are needed later to calculate the last populate and first empty rows and columns\n    msg.ColStart = ColStart\n    msg.MinRow = FirstRow\n}\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":20,"wires":[["f422252c.c0f1d8","ef0c87a9.c2fcb8"]],"info":"This node sets up the inputs to the GSheet node.\nThe outputs that make up those inputs are:\n - msg.sheet -the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n - msg.topic - the combination of spreadsheet tab and cell range\n## Note\nThere are 2 very similar booleans evaluated by this node. They are:\n * **OverrideEnvVariables** - This one looks at the environment variable that was set in the flow triggering the subflow\n * **msg.IgnoreEnvVar** - This one is allows the logic to be driven by a message object property and thus can be set at runtime or earlier in the flow based on upstream logic\n\nFirst it checks the boolean value of the **OverrideEnvVariables** environment variable. This is by default false. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming the first was false, it checks the boolean value of the **msg.IgnoreEnvVar** value. This will evaluated as false if not populated, so sending false is unnecessary. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming both are false, then it can build the outputs based on the subflows environment variables. These can either be those set in the calling flow or they may be the default ones built into the subflow.\n\nRegardless of the method used to build the output, the node also removes the input message properties.\n\n\n\nmsg.IgnoreEnvVar"},{"id":"f422252c.c0f1d8","type":"GSheet","z":"7210fbae.22d8e4","creds":"adb4e9b8.8beee8","method":"get","action":"","sheet":"","cells":"","name":"Read Input from GSheet","x":610,"y":20,"wires":[["2838dc34.945614"]],"info":"Use the GSheet node to get the a set of rows from a google spreadsheet.\n\n# **Inputs**\n### **creds**\nThis is the name on the gauth configuration node. How to get the details is beyond the scope of what I am going to put into an individual node instance. Some details are at [node-red-contrib-google-sheets](https://flows.nodered.org/node/node-red-contrib-google-sheets)\n### **Method**\nIn this case using the get cells method to read a set of data.\n### **SpreadsheetID**\nUnused as the spreadsheet ID is passed in as part of the input msg, but if needed it would be the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n### **Cells**\nUnused as the requested cells are passed in as part of the input msg, but if it was being manually built for a static data source the format is made of of 3 parts with specific seperators:\n * **[Sheetname]** like Sheet1\n * **[upper left corner cell address]** like A1\n * **[lower right corner cell address]** like B2\n\nThe format is **[Sheetname]**!**[upper left corner cell address]**:**[lower right corner cell address]** giving an input like **Sheet1!A1:B2**\n "},{"id":"6da1650e.72098c","type":"comment","z":"7210fbae.22d8e4","name":"Error","info":"","x":1090,"y":20,"wires":[]},{"id":"791141c1.ab893","type":"comment","z":"7210fbae.22d8e4","name":"Last Populated Row","info":"","x":1130,"y":100,"wires":[]},{"id":"3af3fc5d.4cb1a4","type":"function","z":"7210fbae.22d8e4","name":"Prepare Output Parts","func":"/*\n * Row response calculations\n */\nmsg.LastPopulatedRow = msg.payload.length + Number(msg.MinRow) - 1\nmsg.FirstEmptyRow = msg.LastPopulatedRow + 1\n\n/*\n *Column response calculation variables\n */\nlet colCount = 1 //number of columns wide from the data retrieved. This will eventually be replace by logic that loops through array find the max width for any given row\nlet index\nlet sheetdata = msg.payload //this is the data that is returned from Google that will then be examined\nlet fCol = msg.ColStart\nlet fColTotal = 0 //to hold the column number\nlet nCol = \"\"   //nCol is new column\nlet lCol = \"\"   //lCol is last column in the range (to be populated from the actual Gsheet calls data)\n\nfCol = fCol.toUpperCase()\n/*\n * validate fCol (done)\n */\nlet validStartCol = false\nvalidStartCol = ((fCol.length == 1) ||\n                ((fCol.substr(0, 1).charCodeAt(0) - 64) < 9) ||\n                (((fCol.substr(0, 1).charCodeAt(0) - 64) == 9) && ((fCol.substr(1, 1).charCodeAt(0) - 64) <= 22)))\n/*\n *Column response calculations\n */\n//look at each row that is an array\nfor (index = 0; index < sheetdata.length; index++)\n{\n    if (Array.isArray(sheetdata[index]))\n    {\n        // when the rows width is greater than any of the previous rows set the column count to the new largest width\n        colCount = Math.max(colCount, sheetdata[index].length)\n    } //if (Array.isArray(sheetdata[index]))\n}  //for (index = 0; index < sheetdata.length; index++)\nswitch (fCol.length) {\n    case 1:\n        fColTotal = (fCol.substr(0, 1).charCodeAt(0) - 64)\n        fColTotal += colCount - 1\n        break\n    case 2:\n        fColTotal = (fCol.substr(1, 1).charCodeAt(0) - 64) + 26 * (fCol.substr(0, 1).charCodeAt(0) - 64)\n        fColTotal += colCount - 1\n        break\n    default:\n        fColTotal = -1\n}\n//Last Populated Column and First Empty Column calculation\nif ((fColTotal <= 25) && (fColTotal >= 1)) {\n    lCol = String.fromCharCode(fColTotal+64)\n    nCol = String.fromCharCode(fColTotal+65)\n} else if (fColTotal == 26) {\n    lCol = \"Z\"\n    nCol = \"AA\"\n} else if (fColTotal >= 27) {\n    lCol = String.fromCharCode((Math.floor(fColTotal / 26)) + 64) + String.fromCharCode((fColTotal % 26) + 64)\n    nCol = String.fromCharCode((Math.floor(fColTotal / 26)) + 64) + String.fromCharCode((fColTotal % 26) + 65)\n} else if (fColTotal == -1) {\n    lCol = \"Error\"\n    nCol = \"Error\"\n    //Probably worth putting real error here, but deferred\n} else if (fColTotal == 256) {\n    lCol = \"IV\"\n    nCol = \"None\"\n}\nmsg.LastPopulatedCol = lCol\nmsg.FirstEmptyCol = nCol\nmsg.SpreadsheetArray = msg.payload\nreturn msg;","outputs":1,"noerr":0,"x":560,"y":540,"wires":[["2bc97be7.f37b34","6332befe.13c62","e499f758.df9248","df768cb1.db976","a9d36d24.ce42a","83f841eb.373dc"]],"info":"Takes an input from the Gsheet node and calculates a variety of details about the spreadsheet info.\n### **Output**\nmsg.LastPopulatedRow\nmsg.FirstEmptyRow\nmsg.LastPopulatedCol\nmsg.FirstEmptyCol\nmsg.SpreadsheetArray\n"},{"id":"b7be492.2775fb8","type":"comment","z":"7210fbae.22d8e4","name":"First Empty Row","info":"","x":1120,"y":180,"wires":[]},{"id":"2fd9467.e82b3ba","type":"comment","z":"7210fbae.22d8e4","name":"Last Populated Column","info":"","x":1140,"y":260,"wires":[]},{"id":"9123a731.ba8258","type":"comment","z":"7210fbae.22d8e4","name":"First Empty Column","info":"","x":1130,"y":340,"wires":[]},{"id":"a5bd59e.838cfa8","type":"comment","z":"7210fbae.22d8e4","name":"Spreadsheet Array","info":"","x":1130,"y":420,"wires":[]},{"id":"ee060230.df0a6","type":"comment","z":"7210fbae.22d8e4","name":"Full Data","info":"","x":1100,"y":500,"wires":[]},{"id":"3640b7a5.03e378","type":"comment","z":"7210fbae.22d8e4","name":"Full Data with Inputs","info":"","x":1130,"y":580,"wires":[]},{"id":"2bc97be7.f37b34","type":"change","z":"7210fbae.22d8e4","name":"Leave Outputs","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":540,"wires":[[]],"info":"Deletes a variety of message properties, but leaves all of them that were calculated about the Gsheet nodes results to be returned on the designated subflow output."},{"id":"6332befe.13c62","type":"change","z":"7210fbae.22d8e4","name":"Leave Last Populated Row","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"LastPopulatedRow","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":140,"wires":[[]],"info":"Copies msg.theLastPopulatedRow into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"e499f758.df9248","type":"change","z":"7210fbae.22d8e4","name":"Leave First Empty Row","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"FirstEmptyRow","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":870,"y":220,"wires":[[]],"info":"Copies msg.FirstEmptyRow into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"df768cb1.db976","type":"change","z":"7210fbae.22d8e4","name":"Leave Last Populated Column","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"LastPopulatedCol","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":890,"y":300,"wires":[[]],"info":"Copies msg.LastPopulatedCol into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"a9d36d24.ce42a","type":"change","z":"7210fbae.22d8e4","name":"Leave First Empty Column","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"FirstEmptyCol","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":380,"wires":[[]],"info":"Copies msg.FirstEmptyCol into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"83f841eb.373dc","type":"change","z":"7210fbae.22d8e4","name":"Leave Spreadsheet Array","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"SpreadsheetArray","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":870,"y":460,"wires":[[]],"info":"Copies msg.SpreadsheetArray into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"b82ddf24.559fd","type":"trigger","z":"7210fbae.22d8e4","name":"Watchdog","op1":"","op2":"timeout","op1type":"nul","op2type":"str","duration":"10","extend":true,"units":"s","reset":"","bytopic":"all","outputs":1,"x":600,"y":140,"wires":[["df768cb1.db976","6332befe.13c62","a9d36d24.ce42a","83f841eb.373dc","2bc97be7.f37b34"]],"info":"This trigger node works as a watchdog to see if the request to see if the read of the Google Sheet that was triggered on the other branch is successful. If it is succeful, then it will receive a reset message (msg.reset) from the Reset Watchdog node. If, however, 10 seconds elapse without receiving the reset message, this node sends a timeout message (msg.timeout)."},{"id":"ef0c87a9.c2fcb8","type":"change","z":"7210fbae.22d8e4","name":"","rules":[{"t":"set","p":"timeout","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":120,"wires":[["b82ddf24.559fd"]],"info":"Labels what the initial input to the watchdog trigger node is."},{"id":"5847081f.74af68","type":"change","z":"7210fbae.22d8e4","name":"","rules":[{"t":"delete","p":"reset","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":350,"y":540,"wires":[["3af3fc5d.4cb1a4"]],"info":"Removes msg.reset that was only intended for the watchdog trigger node."},{"id":"69a18bbe.6b1de4","type":"catch","z":"7210fbae.22d8e4","name":"Catch and Relay Errors","scope":null,"uncaught":false,"x":860,"y":60,"wires":[["5d106639.b51278"]],"info":"Passes any caught error to the error subflows intentially built error output. By intentionally built I mean I created one and labelled it as such. This is not there by default."},{"id":"2838dc34.945614","type":"change","z":"7210fbae.22d8e4","name":"Reset Watchdog","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":140,"y":140,"wires":[["b82ddf24.559fd","5847081f.74af68"]],"info":"Sends the reset message to the watchdog triger node when there is output from the Gsheet node."},{"id":"5d106639.b51278","type":"debug","z":"7210fbae.22d8e4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1480,"y":80,"wires":[]},{"id":"6315b82d.175b88","type":"debug","z":"7210fbae.22d8e4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":780,"y":740,"wires":[]},{"id":"38dc5c0e.7a5da4","type":"debug","z":"7210fbae.22d8e4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1360,"y":180,"wires":[]},{"id":"ce5f952b.5e5a28","type":"function","z":"62402261.0f073c","name":"Db Put the payload into a global variable named after the content of msg.globalsource","func":"global.set(msg.globalsource, msg.payload)\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":400,"wires":[["790c08a5.162c58"]],"info":"# **What** #\nThis is a simple function node that stores the msg.payload into a global variable. This is done in a function node, however, because the name of that global variable is passed into the function as a the value of msg.globalsource. \n\n## **Why**\nNormally this would be done in a change node, but change nodes could not as of May 2020 take a msg object component as the name of the global variable to be set."},{"id":"e5141427.4a38c8","type":"subflow:7210fbae.22d8e4","z":"62402261.0f073c","name":"","env":[],"x":580,"y":189,"wires":[[],[],[],[],[],[],["ce5f952b.5e5a28"],[]],"info":"This subflow shows information in the environment variables. These are good for testing purposes, but it is noteworthy that the override boolean is false. Unless that boolean is changed, they have no impact."},{"id":"790c08a5.162c58","type":"function","z":"62402261.0f073c","name":"Db Use input to lookup info","func":"//Ref. TMS-000001\n\n//if(msg.exportableresults.DeviceName !== \"Switch_Ikea\") {return}\n\n\n\n//1 Get must have items: searchKeys, searchValues, searchResultKeys, cachedSearch, cacheTime\n//debugger\nlet searchKeys = Object.keys(msg.keyvalues)\nlet searchValues = Object.values(msg.keyvalues)\nlet searchResultKeys = Object.keys(msg.searchfor)\nlet cachedSearch = global.get(\"LastSearch\")\nlet cacheTime = new Date().getTime()\n//2 create working variables searchKeyIndices, searchResultKeysIndices, index, cacheKey\nlet searchResultKeysIndices = []\nlet index\nlet cacheObject\n//3 build the cache key which is essentially the concatenation of key+value+nextkey+nextvalue+.....etc\ncacheObject = BuildCacheObject(searchKeys, searchValues, searchResultKeys)\n//4\n/*\n * 4.1 t/f cached result is usable\n    *  4.1.true then t/f does it meet criteria\n        * 4.1.true.true\ttrue msg.searchfor = cachedSearch.searchfor\n        * 4.1.true.false do the common lookup\n    *   4.1.false  do the common lookup\n    */\n//4.1\nif (cachedSearch !== undefined)\n{\n    //4.1.true\n    if ((cachedSearch.query == cacheObject.query) && (cachedSearch.time > cacheObject.time - 5000))\n    {\n        //4.1.true.true\n        msg.searchfor = cachedSearch.searchfor\n        return [msg, null, null]\n    } //if ((cachedSearch.query == cacheObject.query) && (cachedSearch.time > cacheObject.time - 5000))\n    //4.1.true.false\n    else\n    {\n        //4.1.true.false\n        lookupResults = CommonLookup(msg, searchKeys, searchResultKeys, searchValues, global.get(msg.globalsource), cacheObject)\n        //return results from the node on 1 of the 3 outputs\n        if (lookupResults[0] !== null)\n        {\n            return [lookupResults[0], null, null]\n        } //if (lookupResults[0] !== null)\n        else if (lookupResults[1] !== null)\n        {\n            return [null, lookupResults[1], null]\n        } //else if (lookupResults[1] !== null)\n        else\n        {\n            return [null, null, lookupResults[2]]\n        } //else if (lookupResults[1] !== null) else\n    } //if ((cachedSearch.query == cacheObject.query) && (cachedSearch.time > cacheObject.time - 5000)) else\n} //if (cachedSearch !== undefined)\n//4.1.false\nelse\n{\n    //4.1.false\n    lookupResults = CommonLookup(msg, searchKeys, searchResultKeys, searchValues, global.get(msg.globalsource), cacheObject)\n    //return results from the node on 1 of the 3 outputs\n    if (lookupResults[0] !== null)\n    {\n        return [lookupResults[0], null, null]\n    } //if (lookupResults[0] !== null)\n    else if (lookupResults[1] !== null)\n    {\n        return [null, lookupResults[1], null]\n    } //else if (lookupResults[1] !== null)\n    else\n    {\n        return [null, null, lookupResults[2]]\n    } //else if (lookupResults[1] !== null) else\n} //if (cachedSearch !== undefined) else\nreturn\n\nfunction BuildCacheObject(searchKeysArray, SearchValuesArray, SearchResultKeysArray) {\n    //3 build the cache key which is essentially the concatenation of key+value+nextkey+nextvalue+.....etc\n    let newCacheKey =\"\"\n    for (index = 0; index < searchKeysArray.length; index++)\n    {\n        newCacheKey = newCacheKey + searchKeysArray[index] + SearchValuesArray[index]\n    } //for (index = 0; index < searchKeysArray.length; index++)\n    //add all fields that will be looked for into the cache key\n    for (index = 0; index < SearchResultKeysArray.length; index++)\n    {\n        newCacheKey = newCacheKey + SearchResultKeysArray[index]\n    } //for (index = 0; index < SearchResultKeysArray.length; index++)\n    //combine the cache key and the cache time into a single object that can be compared with the cached last search\n    let createdCacheObject = \n    {\n        query: newCacheKey,\n        time: cacheTime\n    }\n    return createdCacheObject\n}\nfunction CommonLookup(workingMsg, keysForSearchColumn, keysForResultColumn, valuesSearchedFor, requestedDataTable, passedCacheObject) {\n    let searchKeyIndices = []\n    let searchResultKeysIndices = []\n    let outerIndex\n    let innerLoopCounter\n    let innerIndex\n    let index\n    if (requestedDataTable !== undefined)\n    {\n        // iterate through all search keys.\n        //outer index is the place along the array of search keys\n        for (outerIndex = 0; outerIndex < keysForSearchColumn.length; outerIndex++)\n        {\n            //inner index is the place along the first row of data\n            //The innerLoopCounter must be reset each time a new key is being looked for\n            innerLoopCounter = 0\n            for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n            {\n                //these 2 loops will compare every entry in the top row of the data table to every entry in the array of search keys,\n                if (requestedDataTable[0][innerIndex] == keysForSearchColumn[outerIndex])\n                {\n                    //when they match push the column number on to the array that has just indices for the search keys\n                    searchKeyIndices.push(innerIndex)\n                    //break is used to stop comparing as once the column has been found the remaining aren't relevant\n                    //////////////////////////////////////////////////////////////////////////break may be a problem. Maybe swap inner and outer arrays and then do some if then about getting through the whole data headers without finding. Right now it only looks for 1 failure\n                    break\n                } //if (requestedDataTable[0][innerIndex] == keysForSearchColumn[outerIndex])\n                else\n                {\n                    //when they don't match, then this means there is a search key that does not match any header.\n                    //When properly configured this should not happen, but proper configuration cannot be guaranteed\n                    //this is accumulating how many times the search key did not match one of the data table headers\n                    innerLoopCounter++\n                    //Error messaging should only happen if the search key has been compared with all of the headers\n                    //requestedDataTable[0].length gives the total number of data headers (columns of the spreadsheet)\n                    if (requestedDataTable[0].length == innerLoopCounter)\n                    {\n                        //populate error \n                        //put some details on this configuration into the msg to be output\n                        workingMsg.error = \"Key with value \\\"\" + keysForSearchColumn[outerIndex] + \"\\\" not found amongst the \" + (requestedDataTable[0].length + 1) + \" entries, which include \" + requestedDataTable[0]\n                        //either create and populate the error count at 1 or increment it if it already exists\n                        if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n                        {\n                                workingMsg.searchErrorCount++\n                        }\n                        else\n                        {\n                            workingMsg.searchErrorCount = 1\n                        }\n                        //this retry is in case the column was added to the google sheet since it was last loaded into node red\n                        if (workingMsg.searchErrorCount > 1)\n                        {\n                            //return the error on the bottom because with a count of 2 that means reloading has already been tried\n                            return [null, null, workingMsg]\n                        }\n                        else\n                        {\n                            //return the error on the middle there is an error output,\n                            return [null, workingMsg, null]\n                        }\n                    } //if (requestedDataTable[0].length == innerLoopCounter)\n                } //if (requestedDataTable[0][innerIndex] == keysForSearchColumn[outerIndex]) else\n            } //for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n        } //for (outerIndex = 0; outerIndex < keysForSearchColumn.length; outerIndex++)\n        //if this point is reached, searchKeyIndices has been populated\n        // iterate through all search result keys.\n        //outer index is the place along the array of search keys \n        for (outerIndex = 0; outerIndex < keysForResultColumn.length; outerIndex++)\n        {\n            //inner index is the place along the first row of data\n            //The innerLoopCounter must be reset each time a new key is being looked for\n            innerLoopCounter = 0\n            for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n            {\n                //these 2 loops will compare every entry in the top row of the data table to every entry in the array of search keys,\n                if (requestedDataTable[0][innerIndex] == keysForResultColumn[outerIndex])\n                {\n                    //when they match push the column number on to the array that has just indices for the search keys\n                    searchResultKeysIndices.push(innerIndex)\n                    //break is used to stop comparing as once the column has been found the remaining aren't relevant\n                    break\n                } //if (requestedDataTable[0][innerIndex] == keysForResultColumn[outerIndex])\n                else\n                {\n                    //when they don't match, then this means there is a search key that does not match any header.\n                    //When properly configured this should not happen, but proper configuration cannot be guaranteed\n                    innerLoopCounter++\n                    //Error messaging should only happen if the search key has been compared with all of the headers\n                    //requestedDataTable[0].length gives the total number of data headers (columns of the spreadsheet)\n                    if (requestedDataTable[0].length == innerLoopCounter)\n                    {\n                        //populate error \n                        //put some details on this configuration into the msg to be output\n                        workingMsg.error = \"Key with value \\\"\" + keysForSearchColumn[outerIndex] + \"\\\" not found amongst the \" + (requestedDataTable[0].length + 1) + \" entries, which include \" + requestedDataTable[0]\n                        //either create and populate the error count at 1 or increment it if it already exists\n                        if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n                        {\n                            workingMsg.searchErrorCount++\n                        } //if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n                        else\n                        {\n                            workingMsg.searchErrorCount = 1\n                        } //if ( workingMsg.hasOwnProperty(\"searchErrorCount\")) else\n                        //this retry is in case the column was added to the google sheet since it was last loaded into node red\n                        if (workingMsg.searchErrorCount > 1)\n                        {\n                            //return the error on the bottom because with a count of 2 that means reloading has already been tried\n                            return [null, null, workingMsg]\n                        } //if (workingMsg.searchErrorCount > 1)\n                        else\n                        {\n                            //return the error on the middle there is an error output,\n                            return [null, workingMsg, null]\n                        } //if (workingMsg.searchErrorCount > 1) else\n                    } //if (requestedDataTable[0].length == innerLoopCounter)\n                } //if (requestedDataTable[0][innerIndex] == keysForResultColumn[outerIndex]) else\n            } //for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n        } //for (outerIndex = 0; outerIndex < keysForResultColumn.length; outerIndex++)\n        //if this point is reached, both searchKeyIndices and searchResultKeysIndices have been populated\n        //loop through all search keys, 1 index at a time and filter to a row that has the desired data in the desired column\n        let result = []\n        let pushable\n        pushable = false\n        for (outerIndex = 0; outerIndex < requestedDataTable.length; outerIndex++)\n        {\n            for (innerIndex = 0; innerIndex < searchKeyIndices.length; innerIndex++)\n            {\n                if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex])\n                {\n                    pushable = true\n                } //if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex])\n                else\n                {\n                    pushable = false\n                    break\n                } //if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex]) else\n            } //for (innerIndex = 0; innerIndex < searchKeyIndices.length; innerIndex++)\n            if (pushable)\n            {\n                result.push(requestedDataTable[outerIndex])\n            } //if (pushable)\n    \n    } //for (outerIndex = 0; outerIndex < requestedDataTable.length; outerIndex++)\n        //if this point is reached then there is a filtered table\n        //debugger\n        if (result.length === 0)\n        {\n            workingMsg.error = \"After filtering no data rows were left.\"\n            //either create and populate the error count at 1 or increment it if it already exists\n            if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n            {\n                workingMsg.searchErrorCount++\n            } //( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n            else\n            {\n                workingMsg.searchErrorCount = 1\n            } //( workingMsg.hasOwnProperty(\"searchErrorCount\")) else\n            //return the error on the middle there is an error output,\n            //this retry is in case the column was added to the google sheet since it was last loaded into node red\n            if (workingMsg.searchErrorCount > 1)\n            {\n                //return the error on the bottom because with a count of 2 that means reloading has already been tried\n                return [null, null, workingMsg]\n            } //if (workingMsg.searchErrorCount > 1)\n            else\n            {\n                //return the error on the middle there is an error output,\n                return [null, workingMsg, null]\n            } //if (workingMsg.searchErrorCount > 1) else\n        } //if (result.length === 0)\n        else if (result.length > 1)\n        {\n            //do the warning that multiple were found but will take the first\n            node.warn(\"Multiple rows were found that matched the search criteria. Results are from the first row that was found and matched.\")\n        } //else if (result.length > 1)\n        //look up the data\n        for (index = 0; index < searchResultKeysIndices.length; index++)\n        {\n            //workingMsg.searchfor.keysForSearchColumn[index] = result[0][searchResultKeysIndices]\n            // the almost working version\n            workingMsg.searchfor[keysForResultColumn[index]] = result[0][searchResultKeysIndices[index]]\n        } //for (index = 0; index < searchResultKeysIndices.length; index++)\n        //if this point is reached then work workingMsg contains complete info\n        //build and save the LastSearch obect\n        passedCacheObject.searchfor = workingMsg.searchfor\n        global.set(\"LastSearch\", passedCacheObject)\n        return [workingMsg, null, null]\n    } //if (requestedDataTable !== undefined)\n    else\n    {\n        //return on second output to trigger population of global that feeds datatable\n        //put some details on this configuration into the msg to be output\n        workingMsg.error = \"The data normally loaded from google sheet was not loaded.\"\n        //either create and populate the error count at 1 or increment it if it already exists\n        if (workingMsg.hasOwnProperty('searchErrorCount'))\n        {\n            workingMsg.searchErrorCount++\n        } //if (workingMsg.hasOwnProperty('searchErrorCount'))\n        else\n        {\n            workingMsg.searchErrorCount = 1\n        } //if (workingMsg.hasOwnProperty('searchErrorCount')) else\n        //return the error on the middle there is an error output,\n        //this retry is in case the column was added to the google sheet since it was last loaded into node red\n        if (workingMsg.searchErrorCount > 1)\n        {\n            //return the error on the bottom because with a count of 2 that means reloading has already been tried\n            return [null, null, workingMsg]\n        } //if (workingMsg.searchErrorCount > 1)\n        else\n        {\n            //return the error on the middle there is an error output,\n            return [null, workingMsg, null]\n        } //if (workingMsg.searchErrorCount > 1) else\n    } //if (requestedDataTable !== undefined) else\n}","outputs":3,"noerr":0,"x":240,"y":80,"wires":[[],["e5141427.4a38c8"],[]],"outputLabels":["Value Found","Error but try reloading from data source","Error despite having tried to reload from data source"],"info":"# **Conceptual Explanation**\nThis node is designed to use a 2-D array of data loaded from a google sheeet to lookup desired data. The data is arrayed with the first row being column headers describing the data in those columns in subsequent rows.\n## **inputs**\n### globalsource \nThe name of the global variable holding the table of data\n### msg.keyvalues\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row.\n### msg.searchfor\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. The value enters the node empty.\n## **outputs**\n### Output1: Value Found \nThis ouput is used when the node has successfully identified the requested data. That data is placed into the value portions of the key value pairs that made up the msg.searchfor input\n### Output 2: Error but try reloading from data source\nThis output is used when either the global variable to contain the data table either does no exist or does not contain a row with all of the requested search criteria. Normally it is used to trigger loading the table from Google sheets under the expectation that either this is the first time a lookup has been tried an the data had not yet been cached in the global variable or potentially the data in the cache has become stale and reloading from the Google sheet will add a row that will match the requested search criteria.\n### Output 3: Error despite having tried to reload from data source\nThis output is used when either the global variable to contain the data table either does no exist or does not contain a row with all of the requested search criteria and at least 1 attempt has already been made to reload the global vairable cache. This is effectively a notification of non-recoverable lookup failure."},{"id":"440c8db0.e5b1b4","type":"change","z":"62402261.0f073c","name":"Devices table, 1 search key with variable input, 1 result","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"exportableresults.DeviceName","tot":"msg"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":980,"y":100,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value pulled from the **msg.exportableresults.DeviceName** object.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** column.\n"},{"id":"130ae85d.01dcc8","type":"change","z":"62402261.0f073c","name":"Devices table, 1 search key, 2 results","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"Motion_Ikea","tot":"str"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.Manufacturer","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":180,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value **\"Motion_Ikea\"**.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** and **\"Manufacturer\"** columns."},{"id":"e03e256e.9097d8","type":"change","z":"62402261.0f073c","name":"Devices table, 1 search key, 1 result","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"Anyone Presence","tot":"str"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":60,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value **\"Anyone Presence\"**. Notice unlike some examples this includes a space in the value. This has no negative impact.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** column."},{"id":"85df0cee.5191e","type":"change","z":"62402261.0f073c","name":"Devices table, 2 search keys, 1 results","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"Anyone Presence","tot":"str"},{"t":"set","p":"keyvalues.Manufacturer","pt":"msg","to":"homebridge-people-geofence","tot":"str"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":140,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value **\"Anyone Presence\"** and the **\"Manufacturer\"** column for the value **\"homebridge-people-geofence\"**.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** columns."},{"id":"f58c7d20.e5406","type":"comment","z":"62402261.0f073c","name":"Examples of preformating the inputs","info":"","x":920,"y":20,"wires":[]},{"id":"7042ee00.b30cc","type":"change","z":"62402261.0f073c","name":"Spreadsheet Lookup Settings Example","rules":[{"t":"set","p":"IgnoreEnvVar ","pt":"msg","to":"true","tot":"bool"},{"t":"set","p":"SpreadsheetID","pt":"msg","to":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","tot":"str"},{"t":"set","p":"Tab","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"ColStart","pt":"msg","to":"A","tot":"str"},{"t":"set","p":"ColEnd","pt":"msg","to":"Z","tot":"str"},{"t":"set","p":"MinRow","pt":"msg","to":"1","tot":"str"},{"t":"set","p":"MaxRow","pt":"msg","to":"1000","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":260,"wires":[[]],"info":"## **inputs**\n### IgnoreEnvVar \nThis boolean needs to be true to tell that Read Spreadsheet For Details subflow that it should use the specs passed in the msg to determine what spreadsheet to read from and what portion of data to read from.\n### msg.SpreadsheetID\nThis is the very long string that identifies a specific google spreadsheet.\n### msg.Tab\nSpecifies the tab name that contains the data.\n### msg.ColStart\nSpecifies the leftmost column containing the desired data.\n### msg.ColEnd\nSpecifies the rightmost column containing the desired data. \n### msg.MinRow\nSpecifies the top row containing the desired data \n### msg.MaxRow\nSpecifies the bottom row containing the desired data "},{"id":"4e5c896.eedb878","type":"function","z":"56462e67.8c2c1","name":"Determine Source For Gsheet lookup properties.","func":"//Read subflow input variables\nif (env.get(\"OverrideEnvVariables\"))\n{\n    //Put inputs and read values into msg properties to be visible downstream\n    msg.sheet = msg.SpreadsheetID;\n    msg.tab = msg.Tab;\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    msg.topic = msg.targetrange\n    delete msg.Tab\n    delete msg.SpreadsheetID\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\n}\nelse if (msg.IgnoreEnvVar)\n{\n    //Put inputs and read values into msg properties to be visible downstream\n    msg.sheet = msg.SpreadsheetID;\n    msg.tab = msg.Tab;\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    msg.topic = msg.targetrange\n    delete msg.Tab\n    delete msg.SpreadsheetID\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\n}\nelse\n{\n    var ColStart = env.get(\"ColStart\");\n    var ColEnd = env.get(\"ColEnd\");\n    var FirstRow = env.get(\"MinRow\");\n    var LastRow = env.get(\"MaxRow\");\n    //Put inputs and read values into msg properties to be visible downstream\n    msg.sheet = env.get(\"Spreadsheet ID\");\n    msg.tab = env.get(\"TabName\");\n    msg.cellstart = ColStart + FirstRow\n    msg.cellend = ColEnd + LastRow\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    msg.topic = msg.targetrange\n    delete msg.Tab\n    delete msg.SpreadsheetID\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\n    //These 2 are needed later to calculate the last populate and first empty rows and columns\n    msg.ColStart = ColStart\n    msg.MinRow = FirstRow\n}\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":20,"wires":[["26f4e933.493736","6b7fc683.cbc7e8"]],"info":"This node sets up the inputs to the GSheet node.\nThe outputs that make up those inputs are:\n - msg.sheet -the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n - msg.topic - the combination of spreadsheet tab and cell range\n## Note\nThere are 2 very similar booleans evaluated by this node. They are:\n * **OverrideEnvVariables** - This one looks at the environment variable that was set in the flow triggering the subflow\n * **msg.IgnoreEnvVar** - This one is allows the logic to be driven by a message object property and thus can be set at runtime or earlier in the flow based on upstream logic\n\nFirst it checks the boolean value of the **OverrideEnvVariables** environment variable. This is by default false. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming the first was false, it checks the boolean value of the **msg.IgnoreEnvVar** value. This will evaluated as false if not populated, so sending false is unnecessary. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming both are false, then it can build the outputs based on the subflows environment variables. These can either be those set in the calling flow or they may be the default ones built into the subflow.\n\nRegardless of the method used to build the output, the node also removes the input message properties.\n\n\n\nmsg.IgnoreEnvVar"},{"id":"26f4e933.493736","type":"GSheet","z":"56462e67.8c2c1","creds":"adb4e9b8.8beee8","method":"get","action":"","sheet":"","cells":"","name":"Read Input from GSheet","x":610,"y":20,"wires":[["622b4f71.e2b6e"]],"info":"Use the GSheet node to get the a set of rows from a google spreadsheet.\n\n# **Inputs**\n### **creds**\nThis is the name on the gauth configuration node. How to get the details is beyond the scope of what I am going to put into an individual node instance. Some details are at [node-red-contrib-google-sheets](https://flows.nodered.org/node/node-red-contrib-google-sheets)\n### **Method**\nIn this case using the get cells method to read a set of data.\n### **SpreadsheetID**\nUnused as the spreadsheet ID is passed in as part of the input msg, but if needed it would be the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n### **Cells**\nUnused as the requested cells are passed in as part of the input msg, but if it was being manually built for a static data source the format is made of of 3 parts with specific seperators:\n * **[Sheetname]** like Sheet1\n * **[upper left corner cell address]** like A1\n * **[lower right corner cell address]** like B2\n\nThe format is **[Sheetname]**!**[upper left corner cell address]**:**[lower right corner cell address]** giving an input like **Sheet1!A1:B2**\n "},{"id":"69b07297.d8d3ec","type":"comment","z":"56462e67.8c2c1","name":"Error","info":"","x":1090,"y":20,"wires":[]},{"id":"da45612a.2975","type":"comment","z":"56462e67.8c2c1","name":"Last Populated Row","info":"","x":1130,"y":100,"wires":[]},{"id":"3437a510.51a74a","type":"function","z":"56462e67.8c2c1","name":"Prepare Output Parts","func":"/*\n * Row response calculations\n */\nmsg.LastPopulatedRow = msg.payload.length + Number(msg.MinRow) - 1\nmsg.FirstEmptyRow = msg.LastPopulatedRow + 1\n\n/*\n *Column response calculation variables\n */\nlet colCount = 1 //number of columns wide from the data retrieved. This will eventually be replace by logic that loops through array find the max width for any given row\nlet index\nlet sheetdata = msg.payload //this is the data that is returned from Google that will then be examined\nlet fCol = msg.ColStart\nlet fColTotal = 0 //to hold the column number\nlet nCol = \"\"   //nCol is new column\nlet lCol = \"\"   //lCol is last column in the range (to be populated from the actual Gsheet calls data)\n\nfCol = fCol.toUpperCase()\n/*\n * validate fCol (done)\n */\nlet validStartCol = false\nvalidStartCol = ((fCol.length == 1) ||\n                ((fCol.substr(0, 1).charCodeAt(0) - 64) < 9) ||\n                (((fCol.substr(0, 1).charCodeAt(0) - 64) == 9) && ((fCol.substr(1, 1).charCodeAt(0) - 64) <= 22)))\n/*\n *Column response calculations\n */\n//look at each row that is an array\nfor (index = 0; index < sheetdata.length; index++)\n{\n    if (Array.isArray(sheetdata[index]))\n    {\n        // when the rows width is greater than any of the previous rows set the column count to the new largest width\n        colCount = Math.max(colCount, sheetdata[index].length)\n    } //if (Array.isArray(sheetdata[index]))\n}  //for (index = 0; index < sheetdata.length; index++)\nswitch (fCol.length) {\n    case 1:\n        fColTotal = (fCol.substr(0, 1).charCodeAt(0) - 64)\n        fColTotal += colCount - 1\n        break\n    case 2:\n        fColTotal = (fCol.substr(1, 1).charCodeAt(0) - 64) + 26 * (fCol.substr(0, 1).charCodeAt(0) - 64)\n        fColTotal += colCount - 1\n        break\n    default:\n        fColTotal = -1\n}\n//Last Populated Column and First Empty Column calculation\nif ((fColTotal <= 25) && (fColTotal >= 1)) {\n    lCol = String.fromCharCode(fColTotal+64)\n    nCol = String.fromCharCode(fColTotal+65)\n} else if (fColTotal == 26) {\n    lCol = \"Z\"\n    nCol = \"AA\"\n} else if (fColTotal >= 27) {\n    lCol = String.fromCharCode((Math.floor(fColTotal / 26)) + 64) + String.fromCharCode((fColTotal % 26) + 64)\n    nCol = String.fromCharCode((Math.floor(fColTotal / 26)) + 64) + String.fromCharCode((fColTotal % 26) + 65)\n} else if (fColTotal == -1) {\n    lCol = \"Error\"\n    nCol = \"Error\"\n    //Probably worth putting real error here, but deferred\n} else if (fColTotal == 256) {\n    lCol = \"IV\"\n    nCol = \"None\"\n}\nmsg.LastPopulatedCol = lCol\nmsg.FirstEmptyCol = nCol\nmsg.SpreadsheetArray = msg.payload\nreturn msg;","outputs":1,"noerr":0,"x":560,"y":540,"wires":[["1aad3709.387999","4e10e8d5.d61b48","a8dec9f9.1d9a08","6f59f913.bffce8","3029f7f0.2d1fb8","5f254201.4ba14c"]],"info":"Takes an input from the Gsheet node and calculates a variety of details about the spreadsheet info.\n### **Output**\nmsg.LastPopulatedRow\nmsg.FirstEmptyRow\nmsg.LastPopulatedCol\nmsg.FirstEmptyCol\nmsg.SpreadsheetArray\n"},{"id":"28dab18e.272a7e","type":"comment","z":"56462e67.8c2c1","name":"First Empty Row","info":"","x":1120,"y":180,"wires":[]},{"id":"47f75eb6.ec913","type":"comment","z":"56462e67.8c2c1","name":"Last Populated Column","info":"","x":1140,"y":260,"wires":[]},{"id":"3eb8daa3.eb4b56","type":"comment","z":"56462e67.8c2c1","name":"First Empty Column","info":"","x":1130,"y":340,"wires":[]},{"id":"bd50ae6.298fa5","type":"comment","z":"56462e67.8c2c1","name":"Spreadsheet Array","info":"","x":1130,"y":420,"wires":[]},{"id":"8051276a.f98a08","type":"comment","z":"56462e67.8c2c1","name":"Full Data","info":"","x":1100,"y":500,"wires":[]},{"id":"861a081b.b6a6d8","type":"comment","z":"56462e67.8c2c1","name":"Full Data with Inputs","info":"","x":1130,"y":580,"wires":[]},{"id":"1aad3709.387999","type":"change","z":"56462e67.8c2c1","name":"Leave Outputs","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":540,"wires":[[]],"info":"Deletes a variety of message properties, but leaves all of them that were calculated about the Gsheet nodes results to be returned on the designated subflow output."},{"id":"4e10e8d5.d61b48","type":"change","z":"56462e67.8c2c1","name":"Leave Last Populated Row","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"LastPopulatedRow","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":140,"wires":[[]],"info":"Copies msg.theLastPopulatedRow into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"a8dec9f9.1d9a08","type":"change","z":"56462e67.8c2c1","name":"Leave First Empty Row","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"FirstEmptyRow","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":870,"y":220,"wires":[[]],"info":"Copies msg.FirstEmptyRow into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"6f59f913.bffce8","type":"change","z":"56462e67.8c2c1","name":"Leave Last Populated Column","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"LastPopulatedCol","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":890,"y":300,"wires":[[]],"info":"Copies msg.LastPopulatedCol into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"3029f7f0.2d1fb8","type":"change","z":"56462e67.8c2c1","name":"Leave First Empty Column","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"FirstEmptyCol","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":380,"wires":[[]],"info":"Copies msg.FirstEmptyCol into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"5f254201.4ba14c","type":"change","z":"56462e67.8c2c1","name":"Leave Spreadsheet Array","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"SpreadsheetArray","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":870,"y":460,"wires":[[]],"info":"Copies msg.SpreadsheetArray into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"75c13236.259f5c","type":"trigger","z":"56462e67.8c2c1","name":"Watchdog","op1":"","op2":"timeout","op1type":"nul","op2type":"str","duration":"10","extend":true,"units":"s","reset":"","bytopic":"all","outputs":1,"x":600,"y":140,"wires":[["6f59f913.bffce8","4e10e8d5.d61b48","3029f7f0.2d1fb8","5f254201.4ba14c","1aad3709.387999"]],"info":"This trigger node works as a watchdog to see if the request to see if the read of the Google Sheet that was triggered on the other branch is successful. If it is succeful, then it will receive a reset message (msg.reset) from the Reset Watchdog node. If, however, 10 seconds elapse without receiving the reset message, this node sends a timeout message (msg.timeout)."},{"id":"6b7fc683.cbc7e8","type":"change","z":"56462e67.8c2c1","name":"","rules":[{"t":"set","p":"timeout","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":120,"wires":[["75c13236.259f5c"]],"info":"Labels what the initial input to the watchdog trigger node is."},{"id":"279f2c73.1c0fd4","type":"change","z":"56462e67.8c2c1","name":"","rules":[{"t":"delete","p":"reset","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":350,"y":540,"wires":[["3437a510.51a74a"]],"info":"Removes msg.reset that was only intended for the watchdog trigger node."},{"id":"fd167f63.f0515","type":"catch","z":"56462e67.8c2c1","name":"Catch and Relay Errors","scope":null,"uncaught":false,"x":860,"y":60,"wires":[["49e0b1ae.71bbc"]],"info":"Passes any caught error to the error subflows intentially built error output. By intentionally built I mean I created one and labelled it as such. This is not there by default."},{"id":"622b4f71.e2b6e","type":"change","z":"56462e67.8c2c1","name":"Reset Watchdog","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":140,"y":140,"wires":[["75c13236.259f5c","279f2c73.1c0fd4"]],"info":"Sends the reset message to the watchdog triger node when there is output from the Gsheet node."},{"id":"49e0b1ae.71bbc","type":"debug","z":"56462e67.8c2c1","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1480,"y":80,"wires":[]},{"id":"5bfa08e1.07cd88","type":"debug","z":"56462e67.8c2c1","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":780,"y":740,"wires":[]},{"id":"81e68928.768c58","type":"debug","z":"56462e67.8c2c1","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1360,"y":180,"wires":[]},{"id":"536edd13.90f514","type":"function","z":"8b456115.ccf69","name":"Db Put the payload into a global variable named after the content of msg.globalsource","func":"global.set(msg.globalsource, msg.payload)\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":400,"wires":[["23e47880.0f5478"]],"info":"# **What** #\nThis is a simple function node that stores the msg.payload into a global variable. This is done in a function node, however, because the name of that global variable is passed into the function as a the value of msg.globalsource. \n\n## **Why**\nNormally this would be done in a change node, but change nodes could not as of May 2020 take a msg object component as the name of the global variable to be set."},{"id":"4f13373b.e70178","type":"subflow:56462e67.8c2c1","z":"8b456115.ccf69","name":"","env":[],"x":580,"y":189,"wires":[[],[],[],[],[],[],["536edd13.90f514"],[]],"info":"This subflow shows information in the environment variables. These are good for testing purposes, but it is noteworthy that the override boolean is false. Unless that boolean is changed, they have no impact."},{"id":"23e47880.0f5478","type":"function","z":"8b456115.ccf69","name":"Db Use input to lookup info","func":"//Ref. TMS-000001\n\n//if(msg.exportableresults.DeviceName !== \"Switch_Ikea\") {return}\n\n\n\n//1 Get must have items: searchKeys, searchValues, searchResultKeys, cachedSearch, cacheTime\n//debugger\nlet searchKeys = Object.keys(msg.keyvalues)\nlet searchValues = Object.values(msg.keyvalues)\nlet searchResultKeys = Object.keys(msg.searchfor)\nlet cachedSearch = global.get(\"LastSearch\")\nlet cacheTime = new Date().getTime()\n//2 create working variables searchKeyIndices, searchResultKeysIndices, index, cacheKey\nlet searchResultKeysIndices = []\nlet index\nlet cacheObject\n//3 build the cache key which is essentially the concatenation of key+value+nextkey+nextvalue+.....etc\ncacheObject = BuildCacheObject(searchKeys, searchValues, searchResultKeys)\n//4\n/*\n * 4.1 t/f cached result is usable\n    *  4.1.true then t/f does it meet criteria\n        * 4.1.true.true\ttrue msg.searchfor = cachedSearch.searchfor\n        * 4.1.true.false do the common lookup\n    *   4.1.false  do the common lookup\n    */\n//4.1\nif (cachedSearch !== undefined)\n{\n    //4.1.true\n    if ((cachedSearch.query == cacheObject.query) && (cachedSearch.time > cacheObject.time - 5000))\n    {\n        //4.1.true.true\n        msg.searchfor = cachedSearch.searchfor\n        return [msg, null, null]\n    } //if ((cachedSearch.query == cacheObject.query) && (cachedSearch.time > cacheObject.time - 5000))\n    //4.1.true.false\n    else\n    {\n        //4.1.true.false\n        lookupResults = CommonLookup(msg, searchKeys, searchResultKeys, searchValues, global.get(msg.globalsource), cacheObject)\n        //return results from the node on 1 of the 3 outputs\n        if (lookupResults[0] !== null)\n        {\n            return [lookupResults[0], null, null]\n        } //if (lookupResults[0] !== null)\n        else if (lookupResults[1] !== null)\n        {\n            return [null, lookupResults[1], null]\n        } //else if (lookupResults[1] !== null)\n        else\n        {\n            return [null, null, lookupResults[2]]\n        } //else if (lookupResults[1] !== null) else\n    } //if ((cachedSearch.query == cacheObject.query) && (cachedSearch.time > cacheObject.time - 5000)) else\n} //if (cachedSearch !== undefined)\n//4.1.false\nelse\n{\n    //4.1.false\n    lookupResults = CommonLookup(msg, searchKeys, searchResultKeys, searchValues, global.get(msg.globalsource), cacheObject)\n    //return results from the node on 1 of the 3 outputs\n    if (lookupResults[0] !== null)\n    {\n        return [lookupResults[0], null, null]\n    } //if (lookupResults[0] !== null)\n    else if (lookupResults[1] !== null)\n    {\n        return [null, lookupResults[1], null]\n    } //else if (lookupResults[1] !== null)\n    else\n    {\n        return [null, null, lookupResults[2]]\n    } //else if (lookupResults[1] !== null) else\n} //if (cachedSearch !== undefined) else\nreturn\n\nfunction BuildCacheObject(searchKeysArray, SearchValuesArray, SearchResultKeysArray) {\n    //3 build the cache key which is essentially the concatenation of key+value+nextkey+nextvalue+.....etc\n    let newCacheKey =\"\"\n    for (index = 0; index < searchKeysArray.length; index++)\n    {\n        newCacheKey = newCacheKey + searchKeysArray[index] + SearchValuesArray[index]\n    } //for (index = 0; index < searchKeysArray.length; index++)\n    //add all fields that will be looked for into the cache key\n    for (index = 0; index < SearchResultKeysArray.length; index++)\n    {\n        newCacheKey = newCacheKey + SearchResultKeysArray[index]\n    } //for (index = 0; index < SearchResultKeysArray.length; index++)\n    //combine the cache key and the cache time into a single object that can be compared with the cached last search\n    let createdCacheObject = \n    {\n        query: newCacheKey,\n        time: cacheTime\n    }\n    return createdCacheObject\n}\nfunction CommonLookup(workingMsg, keysForSearchColumn, keysForResultColumn, valuesSearchedFor, requestedDataTable, passedCacheObject) {\n    let searchKeyIndices = []\n    let searchResultKeysIndices = []\n    let outerIndex\n    let innerLoopCounter\n    let innerIndex\n    let index\n    if (requestedDataTable !== undefined)\n    {\n        // iterate through all search keys.\n        //outer index is the place along the array of search keys\n        for (outerIndex = 0; outerIndex < keysForSearchColumn.length; outerIndex++)\n        {\n            //inner index is the place along the first row of data\n            //The innerLoopCounter must be reset each time a new key is being looked for\n            innerLoopCounter = 0\n            for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n            {\n                //these 2 loops will compare every entry in the top row of the data table to every entry in the array of search keys,\n                if (requestedDataTable[0][innerIndex] == keysForSearchColumn[outerIndex])\n                {\n                    //when they match push the column number on to the array that has just indices for the search keys\n                    searchKeyIndices.push(innerIndex)\n                    //break is used to stop comparing as once the column has been found the remaining aren't relevant\n                    //////////////////////////////////////////////////////////////////////////break may be a problem. Maybe swap inner and outer arrays and then do some if then about getting through the whole data headers without finding. Right now it only looks for 1 failure\n                    break\n                } //if (requestedDataTable[0][innerIndex] == keysForSearchColumn[outerIndex])\n                else\n                {\n                    //when they don't match, then this means there is a search key that does not match any header.\n                    //When properly configured this should not happen, but proper configuration cannot be guaranteed\n                    //this is accumulating how many times the search key did not match one of the data table headers\n                    innerLoopCounter++\n                    //Error messaging should only happen if the search key has been compared with all of the headers\n                    //requestedDataTable[0].length gives the total number of data headers (columns of the spreadsheet)\n                    if (requestedDataTable[0].length == innerLoopCounter)\n                    {\n                        //populate error \n                        //put some details on this configuration into the msg to be output\n                        workingMsg.error = \"Key with value \\\"\" + keysForSearchColumn[outerIndex] + \"\\\" not found amongst the \" + (requestedDataTable[0].length + 1) + \" entries, which include \" + requestedDataTable[0]\n                        //either create and populate the error count at 1 or increment it if it already exists\n                        if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n                        {\n                                workingMsg.searchErrorCount++\n                        }\n                        else\n                        {\n                            workingMsg.searchErrorCount = 1\n                        }\n                        //this retry is in case the column was added to the google sheet since it was last loaded into node red\n                        if (workingMsg.searchErrorCount > 1)\n                        {\n                            //return the error on the bottom because with a count of 2 that means reloading has already been tried\n                            return [null, null, workingMsg]\n                        }\n                        else\n                        {\n                            //return the error on the middle there is an error output,\n                            return [null, workingMsg, null]\n                        }\n                    } //if (requestedDataTable[0].length == innerLoopCounter)\n                } //if (requestedDataTable[0][innerIndex] == keysForSearchColumn[outerIndex]) else\n            } //for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n        } //for (outerIndex = 0; outerIndex < keysForSearchColumn.length; outerIndex++)\n        //if this point is reached, searchKeyIndices has been populated\n        // iterate through all search result keys.\n        //outer index is the place along the array of search keys \n        for (outerIndex = 0; outerIndex < keysForResultColumn.length; outerIndex++)\n        {\n            //inner index is the place along the first row of data\n            //The innerLoopCounter must be reset each time a new key is being looked for\n            innerLoopCounter = 0\n            for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n            {\n                //these 2 loops will compare every entry in the top row of the data table to every entry in the array of search keys,\n                if (requestedDataTable[0][innerIndex] == keysForResultColumn[outerIndex])\n                {\n                    //when they match push the column number on to the array that has just indices for the search keys\n                    searchResultKeysIndices.push(innerIndex)\n                    //break is used to stop comparing as once the column has been found the remaining aren't relevant\n                    break\n                } //if (requestedDataTable[0][innerIndex] == keysForResultColumn[outerIndex])\n                else\n                {\n                    //when they don't match, then this means there is a search key that does not match any header.\n                    //When properly configured this should not happen, but proper configuration cannot be guaranteed\n                    innerLoopCounter++\n                    //Error messaging should only happen if the search key has been compared with all of the headers\n                    //requestedDataTable[0].length gives the total number of data headers (columns of the spreadsheet)\n                    if (requestedDataTable[0].length == innerLoopCounter)\n                    {\n                        //populate error \n                        //put some details on this configuration into the msg to be output\n                        workingMsg.error = \"Key with value \\\"\" + keysForSearchColumn[outerIndex] + \"\\\" not found amongst the \" + (requestedDataTable[0].length + 1) + \" entries, which include \" + requestedDataTable[0]\n                        //either create and populate the error count at 1 or increment it if it already exists\n                        if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n                        {\n                            workingMsg.searchErrorCount++\n                        } //if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n                        else\n                        {\n                            workingMsg.searchErrorCount = 1\n                        } //if ( workingMsg.hasOwnProperty(\"searchErrorCount\")) else\n                        //this retry is in case the column was added to the google sheet since it was last loaded into node red\n                        if (workingMsg.searchErrorCount > 1)\n                        {\n                            //return the error on the bottom because with a count of 2 that means reloading has already been tried\n                            return [null, null, workingMsg]\n                        } //if (workingMsg.searchErrorCount > 1)\n                        else\n                        {\n                            //return the error on the middle there is an error output,\n                            return [null, workingMsg, null]\n                        } //if (workingMsg.searchErrorCount > 1) else\n                    } //if (requestedDataTable[0].length == innerLoopCounter)\n                } //if (requestedDataTable[0][innerIndex] == keysForResultColumn[outerIndex]) else\n            } //for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n        } //for (outerIndex = 0; outerIndex < keysForResultColumn.length; outerIndex++)\n        //if this point is reached, both searchKeyIndices and searchResultKeysIndices have been populated\n        //loop through all search keys, 1 index at a time and filter to a row that has the desired data in the desired column\n        let result = []\n        let pushable\n        pushable = false\n        for (outerIndex = 0; outerIndex < requestedDataTable.length; outerIndex++)\n        {\n            for (innerIndex = 0; innerIndex < searchKeyIndices.length; innerIndex++)\n            {\n                if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex])\n                {\n                    pushable = true\n                } //if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex])\n                else\n                {\n                    pushable = false\n                    break\n                } //if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex]) else\n            } //for (innerIndex = 0; innerIndex < searchKeyIndices.length; innerIndex++)\n            if (pushable)\n            {\n                result.push(requestedDataTable[outerIndex])\n            } //if (pushable)\n    \n    } //for (outerIndex = 0; outerIndex < requestedDataTable.length; outerIndex++)\n        //if this point is reached then there is a filtered table\n        //debugger\n        if (result.length === 0)\n        {\n            workingMsg.error = \"After filtering no data rows were left.\"\n            //either create and populate the error count at 1 or increment it if it already exists\n            if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n            {\n                workingMsg.searchErrorCount++\n            } //( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n            else\n            {\n                workingMsg.searchErrorCount = 1\n            } //( workingMsg.hasOwnProperty(\"searchErrorCount\")) else\n            //return the error on the middle there is an error output,\n            //this retry is in case the column was added to the google sheet since it was last loaded into node red\n            if (workingMsg.searchErrorCount > 1)\n            {\n                //return the error on the bottom because with a count of 2 that means reloading has already been tried\n                return [null, null, workingMsg]\n            } //if (workingMsg.searchErrorCount > 1)\n            else\n            {\n                //return the error on the middle there is an error output,\n                return [null, workingMsg, null]\n            } //if (workingMsg.searchErrorCount > 1) else\n        } //if (result.length === 0)\n        else if (result.length > 1)\n        {\n            //do the warning that multiple were found but will take the first\n            node.warn(\"Multiple rows were found that matched the search criteria. Results are from the first row that was found and matched.\")\n        } //else if (result.length > 1)\n        //look up the data\n        for (index = 0; index < searchResultKeysIndices.length; index++)\n        {\n            //workingMsg.searchfor.keysForSearchColumn[index] = result[0][searchResultKeysIndices]\n            // the almost working version\n            workingMsg.searchfor[keysForResultColumn[index]] = result[0][searchResultKeysIndices[index]]\n        } //for (index = 0; index < searchResultKeysIndices.length; index++)\n        //if this point is reached then work workingMsg contains complete info\n        //build and save the LastSearch obect\n        passedCacheObject.searchfor = workingMsg.searchfor\n        global.set(\"LastSearch\", passedCacheObject)\n        return [workingMsg, null, null]\n    } //if (requestedDataTable !== undefined)\n    else\n    {\n        //return on second output to trigger population of global that feeds datatable\n        //put some details on this configuration into the msg to be output\n        workingMsg.error = \"The data normally loaded from google sheet was not loaded.\"\n        //either create and populate the error count at 1 or increment it if it already exists\n        if (workingMsg.hasOwnProperty('searchErrorCount'))\n        {\n            workingMsg.searchErrorCount++\n        } //if (workingMsg.hasOwnProperty('searchErrorCount'))\n        else\n        {\n            workingMsg.searchErrorCount = 1\n        } //if (workingMsg.hasOwnProperty('searchErrorCount')) else\n        //return the error on the middle there is an error output,\n        //this retry is in case the column was added to the google sheet since it was last loaded into node red\n        if (workingMsg.searchErrorCount > 1)\n        {\n            //return the error on the bottom because with a count of 2 that means reloading has already been tried\n            return [null, null, workingMsg]\n        } //if (workingMsg.searchErrorCount > 1)\n        else\n        {\n            //return the error on the middle there is an error output,\n            return [null, workingMsg, null]\n        } //if (workingMsg.searchErrorCount > 1) else\n    } //if (requestedDataTable !== undefined) else\n}","outputs":3,"noerr":0,"x":240,"y":80,"wires":[[],["4f13373b.e70178"],[]],"outputLabels":["Value Found","Error but try reloading from data source","Error despite having tried to reload from data source"],"info":"# **Conceptual Explanation**\nThis node is designed to use a 2-D array of data loaded from a google sheeet to lookup desired data. The data is arrayed with the first row being column headers describing the data in those columns in subsequent rows.\n## **inputs**\n### globalsource \nThe name of the global variable holding the table of data\n### msg.keyvalues\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row.\n### msg.searchfor\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. The value enters the node empty.\n## **outputs**\n### Output1: Value Found \nThis ouput is used when the node has successfully identified the requested data. That data is placed into the value portions of the key value pairs that made up the msg.searchfor input\n### Output 2: Error but try reloading from data source\nThis output is used when either the global variable to contain the data table either does no exist or does not contain a row with all of the requested search criteria. Normally it is used to trigger loading the table from Google sheets under the expectation that either this is the first time a lookup has been tried an the data had not yet been cached in the global variable or potentially the data in the cache has become stale and reloading from the Google sheet will add a row that will match the requested search criteria.\n### Output 3: Error despite having tried to reload from data source\nThis output is used when either the global variable to contain the data table either does no exist or does not contain a row with all of the requested search criteria and at least 1 attempt has already been made to reload the global vairable cache. This is effectively a notification of non-recoverable lookup failure."},{"id":"8a2d6dce.29fc8","type":"change","z":"8b456115.ccf69","name":"Devices table, 1 search key with variable input, 1 result","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"exportableresults.DeviceName","tot":"msg"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":980,"y":100,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value pulled from the **msg.exportableresults.DeviceName** object.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** column.\n"},{"id":"1a4bf967.eb2427","type":"change","z":"8b456115.ccf69","name":"Devices table, 1 search key, 2 results","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"Motion_Ikea","tot":"str"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.Manufacturer","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":180,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value **\"Motion_Ikea\"**.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** and **\"Manufacturer\"** columns."},{"id":"d4a3e889.b5c438","type":"change","z":"8b456115.ccf69","name":"Devices table, 1 search key, 1 result","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"Anyone Presence","tot":"str"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":60,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value **\"Anyone Presence\"**. Notice unlike some examples this includes a space in the value. This has no negative impact.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** column."},{"id":"e09f2c5d.0e16b","type":"change","z":"8b456115.ccf69","name":"Devices table, 2 search keys, 1 results","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"Anyone Presence","tot":"str"},{"t":"set","p":"keyvalues.Manufacturer","pt":"msg","to":"homebridge-people-geofence","tot":"str"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":140,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value **\"Anyone Presence\"** and the **\"Manufacturer\"** column for the value **\"homebridge-people-geofence\"**.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** columns."},{"id":"9f332956.80bc18","type":"comment","z":"8b456115.ccf69","name":"Examples of preformating the inputs","info":"","x":920,"y":20,"wires":[]},{"id":"5860cc50.418c94","type":"change","z":"8b456115.ccf69","name":"Spreadsheet Lookup Settings Example","rules":[{"t":"set","p":"IgnoreEnvVar ","pt":"msg","to":"true","tot":"bool"},{"t":"set","p":"SpreadsheetID","pt":"msg","to":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","tot":"str"},{"t":"set","p":"Tab","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"ColStart","pt":"msg","to":"A","tot":"str"},{"t":"set","p":"ColEnd","pt":"msg","to":"Z","tot":"str"},{"t":"set","p":"MinRow","pt":"msg","to":"1","tot":"str"},{"t":"set","p":"MaxRow","pt":"msg","to":"1000","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":260,"wires":[[]],"info":"## **inputs**\n### IgnoreEnvVar \nThis boolean needs to be true to tell that Read Spreadsheet For Details subflow that it should use the specs passed in the msg to determine what spreadsheet to read from and what portion of data to read from.\n### msg.SpreadsheetID\nThis is the very long string that identifies a specific google spreadsheet.\n### msg.Tab\nSpecifies the tab name that contains the data.\n### msg.ColStart\nSpecifies the leftmost column containing the desired data.\n### msg.ColEnd\nSpecifies the rightmost column containing the desired data. \n### msg.MinRow\nSpecifies the top row containing the desired data \n### msg.MaxRow\nSpecifies the bottom row containing the desired data "},{"id":"af11454c.93b218","type":"function","z":"90f110ad.441f1","name":"Determine Source For Gsheet lookup properties.","func":"//Read subflow input variables\nif (env.get(\"OverrideEnvVariables\"))\n{\n    //Put inputs and read values into msg properties to be visible downstream\n    msg.sheet = msg.SpreadsheetID;\n    msg.tab = msg.Tab;\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    msg.topic = msg.targetrange\n    delete msg.Tab\n    delete msg.SpreadsheetID\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\n}\nelse if (msg.IgnoreEnvVar)\n{\n    //Put inputs and read values into msg properties to be visible downstream\n    msg.sheet = msg.SpreadsheetID;\n    msg.tab = msg.Tab;\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    msg.topic = msg.targetrange\n    delete msg.Tab\n    delete msg.SpreadsheetID\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\n}\nelse\n{\n    var ColStart = env.get(\"ColStart\");\n    var ColEnd = env.get(\"ColEnd\");\n    var FirstRow = env.get(\"MinRow\");\n    var LastRow = env.get(\"MaxRow\");\n    //Put inputs and read values into msg properties to be visible downstream\n    msg.sheet = env.get(\"Spreadsheet ID\");\n    msg.tab = env.get(\"TabName\");\n    msg.cellstart = ColStart + FirstRow\n    msg.cellend = ColEnd + LastRow\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    msg.topic = msg.targetrange\n    delete msg.Tab\n    delete msg.SpreadsheetID\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\n    //These 2 are needed later to calculate the last populate and first empty rows and columns\n    msg.ColStart = ColStart\n    msg.MinRow = FirstRow\n}\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":20,"wires":[["60b8349e.260d2c","9a64826c.5835e"]],"info":"This node sets up the inputs to the GSheet node.\nThe outputs that make up those inputs are:\n - msg.sheet -the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n - msg.topic - the combination of spreadsheet tab and cell range\n## Note\nThere are 2 very similar booleans evaluated by this node. They are:\n * **OverrideEnvVariables** - This one looks at the environment variable that was set in the flow triggering the subflow\n * **msg.IgnoreEnvVar** - This one is allows the logic to be driven by a message object property and thus can be set at runtime or earlier in the flow based on upstream logic\n\nFirst it checks the boolean value of the **OverrideEnvVariables** environment variable. This is by default false. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming the first was false, it checks the boolean value of the **msg.IgnoreEnvVar** value. This will evaluated as false if not populated, so sending false is unnecessary. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming both are false, then it can build the outputs based on the subflows environment variables. These can either be those set in the calling flow or they may be the default ones built into the subflow.\n\nRegardless of the method used to build the output, the node also removes the input message properties.\n\n\n\nmsg.IgnoreEnvVar"},{"id":"60b8349e.260d2c","type":"GSheet","z":"90f110ad.441f1","creds":"adb4e9b8.8beee8","method":"get","action":"","sheet":"","cells":"","name":"Read Input from GSheet","x":610,"y":20,"wires":[["5d2aea84.75b684"]],"info":"Use the GSheet node to get the a set of rows from a google spreadsheet.\n\n# **Inputs**\n### **creds**\nThis is the name on the gauth configuration node. How to get the details is beyond the scope of what I am going to put into an individual node instance. Some details are at [node-red-contrib-google-sheets](https://flows.nodered.org/node/node-red-contrib-google-sheets)\n### **Method**\nIn this case using the get cells method to read a set of data.\n### **SpreadsheetID**\nUnused as the spreadsheet ID is passed in as part of the input msg, but if needed it would be the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n### **Cells**\nUnused as the requested cells are passed in as part of the input msg, but if it was being manually built for a static data source the format is made of of 3 parts with specific seperators:\n * **[Sheetname]** like Sheet1\n * **[upper left corner cell address]** like A1\n * **[lower right corner cell address]** like B2\n\nThe format is **[Sheetname]**!**[upper left corner cell address]**:**[lower right corner cell address]** giving an input like **Sheet1!A1:B2**\n "},{"id":"a4d5d4d7.54afb8","type":"comment","z":"90f110ad.441f1","name":"Error","info":"","x":1090,"y":20,"wires":[]},{"id":"faecd98.76f0b28","type":"comment","z":"90f110ad.441f1","name":"Last Populated Row","info":"","x":1130,"y":100,"wires":[]},{"id":"6f8a278a.734cb8","type":"function","z":"90f110ad.441f1","name":"Prepare Output Parts","func":"/*\n * Row response calculations\n */\nmsg.LastPopulatedRow = msg.payload.length + Number(msg.MinRow) - 1\nmsg.FirstEmptyRow = msg.LastPopulatedRow + 1\n\n/*\n *Column response calculation variables\n */\nlet colCount = 1 //number of columns wide from the data retrieved. This will eventually be replace by logic that loops through array find the max width for any given row\nlet index\nlet sheetdata = msg.payload //this is the data that is returned from Google that will then be examined\nlet fCol = msg.ColStart\nlet fColTotal = 0 //to hold the column number\nlet nCol = \"\"   //nCol is new column\nlet lCol = \"\"   //lCol is last column in the range (to be populated from the actual Gsheet calls data)\n\nfCol = fCol.toUpperCase()\n/*\n * validate fCol (done)\n */\nlet validStartCol = false\nvalidStartCol = ((fCol.length == 1) ||\n                ((fCol.substr(0, 1).charCodeAt(0) - 64) < 9) ||\n                (((fCol.substr(0, 1).charCodeAt(0) - 64) == 9) && ((fCol.substr(1, 1).charCodeAt(0) - 64) <= 22)))\n/*\n *Column response calculations\n */\n//look at each row that is an array\nfor (index = 0; index < sheetdata.length; index++)\n{\n    if (Array.isArray(sheetdata[index]))\n    {\n        // when the rows width is greater than any of the previous rows set the column count to the new largest width\n        colCount = Math.max(colCount, sheetdata[index].length)\n    } //if (Array.isArray(sheetdata[index]))\n}  //for (index = 0; index < sheetdata.length; index++)\nswitch (fCol.length) {\n    case 1:\n        fColTotal = (fCol.substr(0, 1).charCodeAt(0) - 64)\n        fColTotal += colCount - 1\n        break\n    case 2:\n        fColTotal = (fCol.substr(1, 1).charCodeAt(0) - 64) + 26 * (fCol.substr(0, 1).charCodeAt(0) - 64)\n        fColTotal += colCount - 1\n        break\n    default:\n        fColTotal = -1\n}\n//Last Populated Column and First Empty Column calculation\nif ((fColTotal <= 25) && (fColTotal >= 1)) {\n    lCol = String.fromCharCode(fColTotal+64)\n    nCol = String.fromCharCode(fColTotal+65)\n} else if (fColTotal == 26) {\n    lCol = \"Z\"\n    nCol = \"AA\"\n} else if (fColTotal >= 27) {\n    lCol = String.fromCharCode((Math.floor(fColTotal / 26)) + 64) + String.fromCharCode((fColTotal % 26) + 64)\n    nCol = String.fromCharCode((Math.floor(fColTotal / 26)) + 64) + String.fromCharCode((fColTotal % 26) + 65)\n} else if (fColTotal == -1) {\n    lCol = \"Error\"\n    nCol = \"Error\"\n    //Probably worth putting real error here, but deferred\n} else if (fColTotal == 256) {\n    lCol = \"IV\"\n    nCol = \"None\"\n}\nmsg.LastPopulatedCol = lCol\nmsg.FirstEmptyCol = nCol\nmsg.SpreadsheetArray = msg.payload\nreturn msg;","outputs":1,"noerr":0,"x":560,"y":540,"wires":[["fa1fdeb4.721e1","d2310a59.812f78","6e9f3c8d.f55944","2d7a6524.7aa10a","233c90c2.90949","c5f2b797.a297f8"]],"info":"Takes an input from the Gsheet node and calculates a variety of details about the spreadsheet info.\n### **Output**\nmsg.LastPopulatedRow\nmsg.FirstEmptyRow\nmsg.LastPopulatedCol\nmsg.FirstEmptyCol\nmsg.SpreadsheetArray\n"},{"id":"b4d8bfaa.43f2b","type":"comment","z":"90f110ad.441f1","name":"First Empty Row","info":"","x":1120,"y":180,"wires":[]},{"id":"1d5b858c.f584ca","type":"comment","z":"90f110ad.441f1","name":"Last Populated Column","info":"","x":1140,"y":260,"wires":[]},{"id":"2a9b7307.05a04c","type":"comment","z":"90f110ad.441f1","name":"First Empty Column","info":"","x":1130,"y":340,"wires":[]},{"id":"4f33b6f2.978368","type":"comment","z":"90f110ad.441f1","name":"Spreadsheet Array","info":"","x":1130,"y":420,"wires":[]},{"id":"a4ae8b82.684ad8","type":"comment","z":"90f110ad.441f1","name":"Full Data","info":"","x":1100,"y":500,"wires":[]},{"id":"4871bdf.301f744","type":"comment","z":"90f110ad.441f1","name":"Full Data with Inputs","info":"","x":1130,"y":580,"wires":[]},{"id":"fa1fdeb4.721e1","type":"change","z":"90f110ad.441f1","name":"Leave Outputs","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":540,"wires":[[]],"info":"Deletes a variety of message properties, but leaves all of them that were calculated about the Gsheet nodes results to be returned on the designated subflow output."},{"id":"d2310a59.812f78","type":"change","z":"90f110ad.441f1","name":"Leave Last Populated Row","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"LastPopulatedRow","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":140,"wires":[[]],"info":"Copies msg.theLastPopulatedRow into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"6e9f3c8d.f55944","type":"change","z":"90f110ad.441f1","name":"Leave First Empty Row","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"FirstEmptyRow","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":870,"y":220,"wires":[[]],"info":"Copies msg.FirstEmptyRow into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"2d7a6524.7aa10a","type":"change","z":"90f110ad.441f1","name":"Leave Last Populated Column","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"LastPopulatedCol","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":890,"y":300,"wires":[[]],"info":"Copies msg.LastPopulatedCol into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"233c90c2.90949","type":"change","z":"90f110ad.441f1","name":"Leave First Empty Column","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"FirstEmptyCol","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":380,"wires":[[]],"info":"Copies msg.FirstEmptyCol into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"c5f2b797.a297f8","type":"change","z":"90f110ad.441f1","name":"Leave Spreadsheet Array","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"SpreadsheetArray","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":870,"y":460,"wires":[[]],"info":"Copies msg.SpreadsheetArray into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"6a6f2f19.d887","type":"trigger","z":"90f110ad.441f1","name":"Watchdog","op1":"","op2":"timeout","op1type":"nul","op2type":"str","duration":"10","extend":true,"units":"s","reset":"","bytopic":"all","outputs":1,"x":600,"y":140,"wires":[["2d7a6524.7aa10a","d2310a59.812f78","233c90c2.90949","c5f2b797.a297f8","fa1fdeb4.721e1"]],"info":"This trigger node works as a watchdog to see if the request to see if the read of the Google Sheet that was triggered on the other branch is successful. If it is succeful, then it will receive a reset message (msg.reset) from the Reset Watchdog node. If, however, 10 seconds elapse without receiving the reset message, this node sends a timeout message (msg.timeout)."},{"id":"9a64826c.5835e","type":"change","z":"90f110ad.441f1","name":"","rules":[{"t":"set","p":"timeout","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":120,"wires":[["6a6f2f19.d887"]],"info":"Labels what the initial input to the watchdog trigger node is."},{"id":"521c6744.dd47b8","type":"change","z":"90f110ad.441f1","name":"","rules":[{"t":"delete","p":"reset","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":350,"y":540,"wires":[["6f8a278a.734cb8"]],"info":"Removes msg.reset that was only intended for the watchdog trigger node."},{"id":"4edff30e.00041c","type":"catch","z":"90f110ad.441f1","name":"Catch and Relay Errors","scope":null,"uncaught":false,"x":860,"y":60,"wires":[["b8f81756.611648"]],"info":"Passes any caught error to the error subflows intentially built error output. By intentionally built I mean I created one and labelled it as such. This is not there by default."},{"id":"5d2aea84.75b684","type":"change","z":"90f110ad.441f1","name":"Reset Watchdog","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":140,"y":140,"wires":[["6a6f2f19.d887","521c6744.dd47b8"]],"info":"Sends the reset message to the watchdog triger node when there is output from the Gsheet node."},{"id":"b8f81756.611648","type":"debug","z":"90f110ad.441f1","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1480,"y":80,"wires":[]},{"id":"89017eda.1ee21","type":"debug","z":"90f110ad.441f1","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":780,"y":740,"wires":[]},{"id":"234bfc26.41cee4","type":"debug","z":"90f110ad.441f1","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1360,"y":180,"wires":[]},{"id":"f047e0b4.2a26e","type":"function","z":"69030aaf.dab944","name":"Db Put the payload into a global variable named after the content of msg.globalsource","func":"global.set(msg.globalsource, msg.payload)\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":400,"wires":[["2c0f2be7.ed2b94"]],"info":"# **What** #\nThis is a simple function node that stores the msg.payload into a global variable. This is done in a function node, however, because the name of that global variable is passed into the function as a the value of msg.globalsource. \n\n## **Why**\nNormally this would be done in a change node, but change nodes could not as of May 2020 take a msg object component as the name of the global variable to be set."},{"id":"2fc439fa.60d566","type":"subflow:90f110ad.441f1","z":"69030aaf.dab944","name":"","env":[],"x":580,"y":189,"wires":[[],[],[],[],[],[],["f047e0b4.2a26e"],[]],"info":"This subflow shows information in the environment variables. These are good for testing purposes, but it is noteworthy that the override boolean is false. Unless that boolean is changed, they have no impact."},{"id":"2c0f2be7.ed2b94","type":"function","z":"69030aaf.dab944","name":"Db Use input to lookup info","func":"//Ref. TMS-000001\n\n//if(msg.exportableresults.DeviceName !== \"Switch_Ikea\") {return}\n\n\n\n//1 Get must have items: searchKeys, searchValues, searchResultKeys, cachedSearch, cacheTime\n//debugger\nlet searchKeys = Object.keys(msg.keyvalues)\nlet searchValues = Object.values(msg.keyvalues)\nlet searchResultKeys = Object.keys(msg.searchfor)\nlet cachedSearch = global.get(\"LastSearch\")\nlet cacheTime = new Date().getTime()\n//2 create working variables searchKeyIndices, searchResultKeysIndices, index, cacheKey\nlet searchResultKeysIndices = []\nlet index\nlet cacheObject\n//3 build the cache key which is essentially the concatenation of key+value+nextkey+nextvalue+.....etc\ncacheObject = BuildCacheObject(searchKeys, searchValues, searchResultKeys)\n//4\n/*\n * 4.1 t/f cached result is usable\n    *  4.1.true then t/f does it meet criteria\n        * 4.1.true.true\ttrue msg.searchfor = cachedSearch.searchfor\n        * 4.1.true.false do the common lookup\n    *   4.1.false  do the common lookup\n    */\n//4.1\nif (cachedSearch !== undefined)\n{\n    //4.1.true\n    if ((cachedSearch.query == cacheObject.query) && (cachedSearch.time > cacheObject.time - 5000))\n    {\n        //4.1.true.true\n        msg.searchfor = cachedSearch.searchfor\n        return [msg, null, null]\n    } //if ((cachedSearch.query == cacheObject.query) && (cachedSearch.time > cacheObject.time - 5000))\n    //4.1.true.false\n    else\n    {\n        //4.1.true.false\n        lookupResults = CommonLookup(msg, searchKeys, searchResultKeys, searchValues, global.get(msg.globalsource), cacheObject)\n        //return results from the node on 1 of the 3 outputs\n        if (lookupResults[0] !== null)\n        {\n            return [lookupResults[0], null, null]\n        } //if (lookupResults[0] !== null)\n        else if (lookupResults[1] !== null)\n        {\n            return [null, lookupResults[1], null]\n        } //else if (lookupResults[1] !== null)\n        else\n        {\n            return [null, null, lookupResults[2]]\n        } //else if (lookupResults[1] !== null) else\n    } //if ((cachedSearch.query == cacheObject.query) && (cachedSearch.time > cacheObject.time - 5000)) else\n} //if (cachedSearch !== undefined)\n//4.1.false\nelse\n{\n    //4.1.false\n    lookupResults = CommonLookup(msg, searchKeys, searchResultKeys, searchValues, global.get(msg.globalsource), cacheObject)\n    //return results from the node on 1 of the 3 outputs\n    if (lookupResults[0] !== null)\n    {\n        return [lookupResults[0], null, null]\n    } //if (lookupResults[0] !== null)\n    else if (lookupResults[1] !== null)\n    {\n        return [null, lookupResults[1], null]\n    } //else if (lookupResults[1] !== null)\n    else\n    {\n        return [null, null, lookupResults[2]]\n    } //else if (lookupResults[1] !== null) else\n} //if (cachedSearch !== undefined) else\nreturn\n\nfunction BuildCacheObject(searchKeysArray, SearchValuesArray, SearchResultKeysArray) {\n    //3 build the cache key which is essentially the concatenation of key+value+nextkey+nextvalue+.....etc\n    let newCacheKey =\"\"\n    for (index = 0; index < searchKeysArray.length; index++)\n    {\n        newCacheKey = newCacheKey + searchKeysArray[index] + SearchValuesArray[index]\n    } //for (index = 0; index < searchKeysArray.length; index++)\n    //add all fields that will be looked for into the cache key\n    for (index = 0; index < SearchResultKeysArray.length; index++)\n    {\n        newCacheKey = newCacheKey + SearchResultKeysArray[index]\n    } //for (index = 0; index < SearchResultKeysArray.length; index++)\n    //combine the cache key and the cache time into a single object that can be compared with the cached last search\n    let createdCacheObject = \n    {\n        query: newCacheKey,\n        time: cacheTime\n    }\n    return createdCacheObject\n}\nfunction CommonLookup(workingMsg, keysForSearchColumn, keysForResultColumn, valuesSearchedFor, requestedDataTable, passedCacheObject) {\n    let searchKeyIndices = []\n    let searchResultKeysIndices = []\n    let outerIndex\n    let innerLoopCounter\n    let innerIndex\n    let index\n    if (requestedDataTable !== undefined)\n    {\n        // iterate through all search keys.\n        //outer index is the place along the array of search keys\n        for (outerIndex = 0; outerIndex < keysForSearchColumn.length; outerIndex++)\n        {\n            //inner index is the place along the first row of data\n            //The innerLoopCounter must be reset each time a new key is being looked for\n            innerLoopCounter = 0\n            for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n            {\n                //these 2 loops will compare every entry in the top row of the data table to every entry in the array of search keys,\n                if (requestedDataTable[0][innerIndex] == keysForSearchColumn[outerIndex])\n                {\n                    //when they match push the column number on to the array that has just indices for the search keys\n                    searchKeyIndices.push(innerIndex)\n                    //break is used to stop comparing as once the column has been found the remaining aren't relevant\n                    //////////////////////////////////////////////////////////////////////////break may be a problem. Maybe swap inner and outer arrays and then do some if then about getting through the whole data headers without finding. Right now it only looks for 1 failure\n                    break\n                } //if (requestedDataTable[0][innerIndex] == keysForSearchColumn[outerIndex])\n                else\n                {\n                    //when they don't match, then this means there is a search key that does not match any header.\n                    //When properly configured this should not happen, but proper configuration cannot be guaranteed\n                    //this is accumulating how many times the search key did not match one of the data table headers\n                    innerLoopCounter++\n                    //Error messaging should only happen if the search key has been compared with all of the headers\n                    //requestedDataTable[0].length gives the total number of data headers (columns of the spreadsheet)\n                    if (requestedDataTable[0].length == innerLoopCounter)\n                    {\n                        //populate error \n                        //put some details on this configuration into the msg to be output\n                        workingMsg.error = \"Key with value \\\"\" + keysForSearchColumn[outerIndex] + \"\\\" not found amongst the \" + (requestedDataTable[0].length + 1) + \" entries, which include \" + requestedDataTable[0]\n                        //either create and populate the error count at 1 or increment it if it already exists\n                        if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n                        {\n                                workingMsg.searchErrorCount++\n                        }\n                        else\n                        {\n                            workingMsg.searchErrorCount = 1\n                        }\n                        //this retry is in case the column was added to the google sheet since it was last loaded into node red\n                        if (workingMsg.searchErrorCount > 1)\n                        {\n                            //return the error on the bottom because with a count of 2 that means reloading has already been tried\n                            return [null, null, workingMsg]\n                        }\n                        else\n                        {\n                            //return the error on the middle there is an error output,\n                            return [null, workingMsg, null]\n                        }\n                    } //if (requestedDataTable[0].length == innerLoopCounter)\n                } //if (requestedDataTable[0][innerIndex] == keysForSearchColumn[outerIndex]) else\n            } //for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n        } //for (outerIndex = 0; outerIndex < keysForSearchColumn.length; outerIndex++)\n        //if this point is reached, searchKeyIndices has been populated\n        // iterate through all search result keys.\n        //outer index is the place along the array of search keys \n        for (outerIndex = 0; outerIndex < keysForResultColumn.length; outerIndex++)\n        {\n            //inner index is the place along the first row of data\n            //The innerLoopCounter must be reset each time a new key is being looked for\n            innerLoopCounter = 0\n            for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n            {\n                //these 2 loops will compare every entry in the top row of the data table to every entry in the array of search keys,\n                if (requestedDataTable[0][innerIndex] == keysForResultColumn[outerIndex])\n                {\n                    //when they match push the column number on to the array that has just indices for the search keys\n                    searchResultKeysIndices.push(innerIndex)\n                    //break is used to stop comparing as once the column has been found the remaining aren't relevant\n                    break\n                } //if (requestedDataTable[0][innerIndex] == keysForResultColumn[outerIndex])\n                else\n                {\n                    //when they don't match, then this means there is a search key that does not match any header.\n                    //When properly configured this should not happen, but proper configuration cannot be guaranteed\n                    innerLoopCounter++\n                    //Error messaging should only happen if the search key has been compared with all of the headers\n                    //requestedDataTable[0].length gives the total number of data headers (columns of the spreadsheet)\n                    if (requestedDataTable[0].length == innerLoopCounter)\n                    {\n                        //populate error \n                        //put some details on this configuration into the msg to be output\n                        workingMsg.error = \"Key with value \\\"\" + keysForSearchColumn[outerIndex] + \"\\\" not found amongst the \" + (requestedDataTable[0].length + 1) + \" entries, which include \" + requestedDataTable[0]\n                        //either create and populate the error count at 1 or increment it if it already exists\n                        if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n                        {\n                            workingMsg.searchErrorCount++\n                        } //if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n                        else\n                        {\n                            workingMsg.searchErrorCount = 1\n                        } //if ( workingMsg.hasOwnProperty(\"searchErrorCount\")) else\n                        //this retry is in case the column was added to the google sheet since it was last loaded into node red\n                        if (workingMsg.searchErrorCount > 1)\n                        {\n                            //return the error on the bottom because with a count of 2 that means reloading has already been tried\n                            return [null, null, workingMsg]\n                        } //if (workingMsg.searchErrorCount > 1)\n                        else\n                        {\n                            //return the error on the middle there is an error output,\n                            return [null, workingMsg, null]\n                        } //if (workingMsg.searchErrorCount > 1) else\n                    } //if (requestedDataTable[0].length == innerLoopCounter)\n                } //if (requestedDataTable[0][innerIndex] == keysForResultColumn[outerIndex]) else\n            } //for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n        } //for (outerIndex = 0; outerIndex < keysForResultColumn.length; outerIndex++)\n        //if this point is reached, both searchKeyIndices and searchResultKeysIndices have been populated\n        //loop through all search keys, 1 index at a time and filter to a row that has the desired data in the desired column\n        let result = []\n        let pushable\n        pushable = false\n        for (outerIndex = 0; outerIndex < requestedDataTable.length; outerIndex++)\n        {\n            for (innerIndex = 0; innerIndex < searchKeyIndices.length; innerIndex++)\n            {\n                if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex])\n                {\n                    pushable = true\n                } //if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex])\n                else\n                {\n                    pushable = false\n                    break\n                } //if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex]) else\n            } //for (innerIndex = 0; innerIndex < searchKeyIndices.length; innerIndex++)\n            if (pushable)\n            {\n                result.push(requestedDataTable[outerIndex])\n            } //if (pushable)\n    \n    } //for (outerIndex = 0; outerIndex < requestedDataTable.length; outerIndex++)\n        //if this point is reached then there is a filtered table\n        //debugger\n        if (result.length === 0)\n        {\n            workingMsg.error = \"After filtering no data rows were left.\"\n            //either create and populate the error count at 1 or increment it if it already exists\n            if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n            {\n                workingMsg.searchErrorCount++\n            } //( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n            else\n            {\n                workingMsg.searchErrorCount = 1\n            } //( workingMsg.hasOwnProperty(\"searchErrorCount\")) else\n            //return the error on the middle there is an error output,\n            //this retry is in case the column was added to the google sheet since it was last loaded into node red\n            if (workingMsg.searchErrorCount > 1)\n            {\n                //return the error on the bottom because with a count of 2 that means reloading has already been tried\n                return [null, null, workingMsg]\n            } //if (workingMsg.searchErrorCount > 1)\n            else\n            {\n                //return the error on the middle there is an error output,\n                return [null, workingMsg, null]\n            } //if (workingMsg.searchErrorCount > 1) else\n        } //if (result.length === 0)\n        else if (result.length > 1)\n        {\n            //do the warning that multiple were found but will take the first\n            node.warn(\"Multiple rows were found that matched the search criteria. Results are from the first row that was found and matched.\")\n        } //else if (result.length > 1)\n        //look up the data\n        for (index = 0; index < searchResultKeysIndices.length; index++)\n        {\n            //workingMsg.searchfor.keysForSearchColumn[index] = result[0][searchResultKeysIndices]\n            // the almost working version\n            workingMsg.searchfor[keysForResultColumn[index]] = result[0][searchResultKeysIndices[index]]\n        } //for (index = 0; index < searchResultKeysIndices.length; index++)\n        //if this point is reached then work workingMsg contains complete info\n        //build and save the LastSearch obect\n        passedCacheObject.searchfor = workingMsg.searchfor\n        global.set(\"LastSearch\", passedCacheObject)\n        return [workingMsg, null, null]\n    } //if (requestedDataTable !== undefined)\n    else\n    {\n        //return on second output to trigger population of global that feeds datatable\n        //put some details on this configuration into the msg to be output\n        workingMsg.error = \"The data normally loaded from google sheet was not loaded.\"\n        //either create and populate the error count at 1 or increment it if it already exists\n        if (workingMsg.hasOwnProperty('searchErrorCount'))\n        {\n            workingMsg.searchErrorCount++\n        } //if (workingMsg.hasOwnProperty('searchErrorCount'))\n        else\n        {\n            workingMsg.searchErrorCount = 1\n        } //if (workingMsg.hasOwnProperty('searchErrorCount')) else\n        //return the error on the middle there is an error output,\n        //this retry is in case the column was added to the google sheet since it was last loaded into node red\n        if (workingMsg.searchErrorCount > 1)\n        {\n            //return the error on the bottom because with a count of 2 that means reloading has already been tried\n            return [null, null, workingMsg]\n        } //if (workingMsg.searchErrorCount > 1)\n        else\n        {\n            //return the error on the middle there is an error output,\n            return [null, workingMsg, null]\n        } //if (workingMsg.searchErrorCount > 1) else\n    } //if (requestedDataTable !== undefined) else\n}","outputs":3,"noerr":0,"x":240,"y":80,"wires":[[],["2fc439fa.60d566"],[]],"outputLabels":["Value Found","Error but try reloading from data source","Error despite having tried to reload from data source"],"info":"# **Conceptual Explanation**\nThis node is designed to use a 2-D array of data loaded from a google sheeet to lookup desired data. The data is arrayed with the first row being column headers describing the data in those columns in subsequent rows.\n## **inputs**\n### globalsource \nThe name of the global variable holding the table of data\n### msg.keyvalues\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row.\n### msg.searchfor\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. The value enters the node empty.\n## **outputs**\n### Output1: Value Found \nThis ouput is used when the node has successfully identified the requested data. That data is placed into the value portions of the key value pairs that made up the msg.searchfor input\n### Output 2: Error but try reloading from data source\nThis output is used when either the global variable to contain the data table either does no exist or does not contain a row with all of the requested search criteria. Normally it is used to trigger loading the table from Google sheets under the expectation that either this is the first time a lookup has been tried an the data had not yet been cached in the global variable or potentially the data in the cache has become stale and reloading from the Google sheet will add a row that will match the requested search criteria.\n### Output 3: Error despite having tried to reload from data source\nThis output is used when either the global variable to contain the data table either does no exist or does not contain a row with all of the requested search criteria and at least 1 attempt has already been made to reload the global vairable cache. This is effectively a notification of non-recoverable lookup failure."},{"id":"9cf7db3e.dc99b8","type":"change","z":"69030aaf.dab944","name":"Devices table, 1 search key with variable input, 1 result","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"exportableresults.DeviceName","tot":"msg"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":980,"y":100,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value pulled from the **msg.exportableresults.DeviceName** object.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** column.\n"},{"id":"d459e6c9.6e42a8","type":"change","z":"69030aaf.dab944","name":"Devices table, 1 search key, 2 results","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"Motion_Ikea","tot":"str"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.Manufacturer","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":180,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value **\"Motion_Ikea\"**.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** and **\"Manufacturer\"** columns."},{"id":"805c682.4fb8598","type":"change","z":"69030aaf.dab944","name":"Devices table, 1 search key, 1 result","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"Anyone Presence","tot":"str"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":60,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value **\"Anyone Presence\"**. Notice unlike some examples this includes a space in the value. This has no negative impact.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** column."},{"id":"afa27ee8.4cbe8","type":"change","z":"69030aaf.dab944","name":"Devices table, 2 search keys, 1 results","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"Anyone Presence","tot":"str"},{"t":"set","p":"keyvalues.Manufacturer","pt":"msg","to":"homebridge-people-geofence","tot":"str"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":140,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value **\"Anyone Presence\"** and the **\"Manufacturer\"** column for the value **\"homebridge-people-geofence\"**.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** columns."},{"id":"9b8e2c78.b8019","type":"comment","z":"69030aaf.dab944","name":"Examples of preformating the inputs","info":"","x":920,"y":20,"wires":[]},{"id":"fb8e119f.49245","type":"change","z":"69030aaf.dab944","name":"Spreadsheet Lookup Settings Example","rules":[{"t":"set","p":"IgnoreEnvVar ","pt":"msg","to":"true","tot":"bool"},{"t":"set","p":"SpreadsheetID","pt":"msg","to":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","tot":"str"},{"t":"set","p":"Tab","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"ColStart","pt":"msg","to":"A","tot":"str"},{"t":"set","p":"ColEnd","pt":"msg","to":"Z","tot":"str"},{"t":"set","p":"MinRow","pt":"msg","to":"1","tot":"str"},{"t":"set","p":"MaxRow","pt":"msg","to":"1000","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":260,"wires":[[]],"info":"## **inputs**\n### IgnoreEnvVar \nThis boolean needs to be true to tell that Read Spreadsheet For Details subflow that it should use the specs passed in the msg to determine what spreadsheet to read from and what portion of data to read from.\n### msg.SpreadsheetID\nThis is the very long string that identifies a specific google spreadsheet.\n### msg.Tab\nSpecifies the tab name that contains the data.\n### msg.ColStart\nSpecifies the leftmost column containing the desired data.\n### msg.ColEnd\nSpecifies the rightmost column containing the desired data. \n### msg.MinRow\nSpecifies the top row containing the desired data \n### msg.MaxRow\nSpecifies the bottom row containing the desired data "},{"id":"70a78de0.3eada4","type":"function","z":"3bfce36.77ec51c","name":"Determine Source For Gsheet lookup properties.","func":"//Read subflow input variables\nif (env.get(\"OverrideEnvVariables\"))\n{\n    //Put inputs and read values into msg properties to be visible downstream\n    msg.sheet = msg.SpreadsheetID;\n    msg.tab = msg.Tab;\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    msg.topic = msg.targetrange\n    delete msg.Tab\n    delete msg.SpreadsheetID\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\n}\nelse if (msg.IgnoreEnvVar)\n{\n    //Put inputs and read values into msg properties to be visible downstream\n    msg.sheet = msg.SpreadsheetID;\n    msg.tab = msg.Tab;\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    msg.topic = msg.targetrange\n    delete msg.Tab\n    delete msg.SpreadsheetID\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\n}\nelse\n{\n    var ColStart = env.get(\"ColStart\");\n    var ColEnd = env.get(\"ColEnd\");\n    var FirstRow = env.get(\"MinRow\");\n    var LastRow = env.get(\"MaxRow\");\n    //Put inputs and read values into msg properties to be visible downstream\n    msg.sheet = env.get(\"Spreadsheet ID\");\n    msg.tab = env.get(\"TabName\");\n    msg.cellstart = ColStart + FirstRow\n    msg.cellend = ColEnd + LastRow\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    msg.topic = msg.targetrange\n    delete msg.Tab\n    delete msg.SpreadsheetID\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\n    //These 2 are needed later to calculate the last populate and first empty rows and columns\n    msg.ColStart = ColStart\n    msg.MinRow = FirstRow\n}\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":20,"wires":[["741e5733.670e18","da7cd56.53f9d28"]],"info":"This node sets up the inputs to the GSheet node.\nThe outputs that make up those inputs are:\n - msg.sheet -the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n - msg.topic - the combination of spreadsheet tab and cell range\n## Note\nThere are 2 very similar booleans evaluated by this node. They are:\n * **OverrideEnvVariables** - This one looks at the environment variable that was set in the flow triggering the subflow\n * **msg.IgnoreEnvVar** - This one is allows the logic to be driven by a message object property and thus can be set at runtime or earlier in the flow based on upstream logic\n\nFirst it checks the boolean value of the **OverrideEnvVariables** environment variable. This is by default false. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming the first was false, it checks the boolean value of the **msg.IgnoreEnvVar** value. This will evaluated as false if not populated, so sending false is unnecessary. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming both are false, then it can build the outputs based on the subflows environment variables. These can either be those set in the calling flow or they may be the default ones built into the subflow.\n\nRegardless of the method used to build the output, the node also removes the input message properties.\n\n\n\nmsg.IgnoreEnvVar"},{"id":"741e5733.670e18","type":"GSheet","z":"3bfce36.77ec51c","creds":"adb4e9b8.8beee8","method":"get","action":"","sheet":"","cells":"","name":"Read Input from GSheet","x":610,"y":20,"wires":[["1310e8b6.c47c27"]],"info":"Use the GSheet node to get the a set of rows from a google spreadsheet.\n\n# **Inputs**\n### **creds**\nThis is the name on the gauth configuration node. How to get the details is beyond the scope of what I am going to put into an individual node instance. Some details are at [node-red-contrib-google-sheets](https://flows.nodered.org/node/node-red-contrib-google-sheets)\n### **Method**\nIn this case using the get cells method to read a set of data.\n### **SpreadsheetID**\nUnused as the spreadsheet ID is passed in as part of the input msg, but if needed it would be the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n### **Cells**\nUnused as the requested cells are passed in as part of the input msg, but if it was being manually built for a static data source the format is made of of 3 parts with specific seperators:\n * **[Sheetname]** like Sheet1\n * **[upper left corner cell address]** like A1\n * **[lower right corner cell address]** like B2\n\nThe format is **[Sheetname]**!**[upper left corner cell address]**:**[lower right corner cell address]** giving an input like **Sheet1!A1:B2**\n "},{"id":"e03785c9.3c8338","type":"comment","z":"3bfce36.77ec51c","name":"Error","info":"","x":1090,"y":20,"wires":[]},{"id":"ed4f16f2.dfcd28","type":"comment","z":"3bfce36.77ec51c","name":"Last Populated Row","info":"","x":1130,"y":100,"wires":[]},{"id":"85038b11.7139c8","type":"function","z":"3bfce36.77ec51c","name":"Prepare Output Parts","func":"/*\n * Row response calculations\n */\nmsg.LastPopulatedRow = msg.payload.length + Number(msg.MinRow) - 1\nmsg.FirstEmptyRow = msg.LastPopulatedRow + 1\n\n/*\n *Column response calculation variables\n */\nlet colCount = 1 //number of columns wide from the data retrieved. This will eventually be replace by logic that loops through array find the max width for any given row\nlet index\nlet sheetdata = msg.payload //this is the data that is returned from Google that will then be examined\nlet fCol = msg.ColStart\nlet fColTotal = 0 //to hold the column number\nlet nCol = \"\"   //nCol is new column\nlet lCol = \"\"   //lCol is last column in the range (to be populated from the actual Gsheet calls data)\n\nfCol = fCol.toUpperCase()\n/*\n * validate fCol (done)\n */\nlet validStartCol = false\nvalidStartCol = ((fCol.length == 1) ||\n                ((fCol.substr(0, 1).charCodeAt(0) - 64) < 9) ||\n                (((fCol.substr(0, 1).charCodeAt(0) - 64) == 9) && ((fCol.substr(1, 1).charCodeAt(0) - 64) <= 22)))\n/*\n *Column response calculations\n */\n//look at each row that is an array\nfor (index = 0; index < sheetdata.length; index++)\n{\n    if (Array.isArray(sheetdata[index]))\n    {\n        // when the rows width is greater than any of the previous rows set the column count to the new largest width\n        colCount = Math.max(colCount, sheetdata[index].length)\n    } //if (Array.isArray(sheetdata[index]))\n}  //for (index = 0; index < sheetdata.length; index++)\nswitch (fCol.length) {\n    case 1:\n        fColTotal = (fCol.substr(0, 1).charCodeAt(0) - 64)\n        fColTotal += colCount - 1\n        break\n    case 2:\n        fColTotal = (fCol.substr(1, 1).charCodeAt(0) - 64) + 26 * (fCol.substr(0, 1).charCodeAt(0) - 64)\n        fColTotal += colCount - 1\n        break\n    default:\n        fColTotal = -1\n}\n//Last Populated Column and First Empty Column calculation\nif ((fColTotal <= 25) && (fColTotal >= 1)) {\n    lCol = String.fromCharCode(fColTotal+64)\n    nCol = String.fromCharCode(fColTotal+65)\n} else if (fColTotal == 26) {\n    lCol = \"Z\"\n    nCol = \"AA\"\n} else if (fColTotal >= 27) {\n    lCol = String.fromCharCode((Math.floor(fColTotal / 26)) + 64) + String.fromCharCode((fColTotal % 26) + 64)\n    nCol = String.fromCharCode((Math.floor(fColTotal / 26)) + 64) + String.fromCharCode((fColTotal % 26) + 65)\n} else if (fColTotal == -1) {\n    lCol = \"Error\"\n    nCol = \"Error\"\n    //Probably worth putting real error here, but deferred\n} else if (fColTotal == 256) {\n    lCol = \"IV\"\n    nCol = \"None\"\n}\nmsg.LastPopulatedCol = lCol\nmsg.FirstEmptyCol = nCol\nmsg.SpreadsheetArray = msg.payload\nreturn msg;","outputs":1,"noerr":0,"x":560,"y":540,"wires":[["8919b098.87e5d","9908b600.2b8b98","3cf3bc5a.886e64","c6ca02c6.9be92","10a747d6.2c6178","7d7cd356.a67e0c"]],"info":"Takes an input from the Gsheet node and calculates a variety of details about the spreadsheet info.\n### **Output**\nmsg.LastPopulatedRow\nmsg.FirstEmptyRow\nmsg.LastPopulatedCol\nmsg.FirstEmptyCol\nmsg.SpreadsheetArray\n"},{"id":"cac8b145.3d689","type":"comment","z":"3bfce36.77ec51c","name":"First Empty Row","info":"","x":1120,"y":180,"wires":[]},{"id":"c4aa2d16.fdb6f","type":"comment","z":"3bfce36.77ec51c","name":"Last Populated Column","info":"","x":1140,"y":260,"wires":[]},{"id":"1965a22e.f50d4e","type":"comment","z":"3bfce36.77ec51c","name":"First Empty Column","info":"","x":1130,"y":340,"wires":[]},{"id":"cbfeea2c.9618f8","type":"comment","z":"3bfce36.77ec51c","name":"Spreadsheet Array","info":"","x":1130,"y":420,"wires":[]},{"id":"2ae2d1f1.c8fe3e","type":"comment","z":"3bfce36.77ec51c","name":"Full Data","info":"","x":1100,"y":500,"wires":[]},{"id":"eff37c1d.ee7b","type":"comment","z":"3bfce36.77ec51c","name":"Full Data with Inputs","info":"","x":1130,"y":580,"wires":[]},{"id":"8919b098.87e5d","type":"change","z":"3bfce36.77ec51c","name":"Leave Outputs","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":540,"wires":[[]],"info":"Deletes a variety of message properties, but leaves all of them that were calculated about the Gsheet nodes results to be returned on the designated subflow output."},{"id":"9908b600.2b8b98","type":"change","z":"3bfce36.77ec51c","name":"Leave Last Populated Row","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"LastPopulatedRow","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":140,"wires":[[]],"info":"Copies msg.theLastPopulatedRow into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"3cf3bc5a.886e64","type":"change","z":"3bfce36.77ec51c","name":"Leave First Empty Row","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"FirstEmptyRow","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":870,"y":220,"wires":[[]],"info":"Copies msg.FirstEmptyRow into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"c6ca02c6.9be92","type":"change","z":"3bfce36.77ec51c","name":"Leave Last Populated Column","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"LastPopulatedCol","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":890,"y":300,"wires":[[]],"info":"Copies msg.LastPopulatedCol into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"10a747d6.2c6178","type":"change","z":"3bfce36.77ec51c","name":"Leave First Empty Column","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"FirstEmptyCol","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":380,"wires":[[]],"info":"Copies msg.FirstEmptyCol into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"7d7cd356.a67e0c","type":"change","z":"3bfce36.77ec51c","name":"Leave Spreadsheet Array","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"SpreadsheetArray","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":870,"y":460,"wires":[[]],"info":"Copies msg.SpreadsheetArray into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"da6b9d6f.86129","type":"trigger","z":"3bfce36.77ec51c","name":"Watchdog","op1":"","op2":"timeout","op1type":"nul","op2type":"str","duration":"10","extend":true,"units":"s","reset":"","bytopic":"all","outputs":1,"x":600,"y":140,"wires":[["c6ca02c6.9be92","9908b600.2b8b98","10a747d6.2c6178","7d7cd356.a67e0c","8919b098.87e5d"]],"info":"This trigger node works as a watchdog to see if the request to see if the read of the Google Sheet that was triggered on the other branch is successful. If it is succeful, then it will receive a reset message (msg.reset) from the Reset Watchdog node. If, however, 10 seconds elapse without receiving the reset message, this node sends a timeout message (msg.timeout)."},{"id":"da7cd56.53f9d28","type":"change","z":"3bfce36.77ec51c","name":"","rules":[{"t":"set","p":"timeout","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":120,"wires":[["da6b9d6f.86129"]],"info":"Labels what the initial input to the watchdog trigger node is."},{"id":"e47bda67.8b4798","type":"change","z":"3bfce36.77ec51c","name":"","rules":[{"t":"delete","p":"reset","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":350,"y":540,"wires":[["85038b11.7139c8"]],"info":"Removes msg.reset that was only intended for the watchdog trigger node."},{"id":"ad80d089.0be6","type":"catch","z":"3bfce36.77ec51c","name":"Catch and Relay Errors","scope":null,"uncaught":false,"x":860,"y":60,"wires":[["4e9b93e0.c94d8c"]],"info":"Passes any caught error to the error subflows intentially built error output. By intentionally built I mean I created one and labelled it as such. This is not there by default."},{"id":"1310e8b6.c47c27","type":"change","z":"3bfce36.77ec51c","name":"Reset Watchdog","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":140,"y":140,"wires":[["da6b9d6f.86129","e47bda67.8b4798"]],"info":"Sends the reset message to the watchdog triger node when there is output from the Gsheet node."},{"id":"4e9b93e0.c94d8c","type":"debug","z":"3bfce36.77ec51c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1480,"y":80,"wires":[]},{"id":"d5587511.d0e8a8","type":"debug","z":"3bfce36.77ec51c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":780,"y":740,"wires":[]},{"id":"fff678c8.6bb158","type":"debug","z":"3bfce36.77ec51c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1360,"y":180,"wires":[]},{"id":"66ab4898.a3f508","type":"function","z":"542f8cf0.3c1ce4","name":"Db Put the payload into a global variable named after the content of msg.globalsource","func":"global.set(msg.globalsource, msg.payload)\nreturn msg;","outputs":1,"noerr":0,"x":800,"y":3560,"wires":[[]],"info":"# **What** #\nThis is a simple function node that stores the msg.payload into a global variable. This is done in a function node, however, because the name of that global variable is passed into the function as a the value of msg.globalsource. \n\n## **Why**\nNormally this would be done in a change node, but change nodes could not as of May 2020 take a msg object component as the name of the global variable to be set."},{"id":"6fe46fee.0241a","type":"subflow:3bfce36.77ec51c","z":"542f8cf0.3c1ce4","name":"","env":[],"x":290,"y":3560,"wires":[[],[],[],[],[],[],["66ab4898.a3f508"],[]],"info":"This subflow shows information in the environment variables. These are good for testing purposes, but it is noteworthy that the override boolean is false. Unless that boolean is changed, they have no impact."},{"id":"a0879f53.f0f19","type":"function","z":"542f8cf0.3c1ce4","name":"Lookup info","func":"//Ref. TMS-000001\n\n//if(msg.exportableresults.DeviceName !== \"Switch_Ikea\") {return}\n\n\n\n//1 Get must have items: searchKeys, searchValues, searchResultKeys, cachedSearch, cacheTime\n//debugger\nlet searchKeys = Object.keys(msg.keyvalues)\nlet searchValues = Object.values(msg.keyvalues)\nlet searchResultKeys = Object.keys(msg.searchfor)\nlet cachedSearch = global.get(\"LastSearch\")\nlet cacheTime = new Date().getTime()\n//2 create working variables searchKeyIndices, searchResultKeysIndices, index, cacheKey\nlet searchResultKeysIndices = []\nlet index\nlet cacheObject\n//3 build the cache key which is essentially the concatenation of key+value+nextkey+nextvalue+.....etc\ncacheObject = BuildCacheObject(searchKeys, searchValues, searchResultKeys)\n//4\n/*\n * 4.1 t/f cached result is usable\n    *  4.1.true then t/f does it meet criteria\n        * 4.1.true.true\ttrue msg.searchfor = cachedSearch.searchfor\n        * 4.1.true.false do the common lookup\n    *   4.1.false  do the common lookup\n    */\n//4.1\nif (cachedSearch !== undefined)\n{\n    //4.1.true\n    if ((cachedSearch.query == cacheObject.query) && (cachedSearch.time > cacheObject.time - 5000))\n    {\n        //4.1.true.true\n        msg.searchfor = cachedSearch.searchfor\n        return [msg, null, null]\n    } //if ((cachedSearch.query == cacheObject.query) && (cachedSearch.time > cacheObject.time - 5000))\n    //4.1.true.false\n    else\n    {\n        //4.1.true.false\n        lookupResults = CommonLookup(msg, searchKeys, searchResultKeys, searchValues, global.get(msg.globalsource), cacheObject)\n        //return results from the node on 1 of the 3 outputs\n        if (lookupResults[0] !== null)\n        {\n            return [lookupResults[0], null, null]\n        } //if (lookupResults[0] !== null)\n        else if (lookupResults[1] !== null)\n        {\n            return [null, lookupResults[1], null]\n        } //else if (lookupResults[1] !== null)\n        else\n        {\n            return [null, null, lookupResults[2]]\n        } //else if (lookupResults[1] !== null) else\n    } //if ((cachedSearch.query == cacheObject.query) && (cachedSearch.time > cacheObject.time - 5000)) else\n} //if (cachedSearch !== undefined)\n//4.1.false\nelse\n{\n    //4.1.false\n    lookupResults = CommonLookup(msg, searchKeys, searchResultKeys, searchValues, global.get(msg.globalsource), cacheObject)\n    //return results from the node on 1 of the 3 outputs\n    if (lookupResults[0] !== null)\n    {\n        return [lookupResults[0], null, null]\n    } //if (lookupResults[0] !== null)\n    else if (lookupResults[1] !== null)\n    {\n        return [null, lookupResults[1], null]\n    } //else if (lookupResults[1] !== null)\n    else\n    {\n        return [null, null, lookupResults[2]]\n    } //else if (lookupResults[1] !== null) else\n} //if (cachedSearch !== undefined) else\nreturn\n\nfunction BuildCacheObject(searchKeysArray, SearchValuesArray, SearchResultKeysArray) {\n    //3 build the cache key which is essentially the concatenation of key+value+nextkey+nextvalue+.....etc\n    let newCacheKey =\"\"\n    for (index = 0; index < searchKeysArray.length; index++)\n    {\n        newCacheKey = newCacheKey + searchKeysArray[index] + SearchValuesArray[index]\n    } //for (index = 0; index < searchKeysArray.length; index++)\n    //add all fields that will be looked for into the cache key\n    for (index = 0; index < SearchResultKeysArray.length; index++)\n    {\n        newCacheKey = newCacheKey + SearchResultKeysArray[index]\n    } //for (index = 0; index < SearchResultKeysArray.length; index++)\n    //combine the cache key and the cache time into a single object that can be compared with the cached last search\n    let createdCacheObject = \n    {\n        query: newCacheKey,\n        time: cacheTime\n    }\n    return createdCacheObject\n}\nfunction CommonLookup(workingMsg, keysForSearchColumn, keysForResultColumn, valuesSearchedFor, requestedDataTable, passedCacheObject) {\n    let searchKeyIndices = []\n    let searchResultKeysIndices = []\n    let outerIndex\n    let innerLoopCounter\n    let innerIndex\n    let index\n    if (requestedDataTable !== undefined)\n    {\n        // iterate through all search keys.\n        //outer index is the place along the array of search keys\n        for (outerIndex = 0; outerIndex < keysForSearchColumn.length; outerIndex++)\n        {\n            //inner index is the place along the first row of data\n            //The innerLoopCounter must be reset each time a new key is being looked for\n            innerLoopCounter = 0\n            for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n            {\n                //these 2 loops will compare every entry in the top row of the data table to every entry in the array of search keys,\n                if (requestedDataTable[0][innerIndex] == keysForSearchColumn[outerIndex])\n                {\n                    //when they match push the column number on to the array that has just indices for the search keys\n                    searchKeyIndices.push(innerIndex)\n                    //break is used to stop comparing as once the column has been found the remaining aren't relevant\n                    //////////////////////////////////////////////////////////////////////////break may be a problem. Maybe swap inner and outer arrays and then do some if then about getting through the whole data headers without finding. Right now it only looks for 1 failure\n                    break\n                } //if (requestedDataTable[0][innerIndex] == keysForSearchColumn[outerIndex])\n                else\n                {\n                    //when they don't match, then this means there is a search key that does not match any header.\n                    //When properly configured this should not happen, but proper configuration cannot be guaranteed\n                    //this is accumulating how many times the search key did not match one of the data table headers\n                    innerLoopCounter++\n                    //Error messaging should only happen if the search key has been compared with all of the headers\n                    //requestedDataTable[0].length gives the total number of data headers (columns of the spreadsheet)\n                    if (requestedDataTable[0].length == innerLoopCounter)\n                    {\n                        //populate error \n                        //put some details on this configuration into the msg to be output\n                        workingMsg.error = \"Key with value \\\"\" + keysForSearchColumn[outerIndex] + \"\\\" not found amongst the \" + (requestedDataTable[0].length + 1) + \" entries, which include \" + requestedDataTable[0]\n                        //either create and populate the error count at 1 or increment it if it already exists\n                        if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n                        {\n                                workingMsg.searchErrorCount++\n                        }\n                        else\n                        {\n                            workingMsg.searchErrorCount = 1\n                        }\n                        //this retry is in case the column was added to the google sheet since it was last loaded into node red\n                        if (workingMsg.searchErrorCount > 1)\n                        {\n                            //return the error on the bottom because with a count of 2 that means reloading has already been tried\n                            return [null, null, workingMsg]\n                        }\n                        else\n                        {\n                            //return the error on the middle there is an error output,\n                            return [null, workingMsg, null]\n                        }\n                    } //if (requestedDataTable[0].length == innerLoopCounter)\n                } //if (requestedDataTable[0][innerIndex] == keysForSearchColumn[outerIndex]) else\n            } //for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n        } //for (outerIndex = 0; outerIndex < keysForSearchColumn.length; outerIndex++)\n        //if this point is reached, searchKeyIndices has been populated\n        // iterate through all search result keys.\n        //outer index is the place along the array of search keys \n        for (outerIndex = 0; outerIndex < keysForResultColumn.length; outerIndex++)\n        {\n            //inner index is the place along the first row of data\n            //The innerLoopCounter must be reset each time a new key is being looked for\n            innerLoopCounter = 0\n            for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n            {\n                //these 2 loops will compare every entry in the top row of the data table to every entry in the array of search keys,\n                if (requestedDataTable[0][innerIndex] == keysForResultColumn[outerIndex])\n                {\n                    //when they match push the column number on to the array that has just indices for the search keys\n                    searchResultKeysIndices.push(innerIndex)\n                    //break is used to stop comparing as once the column has been found the remaining aren't relevant\n                    break\n                } //if (requestedDataTable[0][innerIndex] == keysForResultColumn[outerIndex])\n                else\n                {\n                    //when they don't match, then this means there is a search key that does not match any header.\n                    //When properly configured this should not happen, but proper configuration cannot be guaranteed\n                    innerLoopCounter++\n                    //Error messaging should only happen if the search key has been compared with all of the headers\n                    //requestedDataTable[0].length gives the total number of data headers (columns of the spreadsheet)\n                    if (requestedDataTable[0].length == innerLoopCounter)\n                    {\n                        //populate error \n                        //put some details on this configuration into the msg to be output\n                        workingMsg.error = \"Key with value \\\"\" + keysForSearchColumn[outerIndex] + \"\\\" not found amongst the \" + (requestedDataTable[0].length + 1) + \" entries, which include \" + requestedDataTable[0]\n                        //either create and populate the error count at 1 or increment it if it already exists\n                        if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n                        {\n                            workingMsg.searchErrorCount++\n                        } //if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n                        else\n                        {\n                            workingMsg.searchErrorCount = 1\n                        } //if ( workingMsg.hasOwnProperty(\"searchErrorCount\")) else\n                        //this retry is in case the column was added to the google sheet since it was last loaded into node red\n                        if (workingMsg.searchErrorCount > 1)\n                        {\n                            //return the error on the bottom because with a count of 2 that means reloading has already been tried\n                            return [null, null, workingMsg]\n                        } //if (workingMsg.searchErrorCount > 1)\n                        else\n                        {\n                            //return the error on the middle there is an error output,\n                            return [null, workingMsg, null]\n                        } //if (workingMsg.searchErrorCount > 1) else\n                    } //if (requestedDataTable[0].length == innerLoopCounter)\n                } //if (requestedDataTable[0][innerIndex] == keysForResultColumn[outerIndex]) else\n            } //for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n        } //for (outerIndex = 0; outerIndex < keysForResultColumn.length; outerIndex++)\n        //if this point is reached, both searchKeyIndices and searchResultKeysIndices have been populated\n        //loop through all search keys, 1 index at a time and filter to a row that has the desired data in the desired column\n        let result = []\n        let pushable\n        pushable = false\n        for (outerIndex = 0; outerIndex < requestedDataTable.length; outerIndex++)\n        {\n            for (innerIndex = 0; innerIndex < searchKeyIndices.length; innerIndex++)\n            {\n                if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex])\n                {\n                    pushable = true\n                } //if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex])\n                else\n                {\n                    pushable = false\n                    break\n                } //if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex]) else\n            } //for (innerIndex = 0; innerIndex < searchKeyIndices.length; innerIndex++)\n            if (pushable)\n            {\n                result.push(requestedDataTable[outerIndex])\n            } //if (pushable)\n    \n    } //for (outerIndex = 0; outerIndex < requestedDataTable.length; outerIndex++)\n        //if this point is reached then there is a filtered table\n        //debugger\n        if (result.length === 0)\n        {\n            workingMsg.error = \"After filtering no data rows were left.\"\n            //either create and populate the error count at 1 or increment it if it already exists\n            if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n            {\n                workingMsg.searchErrorCount++\n            } //( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n            else\n            {\n                workingMsg.searchErrorCount = 1\n            } //( workingMsg.hasOwnProperty(\"searchErrorCount\")) else\n            //return the error on the middle there is an error output,\n            //this retry is in case the column was added to the google sheet since it was last loaded into node red\n            if (workingMsg.searchErrorCount > 1)\n            {\n                //return the error on the bottom because with a count of 2 that means reloading has already been tried\n                return [null, null, workingMsg]\n            } //if (workingMsg.searchErrorCount > 1)\n            else\n            {\n                //return the error on the middle there is an error output,\n                return [null, workingMsg, null]\n            } //if (workingMsg.searchErrorCount > 1) else\n        } //if (result.length === 0)\n        else if (result.length > 1)\n        {\n            //do the warning that multiple were found but will take the first\n            node.warn(\"Multiple rows were found that matched the search criteria. Results are from the first row that was found and matched.\")\n        } //else if (result.length > 1)\n        //look up the data\n        for (index = 0; index < searchResultKeysIndices.length; index++)\n        {\n            //workingMsg.searchfor.keysForSearchColumn[index] = result[0][searchResultKeysIndices]\n            // the almost working version\n            workingMsg.searchfor[keysForResultColumn[index]] = result[0][searchResultKeysIndices[index]]\n        } //for (index = 0; index < searchResultKeysIndices.length; index++)\n        //if this point is reached then work workingMsg contains complete info\n        //build and save the LastSearch obect\n        passedCacheObject.searchfor = workingMsg.searchfor\n        global.set(\"LastSearch\", passedCacheObject)\n        return [workingMsg, null, null]\n    } //if (requestedDataTable !== undefined)\n    else\n    {\n        ;\n        //return on second output to trigger population of global that feeds datatable\n        //put some details on this configuration into the msg to be output\n        //either create and populate the error count at 1 or increment it if it already exists\n        if (workingMsg.hasOwnProperty('searchErrorCount'))\n        {\n            workingMsg.searchErrorCount++\n        } //if (workingMsg.hasOwnProperty('searchErrorCount'))\n        else\n        {\n            workingMsg.searchErrorCount = 1\n        } //if (workingMsg.hasOwnProperty('searchErrorCount')) else\n        //return the error on the middle there is an error output,\n        //this retry is in case the column was added to the google sheet since it was last loaded into node red\n        if (workingMsg.searchErrorCount > 1)\n        {\n            //return the error on the bottom because with a count of 2 that means reloading has already been tried\n            workingMsg.error = \"Missing data in the local cache of spreadsheet table multiple times\"\n            node.error(\"Stop Loop\", msg)\n            //return [null, null, workingMsg]\n        } //if (workingMsg.searchErrorCount > 1)\n        else\n        {\n            //return the error on the middle there is an error output,\n            workingMsg.error = \"Local cache of spreadsheet table is empty or has timeout info.\"\n            node.error(\"Reload from Google Sheet\", msg)\n            //return [null, workingMsg, null]\n        } //if (workingMsg.searchErrorCount > 1) else\n    } //if (requestedDataTable !== undefined) else\n}","outputs":3,"noerr":0,"x":210,"y":140,"wires":[[],["a2e026c.37299d8"],[]],"outputLabels":["Value Found","Error but try reloading from data source","Error despite having tried to reload from data source"],"info":"# **Conceptual Explanation**\nThis node is designed to use a 2-D array of data loaded from a google sheeet to lookup desired data. The data is arrayed with the first row being column headers describing the data in those columns in subsequent rows.\n## **inputs**\n### globalsource \nThe name of the global variable holding the table of data\n### msg.keyvalues\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row.\n### msg.searchfor\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. The value enters the node empty.\n## **outputs**\n### Output1: Value Found \nThis ouput is used when the node has successfully identified the requested data. That data is placed into the value portions of the key value pairs that made up the msg.searchfor input\n### Output 2: Error but try reloading from data source\nThis output is used when either the global variable to contain the data table either does no exist or does not contain a row with all of the requested search criteria. Normally it is used to trigger loading the table from Google sheets under the expectation that either this is the first time a lookup has been tried an the data had not yet been cached in the global variable or potentially the data in the cache has become stale and reloading from the Google sheet will add a row that will match the requested search criteria.\n### Output 3: Error despite having tried to reload from data source\nThis output is used when either the global variable to contain the data table either does no exist or does not contain a row with all of the requested search criteria and at least 1 attempt has already been made to reload the global vairable cache. This is effectively a notification of non-recoverable lookup failure."},{"id":"80b802a0.36737","type":"change","z":"542f8cf0.3c1ce4","name":"Devices table, 1 search key with variable input, 1 result","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"exportableresults.DeviceName","tot":"msg"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":860,"y":100,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value pulled from the **msg.exportableresults.DeviceName** object.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** column.\n"},{"id":"18e95872.94c1a8","type":"change","z":"542f8cf0.3c1ce4","name":"Devices table, 1 search key, 2 results","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"Motion_Ikea","tot":"str"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.Manufacturer","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":180,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value **\"Motion_Ikea\"**.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** and **\"Manufacturer\"** columns."},{"id":"77064ddf.37afe4","type":"change","z":"542f8cf0.3c1ce4","name":"Devices table, 1 search key, 1 result","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"Anyone Presence","tot":"str"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":60,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value **\"Anyone Presence\"**. Notice unlike some examples this includes a space in the value. This has no negative impact.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** column."},{"id":"74eab436.96422c","type":"change","z":"542f8cf0.3c1ce4","name":"Devices table, 2 search keys, 1 results","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"Anyone Presence","tot":"str"},{"t":"set","p":"keyvalues.Manufacturer","pt":"msg","to":"homebridge-people-geofence","tot":"str"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":140,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value **\"Anyone Presence\"** and the **\"Manufacturer\"** column for the value **\"homebridge-people-geofence\"**.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** columns."},{"id":"8bb5e311.26804","type":"comment","z":"542f8cf0.3c1ce4","name":"Examples of preformating the inputs","info":"","x":800,"y":20,"wires":[]},{"id":"53b6335a.7e81ac","type":"change","z":"542f8cf0.3c1ce4","name":"Spreadsheet Lookup Settings Example","rules":[{"t":"set","p":"IgnoreEnvVar ","pt":"msg","to":"true","tot":"bool"},{"t":"set","p":"SpreadsheetID","pt":"msg","to":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","tot":"str"},{"t":"set","p":"Tab","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"ColStart","pt":"msg","to":"A","tot":"str"},{"t":"set","p":"ColEnd","pt":"msg","to":"Z","tot":"str"},{"t":"set","p":"MinRow","pt":"msg","to":"1","tot":"str"},{"t":"set","p":"MaxRow","pt":"msg","to":"1000","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":260,"wires":[[]],"info":"## **inputs**\n### IgnoreEnvVar \nThis boolean needs to be true to tell that Read Spreadsheet For Details subflow that it should use the specs passed in the msg to determine what spreadsheet to read from and what portion of data to read from.\n### msg.SpreadsheetID\nThis is the very long string that identifies a specific google spreadsheet.\n### msg.Tab\nSpecifies the tab name that contains the data.\n### msg.ColStart\nSpecifies the leftmost column containing the desired data.\n### msg.ColEnd\nSpecifies the rightmost column containing the desired data. \n### msg.MinRow\nSpecifies the top row containing the desired data \n### msg.MaxRow\nSpecifies the bottom row containing the desired data "},{"id":"a2e026c.37299d8","type":"rbe","z":"542f8cf0.3c1ce4","name":"Limit output to 1 msg per keyvalues.Device","func":"rbe","gap":"","start":"","inout":"out","property":"keyvalues.Device","x":690,"y":340,"wires":[["6f1dc13d.64975"]]},{"id":"6f1dc13d.64975","type":"switch","z":"542f8cf0.3c1ce4","name":"Which Tab","property":"globalsource","propertyType":"msg","rules":[{"t":"eq","v":"Devices","vt":"str"},{"t":"eq","v":"MeasurementTranslations","vt":"str"},{"t":"eq","v":"DataTranslations","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":970,"y":340,"wires":[[],[],[]]},{"id":"1671bee.1fb6b41","type":"function","z":"542f8cf0.3c1ce4","name":"Create spreadsheet range and put into msg.topic","func":"//Put inputs and read values into msg properties to be visible downstream\nmsg.sheet = msg.SpreadsheetID;\nmsg.tab = msg.Tab;\nmsg.cellstart = msg.ColStart + msg.MinRow;\nmsg.cellend = msg.ColEnd + msg.MaxRow;\nmsg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\nmsg.topic = msg.targetrange\ndelete msg.Tab\ndelete msg.SpreadsheetID\ndelete msg.ColEnd\ndelete msg.MaxRow\ndelete msg.IgnoreEnvVar\ndelete msg.tab\ndelete msg.cellstart\ndelete msg.cellend\ndelete msg.targetrange\nreturn msg;","outputs":1,"noerr":0,"x":1260,"y":320,"wires":[["351b6a78.dd53d6"]],"info":"This node sets up the inputs to the GSheet node.\nThe outputs that make up those inputs are:\n - msg.sheet -the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n - msg.topic - the combination of spreadsheet tab and cell range\n## Note\nThere are 2 very similar booleans evaluated by this node. They are:\n * **OverrideEnvVariables** - This one looks at the environment variable that was set in the flow triggering the subflow\n * **msg.IgnoreEnvVar** - This one is allows the logic to be driven by a message object property and thus can be set at runtime or earlier in the flow based on upstream logic\n\nFirst it checks the boolean value of the **OverrideEnvVariables** environment variable. This is by default false. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming the first was false, it checks the boolean value of the **msg.IgnoreEnvVar** value. This will evaluated as false if not populated, so sending false is unnecessary. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming both are false, then it can build the outputs based on the subflows environment variables. These can either be those set in the calling flow or they may be the default ones built into the subflow.\n\nRegardless of the method used to build the output, the node also removes the input message properties.\n\n\n\nmsg.IgnoreEnvVar"},{"id":"351b6a78.dd53d6","type":"GSheet","z":"542f8cf0.3c1ce4","creds":"adb4e9b8.8beee8","method":"get","action":"","sheet":"","cells":"","name":"Read Input from GSheet Devices Tab","x":1610,"y":320,"wires":[["6debf786.be7268"]],"info":"Use the GSheet node to get the a set of rows from a google spreadsheet.\n\n# **Inputs**\n### **creds**\nThis is the name on the gauth configuration node. How to get the details is beyond the scope of what I am going to put into an individual node instance. Some details are at [node-red-contrib-google-sheets](https://flows.nodered.org/node/node-red-contrib-google-sheets)\n### **Method**\nIn this case using the get cells method to read a set of data.\n### **SpreadsheetID**\nUnused as the spreadsheet ID is passed in as part of the input msg, but if needed it would be the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n### **Cells**\nUnused as the requested cells are passed in as part of the input msg, but if it was being manually built for a static data source the format is made of of 3 parts with specific seperators:\n * **[Sheetname]** like Sheet1\n * **[upper left corner cell address]** like A1\n * **[lower right corner cell address]** like B2\n\nThe format is **[Sheetname]**!**[upper left corner cell address]**:**[lower right corner cell address]** giving an input like **Sheet1!A1:B2**\n "},{"id":"dbc5c0fb.9bba9","type":"GSheet","z":"542f8cf0.3c1ce4","creds":"adb4e9b8.8beee8","method":"append","action":"","sheet":"","cells":"","name":"Test Append","x":2130,"y":320,"wires":[["6bbcb59.1ac6d4c"]]},{"id":"6debf786.be7268","type":"function","z":"542f8cf0.3c1ce4","name":"Hubitat Devices Addition Builder","func":"//Ref. TMS-000003\nlet entries = Object.entries(msg.keyvalues)\nlet cachedData = global.get(msg.globalsource)\nlet headerData = cachedData[0]\nlet index = 0\nlet resultingEntry = []\nlet found =false\nlet pushValue = \"\"\nfor (index = 0; index < headerData.length; index++)\n{\n    found = false\n    for (const [key, value] of entries) {\n        if (key === headerData[index])\n        {\n            found = true\n            pushValue = value\n        }\n        else if (\"DeviceID\" === headerData[index])\n        {\n            found = true\n            pushValue = msg.tempDeviceID\n        }\n        else if (\"Hub\" === headerData[index])\n        {\n            found = true\n            pushValue = \"Hubitat\"\n            }\n    }\n        if (found) {resultingEntry.push(pushValue)}\n        else{resultingEntry.push(\"\")}\n}\nnode.warn(msg.payload)\nnode.warn(resultingEntry)\nlet deviceTable = msg.payload\ndeviceTable.push(resultingEntry)\nglobal.set(msg.globalsource, deviceTable)\n    msg.payload = resultingEntry\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\nreturn msg","outputs":1,"noerr":0,"x":1910,"y":320,"wires":[["dbc5c0fb.9bba9"]]},{"id":"131a5eac.2f2271","type":"function","z":"542f8cf0.3c1ce4","name":"Homebridge Addition Builder","func":"//Ref. TMS-000003\nlet entries = Object.entries(msg.keyvalues)\nlet cachedData = global.get(msg.globalsource)\nlet headerData = cachedData[0]\nlet index = 0\nlet resultingEntry = []\nlet found =false\nlet pushValue = \"\"\nfor (index = 0; index < headerData.length; index++)\n{\n    found = false\n    for (const [key, value] of entries) {\n        if (key === headerData[index])\n        {\n            found = true\n            pushValue = value\n        }\n        else if (\"DeviceID\" === headerData[index])\n        {\n            found = true\n            pushValue = msg.tempDeviceID\n        }\n        else if (\"Hub\" === headerData[index])\n        {\n            found = true\n            pushValue = \"HBxxx\"\n            }\n    }\n        if (found) {resultingEntry.push(pushValue)}\n        else{resultingEntry.push(\"\")}\n}\nnode.warn(msg.payload)\nnode.warn(resultingEntry)\nlet deviceTable = msg.payload\ndeviceTable.push(resultingEntry)\nglobal.set(msg.globalsource, deviceTable)\n    msg.payload = resultingEntry\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\nreturn msg","outputs":1,"noerr":0,"x":1920,"y":180,"wires":[[]]},{"id":"7daec06.6087e4","type":"function","z":"542f8cf0.3c1ce4","name":"Zig2MQTT Addition Builder","func":"//Ref. TMS-000003\nlet entries = Object.entries(msg.keyvalues)\nlet cachedData = global.get(msg.globalsource)\nlet headerData = cachedData[0]\nlet index = 0\nlet resultingEntry = []\nlet found =false\nlet pushValue = \"\"\nfor (index = 0; index < headerData.length; index++)\n{\n    found = false\n    for (const [key, value] of entries) {\n        if (key === headerData[index])\n        {\n            found = true\n            pushValue = value\n        }\n        else if (\"DeviceID\" === headerData[index])\n        {\n            found = true\n            pushValue = msg.tempDeviceID\n        }\n        else if (\"Hub\" === headerData[index])\n        {\n            found = true\n            pushValue = \"ZBxxx\"\n            }\n    }\n        if (found) {resultingEntry.push(pushValue)}\n        else{resultingEntry.push(\"\")}\n}\nnode.warn(msg.payload)\nnode.warn(resultingEntry)\nlet deviceTable = msg.payload\ndeviceTable.push(resultingEntry)\nglobal.set(msg.globalsource, deviceTable)\n    msg.payload = resultingEntry\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\nreturn msg","outputs":1,"noerr":0,"x":1920,"y":240,"wires":[[]]},{"id":"738d389d.546d28","type":"link out","z":"542f8cf0.3c1ce4","name":"","links":["1e22ccc0.fe3ec3"],"x":2395,"y":320,"wires":[]},{"id":"1e22ccc0.fe3ec3","type":"link in","z":"542f8cf0.3c1ce4","name":"","links":["738d389d.546d28","5786fb5f.5e9384","23b7a827.3a74e8"],"x":495,"y":640,"wires":[["7916241a.f0e55c","142080d.941a97f"]]},{"id":"6bbcb59.1ac6d4c","type":"change","z":"542f8cf0.3c1ce4","name":"","rules":[{"t":"set","p":"flush","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":2290,"y":320,"wires":[["738d389d.546d28"]]},{"id":"5786fb5f.5e9384","type":"link out","z":"542f8cf0.3c1ce4","name":"","links":["1e22ccc0.fe3ec3"],"x":455,"y":140,"wires":[]},{"id":"99b96b7d.be6b38","type":"function","z":"542f8cf0.3c1ce4","name":"Create spreadsheet range and put into msg.topic","func":"//Put inputs and read values into msg properties to be visible downstream\nmsg.sheet = msg.SpreadsheetID;\nmsg.tab = msg.Tab;\nmsg.cellstart = msg.ColStart + msg.MinRow;\nmsg.cellend = msg.ColEnd + msg.MaxRow;\nmsg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\nmsg.topic = msg.targetrange\ndelete msg.Tab\ndelete msg.SpreadsheetID\ndelete msg.ColEnd\ndelete msg.MaxRow\ndelete msg.IgnoreEnvVar\ndelete msg.tab\ndelete msg.cellstart\ndelete msg.cellend\ndelete msg.targetrange\nreturn msg;","outputs":1,"noerr":0,"x":1280,"y":380,"wires":[["58fddd66.329764"]],"info":"This node sets up the inputs to the GSheet node.\nThe outputs that make up those inputs are:\n - msg.sheet -the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n - msg.topic - the combination of spreadsheet tab and cell range\n## Note\nThere are 2 very similar booleans evaluated by this node. They are:\n * **OverrideEnvVariables** - This one looks at the environment variable that was set in the flow triggering the subflow\n * **msg.IgnoreEnvVar** - This one is allows the logic to be driven by a message object property and thus can be set at runtime or earlier in the flow based on upstream logic\n\nFirst it checks the boolean value of the **OverrideEnvVariables** environment variable. This is by default false. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming the first was false, it checks the boolean value of the **msg.IgnoreEnvVar** value. This will evaluated as false if not populated, so sending false is unnecessary. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming both are false, then it can build the outputs based on the subflows environment variables. These can either be those set in the calling flow or they may be the default ones built into the subflow.\n\nRegardless of the method used to build the output, the node also removes the input message properties.\n\n\n\nmsg.IgnoreEnvVar"},{"id":"58fddd66.329764","type":"GSheet","z":"542f8cf0.3c1ce4","creds":"adb4e9b8.8beee8","method":"get","action":"","sheet":"","cells":"","name":"Read Input from GSheet Devices Tab","x":1630,"y":380,"wires":[["99ce38d1.3038f8"]],"info":"Use the GSheet node to get the a set of rows from a google spreadsheet.\n\n# **Inputs**\n### **creds**\nThis is the name on the gauth configuration node. How to get the details is beyond the scope of what I am going to put into an individual node instance. Some details are at [node-red-contrib-google-sheets](https://flows.nodered.org/node/node-red-contrib-google-sheets)\n### **Method**\nIn this case using the get cells method to read a set of data.\n### **SpreadsheetID**\nUnused as the spreadsheet ID is passed in as part of the input msg, but if needed it would be the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n### **Cells**\nUnused as the requested cells are passed in as part of the input msg, but if it was being manually built for a static data source the format is made of of 3 parts with specific seperators:\n * **[Sheetname]** like Sheet1\n * **[upper left corner cell address]** like A1\n * **[lower right corner cell address]** like B2\n\nThe format is **[Sheetname]**!**[upper left corner cell address]**:**[lower right corner cell address]** giving an input like **Sheet1!A1:B2**\n "},{"id":"a9569ed0.7b3a5","type":"GSheet","z":"542f8cf0.3c1ce4","creds":"adb4e9b8.8beee8","method":"append","action":"","sheet":"","cells":"","name":"Test Append","x":2150,"y":380,"wires":[["61af1db8.4bf1c4"]]},{"id":"99ce38d1.3038f8","type":"function","z":"542f8cf0.3c1ce4","name":"Hubitat Devices Addition Builder","func":"//Ref. TMS-000003\nlet entries = Object.entries(msg.keyvalues)\nlet cachedData = global.get(msg.globalsource)\nlet headerData = cachedData[0]\nlet index = 0\nlet resultingEntry = []\nlet found =false\nlet pushValue = \"\"\nfor (index = 0; index < headerData.length; index++)\n{\n    found = false\n    for (const [key, value] of entries) {\n        if (key === headerData[index])\n        {\n            found = true\n            pushValue = value\n        }\n        else if (\"DeviceID\" === headerData[index])\n        {\n            found = true\n            pushValue = msg.tempDeviceID\n        }\n        else if (\"Hub\" === headerData[index])\n        {\n            found = true\n            pushValue = \"Hubitat\"\n            }\n    }\n        if (found) {resultingEntry.push(pushValue)}\n        else{resultingEntry.push(\"\")}\n}\nnode.warn(msg.payload)\nnode.warn(resultingEntry)\nlet deviceTable = msg.payload\ndeviceTable.push(resultingEntry)\nglobal.set(msg.globalsource, deviceTable)\n    msg.payload = resultingEntry\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\nreturn msg","outputs":1,"noerr":0,"x":1930,"y":380,"wires":[["a9569ed0.7b3a5"]]},{"id":"23b7a827.3a74e8","type":"link out","z":"542f8cf0.3c1ce4","name":"","links":["1e22ccc0.fe3ec3"],"x":2415,"y":380,"wires":[]},{"id":"61af1db8.4bf1c4","type":"change","z":"542f8cf0.3c1ce4","name":"","rules":[{"t":"set","p":"flush","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":2310,"y":380,"wires":[["23b7a827.3a74e8"]]},{"id":"7916241a.f0e55c","type":"link out","z":"542f8cf0.3c1ce4","name":"Send to q gate","links":["ea9bd317.57498"],"x":640,"y":620,"wires":[],"l":true},{"id":"ea9bd317.57498","type":"link in","z":"542f8cf0.3c1ce4","name":"Send to q gate","links":["7916241a.f0e55c"],"x":120,"y":660,"wires":[["fc978fef.b223b"]],"l":true},{"id":"473477aa.2c5e38","type":"q-gate","z":"542f8cf0.3c1ce4","name":"q-gate","controlTopic":"control","defaultState":"queueing","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","queueCmd":"queue","defaultCmd":"default","triggerCmd":"trigger","flushCmd":"flush","resetCmd":"reset","peekCmd":"peek","dropCmd":"drop","statusCmd":"status","maxQueueLength":"100","keepNewest":false,"qToggle":false,"persist":false,"x":730,"y":740,"wires":[["ae6f2ea7.a438"]]},{"id":"1343197e.c692e7","type":"debug","z":"542f8cf0.3c1ce4","name":"simulate rest of the process via debug output","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1610,"y":620,"wires":[]},{"id":"65678f2b.9f3b5","type":"delay","z":"542f8cf0.3c1ce4","name":"1 ms delay passthrough","pauseType":"delay","timeout":"1","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1030,"y":800,"wires":[["2e0822e5.cd635e","ad510d83.8c553"]]},{"id":"39b6277f.b4f258","type":"link out","z":"542f8cf0.3c1ce4","name":"Send Control Message to QGate","links":["c2668b3d.abb388"],"x":1970,"y":840,"wires":[],"l":true},{"id":"c2668b3d.abb388","type":"link in","z":"542f8cf0.3c1ce4","name":"Send Control Message to QGate","links":["39b6277f.b4f258"],"x":230,"y":780,"wires":[["276414e5.a00ecc"]],"l":true},{"id":"4d44ff6d.db18e","type":"function","z":"542f8cf0.3c1ce4","name":"drop processed and get next","func":"//send a drop to drop the \nnode.send({topic: \"control\", payload: \"peek\"})\nnode.send({topic: \"control\", payload: \"drop\"})\nreturn","outputs":1,"noerr":0,"x":1660,"y":820,"wires":[["39b6277f.b4f258"]]},{"id":"142080d.941a97f","type":"link out","z":"542f8cf0.3c1ce4","name":"Send to prep process","links":["31a88a36.cae976"],"x":660,"y":680,"wires":[],"l":true},{"id":"31a88a36.cae976","type":"link in","z":"542f8cf0.3c1ce4","name":"Send to prep process","links":["142080d.941a97f","f613533.081aab"],"x":200,"y":860,"wires":[[]],"l":true},{"id":"10783c42.14d3c4","type":"change","z":"542f8cf0.3c1ce4","name":"Increment flow.Counter","rules":[{"t":"set","p":"Counter","pt":"flow","to":"$flowContext(\"Counter\") + 1","tot":"jsonata"},{"t":"set","p":"payload","pt":"msg","to":"Counter","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":450,"y":1040,"wires":[["cad6128e.8e33a"]]},{"id":"a2155cf1.343af","type":"change","z":"542f8cf0.3c1ce4","name":"Decrement flow.Counter","rules":[{"t":"set","p":"Counter","pt":"flow","to":"$flowContext(\"Counter\") - 1","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1270,"y":940,"wires":[["2e0822e5.cd635e"]]},{"id":"2e0822e5.cd635e","type":"switch","z":"542f8cf0.3c1ce4","name":"Any Prep Processes Pending","property":"Counter","propertyType":"flow","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1340,"y":840,"wires":[["4d44ff6d.db18e"],["7b0fa5ee.aa2c4c"]],"outputLabels":["No","Yes"]},{"id":"7b0fa5ee.aa2c4c","type":"function","z":"542f8cf0.3c1ce4","name":"drop processed only","func":"//send a drop to drop the \nnode.send({topic: \"control\", payload: \"drop\"})\nreturn","outputs":1,"noerr":0,"x":1640,"y":860,"wires":[["39b6277f.b4f258"]]},{"id":"276414e5.a00ecc","type":"change","z":"542f8cf0.3c1ce4","name":"Increment flow.QueueCounter","rules":[{"t":"set","p":"QueueCounter","pt":"flow","to":"$flowContext(\"QueueCounter\") + 1","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":510,"y":740,"wires":[["473477aa.2c5e38"]]},{"id":"ae6f2ea7.a438","type":"change","z":"542f8cf0.3c1ce4","name":"Decrement flow.QueueCounter","rules":[{"t":"set","p":"QueueCounter","pt":"flow","to":"$flowContext(\"QueueCounter\") - 1","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":740,"wires":[["65678f2b.9f3b5"]]},{"id":"ad510d83.8c553","type":"switch","z":"542f8cf0.3c1ce4","name":"Check if Queue is Empty","property":"QueueCounter","propertyType":"flow","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1230,"y":580,"wires":[["1343197e.c692e7"],["cb2f6790.575a98","1343197e.c692e7"]],"outputLabels":["Yes","No"]},{"id":"cb2f6790.575a98","type":"change","z":"542f8cf0.3c1ce4","name":"Set Device = Reset","rules":[{"t":"set","p":"Device","pt":"msg","to":"Reset","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1530,"y":680,"wires":[["f613533.081aab"]]},{"id":"5d45a477.1ab52c","type":"comment","z":"542f8cf0.3c1ce4","name":"Device = Reset is sent to allow RBE to pass the same IOT Device if an input comes in after the queue has been emptied.","info":"","x":1560,"y":720,"wires":[]},{"id":"f613533.081aab","type":"link out","z":"542f8cf0.3c1ce4","name":"Send to prep process","links":["31a88a36.cae976"],"x":1740,"y":680,"wires":[],"l":true},{"id":"d8050b14.6b6178","type":"switch","z":"542f8cf0.3c1ce4","name":"Check if Device is a reset and thus no processing is needed","property":"Device","propertyType":"msg","rules":[{"t":"eq","v":"Reset","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":940,"y":860,"wires":[[],["10783c42.14d3c4"]],"outputLabels":["Yes","No"]},{"id":"cad6128e.8e33a","type":"switch","z":"542f8cf0.3c1ce4","name":"Which Tab","property":"globalsource","propertyType":"msg","rules":[{"t":"eq","v":"Devices","vt":"str"},{"t":"eq","v":"MeasurementTranslations","vt":"str"},{"t":"eq","v":"DataTranslations","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":710,"y":1060,"wires":[["44bff9cd.2fab48"],["2893b088.eccb9"],["2893b088.eccb9"]]},{"id":"44bff9cd.2fab48","type":"function","z":"542f8cf0.3c1ce4","name":"Create spreadsheet range and put into msg.topic","func":"//Put inputs and read values into msg properties to be visible downstream\nmsg.sheet = msg.SpreadsheetID;\nmsg.tab = msg.Tab;\nmsg.cellstart = msg.ColStart + msg.MinRow;\nmsg.cellend = msg.ColEnd + msg.MaxRow;\nmsg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\nmsg.topic = msg.targetrange\ndelete msg.Tab\ndelete msg.SpreadsheetID\ndelete msg.ColEnd\ndelete msg.MaxRow\ndelete msg.IgnoreEnvVar\ndelete msg.tab\ndelete msg.cellstart\ndelete msg.cellend\ndelete msg.targetrange\nreturn msg;","outputs":1,"noerr":0,"x":1000,"y":1040,"wires":[["643cfbd5.467264"]],"info":"This node sets up the inputs to the GSheet node.\nThe outputs that make up those inputs are:\n - msg.sheet -the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n - msg.topic - the combination of spreadsheet tab and cell range\n## Note\nThere are 2 very similar booleans evaluated by this node. They are:\n * **OverrideEnvVariables** - This one looks at the environment variable that was set in the flow triggering the subflow\n * **msg.IgnoreEnvVar** - This one is allows the logic to be driven by a message object property and thus can be set at runtime or earlier in the flow based on upstream logic\n\nFirst it checks the boolean value of the **OverrideEnvVariables** environment variable. This is by default false. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming the first was false, it checks the boolean value of the **msg.IgnoreEnvVar** value. This will evaluated as false if not populated, so sending false is unnecessary. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming both are false, then it can build the outputs based on the subflows environment variables. These can either be those set in the calling flow or they may be the default ones built into the subflow.\n\nRegardless of the method used to build the output, the node also removes the input message properties.\n\n\n\nmsg.IgnoreEnvVar"},{"id":"643cfbd5.467264","type":"GSheet","z":"542f8cf0.3c1ce4","creds":"adb4e9b8.8beee8","method":"get","action":"","sheet":"","cells":"","name":"Read Input from GSheet Devices Tab","x":1350,"y":1040,"wires":[["bf6b3f40.10efb","617a5de2.3704b4"]],"info":"Use the GSheet node to get the a set of rows from a google spreadsheet.\n\n# **Inputs**\n### **creds**\nThis is the name on the gauth configuration node. How to get the details is beyond the scope of what I am going to put into an individual node instance. Some details are at [node-red-contrib-google-sheets](https://flows.nodered.org/node/node-red-contrib-google-sheets)\n### **Method**\nIn this case using the get cells method to read a set of data.\n### **SpreadsheetID**\nUnused as the spreadsheet ID is passed in as part of the input msg, but if needed it would be the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n### **Cells**\nUnused as the requested cells are passed in as part of the input msg, but if it was being manually built for a static data source the format is made of of 3 parts with specific seperators:\n * **[Sheetname]** like Sheet1\n * **[upper left corner cell address]** like A1\n * **[lower right corner cell address]** like B2\n\nThe format is **[Sheetname]**!**[upper left corner cell address]**:**[lower right corner cell address]** giving an input like **Sheet1!A1:B2**\n "},{"id":"bf6b3f40.10efb","type":"function","z":"542f8cf0.3c1ce4","name":"Hubitat Devices Addition Builder","func":"//Ref. TMS-000003\nlet entries = Object.entries(msg.keyvalues)\nlet cachedData = global.get(msg.globalsource)\n if (cachedData === undefined) {\n    cachedData = msg.payload\n  }\n\n//node.warn(cachedData)\nlet headerData = cachedData[0]\nlet index = 0\nlet resultingEntry = []\nlet found =false\nlet pushValue = \"\"\nfor (index = 0; index < headerData.length; index++)\n{\n    found = false\n    for (const [key, value] of entries) {\n        if (key === headerData[index])\n        {\n            found = true\n            pushValue = value\n        }\n        else if (\"DeviceID\" === headerData[index])\n        {\n            found = true\n            pushValue = msg.tempDeviceID\n        }\n        else if (\"Hub\" === headerData[index])\n        {\n            found = true\n            pushValue = \"Hubitat\"\n            }\n    }\n        if (found) {resultingEntry.push(pushValue)}\n        else{resultingEntry.push(\"\")}\n}\n//node.warn(msg.payload)\n//node.warn(resultingEntry)\nlet deviceTable = msg.payload\ndeviceTable.push(resultingEntry)\nglobal.set(msg.globalsource, deviceTable)\n    msg.payload = resultingEntry\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\nreturn msg","outputs":1,"noerr":0,"x":1650,"y":1040,"wires":[["17fa2f9a.4313b"]]},{"id":"17fa2f9a.4313b","type":"GSheet","z":"542f8cf0.3c1ce4","creds":"adb4e9b8.8beee8","method":"append","action":"","sheet":"","cells":"","name":"Test Append","x":1870,"y":1040,"wires":[["9ac99065.16df8"]]},{"id":"9ac99065.16df8","type":"change","z":"542f8cf0.3c1ce4","name":"","rules":[{"t":"set","p":"flush","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":2030,"y":1040,"wires":[["a2155cf1.343af"]]},{"id":"fc978fef.b223b","type":"delay","z":"542f8cf0.3c1ce4","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":280,"y":700,"wires":[["276414e5.a00ecc"]]},{"id":"89f1fa69.385fa8","type":"rbe","z":"542f8cf0.3c1ce4","name":"Limit output to 1 msg per keyvalues.Device","func":"rbe","gap":"","start":"","inout":"out","property":"keyvalues.Device","x":510,"y":860,"wires":[["d8050b14.6b6178"]]},{"id":"2893b088.eccb9","type":"debug","z":"542f8cf0.3c1ce4","name":"Other tab","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":900,"y":1120,"wires":[]},{"id":"617a5de2.3704b4","type":"debug","z":"542f8cf0.3c1ce4","name":"which tab","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1380,"y":1180,"wires":[]},{"id":"ae746050.5fe4c","type":"debug","z":"542f8cf0.3c1ce4","name":"prep after RBE","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":800,"y":820,"wires":[]},{"id":"b5711e44.6e598","type":"debug","z":"542f8cf0.3c1ce4","name":"Increment Counter","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":710,"y":1000,"wires":[]},{"id":"c8d38cf7.a57fd","type":"function","z":"542f8cf0.3c1ce4","name":"Db Use input to lookup info Before adding error logic ","func":"//Ref. TMS-000001\n\n//if(msg.exportableresults.DeviceName !== \"Switch_Ikea\") {return}\n\n\n\n//1 Get must have items: searchKeys, searchValues, searchResultKeys, cachedSearch, cacheTime\n//debugger\nlet searchKeys = Object.keys(msg.keyvalues)\nlet searchValues = Object.values(msg.keyvalues)\nlet searchResultKeys = Object.keys(msg.searchfor)\nlet cachedSearch = global.get(\"LastSearch\")\nlet cacheTime = new Date().getTime()\n//2 create working variables searchKeyIndices, searchResultKeysIndices, index, cacheKey\nlet searchResultKeysIndices = []\nlet index\nlet cacheObject\n//3 build the cache key which is essentially the concatenation of key+value+nextkey+nextvalue+.....etc\ncacheObject = BuildCacheObject(searchKeys, searchValues, searchResultKeys)\n//4\n/*\n * 4.1 t/f cached result is usable\n    *  4.1.true then t/f does it meet criteria\n        * 4.1.true.true\ttrue msg.searchfor = cachedSearch.searchfor\n        * 4.1.true.false do the common lookup\n    *   4.1.false  do the common lookup\n    */\n//4.1\nif (cachedSearch !== undefined)\n{\n    //4.1.true\n    if ((cachedSearch.query == cacheObject.query) && (cachedSearch.time > cacheObject.time - 5000))\n    {\n        //4.1.true.true\n        msg.searchfor = cachedSearch.searchfor\n        return [msg, null, null]\n    } //if ((cachedSearch.query == cacheObject.query) && (cachedSearch.time > cacheObject.time - 5000))\n    //4.1.true.false\n    else\n    {\n        //4.1.true.false\n        lookupResults = CommonLookup(msg, searchKeys, searchResultKeys, searchValues, global.get(msg.globalsource), cacheObject)\n        //return results from the node on 1 of the 3 outputs\n        if (lookupResults[0] !== null)\n        {\n            return [lookupResults[0], null, null]\n        } //if (lookupResults[0] !== null)\n        else if (lookupResults[1] !== null)\n        {\n            return [null, lookupResults[1], null]\n        } //else if (lookupResults[1] !== null)\n        else\n        {\n            return [null, null, lookupResults[2]]\n        } //else if (lookupResults[1] !== null) else\n    } //if ((cachedSearch.query == cacheObject.query) && (cachedSearch.time > cacheObject.time - 5000)) else\n} //if (cachedSearch !== undefined)\n//4.1.false\nelse\n{\n    //4.1.false\n    lookupResults = CommonLookup(msg, searchKeys, searchResultKeys, searchValues, global.get(msg.globalsource), cacheObject)\n    //return results from the node on 1 of the 3 outputs\n    if (lookupResults[0] !== null)\n    {\n        return [lookupResults[0], null, null]\n    } //if (lookupResults[0] !== null)\n    else if (lookupResults[1] !== null)\n    {\n        return [null, lookupResults[1], null]\n    } //else if (lookupResults[1] !== null)\n    else\n    {\n        return [null, null, lookupResults[2]]\n    } //else if (lookupResults[1] !== null) else\n} //if (cachedSearch !== undefined) else\nreturn\n\nfunction BuildCacheObject(searchKeysArray, SearchValuesArray, SearchResultKeysArray) {\n    //3 build the cache key which is essentially the concatenation of key+value+nextkey+nextvalue+.....etc\n    let newCacheKey =\"\"\n    for (index = 0; index < searchKeysArray.length; index++)\n    {\n        newCacheKey = newCacheKey + searchKeysArray[index] + SearchValuesArray[index]\n    } //for (index = 0; index < searchKeysArray.length; index++)\n    //add all fields that will be looked for into the cache key\n    for (index = 0; index < SearchResultKeysArray.length; index++)\n    {\n        newCacheKey = newCacheKey + SearchResultKeysArray[index]\n    } //for (index = 0; index < SearchResultKeysArray.length; index++)\n    //combine the cache key and the cache time into a single object that can be compared with the cached last search\n    let createdCacheObject = \n    {\n        query: newCacheKey,\n        time: cacheTime\n    }\n    return createdCacheObject\n}\nfunction CommonLookup(workingMsg, keysForSearchColumn, keysForResultColumn, valuesSearchedFor, requestedDataTable, passedCacheObject) {\n    let searchKeyIndices = []\n    let searchResultKeysIndices = []\n    let outerIndex\n    let innerLoopCounter\n    let innerIndex\n    let index\n    if (requestedDataTable !== undefined)\n    {\n        // iterate through all search keys.\n        //outer index is the place along the array of search keys\n        for (outerIndex = 0; outerIndex < keysForSearchColumn.length; outerIndex++)\n        {\n            //inner index is the place along the first row of data\n            //The innerLoopCounter must be reset each time a new key is being looked for\n            innerLoopCounter = 0\n            for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n            {\n                //these 2 loops will compare every entry in the top row of the data table to every entry in the array of search keys,\n                if (requestedDataTable[0][innerIndex] == keysForSearchColumn[outerIndex])\n                {\n                    //when they match push the column number on to the array that has just indices for the search keys\n                    searchKeyIndices.push(innerIndex)\n                    //break is used to stop comparing as once the column has been found the remaining aren't relevant\n                    //////////////////////////////////////////////////////////////////////////break may be a problem. Maybe swap inner and outer arrays and then do some if then about getting through the whole data headers without finding. Right now it only looks for 1 failure\n                    break\n                } //if (requestedDataTable[0][innerIndex] == keysForSearchColumn[outerIndex])\n                else\n                {\n                    //when they don't match, then this means there is a search key that does not match any header.\n                    //When properly configured this should not happen, but proper configuration cannot be guaranteed\n                    //this is accumulating how many times the search key did not match one of the data table headers\n                    innerLoopCounter++\n                    //Error messaging should only happen if the search key has been compared with all of the headers\n                    //requestedDataTable[0].length gives the total number of data headers (columns of the spreadsheet)\n                    if (requestedDataTable[0].length == innerLoopCounter)\n                    {\n                        //populate error \n                        //put some details on this configuration into the msg to be output\n                        workingMsg.error = \"Key with value \\\"\" + keysForSearchColumn[outerIndex] + \"\\\" not found amongst the \" + (requestedDataTable[0].length + 1) + \" entries, which include \" + requestedDataTable[0]\n                        //either create and populate the error count at 1 or increment it if it already exists\n                        if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n                        {\n                                workingMsg.searchErrorCount++\n                        }\n                        else\n                        {\n                            workingMsg.searchErrorCount = 1\n                        }\n                        //this retry is in case the column was added to the google sheet since it was last loaded into node red\n                        if (workingMsg.searchErrorCount > 1)\n                        {\n                            //return the error on the bottom because with a count of 2 that means reloading has already been tried\n                            return [null, null, workingMsg]\n                        }\n                        else\n                        {\n                            //return the error on the middle there is an error output,\n                            return [null, workingMsg, null]\n                        }\n                    } //if (requestedDataTable[0].length == innerLoopCounter)\n                } //if (requestedDataTable[0][innerIndex] == keysForSearchColumn[outerIndex]) else\n            } //for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n        } //for (outerIndex = 0; outerIndex < keysForSearchColumn.length; outerIndex++)\n        //if this point is reached, searchKeyIndices has been populated\n        // iterate through all search result keys.\n        //outer index is the place along the array of search keys \n        for (outerIndex = 0; outerIndex < keysForResultColumn.length; outerIndex++)\n        {\n            //inner index is the place along the first row of data\n            //The innerLoopCounter must be reset each time a new key is being looked for\n            innerLoopCounter = 0\n            for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n            {\n                //these 2 loops will compare every entry in the top row of the data table to every entry in the array of search keys,\n                if (requestedDataTable[0][innerIndex] == keysForResultColumn[outerIndex])\n                {\n                    //when they match push the column number on to the array that has just indices for the search keys\n                    searchResultKeysIndices.push(innerIndex)\n                    //break is used to stop comparing as once the column has been found the remaining aren't relevant\n                    break\n                } //if (requestedDataTable[0][innerIndex] == keysForResultColumn[outerIndex])\n                else\n                {\n                    //when they don't match, then this means there is a search key that does not match any header.\n                    //When properly configured this should not happen, but proper configuration cannot be guaranteed\n                    innerLoopCounter++\n                    //Error messaging should only happen if the search key has been compared with all of the headers\n                    //requestedDataTable[0].length gives the total number of data headers (columns of the spreadsheet)\n                    if (requestedDataTable[0].length == innerLoopCounter)\n                    {\n                        //populate error \n                        //put some details on this configuration into the msg to be output\n                        workingMsg.error = \"Key with value \\\"\" + keysForSearchColumn[outerIndex] + \"\\\" not found amongst the \" + (requestedDataTable[0].length + 1) + \" entries, which include \" + requestedDataTable[0]\n                        //either create and populate the error count at 1 or increment it if it already exists\n                        if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n                        {\n                            workingMsg.searchErrorCount++\n                        } //if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n                        else\n                        {\n                            workingMsg.searchErrorCount = 1\n                        } //if ( workingMsg.hasOwnProperty(\"searchErrorCount\")) else\n                        //this retry is in case the column was added to the google sheet since it was last loaded into node red\n                        if (workingMsg.searchErrorCount > 1)\n                        {\n                            //return the error on the bottom because with a count of 2 that means reloading has already been tried\n                            return [null, null, workingMsg]\n                        } //if (workingMsg.searchErrorCount > 1)\n                        else\n                        {\n                            //return the error on the middle there is an error output,\n                            return [null, workingMsg, null]\n                        } //if (workingMsg.searchErrorCount > 1) else\n                    } //if (requestedDataTable[0].length == innerLoopCounter)\n                } //if (requestedDataTable[0][innerIndex] == keysForResultColumn[outerIndex]) else\n            } //for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n        } //for (outerIndex = 0; outerIndex < keysForResultColumn.length; outerIndex++)\n        //if this point is reached, both searchKeyIndices and searchResultKeysIndices have been populated\n        //loop through all search keys, 1 index at a time and filter to a row that has the desired data in the desired column\n        let result = []\n        let pushable\n        pushable = false\n        for (outerIndex = 0; outerIndex < requestedDataTable.length; outerIndex++)\n        {\n            for (innerIndex = 0; innerIndex < searchKeyIndices.length; innerIndex++)\n            {\n                if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex])\n                {\n                    pushable = true\n                } //if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex])\n                else\n                {\n                    pushable = false\n                    break\n                } //if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex]) else\n            } //for (innerIndex = 0; innerIndex < searchKeyIndices.length; innerIndex++)\n            if (pushable)\n            {\n                result.push(requestedDataTable[outerIndex])\n            } //if (pushable)\n    \n    } //for (outerIndex = 0; outerIndex < requestedDataTable.length; outerIndex++)\n        //if this point is reached then there is a filtered table\n        //debugger\n        if (result.length === 0)\n        {\n            workingMsg.error = \"After filtering no data rows were left.\"\n            //either create and populate the error count at 1 or increment it if it already exists\n            if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n            {\n                workingMsg.searchErrorCount++\n            } //( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n            else\n            {\n                workingMsg.searchErrorCount = 1\n            } //( workingMsg.hasOwnProperty(\"searchErrorCount\")) else\n            //return the error on the middle there is an error output,\n            //this retry is in case the column was added to the google sheet since it was last loaded into node red\n            if (workingMsg.searchErrorCount > 1)\n            {\n                //return the error on the bottom because with a count of 2 that means reloading has already been tried\n                return [null, null, workingMsg]\n            } //if (workingMsg.searchErrorCount > 1)\n            else\n            {\n                //return the error on the middle there is an error output,\n                return [null, workingMsg, null]\n            } //if (workingMsg.searchErrorCount > 1) else\n        } //if (result.length === 0)\n        else if (result.length > 1)\n        {\n            //do the warning that multiple were found but will take the first\n            node.warn(\"Multiple rows were found that matched the search criteria. Results are from the first row that was found and matched.\")\n        } //else if (result.length > 1)\n        //look up the data\n        for (index = 0; index < searchResultKeysIndices.length; index++)\n        {\n            //workingMsg.searchfor.keysForSearchColumn[index] = result[0][searchResultKeysIndices]\n            // the almost working version\n            workingMsg.searchfor[keysForResultColumn[index]] = result[0][searchResultKeysIndices[index]]\n        } //for (index = 0; index < searchResultKeysIndices.length; index++)\n        //if this point is reached then work workingMsg contains complete info\n        //build and save the LastSearch obect\n        passedCacheObject.searchfor = workingMsg.searchfor\n        global.set(\"LastSearch\", passedCacheObject)\n        return [workingMsg, null, null]\n    } //if (requestedDataTable !== undefined)\n    else\n    {\n        //return on second output to trigger population of global that feeds datatable\n        //put some details on this configuration into the msg to be output\n        workingMsg.error = \"The data normally loaded from google sheet was not loaded.\"\n        //either create and populate the error count at 1 or increment it if it already exists\n        if (workingMsg.hasOwnProperty('searchErrorCount'))\n        {\n            workingMsg.searchErrorCount++\n        } //if (workingMsg.hasOwnProperty('searchErrorCount'))\n        else\n        {\n            workingMsg.searchErrorCount = 1\n        } //if (workingMsg.hasOwnProperty('searchErrorCount')) else\n        //return the error on the middle there is an error output,\n        //this retry is in case the column was added to the google sheet since it was last loaded into node red\n        if (workingMsg.searchErrorCount > 1)\n        {\n            //return the error on the bottom because with a count of 2 that means reloading has already been tried\n            return [null, null, workingMsg]\n        } //if (workingMsg.searchErrorCount > 1)\n        else\n        {\n            //return the error on the middle there is an error output,\n            return [null, workingMsg, null]\n        } //if (workingMsg.searchErrorCount > 1) else\n    } //if (requestedDataTable !== undefined) else\n}","outputs":3,"noerr":0,"x":300,"y":40,"wires":[[],[],[]],"outputLabels":["Value Found","Error but try reloading from data source","Error despite having tried to reload from data source"],"info":"# **Conceptual Explanation**\nThis node is designed to use a 2-D array of data loaded from a google sheeet to lookup desired data. The data is arrayed with the first row being column headers describing the data in those columns in subsequent rows.\n## **inputs**\n### globalsource \nThe name of the global variable holding the table of data\n### msg.keyvalues\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row.\n### msg.searchfor\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. The value enters the node empty.\n## **outputs**\n### Output1: Value Found \nThis ouput is used when the node has successfully identified the requested data. That data is placed into the value portions of the key value pairs that made up the msg.searchfor input\n### Output 2: Error but try reloading from data source\nThis output is used when either the global variable to contain the data table either does no exist or does not contain a row with all of the requested search criteria. Normally it is used to trigger loading the table from Google sheets under the expectation that either this is the first time a lookup has been tried an the data had not yet been cached in the global variable or potentially the data in the cache has become stale and reloading from the Google sheet will add a row that will match the requested search criteria.\n### Output 3: Error despite having tried to reload from data source\nThis output is used when either the global variable to contain the data table either does no exist or does not contain a row with all of the requested search criteria and at least 1 attempt has already been made to reload the global vairable cache. This is effectively a notification of non-recoverable lookup failure."},{"id":"f6f6594.f50eda8","type":"catch","z":"542f8cf0.3c1ce4","name":"","scope":["a0879f53.f0f19"],"uncaught":false,"x":130,"y":440,"wires":[["31dc779f.ffa658"]]},{"id":"b1f01095.12cba","type":"debug","z":"542f8cf0.3c1ce4","name":"Otherwise Failure","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":470,"y":540,"wires":[]},{"id":"31dc779f.ffa658","type":"switch","z":"542f8cf0.3c1ce4","name":"","property":"error.message","propertyType":"msg","rules":[{"t":"eq","v":"Reload from Google Sheet","vt":"str"},{"t":"eq","v":"Stop Loop","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":290,"y":460,"wires":[["1d41af0f.d8ef61","4b260afa.ac1754"],["65dfe48d.89207c"],[]]},{"id":"65dfe48d.89207c","type":"debug","z":"542f8cf0.3c1ce4","name":"Stop Loop Failure","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":470,"y":500,"wires":[]},{"id":"4b260afa.ac1754","type":"debug","z":"542f8cf0.3c1ce4","name":"Load Cache from Spreadseet Failure","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":530,"y":460,"wires":[]},{"id":"1d41af0f.d8ef61","type":"link out","z":"542f8cf0.3c1ce4","name":"Load Cache from Spreadsheet","links":["d53dfbe4.293a48"],"x":550,"y":420,"wires":[],"l":true},{"id":"d53dfbe4.293a48","type":"link in","z":"542f8cf0.3c1ce4","name":"Load Cache from Spreadsheet","links":["1d41af0f.d8ef61"],"x":250,"y":1500,"wires":[["c49b85ac.541a88","7011c933.90e458"]],"l":true},{"id":"c49b85ac.541a88","type":"change","z":"542f8cf0.3c1ce4","name":"Increment flow.QueueCounter","rules":[{"t":"set","p":"QueueCounter","pt":"flow","to":"$flowContext(\"QueueCounter\") + 1","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":1400,"wires":[["bbaa25c0.ae1ae8","92f8750e.77e398"]]},{"id":"bbaa25c0.ae1ae8","type":"q-gate","z":"542f8cf0.3c1ce4","name":"q-gate","controlTopic":"control","defaultState":"queueing","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","queueCmd":"queue","defaultCmd":"default","triggerCmd":"trigger","flushCmd":"flush","resetCmd":"reset","peekCmd":"peek","dropCmd":"drop","statusCmd":"status","maxQueueLength":"100","keepNewest":false,"qToggle":false,"persist":false,"x":790,"y":1460,"wires":[["44769477.49a0bc"]]},{"id":"44769477.49a0bc","type":"change","z":"542f8cf0.3c1ce4","name":"Decrement flow.QueueCounter","rules":[{"t":"set","p":"QueueCounter","pt":"flow","to":"$flowContext(\"QueueCounter\") - 1","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":990,"y":1400,"wires":[["f8006a98.d72938"]]},{"id":"7011c933.90e458","type":"rbe","z":"542f8cf0.3c1ce4","name":"Limit output to 1 msg per error.message","func":"rbe","gap":"","start":"","inout":"out","property":"error.message","x":600,"y":1620,"wires":[["e2faab60.257a38"]]},{"id":"e2faab60.257a38","type":"switch","z":"542f8cf0.3c1ce4","name":"Check if Device is a reset and thus no processing is needed","property":"error.message","propertyType":"msg","rules":[{"t":"eq","v":"Reset","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":660,"y":1660,"wires":[[],["fb2f7a54.c56b58"]],"outputLabels":["Yes","No"]},{"id":"fb2f7a54.c56b58","type":"change","z":"542f8cf0.3c1ce4","name":"Increment flow.LCFSCounter","rules":[{"t":"set","p":"LCFSCounter","pt":"flow","to":"$flowContext(\"LCFSCounter\") + 1","tot":"jsonata"},{"t":"set","p":"payload","pt":"msg","to":"LCFSCounter","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":1040,"y":1660,"wires":[["a3b07a23.464448"]]},{"id":"a3b07a23.464448","type":"function","z":"542f8cf0.3c1ce4","name":"Create spreadsheet range and put into msg.topic","func":"//Put inputs and read values into msg properties to be visible downstream\nmsg.sheet = msg.SpreadsheetID;\nmsg.tab = msg.Tab;\nmsg.cellstart = msg.ColStart + msg.MinRow;\nmsg.cellend = msg.ColEnd + msg.MaxRow;\nmsg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\nmsg.topic = msg.targetrange\ndelete msg.Tab\ndelete msg.SpreadsheetID\ndelete msg.ColEnd\ndelete msg.MaxRow\ndelete msg.IgnoreEnvVar\ndelete msg.tab\ndelete msg.cellstart\ndelete msg.cellend\ndelete msg.targetrange\nreturn msg;","outputs":1,"noerr":0,"x":1100,"y":1700,"wires":[["e5f9bbf9.4aae68"]],"info":"This node sets up the inputs to the GSheet node.\nThe outputs that make up those inputs are:\n - msg.sheet -the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n - msg.topic - the combination of spreadsheet tab and cell range\n## Note\nThere are 2 very similar booleans evaluated by this node. They are:\n * **OverrideEnvVariables** - This one looks at the environment variable that was set in the flow triggering the subflow\n * **msg.IgnoreEnvVar** - This one is allows the logic to be driven by a message object property and thus can be set at runtime or earlier in the flow based on upstream logic\n\nFirst it checks the boolean value of the **OverrideEnvVariables** environment variable. This is by default false. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming the first was false, it checks the boolean value of the **msg.IgnoreEnvVar** value. This will evaluated as false if not populated, so sending false is unnecessary. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming both are false, then it can build the outputs based on the subflows environment variables. These can either be those set in the calling flow or they may be the default ones built into the subflow.\n\nRegardless of the method used to build the output, the node also removes the input message properties.\n\n\n\nmsg.IgnoreEnvVar"},{"id":"e5f9bbf9.4aae68","type":"GSheet","z":"542f8cf0.3c1ce4","creds":"adb4e9b8.8beee8","method":"get","action":"","sheet":"","cells":"","name":"Read Input from GSheet Devices Tab","x":1070,"y":1740,"wires":[["3db5fe82.d71972"]],"info":"Use the GSheet node to get the a set of rows from a google spreadsheet.\n\n# **Inputs**\n### **creds**\nThis is the name on the gauth configuration node. How to get the details is beyond the scope of what I am going to put into an individual node instance. Some details are at [node-red-contrib-google-sheets](https://flows.nodered.org/node/node-red-contrib-google-sheets)\n### **Method**\nIn this case using the get cells method to read a set of data.\n### **SpreadsheetID**\nUnused as the spreadsheet ID is passed in as part of the input msg, but if needed it would be the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n### **Cells**\nUnused as the requested cells are passed in as part of the input msg, but if it was being manually built for a static data source the format is made of of 3 parts with specific seperators:\n * **[Sheetname]** like Sheet1\n * **[upper left corner cell address]** like A1\n * **[lower right corner cell address]** like B2\n\nThe format is **[Sheetname]**!**[upper left corner cell address]**:**[lower right corner cell address]** giving an input like **Sheet1!A1:B2**\n "},{"id":"3db5fe82.d71972","type":"function","z":"542f8cf0.3c1ce4","name":"Save table data to Global Context Variable Cache","func":"global.set(msg.globalsource,msg.payload)\nnode.warn(msg.globalsource+\" table updated into global context variable cache.\")\nnode.warn(flow.get(\"LCFSCounter\"))\nreturn msg","outputs":1,"noerr":0,"x":1110,"y":1780,"wires":[["4c297ee7.4c7de"]]},{"id":"d6fae775.1da188","type":"debug","z":"542f8cf0.3c1ce4","name":"debug stepper","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1400,"y":1380,"wires":[]},{"id":"4c297ee7.4c7de","type":"change","z":"542f8cf0.3c1ce4","name":"Decrement flow.LCFSCounter","rules":[{"t":"set","p":"LCFSCounter","pt":"flow","to":"$flowContext(\"LCFSCounter\") - 1","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1050,"y":1820,"wires":[["873bf344.db2cc"]]},{"id":"873bf344.db2cc","type":"switch","z":"542f8cf0.3c1ce4","name":"Any Prep Processes Pending","property":"LCFSCounter","propertyType":"flow","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1040,"y":1860,"wires":[["134eaf54.c56a11"],["cd646e87.c0dc8"]],"outputLabels":["No","Yes"]},{"id":"cd646e87.c0dc8","type":"debug","z":"542f8cf0.3c1ce4","name":"This node should never catch pending","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1330,"y":1900,"wires":[]},{"id":"134eaf54.c56a11","type":"function","z":"542f8cf0.3c1ce4","name":"flush Qgate","func":"node.send({topic: \"control\", payload: \"flush\"})\nreturn","outputs":1,"noerr":0,"x":1270,"y":1860,"wires":[["d5a8eb1b.98e1d8"]]},{"id":"c2b8f013.338f1","type":"change","z":"542f8cf0.3c1ce4","name":"Set error.message = Reset","rules":[{"t":"set","p":"error.message","pt":"msg","to":"Reset","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":700,"y":1580,"wires":[["7011c933.90e458"]]},{"id":"8609a53d.f4fc48","type":"link in","z":"542f8cf0.3c1ce4","name":"","links":["5ef0b604.d43e78"],"x":1450,"y":2140,"wires":[[]],"l":true},{"id":"5ef0b604.d43e78","type":"link out","z":"542f8cf0.3c1ce4","name":"","links":["8609a53d.f4fc48"],"x":1240,"y":2140,"wires":[],"l":true},{"id":"61fd9983.8bb5e8","type":"link in","z":"542f8cf0.3c1ce4","name":"Global loaded from spreadsheet","links":["d5a8eb1b.98e1d8"],"x":250,"y":1540,"wires":[["bbaa25c0.ae1ae8"]],"l":true},{"id":"d5a8eb1b.98e1d8","type":"link out","z":"542f8cf0.3c1ce4","name":"Global loaded from spreadsheet","links":["61fd9983.8bb5e8"],"x":1550,"y":1860,"wires":[],"l":true},{"id":"33fc6abe.be0d56","type":"config","z":"542f8cf0.3c1ce4","name":"","properties":[{"p":"Counter","pt":"flow","to":"0","tot":"num"},{"p":"LCFSCounter","pt":"flow","to":"0","tot":"num"}],"active":true,"x":170,"y":1440,"wires":[]},{"id":"f009aba.6e84058","type":"change","z":"542f8cf0.3c1ce4","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1575,"y":1480,"wires":[[]],"l":false},{"id":"f8006a98.d72938","type":"switch","z":"542f8cf0.3c1ce4","name":"Check if Queue is Empty","property":"QueueCounter","propertyType":"flow","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1310,"y":1460,"wires":[["c2b8f013.338f1"],[]],"outputLabels":["Yes","No"]},{"id":"92f8750e.77e398","type":"function","z":"542f8cf0.3c1ce4","name":"","func":"node.warn(flow.get(\"Counter\"))\nreturn msg;","outputs":1,"noerr":0,"x":1140,"y":1300,"wires":[["d6fae775.1da188"]]},{"id":"bc48d67c.4fb9a8","type":"function","z":"612157af.990328","name":"Determine Source For Gsheet lookup properties.","func":"//Read subflow input variables\nif (env.get(\"OverrideEnvVariables\"))\n{\n    //Put inputs and read values into msg properties to be visible downstream\n    msg.sheet = msg.SpreadsheetID;\n    msg.tab = msg.Tab;\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    msg.topic = msg.targetrange\n    delete msg.Tab\n    delete msg.SpreadsheetID\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\n}\nelse if (msg.IgnoreEnvVar)\n{\n    //Put inputs and read values into msg properties to be visible downstream\n    msg.sheet = msg.SpreadsheetID;\n    msg.tab = msg.Tab;\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    msg.topic = msg.targetrange\n    delete msg.Tab\n    delete msg.SpreadsheetID\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\n}\nelse\n{\n    var ColStart = env.get(\"ColStart\");\n    var ColEnd = env.get(\"ColEnd\");\n    var FirstRow = env.get(\"MinRow\");\n    var LastRow = env.get(\"MaxRow\");\n    //Put inputs and read values into msg properties to be visible downstream\n    msg.sheet = env.get(\"Spreadsheet ID\");\n    msg.tab = env.get(\"TabName\");\n    msg.cellstart = ColStart + FirstRow\n    msg.cellend = ColEnd + LastRow\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    msg.topic = msg.targetrange\n    delete msg.Tab\n    delete msg.SpreadsheetID\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\n    //These 2 are needed later to calculate the last populate and first empty rows and columns\n    msg.ColStart = ColStart\n    msg.MinRow = FirstRow\n}\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":20,"wires":[["1cb0873c.ec7779","12214a40.853cb6"]],"info":"This node sets up the inputs to the GSheet node.\nThe outputs that make up those inputs are:\n - msg.sheet -the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n - msg.topic - the combination of spreadsheet tab and cell range\n## Note\nThere are 2 very similar booleans evaluated by this node. They are:\n * **OverrideEnvVariables** - This one looks at the environment variable that was set in the flow triggering the subflow\n * **msg.IgnoreEnvVar** - This one is allows the logic to be driven by a message object property and thus can be set at runtime or earlier in the flow based on upstream logic\n\nFirst it checks the boolean value of the **OverrideEnvVariables** environment variable. This is by default false. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming the first was false, it checks the boolean value of the **msg.IgnoreEnvVar** value. This will evaluated as false if not populated, so sending false is unnecessary. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming both are false, then it can build the outputs based on the subflows environment variables. These can either be those set in the calling flow or they may be the default ones built into the subflow.\n\nRegardless of the method used to build the output, the node also removes the input message properties.\n\n\n\nmsg.IgnoreEnvVar"},{"id":"1cb0873c.ec7779","type":"GSheet","z":"612157af.990328","creds":"adb4e9b8.8beee8","method":"get","action":"","sheet":"","cells":"","name":"Read Input from GSheet","x":610,"y":20,"wires":[["4d4c62ba.c723dc"]],"info":"Use the GSheet node to get the a set of rows from a google spreadsheet.\n\n# **Inputs**\n### **creds**\nThis is the name on the gauth configuration node. How to get the details is beyond the scope of what I am going to put into an individual node instance. Some details are at [node-red-contrib-google-sheets](https://flows.nodered.org/node/node-red-contrib-google-sheets)\n### **Method**\nIn this case using the get cells method to read a set of data.\n### **SpreadsheetID**\nUnused as the spreadsheet ID is passed in as part of the input msg, but if needed it would be the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n### **Cells**\nUnused as the requested cells are passed in as part of the input msg, but if it was being manually built for a static data source the format is made of of 3 parts with specific seperators:\n * **[Sheetname]** like Sheet1\n * **[upper left corner cell address]** like A1\n * **[lower right corner cell address]** like B2\n\nThe format is **[Sheetname]**!**[upper left corner cell address]**:**[lower right corner cell address]** giving an input like **Sheet1!A1:B2**\n "},{"id":"595528bf.50fa18","type":"comment","z":"612157af.990328","name":"Error","info":"","x":1090,"y":20,"wires":[]},{"id":"69e70258.9b376c","type":"comment","z":"612157af.990328","name":"Last Populated Row","info":"","x":1130,"y":100,"wires":[]},{"id":"b0f91300.e54a3","type":"function","z":"612157af.990328","name":"Prepare Output Parts","func":"/*\n * Row response calculations\n */\nmsg.LastPopulatedRow = msg.payload.length + Number(msg.MinRow) - 1\nmsg.FirstEmptyRow = msg.LastPopulatedRow + 1\n\n/*\n *Column response calculation variables\n */\nlet colCount = 1 //number of columns wide from the data retrieved. This will eventually be replace by logic that loops through array find the max width for any given row\nlet index\nlet sheetdata = msg.payload //this is the data that is returned from Google that will then be examined\nlet fCol = msg.ColStart\nlet fColTotal = 0 //to hold the column number\nlet nCol = \"\"   //nCol is new column\nlet lCol = \"\"   //lCol is last column in the range (to be populated from the actual Gsheet calls data)\n\nfCol = fCol.toUpperCase()\n/*\n * validate fCol (done)\n */\nlet validStartCol = false\nvalidStartCol = ((fCol.length == 1) ||\n                ((fCol.substr(0, 1).charCodeAt(0) - 64) < 9) ||\n                (((fCol.substr(0, 1).charCodeAt(0) - 64) == 9) && ((fCol.substr(1, 1).charCodeAt(0) - 64) <= 22)))\n/*\n *Column response calculations\n */\n//look at each row that is an array\nfor (index = 0; index < sheetdata.length; index++)\n{\n    if (Array.isArray(sheetdata[index]))\n    {\n        // when the rows width is greater than any of the previous rows set the column count to the new largest width\n        colCount = Math.max(colCount, sheetdata[index].length)\n    } //if (Array.isArray(sheetdata[index]))\n}  //for (index = 0; index < sheetdata.length; index++)\nswitch (fCol.length) {\n    case 1:\n        fColTotal = (fCol.substr(0, 1).charCodeAt(0) - 64)\n        fColTotal += colCount - 1\n        break\n    case 2:\n        fColTotal = (fCol.substr(1, 1).charCodeAt(0) - 64) + 26 * (fCol.substr(0, 1).charCodeAt(0) - 64)\n        fColTotal += colCount - 1\n        break\n    default:\n        fColTotal = -1\n}\n//Last Populated Column and First Empty Column calculation\nif ((fColTotal <= 25) && (fColTotal >= 1)) {\n    lCol = String.fromCharCode(fColTotal+64)\n    nCol = String.fromCharCode(fColTotal+65)\n} else if (fColTotal == 26) {\n    lCol = \"Z\"\n    nCol = \"AA\"\n} else if (fColTotal >= 27) {\n    lCol = String.fromCharCode((Math.floor(fColTotal / 26)) + 64) + String.fromCharCode((fColTotal % 26) + 64)\n    nCol = String.fromCharCode((Math.floor(fColTotal / 26)) + 64) + String.fromCharCode((fColTotal % 26) + 65)\n} else if (fColTotal == -1) {\n    lCol = \"Error\"\n    nCol = \"Error\"\n    //Probably worth putting real error here, but deferred\n} else if (fColTotal == 256) {\n    lCol = \"IV\"\n    nCol = \"None\"\n}\nmsg.LastPopulatedCol = lCol\nmsg.FirstEmptyCol = nCol\nmsg.SpreadsheetArray = msg.payload\nreturn msg;","outputs":1,"noerr":0,"x":560,"y":540,"wires":[["9a5a7759.34fa38","21f57377.47771c","500b97d7.f990a8","54eec44a.cb413c","f14f21eb.6391","aa9c681e.d12238"]],"info":"Takes an input from the Gsheet node and calculates a variety of details about the spreadsheet info.\n### **Output**\nmsg.LastPopulatedRow\nmsg.FirstEmptyRow\nmsg.LastPopulatedCol\nmsg.FirstEmptyCol\nmsg.SpreadsheetArray\n"},{"id":"2b144fe4.e94fe","type":"comment","z":"612157af.990328","name":"First Empty Row","info":"","x":1120,"y":180,"wires":[]},{"id":"2d538d6e.4fe552","type":"comment","z":"612157af.990328","name":"Last Populated Column","info":"","x":1140,"y":260,"wires":[]},{"id":"ec9f612.0da56a","type":"comment","z":"612157af.990328","name":"First Empty Column","info":"","x":1130,"y":340,"wires":[]},{"id":"a58f130c.85646","type":"comment","z":"612157af.990328","name":"Spreadsheet Array","info":"","x":1130,"y":420,"wires":[]},{"id":"36a6393c.8a6d16","type":"comment","z":"612157af.990328","name":"Full Data","info":"","x":1100,"y":500,"wires":[]},{"id":"9bff28.649d10d8","type":"comment","z":"612157af.990328","name":"Full Data with Inputs","info":"","x":1130,"y":580,"wires":[]},{"id":"9a5a7759.34fa38","type":"change","z":"612157af.990328","name":"Leave Outputs","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":540,"wires":[[]],"info":"Deletes a variety of message properties, but leaves all of them that were calculated about the Gsheet nodes results to be returned on the designated subflow output."},{"id":"21f57377.47771c","type":"change","z":"612157af.990328","name":"Leave Last Populated Row","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"LastPopulatedRow","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":140,"wires":[[]],"info":"Copies msg.theLastPopulatedRow into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"500b97d7.f990a8","type":"change","z":"612157af.990328","name":"Leave First Empty Row","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"FirstEmptyRow","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":870,"y":220,"wires":[[]],"info":"Copies msg.FirstEmptyRow into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"54eec44a.cb413c","type":"change","z":"612157af.990328","name":"Leave Last Populated Column","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"LastPopulatedCol","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":890,"y":300,"wires":[[]],"info":"Copies msg.LastPopulatedCol into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"f14f21eb.6391","type":"change","z":"612157af.990328","name":"Leave First Empty Column","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"SpreadsheetArray","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"FirstEmptyCol","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":380,"wires":[[]],"info":"Copies msg.FirstEmptyCol into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"aa9c681e.d12238","type":"change","z":"612157af.990328","name":"Leave Spreadsheet Array","rules":[{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"tab","pt":"msg"},{"t":"delete","p":"sheet","pt":"msg"},{"t":"delete","p":"cellstart","pt":"msg"},{"t":"delete","p":"cellend","pt":"msg"},{"t":"delete","p":"targetrange","pt":"msg"},{"t":"delete","p":"LastPopulatedRow","pt":"msg"},{"t":"delete","p":"FirstEmptyRow","pt":"msg"},{"t":"delete","p":"LastPopulatedCol","pt":"msg"},{"t":"delete","p":"FirstEmptyCol","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"SpreadsheetArray","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":870,"y":460,"wires":[[]],"info":"Copies msg.SpreadsheetArray into msg.payload. It deletes all of the other msg properties leaving only the copied from and copied to properties that are then returned on the designated subflow output."},{"id":"a7768bf9.a46908","type":"trigger","z":"612157af.990328","name":"Watchdog","op1":"","op2":"timeout","op1type":"nul","op2type":"str","duration":"10","extend":true,"units":"s","reset":"","bytopic":"all","outputs":1,"x":600,"y":140,"wires":[["54eec44a.cb413c","21f57377.47771c","f14f21eb.6391","aa9c681e.d12238","9a5a7759.34fa38"]],"info":"This trigger node works as a watchdog to see if the request to see if the read of the Google Sheet that was triggered on the other branch is successful. If it is succeful, then it will receive a reset message (msg.reset) from the Reset Watchdog node. If, however, 10 seconds elapse without receiving the reset message, this node sends a timeout message (msg.timeout)."},{"id":"12214a40.853cb6","type":"change","z":"612157af.990328","name":"","rules":[{"t":"set","p":"timeout","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":120,"wires":[["a7768bf9.a46908"]],"info":"Labels what the initial input to the watchdog trigger node is."},{"id":"f4f26883.56f568","type":"change","z":"612157af.990328","name":"","rules":[{"t":"delete","p":"reset","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":350,"y":540,"wires":[["b0f91300.e54a3"]],"info":"Removes msg.reset that was only intended for the watchdog trigger node."},{"id":"e4b43a04.ea2398","type":"catch","z":"612157af.990328","name":"Catch and Relay Errors","scope":null,"uncaught":false,"x":860,"y":60,"wires":[["7ee7c7ae.c0b028"]],"info":"Passes any caught error to the error subflows intentially built error output. By intentionally built I mean I created one and labelled it as such. This is not there by default."},{"id":"4d4c62ba.c723dc","type":"change","z":"612157af.990328","name":"Reset Watchdog","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":140,"y":140,"wires":[["a7768bf9.a46908","f4f26883.56f568"]],"info":"Sends the reset message to the watchdog triger node when there is output from the Gsheet node."},{"id":"7ee7c7ae.c0b028","type":"debug","z":"612157af.990328","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1480,"y":80,"wires":[]},{"id":"3f1c061.b107afa","type":"debug","z":"612157af.990328","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":780,"y":740,"wires":[]},{"id":"d47b6753.0640b8","type":"debug","z":"612157af.990328","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1360,"y":180,"wires":[]},{"id":"d5d77204.e5a61","type":"function","z":"76571db3.5c77c4","name":"Db Put the payload into a global variable named after the content of msg.globalsource","func":"global.set(msg.globalsource, msg.payload)\nreturn msg;","outputs":1,"noerr":0,"x":800,"y":3560,"wires":[[]],"info":"# **What** #\nThis is a simple function node that stores the msg.payload into a global variable. This is done in a function node, however, because the name of that global variable is passed into the function as a the value of msg.globalsource. \n\n## **Why**\nNormally this would be done in a change node, but change nodes could not as of May 2020 take a msg object component as the name of the global variable to be set."},{"id":"303e7663.f4892a","type":"subflow:612157af.990328","z":"76571db3.5c77c4","name":"","env":[],"x":290,"y":3560,"wires":[[],[],[],[],[],[],["d5d77204.e5a61"],[]],"info":"This subflow shows information in the environment variables. These are good for testing purposes, but it is noteworthy that the override boolean is false. Unless that boolean is changed, they have no impact."},{"id":"a1684289.60ffe","type":"function","z":"76571db3.5c77c4","name":"Lookup info","func":"//Ref. TMS-000001\n\n//if(msg.exportableresults.DeviceName !== \"Switch_Ikea\") {return}\n\n\n\n//1 Get must have items: searchKeys, searchValues, searchResultKeys, cachedSearch, cacheTime\n//debugger\nlet searchKeys = Object.keys(msg.keyvalues)\nlet searchValues = Object.values(msg.keyvalues)\nlet searchResultKeys = Object.keys(msg.searchfor)\nlet cachedSearch = global.get(\"LastSearch\")\nlet cacheTime = new Date().getTime()\n//2 create working variables searchKeyIndices, searchResultKeysIndices, index, cacheKey\nlet searchResultKeysIndices = []\nlet index\nlet cacheObject\n//3 build the cache key which is essentially the concatenation of key+value+nextkey+nextvalue+.....etc\ncacheObject = BuildCacheObject(searchKeys, searchValues, searchResultKeys)\n//4\n/*\n * 4.1 t/f cached result is usable\n    *  4.1.true then t/f does it meet criteria\n        * 4.1.true.true\ttrue msg.searchfor = cachedSearch.searchfor\n        * 4.1.true.false do the common lookup\n    *   4.1.false  do the common lookup\n    */\n//4.1\nif (cachedSearch !== undefined)\n{\n    //4.1.true\n    if ((cachedSearch.query == cacheObject.query) && (cachedSearch.time > cacheObject.time - 5000))\n    {\n        //4.1.true.true\n        msg.searchfor = cachedSearch.searchfor\n        return [msg, null, null]\n    } //if ((cachedSearch.query == cacheObject.query) && (cachedSearch.time > cacheObject.time - 5000))\n    //4.1.true.false\n    else\n    {\n        //4.1.true.false\n        lookupResults = CommonLookup(msg, searchKeys, searchResultKeys, searchValues, global.get(msg.globalsource), cacheObject)\n        //return results from the node on 1 of the 3 outputs\n        if (lookupResults[0] !== null)\n        {\n            return [lookupResults[0], null, null]\n        } //if (lookupResults[0] !== null)\n        else if (lookupResults[1] !== null)\n        {\n            return [null, lookupResults[1], null]\n        } //else if (lookupResults[1] !== null)\n        else\n        {\n            return [null, null, lookupResults[2]]\n        } //else if (lookupResults[1] !== null) else\n    } //if ((cachedSearch.query == cacheObject.query) && (cachedSearch.time > cacheObject.time - 5000)) else\n} //if (cachedSearch !== undefined)\n//4.1.false\nelse\n{\n    //4.1.false\n    lookupResults = CommonLookup(msg, searchKeys, searchResultKeys, searchValues, global.get(msg.globalsource), cacheObject)\n    //return results from the node on 1 of the 3 outputs\n    if (lookupResults[0] !== null)\n    {\n        return [lookupResults[0], null, null]\n    } //if (lookupResults[0] !== null)\n    else if (lookupResults[1] !== null)\n    {\n        return [null, lookupResults[1], null]\n    } //else if (lookupResults[1] !== null)\n    else\n    {\n        return [null, null, lookupResults[2]]\n    } //else if (lookupResults[1] !== null) else\n} //if (cachedSearch !== undefined) else\nreturn\n\nfunction BuildCacheObject(searchKeysArray, SearchValuesArray, SearchResultKeysArray) {\n    //3 build the cache key which is essentially the concatenation of key+value+nextkey+nextvalue+.....etc\n    let newCacheKey =\"\"\n    for (index = 0; index < searchKeysArray.length; index++)\n    {\n        newCacheKey = newCacheKey + searchKeysArray[index] + SearchValuesArray[index]\n    } //for (index = 0; index < searchKeysArray.length; index++)\n    //add all fields that will be looked for into the cache key\n    for (index = 0; index < SearchResultKeysArray.length; index++)\n    {\n        newCacheKey = newCacheKey + SearchResultKeysArray[index]\n    } //for (index = 0; index < SearchResultKeysArray.length; index++)\n    //combine the cache key and the cache time into a single object that can be compared with the cached last search\n    let createdCacheObject = \n    {\n        query: newCacheKey,\n        time: cacheTime\n    }\n    return createdCacheObject\n}\nfunction CommonLookup(workingMsg, keysForSearchColumn, keysForResultColumn, valuesSearchedFor, requestedDataTable, passedCacheObject) {\n    let searchKeyIndices = []\n    let searchResultKeysIndices = []\n    let outerIndex\n    let innerLoopCounter\n    let innerIndex\n    let index\n    if (requestedDataTable !== undefined)\n    {\n        // iterate through all search keys.\n        //outer index is the place along the array of search keys\n        for (outerIndex = 0; outerIndex < keysForSearchColumn.length; outerIndex++)\n        {\n            //inner index is the place along the first row of data\n            //The innerLoopCounter must be reset each time a new key is being looked for\n            innerLoopCounter = 0\n            for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n            {\n                //these 2 loops will compare every entry in the top row of the data table to every entry in the array of search keys,\n                if (requestedDataTable[0][innerIndex] == keysForSearchColumn[outerIndex])\n                {\n                    //when they match push the column number on to the array that has just indices for the search keys\n                    searchKeyIndices.push(innerIndex)\n                    //break is used to stop comparing as once the column has been found the remaining aren't relevant\n                    //////////////////////////////////////////////////////////////////////////break may be a problem. Maybe swap inner and outer arrays and then do some if then about getting through the whole data headers without finding. Right now it only looks for 1 failure\n                    break\n                } //if (requestedDataTable[0][innerIndex] == keysForSearchColumn[outerIndex])\n                else\n                {\n                    //when they don't match, then this means there is a search key that does not match any header.\n                    //When properly configured this should not happen, but proper configuration cannot be guaranteed\n                    //this is accumulating how many times the search key did not match one of the data table headers\n                    innerLoopCounter++\n                    //Error messaging should only happen if the search key has been compared with all of the headers\n                    //requestedDataTable[0].length gives the total number of data headers (columns of the spreadsheet)\n                    if (requestedDataTable[0].length == innerLoopCounter)\n                    {\n                        //populate error \n                        //put some details on this configuration into the msg to be output\n                        workingMsg.error = \"Key with value \\\"\" + keysForSearchColumn[outerIndex] + \"\\\" not found amongst the \" + (requestedDataTable[0].length + 1) + \" entries, which include \" + requestedDataTable[0]\n                        //either create and populate the error count at 1 or increment it if it already exists\n                        if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n                        {\n                                workingMsg.searchErrorCount++\n                        }\n                        else\n                        {\n                            workingMsg.searchErrorCount = 1\n                        }\n                        //this retry is in case the column was added to the google sheet since it was last loaded into node red\n                        if (workingMsg.searchErrorCount > 1)\n                        {\n                            //return the error on the bottom because with a count of 2 that means reloading has already been tried\n                            return [null, null, workingMsg]\n                        }\n                        else\n                        {\n                            //return the error on the middle there is an error output,\n                            return [null, workingMsg, null]\n                        }\n                    } //if (requestedDataTable[0].length == innerLoopCounter)\n                } //if (requestedDataTable[0][innerIndex] == keysForSearchColumn[outerIndex]) else\n            } //for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n        } //for (outerIndex = 0; outerIndex < keysForSearchColumn.length; outerIndex++)\n        //if this point is reached, searchKeyIndices has been populated\n        // iterate through all search result keys.\n        //outer index is the place along the array of search keys \n        for (outerIndex = 0; outerIndex < keysForResultColumn.length; outerIndex++)\n        {\n            //inner index is the place along the first row of data\n            //The innerLoopCounter must be reset each time a new key is being looked for\n            innerLoopCounter = 0\n            for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n            {\n                //these 2 loops will compare every entry in the top row of the data table to every entry in the array of search keys,\n                if (requestedDataTable[0][innerIndex] == keysForResultColumn[outerIndex])\n                {\n                    //when they match push the column number on to the array that has just indices for the search keys\n                    searchResultKeysIndices.push(innerIndex)\n                    //break is used to stop comparing as once the column has been found the remaining aren't relevant\n                    break\n                } //if (requestedDataTable[0][innerIndex] == keysForResultColumn[outerIndex])\n                else\n                {\n                    //when they don't match, then this means there is a search key that does not match any header.\n                    //When properly configured this should not happen, but proper configuration cannot be guaranteed\n                    innerLoopCounter++\n                    //Error messaging should only happen if the search key has been compared with all of the headers\n                    //requestedDataTable[0].length gives the total number of data headers (columns of the spreadsheet)\n                    if (requestedDataTable[0].length == innerLoopCounter)\n                    {\n                        //populate error \n                        //put some details on this configuration into the msg to be output\n                        workingMsg.error = \"Key with value \\\"\" + keysForSearchColumn[outerIndex] + \"\\\" not found amongst the \" + (requestedDataTable[0].length + 1) + \" entries, which include \" + requestedDataTable[0]\n                        //either create and populate the error count at 1 or increment it if it already exists\n                        if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n                        {\n                            workingMsg.searchErrorCount++\n                        } //if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n                        else\n                        {\n                            workingMsg.searchErrorCount = 1\n                        } //if ( workingMsg.hasOwnProperty(\"searchErrorCount\")) else\n                        //this retry is in case the column was added to the google sheet since it was last loaded into node red\n                        if (workingMsg.searchErrorCount > 1)\n                        {\n                            //return the error on the bottom because with a count of 2 that means reloading has already been tried\n                            return [null, null, workingMsg]\n                        } //if (workingMsg.searchErrorCount > 1)\n                        else\n                        {\n                            //return the error on the middle there is an error output,\n                            return [null, workingMsg, null]\n                        } //if (workingMsg.searchErrorCount > 1) else\n                    } //if (requestedDataTable[0].length == innerLoopCounter)\n                } //if (requestedDataTable[0][innerIndex] == keysForResultColumn[outerIndex]) else\n            } //for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n        } //for (outerIndex = 0; outerIndex < keysForResultColumn.length; outerIndex++)\n        //if this point is reached, both searchKeyIndices and searchResultKeysIndices have been populated\n        //loop through all search keys, 1 index at a time and filter to a row that has the desired data in the desired column\n        let result = []\n        let pushable\n        pushable = false\n        for (outerIndex = 0; outerIndex < requestedDataTable.length; outerIndex++)\n        {\n            for (innerIndex = 0; innerIndex < searchKeyIndices.length; innerIndex++)\n            {\n                if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex])\n                {\n                    pushable = true\n                } //if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex])\n                else\n                {\n                    pushable = false\n                    break\n                } //if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex]) else\n            } //for (innerIndex = 0; innerIndex < searchKeyIndices.length; innerIndex++)\n            if (pushable)\n            {\n                result.push(requestedDataTable[outerIndex])\n            } //if (pushable)\n    \n    } //for (outerIndex = 0; outerIndex < requestedDataTable.length; outerIndex++)\n        //if this point is reached then there is a filtered table\n        //debugger\n        if (result.length === 0)\n        {\n            workingMsg.error = \"After filtering no data rows were left.\"\n            //either create and populate the error count at 1 or increment it if it already exists\n            if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n            {\n                workingMsg.searchErrorCount++\n            } //( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n            else\n            {\n                workingMsg.searchErrorCount = 1\n            } //( workingMsg.hasOwnProperty(\"searchErrorCount\")) else\n            //return the error on the middle there is an error output,\n            //this retry is in case the column was added to the google sheet since it was last loaded into node red\n            if (workingMsg.searchErrorCount > 1)\n            {\n                //return the error on the bottom because with a count of 2 that means reloading has already been tried\n                return [null, null, workingMsg]\n            } //if (workingMsg.searchErrorCount > 1)\n            else\n            {\n                //return the error on the middle there is an error output,\n                return [null, workingMsg, null]\n            } //if (workingMsg.searchErrorCount > 1) else\n        } //if (result.length === 0)\n        else if (result.length > 1)\n        {\n            //do the warning that multiple were found but will take the first\n            node.warn(\"Multiple rows were found that matched the search criteria. Results are from the first row that was found and matched.\")\n        } //else if (result.length > 1)\n        //look up the data\n        for (index = 0; index < searchResultKeysIndices.length; index++)\n        {\n            //workingMsg.searchfor.keysForSearchColumn[index] = result[0][searchResultKeysIndices]\n            // the almost working version\n            workingMsg.searchfor[keysForResultColumn[index]] = result[0][searchResultKeysIndices[index]]\n        } //for (index = 0; index < searchResultKeysIndices.length; index++)\n        //if this point is reached then work workingMsg contains complete info\n        //build and save the LastSearch obect\n        passedCacheObject.searchfor = workingMsg.searchfor\n        global.set(\"LastSearch\", passedCacheObject)\n        return [workingMsg, null, null]\n    } //if (requestedDataTable !== undefined)\n    else\n    {\n        ;\n        //return on second output to trigger population of global that feeds datatable\n        //put some details on this configuration into the msg to be output\n        //either create and populate the error count at 1 or increment it if it already exists\n        if (workingMsg.hasOwnProperty('searchErrorCount'))\n        {\n            workingMsg.searchErrorCount++\n        } //if (workingMsg.hasOwnProperty('searchErrorCount'))\n        else\n        {\n            workingMsg.searchErrorCount = 1\n        } //if (workingMsg.hasOwnProperty('searchErrorCount')) else\n        //return the error on the middle there is an error output,\n        //this retry is in case the column was added to the google sheet since it was last loaded into node red\n        if (workingMsg.searchErrorCount > 1)\n        {\n            //return the error on the bottom because with a count of 2 that means reloading has already been tried\n            workingMsg.error = \"Missing data in the local cache of spreadsheet table multiple times\"\n            node.error(\"Stop Loop\", msg)\n            //return [null, null, workingMsg]\n        } //if (workingMsg.searchErrorCount > 1)\n        else\n        {\n            //return the error on the middle there is an error output,\n            workingMsg.error = \"Local cache of spreadsheet table is empty or has timeout info.\"\n            node.error(\"Reload from Google Sheet\", msg)\n            //return [null, workingMsg, null]\n        } //if (workingMsg.searchErrorCount > 1) else\n    } //if (requestedDataTable !== undefined) else\n}","outputs":3,"noerr":0,"x":210,"y":140,"wires":[[],["e95940c9.a9779"],[]],"outputLabels":["Value Found","Error but try reloading from data source","Error despite having tried to reload from data source"],"info":"# **Conceptual Explanation**\nThis node is designed to use a 2-D array of data loaded from a google sheeet to lookup desired data. The data is arrayed with the first row being column headers describing the data in those columns in subsequent rows.\n## **inputs**\n### globalsource \nThe name of the global variable holding the table of data\n### msg.keyvalues\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row.\n### msg.searchfor\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. The value enters the node empty.\n## **outputs**\n### Output1: Value Found \nThis ouput is used when the node has successfully identified the requested data. That data is placed into the value portions of the key value pairs that made up the msg.searchfor input\n### Output 2: Error but try reloading from data source\nThis output is used when either the global variable to contain the data table either does no exist or does not contain a row with all of the requested search criteria. Normally it is used to trigger loading the table from Google sheets under the expectation that either this is the first time a lookup has been tried an the data had not yet been cached in the global variable or potentially the data in the cache has become stale and reloading from the Google sheet will add a row that will match the requested search criteria.\n### Output 3: Error despite having tried to reload from data source\nThis output is used when either the global variable to contain the data table either does no exist or does not contain a row with all of the requested search criteria and at least 1 attempt has already been made to reload the global vairable cache. This is effectively a notification of non-recoverable lookup failure."},{"id":"453ff9a9.8dcb88","type":"change","z":"76571db3.5c77c4","name":"Devices table, 1 search key with variable input, 1 result","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"exportableresults.DeviceName","tot":"msg"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":860,"y":100,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value pulled from the **msg.exportableresults.DeviceName** object.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** column.\n"},{"id":"77f98127.e496f","type":"change","z":"76571db3.5c77c4","name":"Devices table, 1 search key, 2 results","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"Motion_Ikea","tot":"str"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.Manufacturer","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":180,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value **\"Motion_Ikea\"**.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** and **\"Manufacturer\"** columns."},{"id":"ee8e079.4e1a2f8","type":"change","z":"76571db3.5c77c4","name":"Devices table, 1 search key, 1 result","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"Anyone Presence","tot":"str"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":60,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value **\"Anyone Presence\"**. Notice unlike some examples this includes a space in the value. This has no negative impact.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** column."},{"id":"ccab7d6b.a795f","type":"change","z":"76571db3.5c77c4","name":"Devices table, 2 search keys, 1 results","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"Anyone Presence","tot":"str"},{"t":"set","p":"keyvalues.Manufacturer","pt":"msg","to":"homebridge-people-geofence","tot":"str"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":140,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value **\"Anyone Presence\"** and the **\"Manufacturer\"** column for the value **\"homebridge-people-geofence\"**.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** columns."},{"id":"b08772e5.d8965","type":"comment","z":"76571db3.5c77c4","name":"Examples of preformating the inputs","info":"","x":800,"y":20,"wires":[]},{"id":"3d171c83.394344","type":"change","z":"76571db3.5c77c4","name":"Spreadsheet Lookup Settings Example","rules":[{"t":"set","p":"IgnoreEnvVar ","pt":"msg","to":"true","tot":"bool"},{"t":"set","p":"SpreadsheetID","pt":"msg","to":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","tot":"str"},{"t":"set","p":"Tab","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"ColStart","pt":"msg","to":"A","tot":"str"},{"t":"set","p":"ColEnd","pt":"msg","to":"Z","tot":"str"},{"t":"set","p":"MinRow","pt":"msg","to":"1","tot":"str"},{"t":"set","p":"MaxRow","pt":"msg","to":"1000","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":260,"wires":[[]],"info":"## **inputs**\n### IgnoreEnvVar \nThis boolean needs to be true to tell that Read Spreadsheet For Details subflow that it should use the specs passed in the msg to determine what spreadsheet to read from and what portion of data to read from.\n### msg.SpreadsheetID\nThis is the very long string that identifies a specific google spreadsheet.\n### msg.Tab\nSpecifies the tab name that contains the data.\n### msg.ColStart\nSpecifies the leftmost column containing the desired data.\n### msg.ColEnd\nSpecifies the rightmost column containing the desired data. \n### msg.MinRow\nSpecifies the top row containing the desired data \n### msg.MaxRow\nSpecifies the bottom row containing the desired data "},{"id":"e95940c9.a9779","type":"rbe","z":"76571db3.5c77c4","name":"Limit output to 1 msg per keyvalues.Device","func":"rbe","gap":"","start":"","inout":"out","property":"keyvalues.Device","x":690,"y":340,"wires":[["897aceba.e077"]]},{"id":"897aceba.e077","type":"switch","z":"76571db3.5c77c4","name":"Which Tab","property":"globalsource","propertyType":"msg","rules":[{"t":"eq","v":"Devices","vt":"str"},{"t":"eq","v":"MeasurementTranslations","vt":"str"},{"t":"eq","v":"DataTranslations","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":970,"y":340,"wires":[[],[],[]]},{"id":"e610270c.812268","type":"function","z":"76571db3.5c77c4","name":"Create spreadsheet range and put into msg.topic","func":"//Put inputs and read values into msg properties to be visible downstream\nmsg.sheet = msg.SpreadsheetID;\nmsg.tab = msg.Tab;\nmsg.cellstart = msg.ColStart + msg.MinRow;\nmsg.cellend = msg.ColEnd + msg.MaxRow;\nmsg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\nmsg.topic = msg.targetrange\ndelete msg.Tab\ndelete msg.SpreadsheetID\ndelete msg.ColEnd\ndelete msg.MaxRow\ndelete msg.IgnoreEnvVar\ndelete msg.tab\ndelete msg.cellstart\ndelete msg.cellend\ndelete msg.targetrange\nreturn msg;","outputs":1,"noerr":0,"x":1260,"y":320,"wires":[["8e0a75c3.334d78"]],"info":"This node sets up the inputs to the GSheet node.\nThe outputs that make up those inputs are:\n - msg.sheet -the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n - msg.topic - the combination of spreadsheet tab and cell range\n## Note\nThere are 2 very similar booleans evaluated by this node. They are:\n * **OverrideEnvVariables** - This one looks at the environment variable that was set in the flow triggering the subflow\n * **msg.IgnoreEnvVar** - This one is allows the logic to be driven by a message object property and thus can be set at runtime or earlier in the flow based on upstream logic\n\nFirst it checks the boolean value of the **OverrideEnvVariables** environment variable. This is by default false. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming the first was false, it checks the boolean value of the **msg.IgnoreEnvVar** value. This will evaluated as false if not populated, so sending false is unnecessary. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming both are false, then it can build the outputs based on the subflows environment variables. These can either be those set in the calling flow or they may be the default ones built into the subflow.\n\nRegardless of the method used to build the output, the node also removes the input message properties.\n\n\n\nmsg.IgnoreEnvVar"},{"id":"8e0a75c3.334d78","type":"GSheet","z":"76571db3.5c77c4","creds":"adb4e9b8.8beee8","method":"get","action":"","sheet":"","cells":"","name":"Read Input from GSheet Devices Tab","x":1610,"y":320,"wires":[["49f925b6.fc7ebc"]],"info":"Use the GSheet node to get the a set of rows from a google spreadsheet.\n\n# **Inputs**\n### **creds**\nThis is the name on the gauth configuration node. How to get the details is beyond the scope of what I am going to put into an individual node instance. Some details are at [node-red-contrib-google-sheets](https://flows.nodered.org/node/node-red-contrib-google-sheets)\n### **Method**\nIn this case using the get cells method to read a set of data.\n### **SpreadsheetID**\nUnused as the spreadsheet ID is passed in as part of the input msg, but if needed it would be the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n### **Cells**\nUnused as the requested cells are passed in as part of the input msg, but if it was being manually built for a static data source the format is made of of 3 parts with specific seperators:\n * **[Sheetname]** like Sheet1\n * **[upper left corner cell address]** like A1\n * **[lower right corner cell address]** like B2\n\nThe format is **[Sheetname]**!**[upper left corner cell address]**:**[lower right corner cell address]** giving an input like **Sheet1!A1:B2**\n "},{"id":"1cd022ea.77b7ed","type":"GSheet","z":"76571db3.5c77c4","creds":"adb4e9b8.8beee8","method":"append","action":"","sheet":"","cells":"","name":"Test Append","x":2130,"y":320,"wires":[["cfe453b2.2b5f5"]]},{"id":"49f925b6.fc7ebc","type":"function","z":"76571db3.5c77c4","name":"Hubitat Devices Addition Builder","func":"//Ref. TMS-000003\nlet entries = Object.entries(msg.keyvalues)\nlet cachedData = global.get(msg.globalsource)\nlet headerData = cachedData[0]\nlet index = 0\nlet resultingEntry = []\nlet found =false\nlet pushValue = \"\"\nfor (index = 0; index < headerData.length; index++)\n{\n    found = false\n    for (const [key, value] of entries) {\n        if (key === headerData[index])\n        {\n            found = true\n            pushValue = value\n        }\n        else if (\"DeviceID\" === headerData[index])\n        {\n            found = true\n            pushValue = msg.tempDeviceID\n        }\n        else if (\"Hub\" === headerData[index])\n        {\n            found = true\n            pushValue = \"Hubitat\"\n            }\n    }\n        if (found) {resultingEntry.push(pushValue)}\n        else{resultingEntry.push(\"\")}\n}\nnode.warn(msg.payload)\nnode.warn(resultingEntry)\nlet deviceTable = msg.payload\ndeviceTable.push(resultingEntry)\nglobal.set(msg.globalsource, deviceTable)\n    msg.payload = resultingEntry\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\nreturn msg","outputs":1,"noerr":0,"x":1910,"y":320,"wires":[["1cd022ea.77b7ed"]]},{"id":"3acec0e0.950b4","type":"function","z":"76571db3.5c77c4","name":"Homebridge Addition Builder","func":"//Ref. TMS-000003\nlet entries = Object.entries(msg.keyvalues)\nlet cachedData = global.get(msg.globalsource)\nlet headerData = cachedData[0]\nlet index = 0\nlet resultingEntry = []\nlet found =false\nlet pushValue = \"\"\nfor (index = 0; index < headerData.length; index++)\n{\n    found = false\n    for (const [key, value] of entries) {\n        if (key === headerData[index])\n        {\n            found = true\n            pushValue = value\n        }\n        else if (\"DeviceID\" === headerData[index])\n        {\n            found = true\n            pushValue = msg.tempDeviceID\n        }\n        else if (\"Hub\" === headerData[index])\n        {\n            found = true\n            pushValue = \"HBxxx\"\n            }\n    }\n        if (found) {resultingEntry.push(pushValue)}\n        else{resultingEntry.push(\"\")}\n}\nnode.warn(msg.payload)\nnode.warn(resultingEntry)\nlet deviceTable = msg.payload\ndeviceTable.push(resultingEntry)\nglobal.set(msg.globalsource, deviceTable)\n    msg.payload = resultingEntry\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\nreturn msg","outputs":1,"noerr":0,"x":1920,"y":180,"wires":[[]]},{"id":"e2c3ed24.059fc","type":"function","z":"76571db3.5c77c4","name":"Zig2MQTT Addition Builder","func":"//Ref. TMS-000003\nlet entries = Object.entries(msg.keyvalues)\nlet cachedData = global.get(msg.globalsource)\nlet headerData = cachedData[0]\nlet index = 0\nlet resultingEntry = []\nlet found =false\nlet pushValue = \"\"\nfor (index = 0; index < headerData.length; index++)\n{\n    found = false\n    for (const [key, value] of entries) {\n        if (key === headerData[index])\n        {\n            found = true\n            pushValue = value\n        }\n        else if (\"DeviceID\" === headerData[index])\n        {\n            found = true\n            pushValue = msg.tempDeviceID\n        }\n        else if (\"Hub\" === headerData[index])\n        {\n            found = true\n            pushValue = \"ZBxxx\"\n            }\n    }\n        if (found) {resultingEntry.push(pushValue)}\n        else{resultingEntry.push(\"\")}\n}\nnode.warn(msg.payload)\nnode.warn(resultingEntry)\nlet deviceTable = msg.payload\ndeviceTable.push(resultingEntry)\nglobal.set(msg.globalsource, deviceTable)\n    msg.payload = resultingEntry\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\nreturn msg","outputs":1,"noerr":0,"x":1920,"y":240,"wires":[[]]},{"id":"c1389032.aa6b5","type":"link out","z":"76571db3.5c77c4","name":"","links":["d62169eb.dde8f8"],"x":2395,"y":320,"wires":[]},{"id":"d62169eb.dde8f8","type":"link in","z":"76571db3.5c77c4","name":"","links":["c1389032.aa6b5","71a23ad1.5c7674","f94da7c0.f0bc38"],"x":495,"y":640,"wires":[["a8a1ccb1.7e452","38f046.56873fba"]]},{"id":"cfe453b2.2b5f5","type":"change","z":"76571db3.5c77c4","name":"","rules":[{"t":"set","p":"flush","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":2290,"y":320,"wires":[["c1389032.aa6b5"]]},{"id":"71a23ad1.5c7674","type":"link out","z":"76571db3.5c77c4","name":"","links":["d62169eb.dde8f8"],"x":455,"y":140,"wires":[]},{"id":"31ed8b20.258cf4","type":"function","z":"76571db3.5c77c4","name":"Create spreadsheet range and put into msg.topic","func":"//Put inputs and read values into msg properties to be visible downstream\nmsg.sheet = msg.SpreadsheetID;\nmsg.tab = msg.Tab;\nmsg.cellstart = msg.ColStart + msg.MinRow;\nmsg.cellend = msg.ColEnd + msg.MaxRow;\nmsg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\nmsg.topic = msg.targetrange\ndelete msg.Tab\ndelete msg.SpreadsheetID\ndelete msg.ColEnd\ndelete msg.MaxRow\ndelete msg.IgnoreEnvVar\ndelete msg.tab\ndelete msg.cellstart\ndelete msg.cellend\ndelete msg.targetrange\nreturn msg;","outputs":1,"noerr":0,"x":1280,"y":380,"wires":[["b88a898.82ea378"]],"info":"This node sets up the inputs to the GSheet node.\nThe outputs that make up those inputs are:\n - msg.sheet -the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n - msg.topic - the combination of spreadsheet tab and cell range\n## Note\nThere are 2 very similar booleans evaluated by this node. They are:\n * **OverrideEnvVariables** - This one looks at the environment variable that was set in the flow triggering the subflow\n * **msg.IgnoreEnvVar** - This one is allows the logic to be driven by a message object property and thus can be set at runtime or earlier in the flow based on upstream logic\n\nFirst it checks the boolean value of the **OverrideEnvVariables** environment variable. This is by default false. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming the first was false, it checks the boolean value of the **msg.IgnoreEnvVar** value. This will evaluated as false if not populated, so sending false is unnecessary. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming both are false, then it can build the outputs based on the subflows environment variables. These can either be those set in the calling flow or they may be the default ones built into the subflow.\n\nRegardless of the method used to build the output, the node also removes the input message properties.\n\n\n\nmsg.IgnoreEnvVar"},{"id":"b88a898.82ea378","type":"GSheet","z":"76571db3.5c77c4","creds":"adb4e9b8.8beee8","method":"get","action":"","sheet":"","cells":"","name":"Read Input from GSheet Devices Tab","x":1630,"y":380,"wires":[["fba22e25.65453"]],"info":"Use the GSheet node to get the a set of rows from a google spreadsheet.\n\n# **Inputs**\n### **creds**\nThis is the name on the gauth configuration node. How to get the details is beyond the scope of what I am going to put into an individual node instance. Some details are at [node-red-contrib-google-sheets](https://flows.nodered.org/node/node-red-contrib-google-sheets)\n### **Method**\nIn this case using the get cells method to read a set of data.\n### **SpreadsheetID**\nUnused as the spreadsheet ID is passed in as part of the input msg, but if needed it would be the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n### **Cells**\nUnused as the requested cells are passed in as part of the input msg, but if it was being manually built for a static data source the format is made of of 3 parts with specific seperators:\n * **[Sheetname]** like Sheet1\n * **[upper left corner cell address]** like A1\n * **[lower right corner cell address]** like B2\n\nThe format is **[Sheetname]**!**[upper left corner cell address]**:**[lower right corner cell address]** giving an input like **Sheet1!A1:B2**\n "},{"id":"e29a81b2.1ce39","type":"GSheet","z":"76571db3.5c77c4","creds":"adb4e9b8.8beee8","method":"append","action":"","sheet":"","cells":"","name":"Test Append","x":2150,"y":380,"wires":[["97f6018.18521"]]},{"id":"fba22e25.65453","type":"function","z":"76571db3.5c77c4","name":"Hubitat Devices Addition Builder","func":"//Ref. TMS-000003\nlet entries = Object.entries(msg.keyvalues)\nlet cachedData = global.get(msg.globalsource)\nlet headerData = cachedData[0]\nlet index = 0\nlet resultingEntry = []\nlet found =false\nlet pushValue = \"\"\nfor (index = 0; index < headerData.length; index++)\n{\n    found = false\n    for (const [key, value] of entries) {\n        if (key === headerData[index])\n        {\n            found = true\n            pushValue = value\n        }\n        else if (\"DeviceID\" === headerData[index])\n        {\n            found = true\n            pushValue = msg.tempDeviceID\n        }\n        else if (\"Hub\" === headerData[index])\n        {\n            found = true\n            pushValue = \"Hubitat\"\n            }\n    }\n        if (found) {resultingEntry.push(pushValue)}\n        else{resultingEntry.push(\"\")}\n}\nnode.warn(msg.payload)\nnode.warn(resultingEntry)\nlet deviceTable = msg.payload\ndeviceTable.push(resultingEntry)\nglobal.set(msg.globalsource, deviceTable)\n    msg.payload = resultingEntry\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\nreturn msg","outputs":1,"noerr":0,"x":1930,"y":380,"wires":[["e29a81b2.1ce39"]]},{"id":"f94da7c0.f0bc38","type":"link out","z":"76571db3.5c77c4","name":"","links":["d62169eb.dde8f8"],"x":2415,"y":380,"wires":[]},{"id":"97f6018.18521","type":"change","z":"76571db3.5c77c4","name":"","rules":[{"t":"set","p":"flush","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":2310,"y":380,"wires":[["f94da7c0.f0bc38"]]},{"id":"a8a1ccb1.7e452","type":"link out","z":"76571db3.5c77c4","name":"Send to q gate","links":["d22206e8.27d2f8"],"x":640,"y":620,"wires":[],"l":true},{"id":"d22206e8.27d2f8","type":"link in","z":"76571db3.5c77c4","name":"Send to q gate","links":["a8a1ccb1.7e452"],"x":120,"y":660,"wires":[["4d110499.e1917c"]],"l":true},{"id":"c08f6ee.09fa99","type":"q-gate","z":"76571db3.5c77c4","name":"q-gate","controlTopic":"control","defaultState":"queueing","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","queueCmd":"queue","defaultCmd":"default","triggerCmd":"trigger","flushCmd":"flush","resetCmd":"reset","peekCmd":"peek","dropCmd":"drop","statusCmd":"status","maxQueueLength":"100","keepNewest":false,"qToggle":false,"persist":false,"x":730,"y":740,"wires":[["b56365bc.548fc8"]]},{"id":"feb3da4.735a328","type":"debug","z":"76571db3.5c77c4","name":"simulate rest of the process via debug output","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1610,"y":620,"wires":[]},{"id":"ae09e15c.264de","type":"delay","z":"76571db3.5c77c4","name":"1 ms delay passthrough","pauseType":"delay","timeout":"1","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1030,"y":800,"wires":[["b405e122.0874f","fa8a6d36.58a44"]]},{"id":"5b46f1f5.edb4b","type":"link out","z":"76571db3.5c77c4","name":"Send Control Message to QGate","links":["2a6a5f0.d0f93a2"],"x":1970,"y":840,"wires":[],"l":true},{"id":"2a6a5f0.d0f93a2","type":"link in","z":"76571db3.5c77c4","name":"Send Control Message to QGate","links":["5b46f1f5.edb4b"],"x":230,"y":780,"wires":[["d4c0af29.1a701"]],"l":true},{"id":"203524f4.8a830c","type":"function","z":"76571db3.5c77c4","name":"drop processed and get next","func":"//send a drop to drop the \nnode.send({topic: \"control\", payload: \"peek\"})\nnode.send({topic: \"control\", payload: \"drop\"})\nreturn","outputs":1,"noerr":0,"x":1660,"y":820,"wires":[["5b46f1f5.edb4b"]]},{"id":"38f046.56873fba","type":"link out","z":"76571db3.5c77c4","name":"Send to prep process","links":["7ef44abe.7427c4"],"x":660,"y":680,"wires":[],"l":true},{"id":"7ef44abe.7427c4","type":"link in","z":"76571db3.5c77c4","name":"Send to prep process","links":["38f046.56873fba","10d417bb.3b6e48"],"x":200,"y":860,"wires":[[]],"l":true},{"id":"347b8296.39929e","type":"change","z":"76571db3.5c77c4","name":"Increment flow.Counter","rules":[{"t":"set","p":"Counter","pt":"flow","to":"$flowContext(\"Counter\") + 1","tot":"jsonata"},{"t":"set","p":"payload","pt":"msg","to":"Counter","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":450,"y":1040,"wires":[["b8149789.61cea8"]]},{"id":"10a04cb5.4ea353","type":"change","z":"76571db3.5c77c4","name":"Decrement flow.Counter","rules":[{"t":"set","p":"Counter","pt":"flow","to":"$flowContext(\"Counter\") - 1","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1270,"y":940,"wires":[["b405e122.0874f"]]},{"id":"b405e122.0874f","type":"switch","z":"76571db3.5c77c4","name":"Any Prep Processes Pending","property":"Counter","propertyType":"flow","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1340,"y":840,"wires":[["203524f4.8a830c"],["bfa7068a.605328"]],"outputLabels":["No","Yes"]},{"id":"bfa7068a.605328","type":"function","z":"76571db3.5c77c4","name":"drop processed only","func":"//send a drop to drop the \nnode.send({topic: \"control\", payload: \"drop\"})\nreturn","outputs":1,"noerr":0,"x":1640,"y":860,"wires":[["5b46f1f5.edb4b"]]},{"id":"d4c0af29.1a701","type":"change","z":"76571db3.5c77c4","name":"Increment flow.QueueCounter","rules":[{"t":"set","p":"QueueCounter","pt":"flow","to":"$flowContext(\"QueueCounter\") + 1","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":510,"y":740,"wires":[["c08f6ee.09fa99"]]},{"id":"b56365bc.548fc8","type":"change","z":"76571db3.5c77c4","name":"Decrement flow.QueueCounter","rules":[{"t":"set","p":"QueueCounter","pt":"flow","to":"$flowContext(\"QueueCounter\") - 1","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":740,"wires":[["ae09e15c.264de"]]},{"id":"fa8a6d36.58a44","type":"switch","z":"76571db3.5c77c4","name":"Check if Queue is Empty","property":"QueueCounter","propertyType":"flow","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1230,"y":580,"wires":[["feb3da4.735a328"],["524c9c3b.f91a54","feb3da4.735a328"]],"outputLabels":["Yes","No"]},{"id":"524c9c3b.f91a54","type":"change","z":"76571db3.5c77c4","name":"Set Device = Reset","rules":[{"t":"set","p":"Device","pt":"msg","to":"Reset","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1530,"y":680,"wires":[["10d417bb.3b6e48"]]},{"id":"9fbecc6f.51135","type":"comment","z":"76571db3.5c77c4","name":"Device = Reset is sent to allow RBE to pass the same IOT Device if an input comes in after the queue has been emptied.","info":"","x":1560,"y":720,"wires":[]},{"id":"10d417bb.3b6e48","type":"link out","z":"76571db3.5c77c4","name":"Send to prep process","links":["7ef44abe.7427c4"],"x":1740,"y":680,"wires":[],"l":true},{"id":"6c4c4fc6.e15af","type":"switch","z":"76571db3.5c77c4","name":"Check if Device is a reset and thus no processing is needed","property":"Device","propertyType":"msg","rules":[{"t":"eq","v":"Reset","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":940,"y":860,"wires":[[],["347b8296.39929e"]],"outputLabels":["Yes","No"]},{"id":"b8149789.61cea8","type":"switch","z":"76571db3.5c77c4","name":"Which Tab","property":"globalsource","propertyType":"msg","rules":[{"t":"eq","v":"Devices","vt":"str"},{"t":"eq","v":"MeasurementTranslations","vt":"str"},{"t":"eq","v":"DataTranslations","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":710,"y":1060,"wires":[["2b9cd200.5d2a8e"],["d5c930dc.0b9ff"],["d5c930dc.0b9ff"]]},{"id":"2b9cd200.5d2a8e","type":"function","z":"76571db3.5c77c4","name":"Create spreadsheet range and put into msg.topic","func":"//Put inputs and read values into msg properties to be visible downstream\nmsg.sheet = msg.SpreadsheetID;\nmsg.tab = msg.Tab;\nmsg.cellstart = msg.ColStart + msg.MinRow;\nmsg.cellend = msg.ColEnd + msg.MaxRow;\nmsg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\nmsg.topic = msg.targetrange\ndelete msg.Tab\ndelete msg.SpreadsheetID\ndelete msg.ColEnd\ndelete msg.MaxRow\ndelete msg.IgnoreEnvVar\ndelete msg.tab\ndelete msg.cellstart\ndelete msg.cellend\ndelete msg.targetrange\nreturn msg;","outputs":1,"noerr":0,"x":1000,"y":1040,"wires":[["562da98b.f51eb8"]],"info":"This node sets up the inputs to the GSheet node.\nThe outputs that make up those inputs are:\n - msg.sheet -the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n - msg.topic - the combination of spreadsheet tab and cell range\n## Note\nThere are 2 very similar booleans evaluated by this node. They are:\n * **OverrideEnvVariables** - This one looks at the environment variable that was set in the flow triggering the subflow\n * **msg.IgnoreEnvVar** - This one is allows the logic to be driven by a message object property and thus can be set at runtime or earlier in the flow based on upstream logic\n\nFirst it checks the boolean value of the **OverrideEnvVariables** environment variable. This is by default false. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming the first was false, it checks the boolean value of the **msg.IgnoreEnvVar** value. This will evaluated as false if not populated, so sending false is unnecessary. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming both are false, then it can build the outputs based on the subflows environment variables. These can either be those set in the calling flow or they may be the default ones built into the subflow.\n\nRegardless of the method used to build the output, the node also removes the input message properties.\n\n\n\nmsg.IgnoreEnvVar"},{"id":"562da98b.f51eb8","type":"GSheet","z":"76571db3.5c77c4","creds":"adb4e9b8.8beee8","method":"get","action":"","sheet":"","cells":"","name":"Read Input from GSheet Devices Tab","x":1350,"y":1040,"wires":[["445a9874.9362f8","af0c5920.2c3e88"]],"info":"Use the GSheet node to get the a set of rows from a google spreadsheet.\n\n# **Inputs**\n### **creds**\nThis is the name on the gauth configuration node. How to get the details is beyond the scope of what I am going to put into an individual node instance. Some details are at [node-red-contrib-google-sheets](https://flows.nodered.org/node/node-red-contrib-google-sheets)\n### **Method**\nIn this case using the get cells method to read a set of data.\n### **SpreadsheetID**\nUnused as the spreadsheet ID is passed in as part of the input msg, but if needed it would be the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n### **Cells**\nUnused as the requested cells are passed in as part of the input msg, but if it was being manually built for a static data source the format is made of of 3 parts with specific seperators:\n * **[Sheetname]** like Sheet1\n * **[upper left corner cell address]** like A1\n * **[lower right corner cell address]** like B2\n\nThe format is **[Sheetname]**!**[upper left corner cell address]**:**[lower right corner cell address]** giving an input like **Sheet1!A1:B2**\n "},{"id":"445a9874.9362f8","type":"function","z":"76571db3.5c77c4","name":"Hubitat Devices Addition Builder","func":"//Ref. TMS-000003\nlet entries = Object.entries(msg.keyvalues)\nlet cachedData = global.get(msg.globalsource)\n if (cachedData === undefined) {\n    cachedData = msg.payload\n  }\n\n//node.warn(cachedData)\nlet headerData = cachedData[0]\nlet index = 0\nlet resultingEntry = []\nlet found =false\nlet pushValue = \"\"\nfor (index = 0; index < headerData.length; index++)\n{\n    found = false\n    for (const [key, value] of entries) {\n        if (key === headerData[index])\n        {\n            found = true\n            pushValue = value\n        }\n        else if (\"DeviceID\" === headerData[index])\n        {\n            found = true\n            pushValue = msg.tempDeviceID\n        }\n        else if (\"Hub\" === headerData[index])\n        {\n            found = true\n            pushValue = \"Hubitat\"\n            }\n    }\n        if (found) {resultingEntry.push(pushValue)}\n        else{resultingEntry.push(\"\")}\n}\n//node.warn(msg.payload)\n//node.warn(resultingEntry)\nlet deviceTable = msg.payload\ndeviceTable.push(resultingEntry)\nglobal.set(msg.globalsource, deviceTable)\n    msg.payload = resultingEntry\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\nreturn msg","outputs":1,"noerr":0,"x":1650,"y":1040,"wires":[["c205e7a1.23b8f8"]]},{"id":"c205e7a1.23b8f8","type":"GSheet","z":"76571db3.5c77c4","creds":"adb4e9b8.8beee8","method":"append","action":"","sheet":"","cells":"","name":"Test Append","x":1870,"y":1040,"wires":[["c383b28b.f598d"]]},{"id":"c383b28b.f598d","type":"change","z":"76571db3.5c77c4","name":"","rules":[{"t":"set","p":"flush","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":2030,"y":1040,"wires":[["10a04cb5.4ea353"]]},{"id":"4d110499.e1917c","type":"delay","z":"76571db3.5c77c4","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":280,"y":700,"wires":[["d4c0af29.1a701"]]},{"id":"f528dcf7.7f329","type":"rbe","z":"76571db3.5c77c4","name":"Limit output to 1 msg per keyvalues.Device","func":"rbe","gap":"","start":"","inout":"out","property":"keyvalues.Device","x":510,"y":860,"wires":[["6c4c4fc6.e15af"]]},{"id":"d5c930dc.0b9ff","type":"debug","z":"76571db3.5c77c4","name":"Other tab","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":900,"y":1120,"wires":[]},{"id":"af0c5920.2c3e88","type":"debug","z":"76571db3.5c77c4","name":"which tab","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1380,"y":1180,"wires":[]},{"id":"f687ed18.8eeb3","type":"debug","z":"76571db3.5c77c4","name":"prep after RBE","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":800,"y":820,"wires":[]},{"id":"60678674.77d588","type":"debug","z":"76571db3.5c77c4","name":"Increment Counter","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":710,"y":1000,"wires":[]},{"id":"167cf702.233109","type":"function","z":"76571db3.5c77c4","name":"Db Use input to lookup info Before adding error logic ","func":"//Ref. TMS-000001\n\n//if(msg.exportableresults.DeviceName !== \"Switch_Ikea\") {return}\n\n\n\n//1 Get must have items: searchKeys, searchValues, searchResultKeys, cachedSearch, cacheTime\n//debugger\nlet searchKeys = Object.keys(msg.keyvalues)\nlet searchValues = Object.values(msg.keyvalues)\nlet searchResultKeys = Object.keys(msg.searchfor)\nlet cachedSearch = global.get(\"LastSearch\")\nlet cacheTime = new Date().getTime()\n//2 create working variables searchKeyIndices, searchResultKeysIndices, index, cacheKey\nlet searchResultKeysIndices = []\nlet index\nlet cacheObject\n//3 build the cache key which is essentially the concatenation of key+value+nextkey+nextvalue+.....etc\ncacheObject = BuildCacheObject(searchKeys, searchValues, searchResultKeys)\n//4\n/*\n * 4.1 t/f cached result is usable\n    *  4.1.true then t/f does it meet criteria\n        * 4.1.true.true\ttrue msg.searchfor = cachedSearch.searchfor\n        * 4.1.true.false do the common lookup\n    *   4.1.false  do the common lookup\n    */\n//4.1\nif (cachedSearch !== undefined)\n{\n    //4.1.true\n    if ((cachedSearch.query == cacheObject.query) && (cachedSearch.time > cacheObject.time - 5000))\n    {\n        //4.1.true.true\n        msg.searchfor = cachedSearch.searchfor\n        return [msg, null, null]\n    } //if ((cachedSearch.query == cacheObject.query) && (cachedSearch.time > cacheObject.time - 5000))\n    //4.1.true.false\n    else\n    {\n        //4.1.true.false\n        lookupResults = CommonLookup(msg, searchKeys, searchResultKeys, searchValues, global.get(msg.globalsource), cacheObject)\n        //return results from the node on 1 of the 3 outputs\n        if (lookupResults[0] !== null)\n        {\n            return [lookupResults[0], null, null]\n        } //if (lookupResults[0] !== null)\n        else if (lookupResults[1] !== null)\n        {\n            return [null, lookupResults[1], null]\n        } //else if (lookupResults[1] !== null)\n        else\n        {\n            return [null, null, lookupResults[2]]\n        } //else if (lookupResults[1] !== null) else\n    } //if ((cachedSearch.query == cacheObject.query) && (cachedSearch.time > cacheObject.time - 5000)) else\n} //if (cachedSearch !== undefined)\n//4.1.false\nelse\n{\n    //4.1.false\n    lookupResults = CommonLookup(msg, searchKeys, searchResultKeys, searchValues, global.get(msg.globalsource), cacheObject)\n    //return results from the node on 1 of the 3 outputs\n    if (lookupResults[0] !== null)\n    {\n        return [lookupResults[0], null, null]\n    } //if (lookupResults[0] !== null)\n    else if (lookupResults[1] !== null)\n    {\n        return [null, lookupResults[1], null]\n    } //else if (lookupResults[1] !== null)\n    else\n    {\n        return [null, null, lookupResults[2]]\n    } //else if (lookupResults[1] !== null) else\n} //if (cachedSearch !== undefined) else\nreturn\n\nfunction BuildCacheObject(searchKeysArray, SearchValuesArray, SearchResultKeysArray) {\n    //3 build the cache key which is essentially the concatenation of key+value+nextkey+nextvalue+.....etc\n    let newCacheKey =\"\"\n    for (index = 0; index < searchKeysArray.length; index++)\n    {\n        newCacheKey = newCacheKey + searchKeysArray[index] + SearchValuesArray[index]\n    } //for (index = 0; index < searchKeysArray.length; index++)\n    //add all fields that will be looked for into the cache key\n    for (index = 0; index < SearchResultKeysArray.length; index++)\n    {\n        newCacheKey = newCacheKey + SearchResultKeysArray[index]\n    } //for (index = 0; index < SearchResultKeysArray.length; index++)\n    //combine the cache key and the cache time into a single object that can be compared with the cached last search\n    let createdCacheObject = \n    {\n        query: newCacheKey,\n        time: cacheTime\n    }\n    return createdCacheObject\n}\nfunction CommonLookup(workingMsg, keysForSearchColumn, keysForResultColumn, valuesSearchedFor, requestedDataTable, passedCacheObject) {\n    let searchKeyIndices = []\n    let searchResultKeysIndices = []\n    let outerIndex\n    let innerLoopCounter\n    let innerIndex\n    let index\n    if (requestedDataTable !== undefined)\n    {\n        // iterate through all search keys.\n        //outer index is the place along the array of search keys\n        for (outerIndex = 0; outerIndex < keysForSearchColumn.length; outerIndex++)\n        {\n            //inner index is the place along the first row of data\n            //The innerLoopCounter must be reset each time a new key is being looked for\n            innerLoopCounter = 0\n            for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n            {\n                //these 2 loops will compare every entry in the top row of the data table to every entry in the array of search keys,\n                if (requestedDataTable[0][innerIndex] == keysForSearchColumn[outerIndex])\n                {\n                    //when they match push the column number on to the array that has just indices for the search keys\n                    searchKeyIndices.push(innerIndex)\n                    //break is used to stop comparing as once the column has been found the remaining aren't relevant\n                    //////////////////////////////////////////////////////////////////////////break may be a problem. Maybe swap inner and outer arrays and then do some if then about getting through the whole data headers without finding. Right now it only looks for 1 failure\n                    break\n                } //if (requestedDataTable[0][innerIndex] == keysForSearchColumn[outerIndex])\n                else\n                {\n                    //when they don't match, then this means there is a search key that does not match any header.\n                    //When properly configured this should not happen, but proper configuration cannot be guaranteed\n                    //this is accumulating how many times the search key did not match one of the data table headers\n                    innerLoopCounter++\n                    //Error messaging should only happen if the search key has been compared with all of the headers\n                    //requestedDataTable[0].length gives the total number of data headers (columns of the spreadsheet)\n                    if (requestedDataTable[0].length == innerLoopCounter)\n                    {\n                        //populate error \n                        //put some details on this configuration into the msg to be output\n                        workingMsg.error = \"Key with value \\\"\" + keysForSearchColumn[outerIndex] + \"\\\" not found amongst the \" + (requestedDataTable[0].length + 1) + \" entries, which include \" + requestedDataTable[0]\n                        //either create and populate the error count at 1 or increment it if it already exists\n                        if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n                        {\n                                workingMsg.searchErrorCount++\n                        }\n                        else\n                        {\n                            workingMsg.searchErrorCount = 1\n                        }\n                        //this retry is in case the column was added to the google sheet since it was last loaded into node red\n                        if (workingMsg.searchErrorCount > 1)\n                        {\n                            //return the error on the bottom because with a count of 2 that means reloading has already been tried\n                            return [null, null, workingMsg]\n                        }\n                        else\n                        {\n                            //return the error on the middle there is an error output,\n                            return [null, workingMsg, null]\n                        }\n                    } //if (requestedDataTable[0].length == innerLoopCounter)\n                } //if (requestedDataTable[0][innerIndex] == keysForSearchColumn[outerIndex]) else\n            } //for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n        } //for (outerIndex = 0; outerIndex < keysForSearchColumn.length; outerIndex++)\n        //if this point is reached, searchKeyIndices has been populated\n        // iterate through all search result keys.\n        //outer index is the place along the array of search keys \n        for (outerIndex = 0; outerIndex < keysForResultColumn.length; outerIndex++)\n        {\n            //inner index is the place along the first row of data\n            //The innerLoopCounter must be reset each time a new key is being looked for\n            innerLoopCounter = 0\n            for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n            {\n                //these 2 loops will compare every entry in the top row of the data table to every entry in the array of search keys,\n                if (requestedDataTable[0][innerIndex] == keysForResultColumn[outerIndex])\n                {\n                    //when they match push the column number on to the array that has just indices for the search keys\n                    searchResultKeysIndices.push(innerIndex)\n                    //break is used to stop comparing as once the column has been found the remaining aren't relevant\n                    break\n                } //if (requestedDataTable[0][innerIndex] == keysForResultColumn[outerIndex])\n                else\n                {\n                    //when they don't match, then this means there is a search key that does not match any header.\n                    //When properly configured this should not happen, but proper configuration cannot be guaranteed\n                    innerLoopCounter++\n                    //Error messaging should only happen if the search key has been compared with all of the headers\n                    //requestedDataTable[0].length gives the total number of data headers (columns of the spreadsheet)\n                    if (requestedDataTable[0].length == innerLoopCounter)\n                    {\n                        //populate error \n                        //put some details on this configuration into the msg to be output\n                        workingMsg.error = \"Key with value \\\"\" + keysForSearchColumn[outerIndex] + \"\\\" not found amongst the \" + (requestedDataTable[0].length + 1) + \" entries, which include \" + requestedDataTable[0]\n                        //either create and populate the error count at 1 or increment it if it already exists\n                        if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n                        {\n                            workingMsg.searchErrorCount++\n                        } //if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n                        else\n                        {\n                            workingMsg.searchErrorCount = 1\n                        } //if ( workingMsg.hasOwnProperty(\"searchErrorCount\")) else\n                        //this retry is in case the column was added to the google sheet since it was last loaded into node red\n                        if (workingMsg.searchErrorCount > 1)\n                        {\n                            //return the error on the bottom because with a count of 2 that means reloading has already been tried\n                            return [null, null, workingMsg]\n                        } //if (workingMsg.searchErrorCount > 1)\n                        else\n                        {\n                            //return the error on the middle there is an error output,\n                            return [null, workingMsg, null]\n                        } //if (workingMsg.searchErrorCount > 1) else\n                    } //if (requestedDataTable[0].length == innerLoopCounter)\n                } //if (requestedDataTable[0][innerIndex] == keysForResultColumn[outerIndex]) else\n            } //for (innerIndex = 0; innerIndex < requestedDataTable[0].length; innerIndex++)\n        } //for (outerIndex = 0; outerIndex < keysForResultColumn.length; outerIndex++)\n        //if this point is reached, both searchKeyIndices and searchResultKeysIndices have been populated\n        //loop through all search keys, 1 index at a time and filter to a row that has the desired data in the desired column\n        let result = []\n        let pushable\n        pushable = false\n        for (outerIndex = 0; outerIndex < requestedDataTable.length; outerIndex++)\n        {\n            for (innerIndex = 0; innerIndex < searchKeyIndices.length; innerIndex++)\n            {\n                if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex])\n                {\n                    pushable = true\n                } //if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex])\n                else\n                {\n                    pushable = false\n                    break\n                } //if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex]) else\n            } //for (innerIndex = 0; innerIndex < searchKeyIndices.length; innerIndex++)\n            if (pushable)\n            {\n                result.push(requestedDataTable[outerIndex])\n            } //if (pushable)\n    \n    } //for (outerIndex = 0; outerIndex < requestedDataTable.length; outerIndex++)\n        //if this point is reached then there is a filtered table\n        //debugger\n        if (result.length === 0)\n        {\n            workingMsg.error = \"After filtering no data rows were left.\"\n            //either create and populate the error count at 1 or increment it if it already exists\n            if ( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n            {\n                workingMsg.searchErrorCount++\n            } //( workingMsg.hasOwnProperty(\"searchErrorCount\"))\n            else\n            {\n                workingMsg.searchErrorCount = 1\n            } //( workingMsg.hasOwnProperty(\"searchErrorCount\")) else\n            //return the error on the middle there is an error output,\n            //this retry is in case the column was added to the google sheet since it was last loaded into node red\n            if (workingMsg.searchErrorCount > 1)\n            {\n                //return the error on the bottom because with a count of 2 that means reloading has already been tried\n                return [null, null, workingMsg]\n            } //if (workingMsg.searchErrorCount > 1)\n            else\n            {\n                //return the error on the middle there is an error output,\n                return [null, workingMsg, null]\n            } //if (workingMsg.searchErrorCount > 1) else\n        } //if (result.length === 0)\n        else if (result.length > 1)\n        {\n            //do the warning that multiple were found but will take the first\n            node.warn(\"Multiple rows were found that matched the search criteria. Results are from the first row that was found and matched.\")\n        } //else if (result.length > 1)\n        //look up the data\n        for (index = 0; index < searchResultKeysIndices.length; index++)\n        {\n            //workingMsg.searchfor.keysForSearchColumn[index] = result[0][searchResultKeysIndices]\n            // the almost working version\n            workingMsg.searchfor[keysForResultColumn[index]] = result[0][searchResultKeysIndices[index]]\n        } //for (index = 0; index < searchResultKeysIndices.length; index++)\n        //if this point is reached then work workingMsg contains complete info\n        //build and save the LastSearch obect\n        passedCacheObject.searchfor = workingMsg.searchfor\n        global.set(\"LastSearch\", passedCacheObject)\n        return [workingMsg, null, null]\n    } //if (requestedDataTable !== undefined)\n    else\n    {\n        //return on second output to trigger population of global that feeds datatable\n        //put some details on this configuration into the msg to be output\n        workingMsg.error = \"The data normally loaded from google sheet was not loaded.\"\n        //either create and populate the error count at 1 or increment it if it already exists\n        if (workingMsg.hasOwnProperty('searchErrorCount'))\n        {\n            workingMsg.searchErrorCount++\n        } //if (workingMsg.hasOwnProperty('searchErrorCount'))\n        else\n        {\n            workingMsg.searchErrorCount = 1\n        } //if (workingMsg.hasOwnProperty('searchErrorCount')) else\n        //return the error on the middle there is an error output,\n        //this retry is in case the column was added to the google sheet since it was last loaded into node red\n        if (workingMsg.searchErrorCount > 1)\n        {\n            //return the error on the bottom because with a count of 2 that means reloading has already been tried\n            return [null, null, workingMsg]\n        } //if (workingMsg.searchErrorCount > 1)\n        else\n        {\n            //return the error on the middle there is an error output,\n            return [null, workingMsg, null]\n        } //if (workingMsg.searchErrorCount > 1) else\n    } //if (requestedDataTable !== undefined) else\n}","outputs":3,"noerr":0,"x":300,"y":40,"wires":[[],[],[]],"outputLabels":["Value Found","Error but try reloading from data source","Error despite having tried to reload from data source"],"info":"# **Conceptual Explanation**\nThis node is designed to use a 2-D array of data loaded from a google sheeet to lookup desired data. The data is arrayed with the first row being column headers describing the data in those columns in subsequent rows.\n## **inputs**\n### globalsource \nThe name of the global variable holding the table of data\n### msg.keyvalues\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row.\n### msg.searchfor\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. The value enters the node empty.\n## **outputs**\n### Output1: Value Found \nThis ouput is used when the node has successfully identified the requested data. That data is placed into the value portions of the key value pairs that made up the msg.searchfor input\n### Output 2: Error but try reloading from data source\nThis output is used when either the global variable to contain the data table either does no exist or does not contain a row with all of the requested search criteria. Normally it is used to trigger loading the table from Google sheets under the expectation that either this is the first time a lookup has been tried an the data had not yet been cached in the global variable or potentially the data in the cache has become stale and reloading from the Google sheet will add a row that will match the requested search criteria.\n### Output 3: Error despite having tried to reload from data source\nThis output is used when either the global variable to contain the data table either does no exist or does not contain a row with all of the requested search criteria and at least 1 attempt has already been made to reload the global vairable cache. This is effectively a notification of non-recoverable lookup failure."},{"id":"a75403a2.f73fb","type":"catch","z":"76571db3.5c77c4","name":"","scope":["a1684289.60ffe"],"uncaught":false,"x":130,"y":440,"wires":[["19517b27.eec035"]]},{"id":"2d81353a.25b10a","type":"debug","z":"76571db3.5c77c4","name":"Otherwise Failure","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":470,"y":540,"wires":[]},{"id":"19517b27.eec035","type":"switch","z":"76571db3.5c77c4","name":"","property":"error.message","propertyType":"msg","rules":[{"t":"eq","v":"Reload from Google Sheet","vt":"str"},{"t":"eq","v":"Stop Loop","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":290,"y":460,"wires":[["bd656abb.85fe58","a7ebddf3.84125"],["472f76e8.b715a8"],[]]},{"id":"472f76e8.b715a8","type":"debug","z":"76571db3.5c77c4","name":"Stop Loop Failure","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":470,"y":500,"wires":[]},{"id":"a7ebddf3.84125","type":"debug","z":"76571db3.5c77c4","name":"Load Cache from Spreadseet Failure","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":530,"y":460,"wires":[]},{"id":"bd656abb.85fe58","type":"link out","z":"76571db3.5c77c4","name":"Load Cache from Spreadsheet","links":["d0155195.67c21"],"x":550,"y":420,"wires":[],"l":true},{"id":"d0155195.67c21","type":"link in","z":"76571db3.5c77c4","name":"Load Cache from Spreadsheet","links":["bd656abb.85fe58"],"x":250,"y":1500,"wires":[["c353955c.83de58","8fe7ed53.4f9fc"]],"l":true},{"id":"c353955c.83de58","type":"change","z":"76571db3.5c77c4","name":"Increment flow.QueueCounter","rules":[{"t":"set","p":"QueueCounter","pt":"flow","to":"$flowContext(\"QueueCounter\") + 1","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":1400,"wires":[["16039a0b.74ab06","3e245f36.fcf75"]]},{"id":"16039a0b.74ab06","type":"q-gate","z":"76571db3.5c77c4","name":"q-gate","controlTopic":"control","defaultState":"queueing","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","queueCmd":"queue","defaultCmd":"default","triggerCmd":"trigger","flushCmd":"flush","resetCmd":"reset","peekCmd":"peek","dropCmd":"drop","statusCmd":"status","maxQueueLength":"100","keepNewest":false,"qToggle":false,"persist":false,"x":790,"y":1460,"wires":[["308ba7cc.86f8b8"]]},{"id":"308ba7cc.86f8b8","type":"change","z":"76571db3.5c77c4","name":"Decrement flow.QueueCounter","rules":[{"t":"set","p":"QueueCounter","pt":"flow","to":"$flowContext(\"QueueCounter\") - 1","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":990,"y":1400,"wires":[["c409172c.48af28"]]},{"id":"8fe7ed53.4f9fc","type":"rbe","z":"76571db3.5c77c4","name":"Limit output to 1 msg per error.message","func":"rbe","gap":"","start":"","inout":"out","property":"error.message","x":600,"y":1620,"wires":[["8aec2a6b.759298"]]},{"id":"8aec2a6b.759298","type":"switch","z":"76571db3.5c77c4","name":"Check if Device is a reset and thus no processing is needed","property":"error.message","propertyType":"msg","rules":[{"t":"eq","v":"Reset","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":660,"y":1660,"wires":[[],["e2195bce.432348"]],"outputLabels":["Yes","No"]},{"id":"e2195bce.432348","type":"change","z":"76571db3.5c77c4","name":"Increment flow.LCFSCounter","rules":[{"t":"set","p":"LCFSCounter","pt":"flow","to":"$flowContext(\"LCFSCounter\") + 1","tot":"jsonata"},{"t":"set","p":"payload","pt":"msg","to":"LCFSCounter","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":1040,"y":1660,"wires":[["5c37366a.28afd8"]]},{"id":"5c37366a.28afd8","type":"function","z":"76571db3.5c77c4","name":"Create spreadsheet range and put into msg.topic","func":"//Put inputs and read values into msg properties to be visible downstream\nmsg.sheet = msg.SpreadsheetID;\nmsg.tab = msg.Tab;\nmsg.cellstart = msg.ColStart + msg.MinRow;\nmsg.cellend = msg.ColEnd + msg.MaxRow;\nmsg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\nmsg.topic = msg.targetrange\ndelete msg.Tab\ndelete msg.SpreadsheetID\ndelete msg.ColEnd\ndelete msg.MaxRow\ndelete msg.IgnoreEnvVar\ndelete msg.tab\ndelete msg.cellstart\ndelete msg.cellend\ndelete msg.targetrange\nreturn msg;","outputs":1,"noerr":0,"x":1100,"y":1700,"wires":[["92d7505a.5feea"]],"info":"This node sets up the inputs to the GSheet node.\nThe outputs that make up those inputs are:\n - msg.sheet -the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n - msg.topic - the combination of spreadsheet tab and cell range\n## Note\nThere are 2 very similar booleans evaluated by this node. They are:\n * **OverrideEnvVariables** - This one looks at the environment variable that was set in the flow triggering the subflow\n * **msg.IgnoreEnvVar** - This one is allows the logic to be driven by a message object property and thus can be set at runtime or earlier in the flow based on upstream logic\n\nFirst it checks the boolean value of the **OverrideEnvVariables** environment variable. This is by default false. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming the first was false, it checks the boolean value of the **msg.IgnoreEnvVar** value. This will evaluated as false if not populated, so sending false is unnecessary. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming both are false, then it can build the outputs based on the subflows environment variables. These can either be those set in the calling flow or they may be the default ones built into the subflow.\n\nRegardless of the method used to build the output, the node also removes the input message properties.\n\n\n\nmsg.IgnoreEnvVar"},{"id":"92d7505a.5feea","type":"GSheet","z":"76571db3.5c77c4","creds":"adb4e9b8.8beee8","method":"get","action":"","sheet":"","cells":"","name":"Read Input from GSheet Devices Tab","x":1070,"y":1740,"wires":[["59176330.95ad2c"]],"info":"Use the GSheet node to get the a set of rows from a google spreadsheet.\n\n# **Inputs**\n### **creds**\nThis is the name on the gauth configuration node. How to get the details is beyond the scope of what I am going to put into an individual node instance. Some details are at [node-red-contrib-google-sheets](https://flows.nodered.org/node/node-red-contrib-google-sheets)\n### **Method**\nIn this case using the get cells method to read a set of data.\n### **SpreadsheetID**\nUnused as the spreadsheet ID is passed in as part of the input msg, but if needed it would be the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n### **Cells**\nUnused as the requested cells are passed in as part of the input msg, but if it was being manually built for a static data source the format is made of of 3 parts with specific seperators:\n * **[Sheetname]** like Sheet1\n * **[upper left corner cell address]** like A1\n * **[lower right corner cell address]** like B2\n\nThe format is **[Sheetname]**!**[upper left corner cell address]**:**[lower right corner cell address]** giving an input like **Sheet1!A1:B2**\n "},{"id":"59176330.95ad2c","type":"function","z":"76571db3.5c77c4","name":"Save table data to Global Context Variable Cache","func":"global.set(msg.globalsource,msg.payload)\nnode.warn(msg.globalsource+\" table updated into global context variable cache.\")\nnode.warn(flow.get(\"LCFSCounter\"))\nreturn msg","outputs":1,"noerr":0,"x":1110,"y":1780,"wires":[["b6e9be04.87d08"]]},{"id":"ede1da4c.5537b8","type":"debug","z":"76571db3.5c77c4","name":"debug stepper","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1400,"y":1380,"wires":[]},{"id":"b6e9be04.87d08","type":"change","z":"76571db3.5c77c4","name":"Decrement flow.LCFSCounter","rules":[{"t":"set","p":"LCFSCounter","pt":"flow","to":"$flowContext(\"LCFSCounter\") - 1","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1050,"y":1820,"wires":[["820817b2.7eb488"]]},{"id":"820817b2.7eb488","type":"switch","z":"76571db3.5c77c4","name":"Any Prep Processes Pending","property":"LCFSCounter","propertyType":"flow","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1040,"y":1860,"wires":[["db5b7726.69c348"],["ca71cbfd.567e68"]],"outputLabels":["No","Yes"]},{"id":"ca71cbfd.567e68","type":"debug","z":"76571db3.5c77c4","name":"This node should never catch pending","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1330,"y":1900,"wires":[]},{"id":"db5b7726.69c348","type":"function","z":"76571db3.5c77c4","name":"flush Qgate","func":"node.send({topic: \"control\", payload: \"flush\"})\nreturn","outputs":1,"noerr":0,"x":1270,"y":1860,"wires":[["e65441e4.82a18"]]},{"id":"fc3bb3da.25d39","type":"change","z":"76571db3.5c77c4","name":"Set error.message = Reset","rules":[{"t":"set","p":"error.message","pt":"msg","to":"Reset","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":700,"y":1580,"wires":[["8fe7ed53.4f9fc"]]},{"id":"a1ec750d.775878","type":"link in","z":"76571db3.5c77c4","name":"","links":["7fbfc645.509cd8"],"x":1450,"y":2140,"wires":[[]],"l":true},{"id":"7fbfc645.509cd8","type":"link out","z":"76571db3.5c77c4","name":"","links":["a1ec750d.775878"],"x":1240,"y":2140,"wires":[],"l":true},{"id":"6bdff76b.ac7628","type":"link in","z":"76571db3.5c77c4","name":"Global loaded from spreadsheet","links":["e65441e4.82a18"],"x":250,"y":1540,"wires":[["16039a0b.74ab06"]],"l":true},{"id":"e65441e4.82a18","type":"link out","z":"76571db3.5c77c4","name":"Global loaded from spreadsheet","links":["6bdff76b.ac7628"],"x":1550,"y":1860,"wires":[],"l":true},{"id":"333ff57e.34ca1a","type":"config","z":"76571db3.5c77c4","name":"","properties":[{"p":"Counter","pt":"flow","to":"0","tot":"num"},{"p":"LCFSCounter","pt":"flow","to":"0","tot":"num"}],"active":true,"x":170,"y":1440,"wires":[]},{"id":"61309769.5561f8","type":"change","z":"76571db3.5c77c4","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1575,"y":1480,"wires":[[]],"l":false},{"id":"c409172c.48af28","type":"switch","z":"76571db3.5c77c4","name":"Check if Queue is Empty","property":"QueueCounter","propertyType":"flow","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1310,"y":1460,"wires":[["fc3bb3da.25d39"],[]],"outputLabels":["Yes","No"]},{"id":"3e245f36.fcf75","type":"function","z":"76571db3.5c77c4","name":"","func":"node.warn(flow.get(\"Counter\"))\nreturn msg;","outputs":1,"noerr":0,"x":1140,"y":1300,"wires":[["ede1da4c.5537b8"]]},{"id":"ac8058d4.b6e428","type":"function","z":"5b8974a.7ce288c","name":"Splitting Preprocessor","func":"/*\n * Main function node code \n * \n */\n//Check if there is any data. If not, stop processing. At the time this was created, the trackData sent from a Hubitat Elevation device node was always null\nif (msg.payload.value === null) {\n    return null;\n}\n//delete the currentValue portion of the object since it is deprecated\ndelete msg.payload.currentValue\n//initial call into the recursive function\nhandlemsg(msg)\n//send nothing from main code\nreturn\n\n/*\n * Main recursive function code\n *\n */\n\nfunction handlemsg(msg) {\n    //The evaluation part of this switch/case statement determines which type of entity is in the value\n    //  the key idea is that once the value is an atomic item (number, string, bool) then the message should be sent out\n    //  of the node to downstream, but if the value is a splittable, then it should be split into multiple messages. These\n    //  messages are then evaulated individually. They in turn are either found to have atomic entries in the value or have\n    //  values that are themselves splittable.\n    //  For example:\n    //  JSON - each key value pair will be used to create a new msg. The msg.payload.name will be changed to add \":\" and the key\n    //          from the key value pair. The msg.payload.value will become the value from the key value pair\n    //  Array - TBAdded\n    //  Object - TBAdded\n    switch (typeofhubitatvalue(msg.payload.value, \"msg.payload.value\")) {\n        case \"number\":\n        case \"bigint\":\n            //numbers are an atomic type of value and should be sent to downstream nodes\n            msg.payload.dataType = \"Number\"\n            //send the version of the msg with an atomic value to downstream nodes\n            node.send(msg)\n            //do nothing more once msg has been sent\n            break;\n        case \"boolean\":\n            //Booleans are an atomic type of value and should be sent to downstream nodes\n            msg.payload.dataType = \"Boolean\"\n            //send the version of the msg with an atomic value to downstream nodes\n            node.send(msg)\n            //do nothing more once msg has been sent\n            break;\n        case \"string\":\n            //Strings are an atomic type of value and should be sent to downstream nodes\n            msg.payload.dataType = \"String\"\n            //send the version of the msg with an atomic value to downstream nodes\n            node.send(msg)\n            //do nothing more once msg has been sent\n            break;\n        case \"unsplittable array\":\n            //This case is where the item is an array, but with only a single entry. The idea is to move that single\n            //  value out of the array and into the value natively and then to call the recursive function to evaluate\n            //  what type of item it now is and then process (split or send or extract) appropriately\n            msg.payload.value = msg.payload.value[0]\n            handlemsg(msg)\n            break;\n        case \"splittable JSON\":\n            //This is for cases where the JSON is in the form of key:value where there is at least 1 pair\n            //  Examples of \"valid\" JSON that would not be coming to this case would be {} or 100\n            splitJSON(msg)\n            break;\n        case \"splittable array\":\n            //This is for cases where the Array is in the form [\"A\",\"B\",\"C\"] where there is are at least 2 members\n            //  SplitArray function not yet built. TBD\n            splitArray(msg)\n            break;\n        case \"unsplittable JSON\":\n            //This is for handling \"valid\" JSON that does not have key:value pairs.\n            //  Examples of \"valid\" JSON that are handed here are {} or 100 or \"100\"\n            //  This case either treats it as a string (no changes made) or a number where a number in\n            //  a string like \"100\" is changed into an actual number like 100\n\n            //by checking if NaN, if it is a number 100 or \"100\", the ++ followed by -- changes it to a number 100\n            //  without changing its actual value\n            if (isNaN(msg.payload.value)) { } else {\n                ++msg.payload.value;\n                --msg.payload.value;\n             }\n            //Sets the data type for downstream since the incoming message could have been a variety of types\n            //  before JSON, object or array was split\n            msg.payload.dataType = typeof (msg.payload.value)\n            //send the version of the msg with an atomic value to downstream nodes (could probably just recursively call\n            //  handlemsg, but I can't identify a circumstance where that would give a different result to downstream,\n            //  but this would be a place to investigate if downstream results are unexpected.)\n            node.send(msg)\n            break\n        case \"object\":\n            //This is for handling an object. It then calls splitObj to create multiple msgs with the object keys into the names\n            //  and the values from those keys moved into the value of the new object.\n            splitObj(msg)\n            break\n        default:\n            //This is just in case no valid process is found by the typeofhubitatvalue function.\n            //  If you encounter this then you will either need to investigate the function or contact tmichael in\n            //  Hubitat discourse forums https://community.hubitat.com/\n            return\n    }\n}\n\n/*\n * This function is used by the Main recursive function (handlemsg) to decide whether to send the msg on as\n *  the msg.payload.value is atomic or if it needs to split the value into multiple msgs\n *\n */\nfunction typeofhubitatvalue(value, source = \"\") {\n    switch (typeof (value)) {\n        case \"number\":\n            //atomic just return the result of typeof\n            return \"number\"\n            break;\n        case \"bigint\":\n            //atomic just return the result of typeof\n            return \"bigint\"\n            break;\n        case \"boolean\":\n            //atomic just return the result of typeof\n            return \"boolean\"\n            break;\n        case \"string\":\n            //most splittable values are encoded strictly as text and so may be identified as a string\n\n            //Fist check if the string is \"valid\" JSON\n            if (isvalidJSONstring(value)) {\n                //When it is \"valid\" JSON, check if it is splittable\n                if (issplittablevalidJSONstring(value)) {\n                    //When it is splittable, then return type as splittable JSON\n                    return \"splittable JSON\"\n                }\n                else\n                {\n                    //if it is JSON, but not splittable ({}, \"100, 100) return unsplittable JSON\n                    return \"unsplittable JSON\"\n                }\n            }\n            else\n            {\n                //When it isn't \"valid\" JSON, check if it is an array\n                if (isvalidarray(value)) {\n                    //When it is an array, check if it is splittable\n                    if (issplittablearray(value)) {\n                        //When it is splittable, return splittable Array\n                        return \"splittable Array\"\n                    }\n                    else\n                    {\n                        //if the array is not splittable ([\"apple\"]) return unsplittable array\n                        return \"unsplittable array\"\n                    }\n                }\n                else\n                {\n                    //When it is neither JSON or Array, then it is really just a string, so return string\n                    return \"string\"\n                }\n            }\n            break;\n        case \"object\":\n            //some  splittable values are identified as objects\n\n            //Fist check if the object is \"valid\" JSON\n            if (isvalidJSONstring(value)) {\n                //When it is \"valid\" JSON, check if it is splittable\n                if (issplittablevalidJSONstring(value)) {\n                    //When it is splittable, then return type as splittable JSON\n                    return \"splittable JSON\"\n                }\n                else\n                {\n                    //if it is JSON, but not splittable ({}, \"100, 100) return unsplittable JSON\n                    return \"unsplittable JSON\"\n                }\n            }\n            else\n            {\n                //When it isn't \"valid\" JSON, check if it is an array\n                if (isvalidarray(value)) {\n                    //When it is an array, check if it is splittable\n                    if (issplittablearray(value)) {\n                        //When it is splittable, return splittable Array\n                        return \"splittable Array\"\n                    }\n                    else {\n                        //if the array is not splittable ([\"apple\"]) return unsplittable array\n                        return \"unsplittable array\"\n                    }\n                }\n                else\n                {\n                    //When it is neither JSON or Array, then I have not accounted for it. If you reach this point during an\n                    //  investigation, it might be worth using the example that triggered your investigation to see if the object\n                    //  is really just a string (without a triggering example I have not investigated)\n                    return \"object\"\n                }\n            }\n            break;\n        default:\n            //When the type is not one that I coded for then return unhandled because the situation is by definition unhandled\n            return \"unhandled\"\n            break;\n    }\n}\n\n//True False functions\n/*\n * This function was found on the internet to check if an input is valid JSON\n * There seems to be a belief that there should be some more elegant method that trying parse and the catching the error,\n * but no one seems to have demonstrated what that more elegant way would be\n */\nfunction isvalidJSONstring(str) {\n    try {\n        JSON.parse(str);\n    } catch (e) {\n        return false;\n    }\n    return true;\n}\n\n/*\n * This function decides where the JSON is made up of at least 1 key:value pair\n */\nfunction issplittablevalidJSONstring(str) {\n    if (str.includes(\":\")) {\n        return true;\n    }\n    else {\n        return false;\n    }\n}\n/*\n * This function is simply wrapping the Array.isArray, to align the function naming with the other true false functions\n */\nfunction isvalidarray(str) {\n    if (Array.isArray(str)) {\n        return true;\n    }\n    else {\n        return false;\n    }\n}\n/*\n * This function identifies if the array has only a single entry or multiple entries i.e. [\"Apple\"] not splittable,\n *  [\"Apple\",\"Pear\"] splittable\n */\nfunction issplittablearray(str) {\n    // If the length is more than 1, then the array has mutliple entries, but if it is just 1, then it is not splittable\n    if (str.length > 1) {\n        return true;\n    }\n    else {\n        return false;\n    }\n}\n\n//Splitting functions\n/*\n * This function takes in a msg where msg.payload.value is splittable JSON and iterates through all key:value pairs and then\n *  recursively calls handlemsg with multiple messages. Each new message retains most of the details of the input message, \n *  but the name and value are changed.\n *  The name has the key from the key:value pair appended with a : as a seperator\n *  The value is replaced with the value from the key:value pair\n *  A new message is created for each key:value pair\n */\nfunction splitJSON(latestMsg) {\n    //put the inputs value into a variable for easier access\n    var valueJSON = JSON.parse(latestMsg.payload.value);\n    //put the inputs name aside for multiple reuses\n    var name = latestMsg.payload.name\n    //Iterative loop\n    Object.keys(valueJSON).forEach(function (key) {\n        //concatenate the original name, a colon and the key from the pair\n        latestMsg.payload.name = name + \":\" + key;\n        //move the value from the pair to payload.value\n        latestMsg.payload.value = valueJSON[key];\n        //recursively call this function in case the value is itself splittable\n        handlemsg(latestMsg)\n    }\n    )\n    return\n}\n\n/*\n * This function takes in a msg where msg.payload.value is splittable object\n *  and iterates through all key:value pairs and then\n *  recursively calls handlemsg with multiple messages. Each new message retains most of the details of the input message,\n *  but the name and value are changed.\n *  The name has the key from the key:value pair appended with a : as a seperator\n *  The value is replaced with the value from the key:value pair\n *  A new message is created for each key:value pair\n *  \n *  Note: While working on the splitArray function, I realized that I may not have tested this on an object value with multiple\n *  pairs, so it is possible that the function only handles the first pair\n */\nfunction splitObj(oMsg) {\n    //put the inputs name aside for multiple reuses\n    var name = oMsg.payload.name\n    //Iterative loop\n    for (let [key, value] of Object.entries(oMsg.payload.value)) {\n        if ((value !== null) && (key !== null)) {\n            oMsg.payload.name = name + \":\" + key;\n            oMsg.payload.value = value;\n            //recursively call this function in case the value is itself splittable\n            handlemsg(oMsg)\n        }\n    }\n}\n\n/*\n * Note: At the time of creation, I did not have a live example and had too many other things in the works to construct one.\n * \n * This function takes in a msg where msg.payload.value is splittable array\n *  and iterates through all entries and recursively calls handlemsg with multiple messages. \n *  Each new message retains most of the details of the input message,\n *  but the value is changed.\n *  The value is replaced with the value from the entry in the Array\n *  For example if the input value is [\"Apple\",\"Pear\"], then the first msg will have a value of \"Apple\"\n *  and the second will have a value of \"Pear\"\n */\nfunction splitArray(aMsg) {\n    //Iterative loop\n    for (index = 0; index < aMsg.payload.value.length; index++) {\n        (aMsg.payload.value = aMsg.payload.value[index]);\n        //recursively call this function in case the value is itself splittable\n        handlemsg(aMsg)\n    }\n}","outputs":1,"noerr":0,"x":560,"y":80,"wires":[["a03431d6.cd424","9d8082c8.a5927","5dd4aeb3.c8d4"]]},{"id":"7e77e3cf.86febc","type":"debug","z":"5b8974a.7ce288c","name":"HE Explorer Splittable","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":540,"y":20,"wires":[]},{"id":"a03431d6.cd424","type":"debug","z":"5b8974a.7ce288c","name":"Split HE Explorer","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":770,"y":20,"wires":[]},{"id":"699bff70.46e8f","type":"change","z":"5b8974a.7ce288c","name":"","rules":[{"t":"set","p":"exportableresults.DeviceName","pt":"msg","to":"topic","tot":"msg"},{"t":"set","p":"exportableresults.Value","pt":"msg","to":"payload.value","tot":"msg"},{"t":"set","p":"exportableresults.Measure","pt":"msg","to":"payload.name","tot":"msg"},{"t":"delete","p":"topic","pt":"msg"},{"t":"set","p":"tempDeviceID","pt":"msg","to":"payload.deviceId","tot":"msg"},{"t":"delete","p":"payload","pt":"msg"},{"t":"delete","p":"_event","pt":"msg"},{"t":"set","p":"exportableresults.MQTTname","pt":"msg","to":"HubitatTesting","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":460,"wires":[["291eb1c2.3918ae","5dd4aeb3.c8d4"]]},{"id":"291eb1c2.3918ae","type":"debug","z":"5b8974a.7ce288c","name":"HE Explorer Prepped to minimize","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":940,"y":60,"wires":[]},{"id":"5dd4aeb3.c8d4","type":"change","z":"5b8974a.7ce288c","name":"Spreadsheet Lookup Settings","rules":[{"t":"set","p":"IgnoreEnvVar","pt":"msg","to":"true","tot":"bool"},{"t":"set","p":"SpreadsheetID","pt":"msg","to":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","tot":"str"},{"t":"set","p":"Tab","pt":"msg","to":"globalsource","tot":"msg"},{"t":"set","p":"ColStart","pt":"msg","to":"A","tot":"str"},{"t":"set","p":"ColEnd","pt":"msg","to":"Z","tot":"str"},{"t":"set","p":"MinRow","pt":"msg","to":"1","tot":"str"},{"t":"set","p":"MaxRow","pt":"msg","to":"1000","tot":"str"},{"t":"delete","p":"_event","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":820,"y":120,"wires":[["232021d8.418a3e"]],"info":"## **inputs**\n### IgnoreEnvVar \nThis boolean needs to be true to tell that Read Spreadsheet For Details subflow that it should use the specs passed in the msg to determine what spreadsheet to read from and what portion of data to read from.\n### msg.SpreadsheetID\nThis is the very long string that identifies a specific google spreadsheet.\n### msg.Tab\nSpecifies the tab name that contains the data.\n### msg.ColStart\nSpecifies the leftmost column containing the desired data.\n### msg.ColEnd\nSpecifies the rightmost column containing the desired data. \n### msg.MinRow\nSpecifies the top row containing the desired data \n### msg.MaxRow\nSpecifies the bottom row containing the desired data "},{"id":"717ac75c.4c8628","type":"change","z":"5b8974a.7ce288c","name":"Lookup 1 Devices Settings","rules":[{"t":"set","p":"keyvalues.Device","pt":"msg","to":"exportableresults.DeviceName","tot":"msg"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.Floor","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.Location","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.Room","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.DeviceType","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.Manufacturer","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.AccessProtocol","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.PhysicalVirtualType","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.House","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.MQTTDeviceTopic","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.Hub","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1400,"y":120,"wires":[["d744b303.ed5a7"]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value pulled from the **msg.exportableresults.DeviceName** object.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** column.\n"},{"id":"69d9e3bb.5bf85c","type":"change","z":"5b8974a.7ce288c","name":"Devices table, 1 search key with variable input, 1 result","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"exportableresults.DeviceName","tot":"msg"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2780,"y":100,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value pulled from the **msg.exportableresults.DeviceName** object.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** column.\n"},{"id":"56ab9081.a487b","type":"change","z":"5b8974a.7ce288c","name":"Devices table, 1 search key, 2 results","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"Motion_Ikea","tot":"str"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.Manufacturer","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2730,"y":180,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value **\"Motion_Ikea\"**.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** and **\"Manufacturer\"** columns."},{"id":"ea9d4bab.f3b128","type":"change","z":"5b8974a.7ce288c","name":"Devices table, 1 search key, 1 result","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"Anyone Presence","tot":"str"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2730,"y":60,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value **\"Anyone Presence\"**. Notice unlike some examples this includes a space in the value. This has no negative impact.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** column."},{"id":"97475057.4c636","type":"change","z":"5b8974a.7ce288c","name":"Devices table, 2 search keys, 1 results","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"Anyone Presence","tot":"str"},{"t":"set","p":"keyvalues.Manufacturer","pt":"msg","to":"homebridge-people-geofence","tot":"str"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2730,"y":140,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value **\"Anyone Presence\"** and the **\"Manufacturer\"** column for the value **\"homebridge-people-geofence\"**.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** columns."},{"id":"6d31b022.69f87","type":"comment","z":"5b8974a.7ce288c","name":"Examples of preformating the inputs","info":"","x":2720,"y":20,"wires":[]},{"id":"913d7ed7.06898","type":"change","z":"5b8974a.7ce288c","name":"Spreadsheet Lookup Settings Example","rules":[{"t":"set","p":"IgnoreEnvVar ","pt":"msg","to":"true","tot":"bool"},{"t":"set","p":"SpreadsheetID","pt":"msg","to":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","tot":"str"},{"t":"set","p":"Tab","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"ColStart","pt":"msg","to":"A","tot":"str"},{"t":"set","p":"ColEnd","pt":"msg","to":"Z","tot":"str"},{"t":"set","p":"MinRow","pt":"msg","to":"1","tot":"str"},{"t":"set","p":"MaxRow","pt":"msg","to":"1000","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2730,"y":260,"wires":[[]],"info":"## **inputs**\n### IgnoreEnvVar \nThis boolean needs to be true to tell that Read Spreadsheet For Details subflow that it should use the specs passed in the msg to determine what spreadsheet to read from and what portion of data to read from.\n### msg.SpreadsheetID\nThis is the very long string that identifies a specific google spreadsheet.\n### msg.Tab\nSpecifies the tab name that contains the data.\n### msg.ColStart\nSpecifies the leftmost column containing the desired data.\n### msg.ColEnd\nSpecifies the rightmost column containing the desired data. \n### msg.MinRow\nSpecifies the top row containing the desired data \n### msg.MaxRow\nSpecifies the bottom row containing the desired data "},{"id":"ce90d3a9.ea0c3","type":"link in","z":"5b8974a.7ce288c","name":"Might be fixed so search again","links":["6cb80d8f.b5de24","70436624.ab8118","1880846f.74d04c","a0caf842.59d288","15b2018d.72e20e","b898961c.967928","3b26517c.3d413e","98c1a61b.99d998","77f54c4f.d38274"],"x":1560,"y":40,"wires":[["b0c9887a.a26758"]],"l":true},{"id":"5b2d32a4.fec8cc","type":"function","z":"5b8974a.7ce288c","name":"Create spreadsheet range and put into msg.topic","func":"//Put inputs and read values into msg properties to be visible downstream\nmsg.sheet = msg.SpreadsheetID;\nmsg.tab = msg.Tab;\nmsg.cellstart = msg.ColStart + msg.MinRow;\nmsg.cellend = msg.ColEnd + msg.MaxRow;\nmsg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\nmsg.topic = msg.targetrange\ndelete msg.Tab\ndelete msg.SpreadsheetID\ndelete msg.ColEnd\ndelete msg.MaxRow\ndelete msg.IgnoreEnvVar\ndelete msg.tab\ndelete msg.cellstart\ndelete msg.cellend\ndelete msg.targetrange\nreturn msg;","outputs":1,"noerr":0,"x":2780,"y":580,"wires":[["8ff80f71.4a5ef"]],"info":"This node sets up the inputs to the GSheet node.\nThe outputs that make up those inputs are:\n - msg.sheet -the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n - msg.topic - the combination of spreadsheet tab and cell range\n## Note\nThere are 2 very similar booleans evaluated by this node. They are:\n * **OverrideEnvVariables** - This one looks at the environment variable that was set in the flow triggering the subflow\n * **msg.IgnoreEnvVar** - This one is allows the logic to be driven by a message object property and thus can be set at runtime or earlier in the flow based on upstream logic\n\nFirst it checks the boolean value of the **OverrideEnvVariables** environment variable. This is by default false. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming the first was false, it checks the boolean value of the **msg.IgnoreEnvVar** value. This will evaluated as false if not populated, so sending false is unnecessary. If it is true, it builds the outputs from the following inputs:\n - msg.SpreadsheetID\n - msg.Tab\n - msg.ColStart\n - msg.MinRow\n - msg.ColEnd\n - msg.MaxRow\n\nAssuming both are false, then it can build the outputs based on the subflows environment variables. These can either be those set in the calling flow or they may be the default ones built into the subflow.\n\nRegardless of the method used to build the output, the node also removes the input message properties.\n\n\n\nmsg.IgnoreEnvVar"},{"id":"8ff80f71.4a5ef","type":"GSheet","z":"5b8974a.7ce288c","creds":"adb4e9b8.8beee8","method":"get","action":"","sheet":"","cells":"","name":"Read Input from GSheet Devices Tab","x":3130,"y":580,"wires":[["adeab23.69b195"]],"info":"Use the GSheet node to get the a set of rows from a google spreadsheet.\n\n# **Inputs**\n### **creds**\nThis is the name on the gauth configuration node. How to get the details is beyond the scope of what I am going to put into an individual node instance. Some details are at [node-red-contrib-google-sheets](https://flows.nodered.org/node/node-red-contrib-google-sheets)\n### **Method**\nIn this case using the get cells method to read a set of data.\n### **SpreadsheetID**\nUnused as the spreadsheet ID is passed in as part of the input msg, but if needed it would be the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n### **Cells**\nUnused as the requested cells are passed in as part of the input msg, but if it was being manually built for a static data source the format is made of of 3 parts with specific seperators:\n * **[Sheetname]** like Sheet1\n * **[upper left corner cell address]** like A1\n * **[lower right corner cell address]** like B2\n\nThe format is **[Sheetname]**!**[upper left corner cell address]**:**[lower right corner cell address]** giving an input like **Sheet1!A1:B2**\n "},{"id":"141ca182.7fcf8e","type":"GSheet","z":"5b8974a.7ce288c","creds":"adb4e9b8.8beee8","method":"append","action":"","sheet":"","cells":"","name":"Test Append","x":3650,"y":580,"wires":[["7cbbd85a.54cfb8"]]},{"id":"adeab23.69b195","type":"function","z":"5b8974a.7ce288c","name":"Hubitat Devices Addition Builder","func":"//Ref. TMS-000003\nlet entries = Object.entries(msg.keyvalues)\nlet cachedData = global.get(msg.globalsource)\nlet headerData = cachedData[0]\nlet index = 0\nlet resultingEntry = []\nlet found =false\nlet pushValue = \"\"\nfor (index = 0; index < headerData.length; index++)\n{\n    found = false\n    for (const [key, value] of entries) {\n        if (key === headerData[index])\n        {\n            found = true\n            pushValue = value\n        }\n        else if (\"DeviceID\" === headerData[index])\n        {\n            found = true\n            pushValue = msg.tempDeviceID\n        }\n        else if (\"Hub\" === headerData[index])\n        {\n            found = true\n            pushValue = \"Hubitat\"\n            }\n    }\n        if (found) {resultingEntry.push(pushValue)}\n        else{resultingEntry.push(\"\")}\n}\nnode.warn(msg.payload)\nnode.warn(resultingEntry)\nlet deviceTable = msg.payload\ndeviceTable.push(resultingEntry)\nglobal.set(msg.globalsource, deviceTable)\n    msg.payload = resultingEntry\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\nreturn msg","outputs":1,"noerr":0,"x":3430,"y":580,"wires":[["141ca182.7fcf8e"]]},{"id":"7cbbd85a.54cfb8","type":"change","z":"5b8974a.7ce288c","name":"","rules":[{"t":"set","p":"flush","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":3810,"y":580,"wires":[[]]},{"id":"2e31171f.7fd678","type":"catch","z":"5b8974a.7ce288c","name":"Catch Lookup Errors","scope":["b0c9887a.a26758"],"uncaught":false,"x":210,"y":940,"wires":[["6dd2331f.f6785c"]]},{"id":"6dd2331f.f6785c","type":"switch","z":"5b8974a.7ce288c","name":"Sort by Error Message","property":"error.message","propertyType":"msg","rules":[{"t":"eq","v":"Reload from Google Sheet","vt":"str"},{"t":"eq","v":"Build stub","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":3,"x":440,"y":940,"wires":[["44d90c6f.b27a14"],["e8718ec8.ca693"],["cc51704a.11e9b","27c2179e.231988"]]},{"id":"44d90c6f.b27a14","type":"link out","z":"5b8974a.7ce288c","name":"Load Cache from Spreadsheet","links":["3eaa075c.e87118","940aff1e.f85cc","12c961a6.40967e","aa8ffe00.b09c3","5d8ec463.2cd10c","7e8d2a18.3c01f4","5c918711.3a2948","462060c.ca392a"],"x":690,"y":880,"wires":[],"l":true},{"id":"dfd2fb55.eedd48","type":"link in","z":"5b8974a.7ce288c","name":"","links":["ddd692d8.dd5f5"],"x":590,"y":3600,"wires":[[]],"l":true},{"id":"ddd692d8.dd5f5","type":"link out","z":"5b8974a.7ce288c","name":"","links":["dfd2fb55.eedd48"],"x":380,"y":3600,"wires":[],"l":true},{"id":"808d1a21.fedff8","type":"function","z":"5b8974a.7ce288c","name":"Split 2 types of device node outputs","func":"var singleAttributeData = false\nvar foundType\n//node.warn(msg.payload)\nfor (let [key, value] of Object.entries(msg.payload)) {\n//  node.warn(key)\n  //node.warn(typeof(value))\n  foundtype= typeof(value)\n  if ((foundtype==\"string\")||(foundtype==\"number\")||(foundtype==\"boolean\")){\n      singleAttributeData =true\n  }\n}\nif (singleAttributeData){\n    node.send([null,msg])\n    //node.send([msg,null])\n}\nelse\n{\n    //interate through the objects in the input\n    for (let [key, value] of Object.entries(msg.payload))\n    {    \n        msg.payload = value\n        node.send([msg,null])\n        node.done()\n    }\n}\nreturn","outputs":2,"noerr":0,"x":260,"y":20,"wires":[["ac8058d4.b6e428","7e77e3cf.86febc"],["ac8058d4.b6e428"]],"outputLabels":["Moved contents from payload.x.contents to payload.contents","FYI massaged"],"info":"var singleAttributeData = false\nvar foundType\nfor (let [key, value] of Object.entries(msg.payload)) {\n  foundtype= typeof(value)\n  if ((foundtype==\"string\")||(foundtype==\"number\")||(foundtype==\"boolean\")){\n      singleAttributeData =true\n  }\n}\nif (singleAttributeData){\n    node.send([msg,null])\n} else\n{\n    node.send([null,msg])\n    //interate through the objects in the input\n    for (let [key, value] of Object.entries(msg.payload))\n    {    \n        msg.payload = value\n        node.send([msg,null])\n        node.done()\n        \n    }\n}\nreturn"},{"id":"cc51704a.11e9b","type":"debug","z":"5b8974a.7ce288c","name":"Otherwise Failure","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"error.message","targetType":"msg","x":670,"y":980,"wires":[]},{"id":"b2f4ce27.3cc68","type":"debug","z":"5b8974a.7ce288c","name":"Build Stub","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":940,"y":960,"wires":[]},{"id":"c156523d.202b2","type":"debug","z":"5b8974a.7ce288c","name":"Load Cache from Spreadseet Failure","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":710,"y":840,"wires":[]},{"id":"b0c9887a.a26758","type":"function","z":"5b8974a.7ce288c","name":"6/11 updated Lookup info","func":"//Ref. TMS-06-11-2020\n\n/*\n//1 Get must have items: searchKeys, searchValues, searchResultKeys, cachedSearch, cacheTime, localTable\n//2 Create working variables searchKeyIndices, searchResultKeysIndices, result, pushable, index, cacheObject, outerIndex, innerIndex, innerLoopCounter\n//3 Build the cache key which is essentially the concatenation of key+value+nextkey+nextvalue+.....etc\n//4 Retrieve results\n    //4.1 Send from LastSearch global variable if possible\n    //4.2 Do in-depth lookup\n        //4.2.1 Is the table in memory\n            // Yes carry on\n            // No load table from sheet (triggered by error catching node with \"Reload from Google Sheet\" error.message) built in flow\n                // success loading restart lookup  built in flow\n                // failure send failure message (Global memory table X is missing and Google sheet loading process has failed) built in flow\n        //4.2.2 Find search key(s)\n            //success carry on\n            //failure send failure message (the first invalid search key is X)\n        //4.2.3 Find searchfor keys\n            //success carry on\n            //failure send failure message (The first search item missing from the table is X)\n        //4.2.4 Find row matching search values\n            // success carry on\n            // failure \n                //build stub entry (triggered by error catching node with \"Reload from Google Sheet\" error.message) new flow build (must account for which table)\n                //restart lookup\n        //4.2.5 Add results\n        //4.2.6 Populate the LastSearch global variable\n        //4.2.7 Return successful results\n*/\n\n//1 Get must have items: searchKeys, searchValues, searchResultKeys, cachedSearch, cacheTime, localTable\n//node.warn(1)\nlet searchKeys = Object.keys(msg.keyvalues)\nlet searchValues = Object.values(msg.keyvalues)\nlet searchResultKeys = Object.keys(msg.searchfor)\nlet cachedSearch = global.get(\"LastSearch\")\nlet cacheTime = new Date().getTime()\nlet localTable = global.get(msg.globalsource)\n//2 Create working variables searchKeyIndices, searchResultKeysIndices, result, pushable, index, cacheObject, outerIndex, innerIndex, innerLoopCounter\n//node.warn(2)\nlet searchKeyIndices =[]\nlet searchResultKeysIndices = []\nlet result = []\nlet pushable = false\nlet index\nlet cacheObject\nlet outerIndex\nlet innerIndex\nlet innerLoopCounter\n//3 Build the cache key which is essentially the concatenation of key+value+nextkey+nextvalue+.....etc\n//node.warn(3)\ncacheObject = BuildCacheObject(searchKeys, searchValues, searchResultKeys)\n//4 Retrieve results\n//node.warn(4)\nif (cachedSearch !== undefined)\n{\n    //4.1 Send from LastSearch global variable if possible\n    //node.warn(4.1)\n    if ((cachedSearch.query == cacheObject.query) && (cachedSearch.time > cacheObject.time - 5000))\n    {\n        msg.searchfor = cachedSearch.searchfor\n        return msg\n    }\n}\n    //4.2 Do in-depth lookup\n    //node.warn(4.2)\n        //4.2.1 Is the table in memory\n        //node.warn(\"4.2.1\")\n        //node.warn(\"4.2.1 + localTable =\" + localTable )\n        if (localTable !== undefined)\n        { //Yes carry on\n        }\n        else\n        {\n            // No load table from sheet (triggered by error catching node with \"Reload from Google Sheet\" error.message) built in flow\n                // success loading restart lookup built in flow\n                // failure send failure message (Global memory table X is missing and Google sheet loading process has failed) built in flow\n                //node.warn(\"Reload from Google Sheet =\" + localTable )\n                node.error(\"Reload from Google Sheet\", msg)\n                return\n        }\n        //4.2.2 Find search key(s)\n        //node.warn(\"4.2.2\")\n        for (outerIndex = 0; outerIndex < searchKeys.length; outerIndex++)\n        {\n            //node.warn(\"4.2.2  + 84\"+ localTable[0])\n            //inner index is the place along the first row of data\n            //The innerLoopCounter must be reset each time a new key is being looked for\n            innerLoopCounter = 0\n            for (innerIndex = 0; innerIndex < localTable[0].length; innerIndex++)\n            {\n                //node.warn(\"4.2.2  + 90\")\n                //these 2 loops will compare every entry in the top row of the data table to every entry in the array of search keys,\n                if (localTable[0][innerIndex] == searchKeys[outerIndex])\n                {\n                    //node.warn(\"4.2.2  + 94\")\n                    //when they match push the column number on to the array that has just indices for the search keys\n                    searchKeyIndices.push(innerIndex)\n                    //break is used to stop comparing as once the column has been found the remaining aren't relevant\n                    break\n                } //if (localTable[0][innerIndex] == searchKeys[outerIndex])\n                else\n                {\n                    //when they don't match, then this means the search key that does not match that header.\n                    //this is accumulating how many times the search key did not match one of the data table headers\n                    innerLoopCounter++\n                    //Error messaging should only happen if the search key has been compared with all of the headers\n                    //localTable[0].length gives the total number of data headers (columns of the spreadsheet)\n                    //node.warn(\"4.2.2 before \")\n                    if (localTable[0].length == innerLoopCounter)\n                    {\n                        //failure send failure message (the first invalid search key is X)\n                        node.error(\"The first invalid search key from this input is \" + searchKeys[outerIndex], msg)\n                        return\n                    } //if (localTable[0].length == innerLoopCounter)\n                } //else to the if (localTable[0][innerIndex] == searchKeys[outerIndex])\n            } //for innerIndex loop\n        } //for outerIndex loop\n\n        //4.2.3 Find searchfor keys\n        //node.warn(\"4.2.3\")\n            //success carry on\n            //failure send failure message (The first search item missing from the table is X)\n            for (outerIndex = 0; outerIndex < searchResultKeys.length; outerIndex++)\n            {\n                //inner index is the place along the first row of data\n                //The innerLoopCounter must be reset each time a new key is being looked for\n                innerLoopCounter = 0\n                for (innerIndex = 0; innerIndex < localTable[0].length; innerIndex++)\n                {\n                    //these 2 loops will compare every entry in the top row of the data table to every entry in the array of search keys,\n                    if (localTable[0][innerIndex] == searchResultKeys[outerIndex])\n                    {\n                        //when they match push the column number on to the array that has just indices for the search keys\n                        searchResultKeysIndices.push(innerIndex)\n                        //break is used to stop comparing as once the column has been found the remaining aren't relevant\n                        break\n                    } //if (localTable[0][innerIndex] == searchResultKeys[outerIndex])\n                    else\n                    {\n                        //when they don't match, then this means the search result key does not match the currently examined header.\n                        innerLoopCounter++\n                        //Error messaging should only happen if the search key has been compared with all of the headers\n                        //localTable[0].length gives the total number of data headers (columns of the spreadsheet)\n                        if (localTable[0].length == innerLoopCounter)\n                        {\n                            //failure send failure message (The first search item missing from the table is X)\n                            node.error(\"The first invalid desired data column from this input is \" + searchResultKeys[outerIndex], msg)\n                            return\n                        } \n                    }// else for the if (localTable[0][innerIndex] == searchResultKeys[outerIndex])\n                } //for innerIndex loop\n            } //for outerIndex loop\n\n        //4.2.4 Find row matching search values\n        //node.warn(\"4.2.4\")\n            // success carry on\n            // failure \n                //build stub entry (triggered by error catching node with \"Reload from Google Sheet\" error.message) new flow build (must account for which table)\n                //restart lookup\n        //loop through all search keys, 1 index at a time and filter to a row that has the desired data in the desired column\n        for (outerIndex = 0; outerIndex < localTable.length; outerIndex++)\n        {\n            for (innerIndex = 0; innerIndex < searchKeyIndices.length; innerIndex++)\n            {\n                if (localTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex])\n                {\n                    pushable = true\n                }\n                else\n                {\n                    pushable = false\n                    break\n                }\n            } //for innerIndex loop\n            if (pushable)\n            {\n                result.push(localTable[outerIndex])\n            } \n        } //for outerIndex loop\n        //check to see if there are any rows 0 means now, 1 means single match, >1 multiple matches\n        if (result.length === 0)\n        {\n            node.error(\"Build stub\", msg)\n            return\n        }\n        else if (result.length > 1)\n        {\n            //do the warning that multiple were found but will take the first\n            //node.warn(\"Multiple rows were found that matched the search criteria. Results are from the first row that was found and matched.\")\n        }\n\n        //4.2.5 Add results\n        //node.warn(\"4.2.5\")\n        for (index = 0; index < searchResultKeysIndices.length; index++)\n        {\n            msg.searchfor[searchResultKeys[index]] = result[0][searchResultKeysIndices[index]]\n        } //for (index = 0; index < searchResultKeysIndices.length; index++)\n        //if this point is reached then work workingMsg contains complete info\n        //build and save the LastSearch obect\n        cacheObject.searchfor = msg.searchfor\n\n        //4.2.6 Populate the LastSearch global variable\n        //node.warn(\"4.2.6\")\n        global.set(\"LastSearch\", cacheObject)\n\n        //4.2.7 Return successful results\n        //node.warn(\"4.2.7\")\n        return msg\n\nfunction BuildCacheObject(searchKeysArray, SearchValuesArray, SearchResultKeysArray) {\n    //3 build the cache key which is essentially the concatenation of key+value+nextkey+nextvalue+.....etc\n    let newCacheKey =\"\"\n    for (index = 0; index < searchKeysArray.length; index++)\n    {\n        newCacheKey = newCacheKey + searchKeysArray[index] + SearchValuesArray[index]\n    } //for (index = 0; index < searchKeysArray.length; index++)\n    //add all fields that will be looked for into the cache key\n    for (index = 0; index < SearchResultKeysArray.length; index++)\n    {\n        newCacheKey = newCacheKey + SearchResultKeysArray[index]\n    } //for (index = 0; index < SearchResultKeysArray.length; index++)\n    //combine the cache key and the cache time into a single object that can be compared with the cached last search\n    let createdCacheObject = \n    {\n        query: newCacheKey,\n        time: cacheTime\n    }\n    return createdCacheObject\n}","outputs":1,"noerr":0,"x":1910,"y":160,"wires":[["6741414c.1925a"]],"outputLabels":["Value Found"],"info":"# **Conceptual Explanation**\nThis node is designed to use a 2-D array of data loaded from a google sheeet to lookup desired data. The data is arrayed with the first row being column headers describing the data in those columns in subsequent rows.\n## **inputs**\n### globalsource \nThe name of the global variable holding the table of data\n### msg.keyvalues\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row.\n### msg.searchfor\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. The value enters the node empty.\n## **outputs**\n### Output1: Value Found \nThis ouput is used when the node has successfully identified the requested data. That data is placed into the value portions of the key value pairs that made up the msg.searchfor input\n### Output 2: Error but try reloading from data source\nThis output is used when either the global variable to contain the data table either does no exist or does not contain a row with all of the requested search criteria. Normally it is used to trigger loading the table from Google sheets under the expectation that either this is the first time a lookup has been tried an the data had not yet been cached in the global variable or potentially the data in the cache has become stale and reloading from the Google sheet will add a row that will match the requested search criteria.\n### Output 3: Error despite having tried to reload from data source\nThis output is used when either the global variable to contain the data table either does no exist or does not contain a row with all of the requested search criteria and at least 1 attempt has already been made to reload the global vairable cache. This is effectively a notification of non-recoverable lookup failure."},{"id":"f608ff82.441dc","type":"catch","z":"5b8974a.7ce288c","name":"Catch Google Sheet Read Errors","scope":["397d4461.531e3c"],"uncaught":false,"x":250,"y":1100,"wires":[["c877204.1454de"]]},{"id":"73f605.7e67f9fc","type":"comment","z":"5b8974a.7ce288c","name":"Error Handling","info":"","x":330,"y":860,"wires":[]},{"id":"c877204.1454de","type":"switch","z":"5b8974a.7ce288c","name":"Sort by Error Message","property":"error.message","propertyType":"msg","rules":[{"t":"eq","v":"The API returned an error: Error: Requested entity was not found.","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":520,"y":1100,"wires":[["311690e2.cc25a"],["78977ae.8c6b484"]]},{"id":"311690e2.cc25a","type":"debug","z":"5b8974a.7ce288c","name":"Google Sheet Lookup Failure","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"error.message","targetType":"msg","x":760,"y":1080,"wires":[]},{"id":"78977ae.8c6b484","type":"debug","z":"5b8974a.7ce288c","name":"Otherwise Google Failure","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"error.message","targetType":"msg","x":750,"y":1120,"wires":[]},{"id":"6741414c.1925a","type":"debug","z":"5b8974a.7ce288c","name":"6/11 Lookup function Output","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2300,"y":380,"wires":[]},{"id":"e53d3576.935d98","type":"catch","z":"5b8974a.7ce288c","name":"","scope":null,"uncaught":true,"x":200,"y":1220,"wires":[["a57c57da.ecb438"]]},{"id":"a57c57da.ecb438","type":"debug","z":"5b8974a.7ce288c","name":"Catch All output","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":400,"y":1220,"wires":[]},{"id":"27c2179e.231988","type":"debug","z":"5b8974a.7ce288c","name":"Otherwise Failure complete msg","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":710,"y":1020,"wires":[]},{"id":"e8718ec8.ca693","type":"link out","z":"5b8974a.7ce288c","name":"Build Stub","links":["9bdc1a2a.5c4868"],"x":940,"y":920,"wires":[],"l":true},{"id":"70436624.ab8118","type":"link out","z":"5b8974a.7ce288c","name":"Stub Built","links":["ce90d3a9.ea0c3"],"x":1200,"y":1620,"wires":[],"l":true},{"id":"70ab806e.fa527","type":"comment","z":"5b8974a.7ce288c","name":"Build Stub","info":"","x":140,"y":1540,"wires":[]},{"id":"9c324254.58f27","type":"comment","z":"5b8974a.7ce288c","name":"This node is Hubitat Specific","info":"","x":620,"y":460,"wires":[]},{"id":"bf0033c0.0d31e","type":"change","z":"5b8974a.7ce288c","name":"Backup Version Devices Lookup Settings","rules":[{"t":"set","p":"globalsource","pt":"msg","to":"Devices","tot":"str"},{"t":"set","p":"keyvalues.Device","pt":"msg","to":"exportableresults.DeviceName","tot":"msg"},{"t":"set","p":"searchfor.DeviceID","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.Floor","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.Location","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.Room","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.DeviceType","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.Manufacturer","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.AccessProtocol","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.PhysicalVirtualType","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.House","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.MQTTDeviceTopic","pt":"msg","to":"","tot":"str"},{"t":"set","p":"searchfor.Hub","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1180,"y":20,"wires":[[]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value pulled from the **msg.exportableresults.DeviceName** object.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** column.\n"},{"id":"a95715b0.81c398","type":"debug","z":"5b8974a.7ce288c","name":"Subflow Input","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":200,"y":300,"wires":[]},{"id":"a5d47888.045c98","type":"change","z":"5b8974a.7ce288c","name":"Lookup 2 MeasurementTranslations Settings","rules":[{"t":"set","p":"keyvalues.DeviceID","pt":"msg","to":"exportableresults.DeviceID","tot":"msg"},{"t":"set","p":"keyvalues.Measurement","pt":"msg","to":"exportableresults.Measure","tot":"msg"},{"t":"set","p":"searchfor.ChangeNameTo","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1390,"y":180,"wires":[["4cef0b69.737af4"]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value pulled from the **msg.exportableresults.DeviceName** object.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** column.\n"},{"id":"232021d8.418a3e","type":"switch","z":"5b8974a.7ce288c","name":"Which table is being looked up","property":"globalsource","propertyType":"msg","rules":[{"t":"eq","v":"Devices","vt":"str"},{"t":"eq","v":"MeasurementTranslations","vt":"str"},{"t":"eq","v":"DataTranslations","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":930,"y":220,"wires":[["717ac75c.4c8628"],["a5d47888.045c98"],["397f6310.90cf2c"]]},{"id":"9a85347b.8fd258","type":"switch","z":"5b8974a.7ce288c","name":"","property":"exportableresults.DeviceID","propertyType":"msg","rules":[{"t":"null"},{"t":"nnull"}],"checkall":"true","repair":false,"outputs":2,"x":290,"y":120,"wires":[["808d1a21.fedff8"],["b8cdc4bd.8f71d8","5dd4aeb3.c8d4"]]},{"id":"c829a5cb.64d4e8","type":"debug","z":"5b8974a.7ce288c","name":"debug stepper","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2000,"y":3440,"wires":[]},{"id":"39fe9d04.593ee2","type":"debug","z":"5b8974a.7ce288c","name":"Before gate","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1990,"y":3480,"wires":[]},{"id":"c38abbe.cc55348","type":"debug","z":"5b8974a.7ce288c","name":"After gate","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2160,"y":3480,"wires":[]},{"id":"42ec679.8771a98","type":"debug","z":"5b8974a.7ce288c","name":"Before gsheet","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2000,"y":3520,"wires":[]},{"id":"16e7246f.5cb2cc","type":"debug","z":"5b8974a.7ce288c","name":"After gsheet","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2170,"y":3520,"wires":[]},{"id":"c4bd8682.ac6228","type":"debug","z":"5b8974a.7ce288c","name":"Before function","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2200,"y":3440,"wires":[]},{"id":"5c918711.3a2948","type":"link in","z":"5b8974a.7ce288c","name":"Load Cache from Spreadsheet","links":["44d90c6f.b27a14"],"x":190,"y":1380,"wires":[["a9eb7351.bff69"]],"l":true},{"id":"d7045779.279948","type":"link in","z":"5b8974a.7ce288c","name":"Global loaded from spreadsheet","links":["5ab691d.784da7"],"x":430,"y":1420,"wires":[["bc6e060a.2d0148"]],"l":true},{"id":"5ab691d.784da7","type":"link out","z":"5b8974a.7ce288c","name":"Global loaded from spreadsheet","links":["d7045779.279948"],"x":1290,"y":1440,"wires":[],"l":true},{"id":"bd3184df.807648","type":"comment","z":"5b8974a.7ce288c","name":"Reload from Google Sheet","info":"","x":170,"y":1320,"wires":[]},{"id":"bc6e060a.2d0148","type":"function","z":"5b8974a.7ce288c","name":"Queue Coordination","func":"// fill variables from the context variables or initialize them if the context variables do not exist\n            //qCount holds how many msgs are in the queue gate\n    var qCount = context.get('qCount')||0;\n            //pCount holds how many msgs have been sent to the processing nodes (like read from Gsheet) that have not yet looped back\n    var pCount = context.get('pCount')||0;\n            //lastErrMsg holds the last error message that was received. It is used for the RBE type logic\n    var lastErrMsg = context.get('lastErrMsg')||\"\";\n\n\n//put the incoming error message into a variable\n    var incomingErrMsg = msg.error.message\n\n//while troublshooting, send state of the variables to the debug window\n    //node.warn(\"Q count = \" + qCount+ \" PCount = \" + pCount + \" Last Error = \" +lastErrMsg +\" Incoming Error = \"+incomingErrMsg)\n\n//branch based on whether this is a new msg (i.e. it comes from the main part of the subflow) or a message that has looped back to this node\n    if (msg.newMessage)\n    {\n        //When new message\n        //remove new mesage indicator\n            delete msg.newMessage\n        //increment the qCount since this new message will be sent to the q gate\n            qCount +=1\n        //save the updated qcount into the node's context variable\n            context.set('qCount',qCount);\n        //branch based on RBE-like logic\n            if (incomingErrMsg == lastErrMsg)\n            {\n                //since this is a new message, without a new error message, send only to the q gate\n                    return [msg, null]\n            }\n            else\n            {\n                //since this is a new message, **with** a new error message, prepare the message and then send to both q gate and proces\n                    //increment the process counter\n                        pCount +=1\n                    //save the process counter to the node's context variable\n                        context.set('pCount',pCount);\n                    //create items needed for reading from Google Sheet and delete excess intermediate properties\n                        msg.sheet = msg.SpreadsheetID;\n                        msg.tab = msg.Tab;\n                        msg.cellstart = msg.ColStart + msg.MinRow;\n                        msg.cellend = msg.ColEnd + msg.MaxRow;\n                        msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n                        msg.topic = msg.targetrange\n                        delete msg.Tab\n                        delete msg.IgnoreEnvVar\n                        delete msg.tab\n                        delete msg.cellstart\n                        delete msg.cellend\n                        delete msg.targetrange\n                    //send to qgate and to process                        \n                        return [msg, msg]\n            }\n    }\n    else\n    {\n        //when not a new message, then process the results of reading from Google sheet\n        //save the read result into the global context variable specified in msg.globalsource\n            global.set(msg.globalsource,msg.payload)\n        //decrement the process counter\n            pCount -=1\n        //save the process counter to the node's context variable\n            context.set('pCount',pCount);\n        //Decide if all process requests have been finished based on whether the pCount. A value of 1 or greater means there are additional process requests still in progress. <1 indicates there are non and thus the queued messages may be released.\n            if (context.get('pCount') <1)\n            {\n                //when the process counter is 0 (or less), then flush the queue and clean up the node's context variables\n                //send a flush message to the queue gate to allow all of the held messages to flow downstream\n                    node.send([{topic: \"control\", payload: \"flush\"},null])\n                //reset the node's context variables for qCount and pCount to 0\n                    context.set('qCount',0);\n                    context.set('pCount',0);\n            //while troublshooting, send state of the variables to the debug window\n                //node.warn(\"Flushed-------Q count = \" + context.get('qCount')+ \" PCount = \" + context.get('qCount') + \" Last Error = \" +lastErrMsg +\" Incoming Error = \"+incomingErrMsg)\n           }\n    }","outputs":2,"noerr":0,"x":700,"y":1420,"wires":[["a7ed3b65.289c68"],["32b59a7a.34f526","c9addf09.f90ad"]],"outputLabels":["queue","flush"],"info":"This node takes incoming new messages and stores a copy in the queue gate. It then adds information to the message and sends a request to read data from the Google Sheet. When that is done, then the results are returned but not labelled as new.\n\nAny time a non-new msg is received, this node looks to see if there are any processing request still pending. If so, then the message is ignored. If not, then it sends a flush command to the queue gate."},{"id":"a9eb7351.bff69","type":"change","z":"5b8974a.7ce288c","name":"Label as a New Message","rules":[{"t":"set","p":"newMessage","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":450,"y":1380,"wires":[["bc6e060a.2d0148"]],"info":"The following function node receives messages from 2 sources. This node labels thoust that come from up stream as new."},{"id":"a7ed3b65.289c68","type":"q-gate","z":"5b8974a.7ce288c","name":"q-gate","controlTopic":"control","defaultState":"queueing","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","queueCmd":"queue","defaultCmd":"default","triggerCmd":"trigger","flushCmd":"flush","resetCmd":"reset","peekCmd":"peek","dropCmd":"drop","statusCmd":"status","maxQueueLength":"0","keepNewest":false,"qToggle":false,"persist":false,"x":870,"y":1400,"wires":[["98c1a61b.99d998"]]},{"id":"32b59a7a.34f526","type":"GSheet","z":"5b8974a.7ce288c","creds":"adb4e9b8.8beee8","method":"get","action":"","sheet":"","cells":"","name":"Read Input from GSheet","x":970,"y":1440,"wires":[["5ab691d.784da7"]],"info":"Use the GSheet node to get the a set of rows from a google spreadsheet.\n\n# **Inputs**\n### **creds**\nThis is the name on the gauth configuration node. How to get the details is beyond the scope of what I am going to put into an individual node instance. Some details are at [node-red-contrib-google-sheets](https://flows.nodered.org/node/node-red-contrib-google-sheets)\n### **Method**\nIn this case using the get cells method to read a set of data.\n### **SpreadsheetID**\nUnused as the spreadsheet ID is passed in as part of the input msg, but if needed it would be the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n### **Cells**\nUnused as the requested cells are passed in as part of the input msg, but if it was being manually built for a static data source the format is made of of 3 parts with specific seperators:\n * **[Sheetname]** like Sheet1\n * **[upper left corner cell address]** like A1\n * **[lower right corner cell address]** like B2\n\nThe format is **[Sheetname]**!**[upper left corner cell address]**:**[lower right corner cell address]** giving an input like **Sheet1!A1:B2**\n "},{"id":"98c1a61b.99d998","type":"link out","z":"5b8974a.7ce288c","name":"Might be fixed so search again","links":["ce90d3a9.ea0c3"],"x":1070,"y":1400,"wires":[],"l":true},{"id":"34fae0bc.414b9","type":"link in","z":"5b8974a.7ce288c","name":"Global loaded from spreadsheet","links":["2c69f03a.b5b3a"],"x":310,"y":1640,"wires":[["8128bf33.f61f2"]],"l":true},{"id":"2c69f03a.b5b3a","type":"link out","z":"5b8974a.7ce288c","name":"Global loaded from spreadsheet","links":["34fae0bc.414b9"],"x":2430,"y":1680,"wires":[],"l":true},{"id":"8128bf33.f61f2","type":"function","z":"5b8974a.7ce288c","name":"Queue Coordination (Build Stub Version)","func":"//msg.error.message -> msg.exportableresults.Measure\n\n// fill variables from the context variables or initialize them if the context variables do not exist\n            //qCount holds how many msgs are in the queue gate\n    var qCount = context.get('qCount')||0;\n            //pCount holds how many msgs have been sent to the processing nodes (like read from Gsheet) that have not yet looped back\n    var pCount = context.get('pCount')||0;\n            //lastErrMsg holds the last error message that was received. It is used for the RBE type logic\n    var lastErrMsg = context.get('lastErrMsg')||\"\";\n\n\n//put the incoming error message into a variable\n    var incomingErrMsg = msg.exportableresults.Measure\n\n//while troublshooting, send state of the variables to the debug window\n    //node.warn(\"Q count = \" + qCount+ \" PCount = \" + pCount + \" Last Error = \" +lastErrMsg +\" Incoming Error = \"+incomingErrMsg)\n\n//branch based on whether this is a new msg (i.e. it comes from the main part of the subflow) or a message that has looped back to this node\n    if (msg.newMessage)\n    {\n        //When new message\n        //remove new mesage indicator\n            delete msg.newMessage\n        //increment the qCount since this new message will be sent to the q gate\n            qCount +=1\n        //save the updated qcount into the node's context variable\n            context.set('qCount',qCount);\n        //branch based on RBE-like logic\n            if (incomingErrMsg == lastErrMsg)\n            {\n                //since this is a new message, without a new error message, send only to the q gate\n                    return [msg, null]\n            }\n            else\n            {\n                //since this is a new message, **with** a new error message, prepare the message and then send to both q gate and proces\n                    //increment the process counter\n                        pCount +=1\n                    //save the process counter to the node's context variable\n                        context.set('pCount',pCount);\n                    //create items needed for reading from Google Sheet and delete excess intermediate properties\n                        msg.sheet = msg.SpreadsheetID;\n                        msg.tab = msg.globalsource;\n                        msg.cellstart = msg.ColStart + msg.MinRow;\n                        //node.warn(\"msg.ColEnd = \"+msg.ColEnd+   \" msg.MaxRow = \"+msg.MaxRow)\n                        msg.cellend = msg.ColEnd + msg.MaxRow;\n                        msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n                        msg.topic = msg.targetrange\n                        delete msg.Tab\n                        delete msg.IgnoreEnvVar\n                        delete msg.tab\n                        delete msg.cellstart\n                        delete msg.cellend\n                        delete msg.targetrange\n                    //send to qgate and to process                        \n                        return [msg, msg]\n            }\n    }\n    else\n    {\n        //when not a new message, then process the results of reading from Google sheet\n        //unlike the Devices version, this version does not save the returned info to the global context variable, because the portion that writes to spreadsheet populates the payload.\n        //decrement the process counter\n            pCount -=1\n        //save the process counter to the node's context variable\n            context.set('pCount',pCount);\n        //Decide if all process requests have been finished based on whether the pCount. A value of 1 or greater means there are additional process requests still in progress. <1 indicates there are non and thus the queued messages may be released.\n            if (context.get('pCount') <1)\n            {\n                //when the process counter is 0 (or less), then flush the queue and clean up the node's context variables\n                //send a flush message to the queue gate to allow all of the held messages to flow downstream\n                    node.send([{topic: \"control\", payload: \"flush\"},null])\n                //reset the node's context variables for qCount and pCount to 0\n                    context.set('qCount',0);\n                    context.set('pCount',0);\n            //while troublshooting, send state of the variables to the debug window\n                //node.warn(\"Flushed-------Q count = \" + context.get('qCount')+ \" PCount = \" + context.get('qCount') + \" Last Error = \" +lastErrMsg +\" Incoming Error = \"+incomingErrMsg)\n           }\n    }","outputs":2,"noerr":0,"x":640,"y":1640,"wires":[["18d1ddab.b43942"],["57ed9717.583228","b6a762e5.5ee4c"]],"outputLabels":["queue","flush"],"info":"This node takes incoming new messages and stores a copy in the queue gate. It then adds information to the message and sends a request to read data from the Google Sheet. When that is done, then the results are returned but not labelled as new.\n\nAny time a non-new msg is received, this node looks to see if there are any processing request still pending. If so, then the message is ignored. If not, then it sends a flush command to the queue gate."},{"id":"4c9f81c4.70911","type":"change","z":"5b8974a.7ce288c","name":"Label as a New Message","rules":[{"t":"set","p":"newMessage","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":330,"y":1600,"wires":[["8128bf33.f61f2"]],"info":"The following function node receives messages from 2 sources. This node labels thoust that come from up stream as new."},{"id":"18d1ddab.b43942","type":"q-gate","z":"5b8974a.7ce288c","name":"q-gate","controlTopic":"control","defaultState":"queueing","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","queueCmd":"queue","defaultCmd":"default","triggerCmd":"trigger","flushCmd":"flush","resetCmd":"reset","peekCmd":"peek","dropCmd":"drop","statusCmd":"status","maxQueueLength":"0","keepNewest":false,"qToggle":false,"persist":false,"x":950,"y":1620,"wires":[["70436624.ab8118"]]},{"id":"9bdc1a2a.5c4868","type":"link in","z":"5b8974a.7ce288c","name":"Build Stub","links":["e8718ec8.ca693"],"x":140,"y":1600,"wires":[["4c9f81c4.70911"]],"l":true},{"id":"57ed9717.583228","type":"GSheet","z":"5b8974a.7ce288c","creds":"adb4e9b8.8beee8","method":"get","action":"","sheet":"","cells":"","name":"Read Input from GSheet (Build Stub)","x":1050,"y":1660,"wires":[["58c341dc.bf79e"]],"info":"Use the GSheet node to get the a set of rows from a google spreadsheet.\n\n# **Inputs**\n### **creds**\nThis is the name on the gauth configuration node. How to get the details is beyond the scope of what I am going to put into an individual node instance. Some details are at [node-red-contrib-google-sheets](https://flows.nodered.org/node/node-red-contrib-google-sheets)\n### **Method**\nIn this case using the get cells method to read a set of data.\n### **SpreadsheetID**\nUnused as the spreadsheet ID is passed in as part of the input msg, but if needed it would be the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n### **Cells**\nUnused as the requested cells are passed in as part of the input msg, but if it was being manually built for a static data source the format is made of of 3 parts with specific seperators:\n * **[Sheetname]** like Sheet1\n * **[upper left corner cell address]** like A1\n * **[lower right corner cell address]** like B2\n\nThe format is **[Sheetname]**!**[upper left corner cell address]**:**[lower right corner cell address]** giving an input like **Sheet1!A1:B2**\n "},{"id":"8336936a.4c344","type":"GSheet","z":"5b8974a.7ce288c","creds":"adb4e9b8.8beee8","method":"append","action":"","sheet":"","cells":"","name":"Append Built Row","x":2150,"y":1680,"wires":[["2c69f03a.b5b3a"]]},{"id":"fdfd0a52.4ecbb8","type":"function","z":"5b8974a.7ce288c","name":"Hubitat Devices Addition Builder..............................","func":"//Ref. TMS-000003\nlet entries = Object.entries(msg.keyvalues)\nlet cachedData = global.get(msg.globalsource)\nlet headerData = cachedData[0]\nlet index = 0\nlet resultingEntry = []\nlet found =false\nlet pushValue = \"\"\nfor (index = 0; index < headerData.length; index++)\n{\n    found = false\n    for (const [key, value] of entries) {\n        if (key === headerData[index])\n        {\n            found = true\n            pushValue = value\n        }\n        else if (\"DeviceID\" === headerData[index])\n        {\n            found = true\n            pushValue = msg.tempDeviceID\n        }\n        else if (\"Hub\" === headerData[index])\n        {\n            found = true\n            pushValue = \"Hubitat\"\n            }\n    }\n        if (found) {resultingEntry.push(pushValue)}\n        else{resultingEntry.push(\"\")}\n}\n//node.warn(msg.payload)\n//node.warn(resultingEntry)\nlet deviceTable = msg.payload\ndeviceTable.push(resultingEntry)\nglobal.set(msg.globalsource, deviceTable)\n    msg.payload = resultingEntry\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\nreturn msg","outputs":1,"noerr":0,"x":1790,"y":1560,"wires":[["8336936a.4c344","ae9a2756.96ba98"]]},{"id":"4b320e6c.a81e","type":"debug","z":"5b8974a.7ce288c","name":"Is this carrying source?","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1150,"y":3080,"wires":[]},{"id":"58c341dc.bf79e","type":"switch","z":"5b8974a.7ce288c","name":"","property":"exportableresults.MQTTname","propertyType":"msg","rules":[{"t":"eq","v":"HubitatTesting","vt":"str"},{"t":"eq","v":"???Homebridge???","vt":"str"},{"t":"eq","v":"???Zigbee2MQTT???","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":4,"x":1370,"y":1720,"wires":[["d98d317d.b522e"],["40928ea7.86ff6"],["27d8d47f.ea559c"],[]],"info":"This node decides which processing node to go to based on which hub the data is sourced from."},{"id":"40928ea7.86ff6","type":"function","z":"5b8974a.7ce288c","name":"Homebridge Addition Builder","func":"//Ref. TMS-000003\nlet entries = Object.entries(msg.keyvalues)\nlet cachedData = global.get(msg.globalsource)\nlet headerData = cachedData[0]\nlet index = 0\nlet resultingEntry = []\nlet found =false\nlet pushValue = \"\"\nfor (index = 0; index < headerData.length; index++)\n{\n    found = false\n    for (const [key, value] of entries) {\n        if (key === headerData[index])\n        {\n            found = true\n            pushValue = value\n        }\n        else if (\"DeviceID\" === headerData[index])\n        {\n            found = true\n            pushValue = msg.tempDeviceID\n        }\n        else if (\"Hub\" === headerData[index])\n        {\n            found = true\n            pushValue = \"HBxxx\"\n            }\n    }\n        if (found) {resultingEntry.push(pushValue)}\n        else{resultingEntry.push(\"\")}\n}\nnode.warn(msg.payload)\nnode.warn(resultingEntry)\nlet deviceTable = msg.payload\ndeviceTable.push(resultingEntry)\nglobal.set(msg.globalsource, deviceTable)\n    msg.payload = resultingEntry\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\nreturn msg","outputs":1,"noerr":0,"x":1640,"y":1680,"wires":[["8336936a.4c344"]]},{"id":"27d8d47f.ea559c","type":"function","z":"5b8974a.7ce288c","name":"Zig2MQTT Addition Builder","func":"//Ref. TMS-000003\nlet entries = Object.entries(msg.keyvalues)\nlet cachedData = global.get(msg.globalsource)\nlet headerData = cachedData[0]\nlet index = 0\nlet resultingEntry = []\nlet found =false\nlet pushValue = \"\"\nfor (index = 0; index < headerData.length; index++)\n{\n    found = false\n    for (const [key, value] of entries) {\n        if (key === headerData[index])\n        {\n            found = true\n            pushValue = value\n        }\n        else if (\"DeviceID\" === headerData[index])\n        {\n            found = true\n            pushValue = msg.tempDeviceID\n        }\n        else if (\"Hub\" === headerData[index])\n        {\n            found = true\n            pushValue = \"ZBxxx\"\n            }\n    }\n        if (found) {resultingEntry.push(pushValue)}\n        else{resultingEntry.push(\"\")}\n}\nnode.warn(msg.payload)\nnode.warn(resultingEntry)\nlet deviceTable = msg.payload\ndeviceTable.push(resultingEntry)\nglobal.set(msg.globalsource, deviceTable)\n    msg.payload = resultingEntry\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\nreturn msg","outputs":1,"noerr":0,"x":1640,"y":1720,"wires":[["8336936a.4c344"]]},{"id":"d98d317d.b522e","type":"switch","z":"5b8974a.7ce288c","name":"Which Table","property":"globalsource","propertyType":"msg","rules":[{"t":"eq","v":"Devices","vt":"str"},{"t":"eq","v":"MeasurementTranslations","vt":"str"},{"t":"eq","v":"DataTranslations","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":1430,"y":1600,"wires":[["fdfd0a52.4ecbb8"],["ba073488.eb55e8"],["2745e93f.78ce16"]],"info":"Still trying to figure out why I had this here"},{"id":"ba073488.eb55e8","type":"function","z":"5b8974a.7ce288c","name":"Hubitat MeasurementTranslations Addition Builder","func":"//Ref. TMS-000003\nlet entries = Object.entries(msg.keyvalues)\nlet cachedData = global.get(msg.globalsource)\nlet headerData = cachedData[0]\nlet index = 0\nlet resultingEntry = []\nlet found =false\nlet pushValue = \"\"\nfor (index = 0; index < headerData.length; index++)\n{\n    found = false\n    for (const [key, value] of entries) {\n        if (key === headerData[index])\n        {\n            found = true\n            pushValue = value\n        }\n        else if (\"DeviceID\" === headerData[index])\n        {\n            found = true\n            pushValue = msg.exportableresults.DeviceID\n        }\n        else if (\"Measurement\" === headerData[index])\n        {\n            found = true\n            pushValue = msg.exportableresults.Measure\n        }\n        else if (\"SourceDevice\" === headerData[index])\n        {\n            found = true\n            pushValue = msg.exportableresults.DeviceName\n        }\n        else if (\"ChangeNameTo\" === headerData[index])\n        {\n            found = true\n            pushValue = \"null\"\n        }\n        else if (\"Update Type\" === headerData[index])\n        {\n            found = true\n            pushValue = \"Stub\"\n        }\n    }\n        if (found) {resultingEntry.push(pushValue)}\n        else{resultingEntry.push(\"\")}\n}\n//node.warn(msg.payload)\n//node.warn(resultingEntry)\nlet deviceTable = msg.payload\ndeviceTable.push(resultingEntry)\nglobal.set(msg.globalsource, deviceTable)\n    msg.payload = resultingEntry\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\nreturn msg","outputs":1,"noerr":0,"x":1790,"y":1600,"wires":[["8336936a.4c344","a2e5d51e.b4e088"]]},{"id":"cd7f082a.b307a8","type":"debug","z":"5b8974a.7ce288c","name":"Before load build stub read","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1020,"y":1700,"wires":[]},{"id":"2039370e.13b188","type":"debug","z":"5b8974a.7ce288c","name":"null","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1330,"y":3080,"wires":[]},{"id":"b8435a40.a0ddf8","type":"debug","z":"5b8974a.7ce288c","name":"Check for spreadsheet id","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":930,"y":3060,"wires":[]},{"id":"9241ff10.4a616","type":"debug","z":"5b8974a.7ce288c","name":"6/11 Lookup Output","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1987.3697509765625,"y":97.3611068725586,"wires":[]},{"id":"397f6310.90cf2c","type":"change","z":"5b8974a.7ce288c","name":"Lookup 3 DataTranslations Settings","rules":[{"t":"set","p":"keyvalues.DeviceID","pt":"msg","to":"exportableresults.DeviceID","tot":"msg"},{"t":"set","p":"keyvalues.Measurement","pt":"msg","to":"exportableresults.Measure","tot":"msg"},{"t":"set","p":"searchfor.TranslationType","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1420,"y":240,"wires":[["f4e3bc01.2161a"]],"info":"## **inputs**\n### globalsource \nThe name of the global variable holding the table of data. In this case **\"Devices\"**\n### msg.keyvalues.Device\nThese components of the msg object are made up of key value pairs used to identify the row of data. The key corresponds to the column header identifying the column to look in and the value corresponds to what data value in that column qualifies as a matching row. In this case look in the **\"Device\"** column for the value pulled from the **msg.exportableresults.DeviceName** object.\n### msg.searchfor.DeviceID\nThese components of the msg object are made up of key value pairs used to retrieve the missing data. The key corresponds to the column header identifying the column to look in. In this case find the data in the **\"DeviceID\"** column.\n"},{"id":"c0dc09b7.01a9e8","type":"debug","z":"5b8974a.7ce288c","name":"Which lookup switch output 2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1340,"y":320,"wires":[]},{"id":"f4e3bc01.2161a","type":"function","z":"5b8974a.7ce288c","name":"","func":"node.warn(\"lookup 3\")\nreturn msg;","outputs":1,"noerr":0,"x":1670,"y":220,"wires":[["b0c9887a.a26758"]]},{"id":"45ddd513.fef5cc","type":"debug","z":"5b8974a.7ce288c","name":"Before load cache read","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":970,"y":1480,"wires":[]},{"id":"4cef0b69.737af4","type":"function","z":"5b8974a.7ce288c","name":"","func":"node.warn(\"lookup 2\")\nreturn msg;","outputs":1,"noerr":0,"x":1650,"y":180,"wires":[["b0c9887a.a26758"]]},{"id":"d744b303.ed5a7","type":"function","z":"5b8974a.7ce288c","name":"","func":"node.warn(\"lookup 1\")\nreturn msg;","outputs":1,"noerr":0,"x":1630,"y":120,"wires":[["b0c9887a.a26758"]]},{"id":"d71ddd5d.41e2a","type":"debug","z":"5b8974a.7ce288c","name":"Appended","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2360,"y":1760,"wires":[]},{"id":"a4d1e4c8.0e2b68","type":"debug","z":"5b8974a.7ce288c","name":"sent to stub q gate","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":990,"y":1580,"wires":[]},{"id":"2745e93f.78ce16","type":"function","z":"5b8974a.7ce288c","name":"Hubitat DataTranslations Addition Builder","func":"//Ref. TMS-000003\nlet entries = Object.entries(msg.keyvalues)\nlet cachedData = global.get(msg.globalsource)\nlet headerData = cachedData[0]\nlet index = 0\nlet resultingEntry = []\nlet found =false\nlet pushValue = \"\"\nfor (index = 0; index < headerData.length; index++)\n{\n    found = false\n    for (const [key, value] of entries) {\n        if (key === headerData[index])\n        {\n            found = true\n            pushValue = value\n        }\n        else if (\"DeviceID\" === headerData[index])\n        {\n            found = true\n            pushValue = msg.exportableresults.DeviceID\n        }\n        else if (\"Measurement\" === headerData[index])\n        {\n            found = true\n            pushValue = msg.exportableresults.Measure\n        }\n        else if (\"TranslationType\" === headerData[index])\n        {\n            found = true\n            pushValue = \"null\"\n        }\n        else if (\"Lookup Type\" === headerData[index])\n        {\n            found = true\n            pushValue = \"Stub\"\n        }\n    }\n        if (found) {resultingEntry.push(pushValue)}\n        else{resultingEntry.push(\"\")}\n}\n//node.warn(msg.payload)\n//node.warn(resultingEntry)\nlet deviceTable = msg.payload\ndeviceTable.push(resultingEntry)\nglobal.set(msg.globalsource, deviceTable)\n    msg.payload = resultingEntry\n    msg.cellstart = msg.ColStart + msg.MinRow;\n    msg.cellend = msg.ColEnd + msg.MaxRow;\n    msg.targetrange = msg.tab+\"!\"+msg.cellstart+\":\"+msg.cellend\n    delete msg.ColEnd\n    delete msg.MaxRow\n    delete msg.IgnoreEnvVar\n    delete msg.tab\n    delete msg.cellstart\n    delete msg.cellend\n    delete msg.targetrange\nreturn msg","outputs":1,"noerr":0,"x":1760,"y":1640,"wires":[["8336936a.4c344","62adfc23.3e6034"]]},{"id":"c9addf09.f90ad","type":"function","z":"5b8974a.7ce288c","name":"","func":"var reloadReadCount = context.get('reloadReadCount')||0;\n reloadReadCount +=1\n node.warn(\"Reload Cache read count = \"+reloadReadCount)\ncontext.set('reloadReadCount',reloadReadCount )\nreturn","outputs":1,"noerr":0,"x":750,"y":1500,"wires":[[]]},{"id":"b6a762e5.5ee4c","type":"function","z":"5b8974a.7ce288c","name":"","func":"var buildStubReadCount = context.get('buildStubReadCount')||0;\n buildStubReadCount +=1\n node.warn(\"Build Stub read count = \"+buildStubReadCount)\ncontext.set('buildStubReadCount',buildStubReadCount )\nreturn","outputs":1,"noerr":0,"x":950,"y":1740,"wires":[[]]},{"id":"ae9a2756.96ba98","type":"function","z":"5b8974a.7ce288c","name":"","func":"var devicesWriteCount = context.get('devicesWriteCount')||0;\n devicesWriteCount +=1\n node.warn(\"Hubitat Devices write count = \"+devicesWriteCount)\ncontext.set('devicesWriteCount',devicesWriteCount )\nreturn","outputs":1,"noerr":0,"x":2170,"y":1540,"wires":[[]]},{"id":"a2e5d51e.b4e088","type":"function","z":"5b8974a.7ce288c","name":"","func":"var measurementTranslationsWriteCount = context.get('measurementTranslationsWriteCount')||0;\n measurementTranslationsWriteCount +=1\n node.warn(\"Hubitat Measurement Translations write count = \"+measurementTranslationsWriteCount)\ncontext.set('measurementTranslationsWriteCount',measurementTranslationsWriteCount )\nreturn","outputs":1,"noerr":0,"x":2170,"y":1580,"wires":[[]]},{"id":"62adfc23.3e6034","type":"function","z":"5b8974a.7ce288c","name":"","func":"var dataTranslationsWriteCount = context.get('dataTranslationsWriteCount')||0;\n dataTranslationsWriteCount +=1\n node.warn(\"Hubitat Data Translations write count = \"+dataTranslationsWriteCount)\ncontext.set('dataTranslationsWriteCount',dataTranslationsWriteCount )\nreturn","outputs":1,"noerr":0,"x":2170,"y":1620,"wires":[[]]},{"id":"6cdd85f1.2d9d7c","type":"debug","z":"5b8974a.7ce288c","name":"post split","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":780,"y":600,"wires":[]},{"id":"b8cdc4bd.8f71d8","type":"debug","z":"5b8974a.7ce288c","name":"no split","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":320,"y":200,"wires":[]},{"id":"af2e41bf.ab153","type":"function","z":"5b8974a.7ce288c","name":"","func":"if (msg.payload.name.substr(0,1) ===\"a\") {\nreturn msg;\n}\nreturn","outputs":1,"noerr":0,"x":550,"y":540,"wires":[["6cdd85f1.2d9d7c","699bff70.46e8f"]]},{"id":"47dcbc64.299284","type":"comment","z":"5b8974a.7ce288c","name":"This node is Hubitat Specific for when there are so many items it overfils google quota","info":"","x":800,"y":540,"wires":[]},{"id":"b7515f69.b3c5","type":"join","z":"5b8974a.7ce288c","name":"","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":890,"y":420,"wires":[["9d8082c8.a5927"]]},{"id":"9d8082c8.a5927","type":"debug","z":"5b8974a.7ce288c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1200,"y":420,"wires":[]},{"id":"580a87ac.f86bf8","type":"function","z":"aad5f0e1.84355","name":"Transformation Lookup Hubitat Formatted Input","func":"//00001 Ref 8-8-20 Final Splitting Preprocessor for Hubitat Only.js\n// Main Function steps\n// 1. Get 3 globals and create placeholders for MeasurementTranslations table array, DataTranslations table array and returnable messages array\n{\n    let d = global.get(\"Devices\")\n    /* let mT = global.get(\"MeasurementTranslations\")\n    let dT = global.get(\"DataTranslations\")\n    let mTAdditions\n    let dTAdditions\n    let returnableMsgs */\n// 2. Check Device if in Devices table\n    let deviceName = msg.topic\n    let deviceID\n    if (msg.payload.hasOwnProperty('deviceId')) {\n        //This embedded check was created when a fully kiosk browser feed included a measurement with the name deviceId which confused the process creating an error\n        if (msg.payload.deviceId.hasOwnProperty('deviceId')) {\n            deviceID = msg.payload.deviceId.deviceId\n        }else{\n            // for the case when the payload is not nested as there is a single measurement\n            deviceID = msg.payload.deviceId\n        }\n    } else {\n        // for the case when the payload is nested as there are multiple measurements\n        deviceID = Object.values(msg.payload)[0].deviceId\n    }\n    let hub = msg.Source\n    let mainIndex\n    let dNCol   //device name column number\n    let dICol   //device ID column number\n    let stub =[]\n    //get column number for Device Name and Device ID\n    for (mainIndex = 0; mainIndex < d[0].length; mainIndex++) {\n        if (d[0][mainIndex] == 'Device') {\n            dNCol = mainIndex\n            continue\n        }\n        if (d[0][mainIndex] == 'DeviceID') {\n            dICol = mainIndex\n            continue\n        }\n    }\n    let matchingDataRows = d.filter((item) => (item[dNCol]== deviceName && item[dICol]== deviceID))\n    switch (matchingDataRows.length) {\n        case 0:\n            //i. if there is are no matching rows,  build stub  and send to output 1 (Add array to Devices table)\n            stub = [deviceName,\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"placeholder\",deviceID,hub]\n            msg.payload = stub\n            return [msg,null,null,null,null]\n            /*  1. msg Object containing an array of items to be added to the Devices table\n                2. msg Object containing an array of arrays where each sub array is to be added to MeasurementTranslations table\n                3. msg Object containing an array of arrays where each sub array is to be added to DataTranslations table\n                4. msg Object to be sent to data translation process (successful other than translation)\n                5. msg Object containing the results of successful lookup (no translation required)*/\n            break\n        case 1:\n            //ii. if there is just 1 row, then add those details to the exportable results portion of the msg object\n            msg[\"exportableresults\"]={}\n            for (mainIndex = 0; mainIndex < matchingDataRows[0].length; mainIndex++) {\n                if(matchingDataRows[mainIndex]!== \"\") {\n                    if  (matchingDataRows[0][mainIndex] != \"placeholder\") {\n                        //A. If it is not a stub, add those details to the exportable results portion of the msg object\n                        msg.exportableresults[d[0][mainIndex]] = matchingDataRows[0][mainIndex]\n                    } else {\n                        //B. If it is a stub, warn and then return nothing\n                        node.warn(\"The found information is a stub with placeholder as the MQTTDeviceTopic. No further processing will happen with this input.\"+matchingDataRows[0])\n                        return\n                    }\n                }\n            }\n            break\n        default:\n            //iii. if there are more than 1 row, give a warning and treat like 1 row\n            node.warn(\"Duplicate rows were found that matched the search criteria. The first matching row will be assumed to be correct.\")\n            msg[\"exportableresults\"]={}\n            for (mainIndex = 0; mainIndex < matchingDataRows[0].length; mainIndex++) {\n                if(matchingDataRows[mainIndex]!== \"\") {\n                    if  (matchingDataRows[0][mainIndex] != \"placeholder\") {\n                        //A. If it is not a stub, add those details to the exportable results portion of the msg object\n                        msg.exportableresults[d[0][mainIndex]] = matchingDataRows[0][mainIndex]\n                    } else {\n                        //B. If it is a stub, warn and then return nothing\n                        node.warn(\"The found information is a stub with placeholder as the MQTTDeviceTopic. No further processing will happen with this input.\")\n                        return\n                    }\n                }\n            }\n    };\n}\n/* 3. Call Iterate function which returns an object with 3 properties:\n    a. Array of stubs to be added to the MeasurementTranslations table\n    b. Array of stubs to be added to the DataTranslations table\n    c. Array of messages that can be sent to later processing nodes\n */\n[mTAdditions, dTAdditions, returnableMsgs] = RED.util.cloneMessage(iterativeProcessor(msg)) //getting 3 thing back from 1 function call\n//4. Send Messages from Iterate function\n{\n    //! Loop through the returned messages as they need to be sent along 1 at a time\n    if (returnableMsgs !== null) {\n        for (index = 0; index < returnableMsgs.length; index++) {\n            //a. Sort those that need data translations from those that don't\n            if ((typeof returnableMsgs[index].exportableresults.Translation == 'undefined') || (returnableMsgs[index].exportableresults.Translation == null)) {\n                //b. Send those that don't to output 5\n                node.send([null,null,null,null,returnableMsgs[index]])\n            } else {\n                //c. Send those needing to output 4\n                node.send([null,null,null,returnableMsgs[index],null])\n            }\n        }\n    }\n    //! check if both, either or niether mTadditions or dTAdditions need to be sent downstream\n    if ((mTAdditions !== null) &&(dTAdditions !== null)) {\n        return [null,{MeasurementTableAdditions:mTAdditions},{DataTranslationTableAdditions:dTAdditions},null,null]\n    } else {\n        if (mTAdditions !== null) {\n            // mTA only node.warn(\"TF\")\n            return [null,{MeasurementTableAdditions:mTAdditions},null,null,null]\n        } else {\n            if (dTAdditions !== null) {\n                // dTA only node.warn(\"FT\")\n                return [null,null,{DataTranslationTableAdditions:dTAdditions},null,null]\n            }\n        }\n    }\n}\n//5. Send MeasurementTranslations and DataTranslations table updates from Iterate function\n{    // check if both, either or neither mTadditions or dTAdditions need to be sent downstream\n    if ((mTAdditions !== null) &&(dTAdditions !== null)) {\n        // both node.warn(\"TT\")\n        return [null,{MeasurementTableAdditions:mTAdditions},{DataTranslationTableAdditions:dTAdditions},null,null]\n    } else {\n        if (mTAdditions !== null) {\n            // mTA only node.warn(\"TF\")\n            return [null,{MeasurementTableAdditions:mTAdditions},null,null,null]\n        } else {\n            if (dTAdditions !== null) {\n                // dTA only node.warn(\"FT\")\n                return [null,null,{DataTranslationTableAdditions:dTAdditions},null,null]\n            } else {\n                // neither node.warn(\"FF\")\n                return\n            }\n        }\n    }\n}\n\n/*//! Previously tested functions that are used, but are not new test items\n    isvalidJSONstring\n    issplittablevalidJSONstring\n    isvalidarray\n    issplittablearray\n    simpleVsComplex\n *///!\n/* isvalidJSONstring\n        This function was found on the internet to check if an input is valid JSON\n        There seems to be a belief that there should be some more elegant method that trying parse and the catching the error,\n        but no one seems to have demonstrated what that more elegant way would be\n */\nfunction isvalidJSONstring(str)\n{\n//1. Try to send it to JSON.parse and catch the error a false, and no error as true.\n    try {JSON.parse(str);}\n    catch (e) {return false;}\n    return true;\n}\n/* issplittablevalidJSONstring\n    This function decides where the JSON is made up of at least 1 key:value pair\n */\nfunction issplittablevalidJSONstring(str) {\n//1. Check to see if there is a colon (:) in the string\n    if (str.includes(\":\")) { return true;}\n    else {return false;}\n}\n/* isvalidarray\n    This function is simply wrapping the Array.isArray, to align the function naming with the other true false functions\n */\nfunction isvalidarray(str) {\n//1. Evaluate using Array.isArray function\n    if (Array.isArray(str)) {return true;}\n    else {return false;}\n}\n/* issplittablearray\n    This function identifies if the array has only a single entry or multiple entries i.e. [\"Apple\"] not splittable,\n    [\"Apple\",\"Pear\"] splittable\n */\nfunction issplittablearray(str) {\n    // If the length is more than 1, then the array has mutliple entries, but if it is just 1, then it is not splittable\n    if (str.length > 1) {return true;}\n    else {return false;}\n}\n/* simpleVsComplex\n    Examines the incoming value and decides if it is a simple one that can be handled by the simple processor or complex\n    complex values are like JSON, arrays or object\n*/\nfunction simpleVsComplex(passedMsgPayloadxxxValue) {\n//1. Determine what type of JS item it is\n    switch (typeof (passedMsgPayloadxxxValue)) {\n        case \"number\":\n        case \"bigint\":\n        case \"boolean\":\n    //a. number, bigint, and boolean are simple objects that can't be decomposed so return simple\n            return \"simple\"\n            break;\n        case \"string\":\n    //b. string may be one of several actual types\n        //i. check if it is actually JSON\n        //      and if it is then determine which type of JSON\n        //      and return either splittable or unsplittable JSON \n            if (isvalidJSONstring(passedMsgPayloadxxxValue)) {\n                //When it is \"valid\" JSON, check if it is splittable\n                if (issplittablevalidJSONstring(passedMsgPayloadxxxValue)) {\n                    //When it is splittable, then return type as splittable JSON\n                    return \"splittable JSON\"\n                } else {\n                    //if it is JSON, but not splittable ({}, \"100\", 100) return unsplittable JSON\n                    return \"unsplittable JSON\"\n                }\n            }\n            else {\n        //ii. if it isn't JSON, check if it is actually an array\n        //      and if it is then determine which type of array\n        //      and return either splittable or unsplittable array\n                if (isvalidarray(passedMsgPayloadxxxValue)) {\n                    //When it is an array, check if it is splittable\n                    if (issplittablearray(passedMsgPayloadxxxValue)) {\n                        //When it is splittable, return splittable Array\n                        return \"splittable Array\"\n                    } else {\n                        //if the array is not splittable ([\"apple\"]) return unsplittable array\n                        return \"unsplittable array\"\n                    }\n                } else {\n        //iii. if it isn't an array, return simple since it is just a simple string \n                    return \"simple\"\n                }\n            }\n            break;\n        case \"object\":\n    //c. objects should be evaluated as a string\n        //i. check if it is actually JSON, and if it is then determine which type of JSON and return either splittable or unsplittable JSON \n            if (isvalidJSONstring(passedMsgPayloadxxxValue)) {\n                //When it is \"valid\" JSON, check if it is splittable\n                if (issplittablevalidJSONstring(passedMsgPayloadxxxValue)) {\n                    //When it is splittable, then return type as splittable JSON\n                    return \"complex splittable JSON\"\n                } else {\n                    //if it is JSON, but not splittable ({}, \"100, 100) return unsplittable JSON\n                    return \"complex unsplittable JSON\"\n                }\n            } else {\n        //ii. if it isn't JSON, check if it is actually an array, and if it is then determine which type of array and return either splittable or unsplittable array\n                if (isvalidarray(passedMsgPayloadxxxValue)) {\n                    //When it is an array, check if it is splittable\n                    if (issplittablearray(passedMsgPayloadxxxValue)) {\n                        //When it is splittable, return splittable Array\n                        return \"complex splittable Array\"\n                    } else {\n                        //if the array is not splittable ([\"apple\"]) return unsplittable array\n                        return \"complex unsplittable array\"\n                    }\n                } else {\n        //iii. if it isn't an array, return complex obect to be handled by code to account for an uncared for result\n                    //When it is neither JSON or Array, then I have not accounted for it. If you reach this point during an\n                    //  investigation, it might be worth using the example that triggered your investigation to see if the object\n                    //  is really just a string (without a triggering example I have not investigated)\n                    return \"complex object\"\n                }\n            }\n            break;\n        default:\n    //d. When the type is not one that was coded for then return unhandled because the situation is by definition unhandled\n            node.warn(\"Unexpected type of result = \" + typeof (passedMsgPayloadxxxValue))\n            return \"unhandled\"\n    }\n}\n/*//! Hand updated functions that need to be tested\n    simpleInputProcessor\n    complexInputProcessor\n    iterativeProcessor\n*///!\nfunction simpleInputProcessor(sMsg){\n    let simpleIndex //a variable to be used as an index for looping inside the \"simple\" function\n    let dICol       //DeviceID column #\n    let mCol        //Measurement column #\n    let sDCol       //Source Device column #\n//1. Get the deviceID\n    let deviceID = sMsg.exportableresults.DeviceID\n//2. get the measurement\n    let measurementName = sMsg.payload[Object.keys(sMsg.payload)[0]].name\n//3. Get the value of the measurement\n    let measurementValue = sMsg.payload[Object.keys(sMsg.payload)[0]].value\n//4. Get the source device\n    let sourceDevice = sMsg.exportableresults.Device\n//5. Initialize the results\n    let resultsArray = [null,null,null]\n//6. Get global variable for MeasurementTranslations\n    let mT = global.get(\"MeasurementTranslations\")\n//7 Find the column numbers for 3 lookup items in the MeasurementTranslations table\n    for (simpleIndex = 0; simpleIndex < mT[0].length; simpleIndex++)\n    {\n        if (mT[0][simpleIndex] == 'DeviceID')\n        {\n            dICol = simpleIndex\n            continue\n        }\n        if (mT[0][simpleIndex] == 'Measurement')\n        {\n            mCol = simpleIndex\n            continue\n        }\n        if (mT[0][simpleIndex] == 'SourceDevice')\n        {\n            sDCol = simpleIndex\n            continue\n        }\n    }\n//8. Check if DeviceID, Measurement, and SourceDevice are in MeasurementTranslations table\n    let matchingDataRows = mT.find((item) => (item[mCol]== measurementName && item[dICol]== deviceID&& item[sDCol]== sourceDevice))\n//a. If Meaurement is not in MeasurementTranslations, build and return stub\n    if(matchingDataRows == null)\n    {\n        missingMeasurementTranslationStub = [sMsg.exportableresults.DeviceID, measurementName, \"Stub\", sourceDevice, \"Stub\"]\n        return [[missingMeasurementTranslationStub],null,null] //*Note missingDataTranslationStub is an array so this is return an array[1] with the missingDataTranslationStub array as that single entry\n    }\n    else{\n        if((matchingDataRows[4] == \"Permanent\")&& (matchingDataRows[5] == \"No\")){\n            return [null,null,null]\n        } \n        if((matchingDataRows[4] == \"Permanent\")&& (matchingDataRows[2] !== \"null\"))\n//b. if lookup finds a row and the Update type ([4]) = Permanent and the ChangeNameTo ([2]) <> null, then popluate exportableresults[\"Measurement\"] and exportableresults[\"Value\"]\n        {        \n            sMsg.exportableresults[\"Measurement\"] = matchingDataRows[2]\n            measurementName = matchingDataRows[2]\n            sMsg.exportableresults[\"Value\"] = measurementValue\n        }\n        else if ((matchingDataRows[4] == \"Permanent\")&& (matchingDataRows[2] == \"null\"))\n//c. if lookup finds a row and the Update type ([4]) = Permanent and the ChangeNameTo ([2]) = null, then popluate exportableresults[\"Measurement\"] and exportableresults[\"Value\"]\n        {\n            sMsg.exportableresults[\"Measurement\"] = matchingDataRows[1]\n            sMsg.exportableresults[\"Value\"] = measurementValue\n        }\n        else\n//d. if lookout finds a row and the Update type ([4]) <> Permanent, then warn that the measurement has a stub and return all nulls\n        {\n            if (matchingDataRows[5] !== 'No'){\n                node.warn(\"Only a stub entry in the Measurements Translation table is there for \\n\" + matchingDataRows[1] + \"\\n so this measurement will not be passed downstream.\")\n            }\n            return [null,null,null]\n        }\n    }\n//9. Get global variable for DataTranslations\n    let dT = global.get(\"DataTranslations\")\n//10. Find the column numbers for 3 lookup items in the MeasurementTranslations table\n    for (simpleIndex = 0; simpleIndex < dT[0].length; simpleIndex++)\n        {\n            if (dT[0][simpleIndex] == 'DeviceID')\n            {\n                dICol = simpleIndex\n                continue\n            }\n            if (dT[0][simpleIndex] == 'Measurement')\n            {\n                mCol = simpleIndex\n                continue\n            }\n        }\n//11. Check if DeviceID, and Measurement are in DataTranslations table\n    matchingDataRows = dT.find((item) => (item[mCol]== measurementName && item[dICol]== deviceID))\n    if(matchingDataRows == null)\n//a. if DeviceID and Measurement are not in DataTranslations, build return stub\n    {\n        missingDataTranslationStub = [sMsg.exportableresults.DeviceID, measurementName,\"null\", \"Stub\",measurementValue]\n        return [null,[missingDataTranslationStub],null] //*Note missingDataTranslationStub is an array so this is return an array[1] with the missingDataTranslationStub array as that single entry\n    }\n    else\n    {\n        if((matchingDataRows[2] !== \"null\") && (matchingDataRows[3] == \"Permanent\"))\n//b. if DeviceID and Measurement are in DataTranslations table and Lookup Type([3]) = permanent and TranslationType <> null then add the translation to exportableresults[\"Translation\"]\n        {\n            sMsg.exportableresults[\"Translation\"] = matchingDataRows[2]\n        }\n        else if (matchingDataRows[3] !== \"Permanent\")\n//c. if DeviceID, and Measurement are in DataTranslations table and Lookup Type([3]) = permanent, then warn that the measurement has a stub and return all nulls\n        {\n            node.warn(\"Only a stub entry in the Data Translations table is there for Device Id = \" +matchingDataRows[0] +\" Measurement = \"+ matchingDataRows[1] + \" so this measurement will not be passed downstream.\")\n            return [null,null, null]\n        }\n    }\n//12. Return the updated message\n    return[null, null, [sMsg]]  //*Note sMsg is an object so this is return an array[1] with the sMsg object as that single entry\n}\n\nfunction complexInputProcessor(sMsg,typeOfComplex) {\n    let mTAdditions\n    let dTAdditions\n    let returnableMsgs\n    let compOut=[null,null,null];\n    let valueJSON\n    let name\n    switch (typeOfComplex)\n    {\n        case \"Splittable JSON\":\n        //This is for cases where the JSON is in the form of key:value where there is at least 1 pair\n        //  Examples of \"valid\" JSON that would not be coming to this case would be {} or 100\n            //put the inputs value into a variable for easier access\n            valueJSON = JSON.parse(Object.entries(sMsg.payload)[0][1].value); //! This is where the bug is for C3\n            //put the inputs name aside for multiple reuses\n            name = Object.entries(sMsg.payload)[0][1].name\n            //Iterative loop as there may be multiple properites within the Object\n            Object.keys(valueJSON).forEach(function (key) {\n                //concatenate the original name, a colon and the key from the pair\n                    Object.entries(sMsg.payload)[0][1].name = name + \":\" + key;\n                //move the value from the pair to payload.value\n                    Object.entries(sMsg.payload)[0][1].value = valueJSON[key];\n                //with the object transformed, then this call is to the iterativeProcessor\n                //  just like the main function calls. Thus the iterativeProcessor function may\n                //  find that the new value is a simple value and return the results from the\n                //  simpleProcessor of may call the complexProcessor where eventually the bottom \n                //  of some finite number of nested values is reached\n                    //! Note that becaue an array of 3 variables is getting the result of the call\n                    //!     the preceeding statement must end with a semicolon (;) or else the array\n                    //!     looks like part of that statement\n                    [mTAdditions, dTAdditions, returnableMsgs] = RED.util.cloneMessage(iterativeProcessor(sMsg))\n                //! Source for duplicate code\n                //First process the mTAdditions that are returned (if any)\n                    if (compOut[0] === null){\n                    //the array is transferred in when it can replace null\n                        compOut[0] = mTAdditions\n                    } else if (Array.isArray(compOut[0])) {\n                    //if however there is already an array, then more complexity is involved \n                        if (Array.isArray(mTAdditions)) {\n                        //this complexity only occurs if the returned value is an array\n                        //  if is is an array then this code loops through that array and\n                        //  adds each array member to the preexisting array\n                            for (index1 = 0; index1 < mTAdditions.length; index1++) { \n                                compOut[0].push(mTAdditions[index1])\n                            }    \n                        }\n                    }\n                //Second process the dTAdditions that are returned (if any)\n                    if (compOut[1] === null){\n                    //the array is transferred in when it can replace null\n                        compOut[1] = dTAdditions\n                    } else if (Array.isArray(compOut[1])) {\n                    //if however there is already an array, then more complexity is involved \n                        if (Array.isArray(dTAdditions)) {\n                        //this complexity only occurs if the returned value is an array\n                        //  if is is an array then this code loops through that array and\n                        //  adds each array member to the preexisting array\n                            for (index1 = 0; index1 < dTAdditions.length; index1++) { \n                                compOut[1].push(dTAdditions[index1])\n                            }    \n                        }\n                    }\n                //Third process the returnableMsgs that are returned (if any)\n                    if (compOut[2] === null){\n                    //the array is transferred in when it can replace null\n                        compOut[2] = returnableMsgs\n                    } else if (Array.isArray(compOut[2])) {\n                    //if however there is already an array, then more complexity is involved \n                        if (Array.isArray(returnableMsgs)) {\n                        //this complexity only occurs if the returned value is an array\n                        //  if is is an array then this code loops through that array and\n                        //  adds each array member to the preexisting array\n                            for (index1 = 0; index1 < returnableMsgs.length; index1++) { \n                                compOut[2].push(returnableMsgs[index1])\n                            }    \n                        }\n                    }\n//? In retrospect, intead of getting 3 items back from iterative processor, it should have been possible to get a\n//?     single variable back and then looped through the array that was returned instead of having 3 very similar\n//?     code pieces (1 for each of the 3 pieces of data)\n                }\n            )\n            return compOut\n        case \"Unsplittable JSON\":\n            //This is for handling \"valid\" JSON that does not have key:value pairs.\n            //  Examples of \"valid\" JSON that are handed here are {} or 100 or \"100\"\n            //  This case either treats it as a string (no changes made) or a number where a number in\n            //  a string like \"100\" is changed into an actual number like 100\n\n            //by checking if NaN, if it is a number 100 or \"100\", the ++ followed by -- changes it to a number 100\n            //  without changing its actual value\n            if (isNaN(sMsg.payload.value)) {\n            //When the value is not a number return nothing\n                return [null,null,null]\n            } else {\n            //When it pass the NAN do this math to convert \"1\" into 1 or similar numbers as a string\n                ++sMsg.payload.value;\n                --sMsg.payload.value;\n            };\n            //send the version of the msg with an atomic value to downstream nodes (could probably just recursively call\n            //! Note that becaue an array of 3 variables is getting the result of the call\n            //!     the preceeding statement must end with a semicolon (;) or else the array\n            //!     looks like part of that statement\n            [mTAdditions, dTAdditions, returnableMsgs] = RED.util.cloneMessage(iterativeProcessor(sMsg))\n            //! This section until the major blue part about being about to loop through an array is duplicate 1\n            //First process the mTAdditions that are returned (if any)\n            if (compOut[0] === null){\n                //the array is transferred in when it can replace null\n                    compOut[0] = mTAdditions\n                } else if (Array.isArray(compOut[0])) {\n                //if however there is already an array, then more complexity is involved \n                    if (Array.isArray(mTAdditions)) {\n                    //this complexity only occurs if the returned value is an array\n                    //  if is is an array then this code loops through that array and\n                    //  adds each array member to the preexisting array\n                        for (index1 = 0; index1 < mTAdditions.length; index1++) { \n                            compOut[0].push(mTAdditions[index1])\n                        }    \n                    }\n                }\n            //Second process the dTAdditions that are returned (if any)\n                if (compOut[1] === null){\n                //the array is transferred in when it can replace null\n                    compOut[1] = dTAdditions\n                } else if (Array.isArray(compOut[1])) {\n                //if however there is already an array, then more complexity is involved \n                    if (Array.isArray(dTAdditions)) {\n                    //this complexity only occurs if the returned value is an array\n                    //  if is is an array then this code loops through that array and\n                    //  adds each array member to the preexisting array\n                        for (index1 = 0; index1 < dTAdditions.length; index1++) { \n                            compOut[1].push(dTAdditions[index1])\n                        }    \n                    }\n                }\n            //Third process the returnableMsgs that are returned (if any)\n                if (compOut[2] === null){\n                //the array is transferred in when it can replace null\n                    compOut[2] = returnableMsgs\n                } else if (Array.isArray(compOut[2])) {\n                //if however there is already an array, then more complexity is involved \n                    if (Array.isArray(returnableMsgs)) {\n                    //this complexity only occurs if the returned value is an array\n                    //  if is is an array then this code loops through that array and\n                    //  adds each array member to the preexisting array\n                        for (index1 = 0; index1 < returnableMsgs.length; index1++) { \n                            compOut[2].push(returnableMsgs[index1])\n                        }    \n                    }\n                }\n//? In retrospect, intead of getting 3 items back from iterative processor, it should have been possible to get a\n//?     single variable back and then looped through the array that was returned instead of having 3 very similar\n//?     code pieces (1 for each of the 3 pieces of data)\n                return compOut\n        case \"Splittable Array\":\n            //This is for cases where the Array is in the form [\"A\",\"B\",\"C\"] where there is are at least 2 members\n            // Loop through the array\n            for (index = 0; index < sMsg.payload.value.length; index++) {\n                // move the current position within the array's value to the value position\n                sMsg.payload.value = sMsg.payload.value[index];\n                // then recursively call this function in case the value is itself splittable\n                //! Note that becaue an array of 3 variables is getting the result of the call\n                //!     the preceeding statement must end with a semicolon (;) or else the array\n                //!     looks like part of that statement\n                [mTAdditions, dTAdditions, returnableMsgs] = RED.util.cloneMessage(iterativeProcessor(sMsg))\n                //! This section until the major blue part about being about to loop through an array is duplicate 2\n                //First process the mTAdditions that are returned (if any)\n                if (compOut[0] === null){\n                    //the array is transferred in when it can replace null\n                        compOut[0] = mTAdditions\n                    } else if (Array.isArray(compOut[0])) {\n                    //if however there is already an array, then more complexity is involved \n                        if (Array.isArray(mTAdditions)) {\n                        //this complexity only occurs if the returned value is an array\n                        //  if is is an array then this code loops through that array and\n                        //  adds each array member to the preexisting array\n                            for (index1 = 0; index1 < mTAdditions.length; index1++) { \n                                compOut[0].push(mTAdditions[index1])\n                            }    \n                        }\n                    }\n                //Second process the dTAdditions that are returned (if any)\n                    if (compOut[1] === null){\n                    //the array is transferred in when it can replace null\n                        compOut[1] = dTAdditions\n                    } else if (Array.isArray(compOut[1])) {\n                    //if however there is already an array, then more complexity is involved \n                        if (Array.isArray(dTAdditions)) {\n                        //this complexity only occurs if the returned value is an array\n                        //  if is is an array then this code loops through that array and\n                        //  adds each array member to the preexisting array\n                            for (index1 = 0; index1 < dTAdditions.length; index1++) { \n                                compOut[1].push(dTAdditions[index1])\n                            }    \n                        }\n                    }\n                //Third process the returnableMsgs that are returned (if any)\n                    if (compOut[2] === null){\n                    //the array is transferred in when it can replace null\n                        compOut[2] = returnableMsgs\n                    } else if (Array.isArray(compOut[2])) {\n                    //if however there is already an array, then more complexity is involved \n                        if (Array.isArray(returnableMsgs)) {\n                        //this complexity only occurs if the returned value is an array\n                        //  if is is an array then this code loops through that array and\n                        //  adds each array member to the preexisting array\n                            for (index1 = 0; index1 < returnableMsgs.length; index1++) { \n                                compOut[2].push(returnableMsgs[index1])\n                            }    \n                        }\n                    }\n//? In retrospect, intead of getting 3 items back from iterative processor, it should have been possible to get a\n//?     single variable back and then looped through the array that was returned instead of having 3 very similar\n//?     code pieces (1 for each of the 3 pieces of data)\n            }\n            return compOut\n        case \"Unsplittable Array\":\n            //This case is where the item is an array, but with only a single entry. The idea is to move that single\n            //  value out of the array and into the value natively and then to call the recursive function to evaluate\n            //  what type of item it now is and then process (split or send or extract) appropriately\n            Object.entries(sMsg.payload)[0][1].value = Object.entries(sMsg.payload)[0][1].value[0];\n            //! Note that becaue an array of 3 variables is getting the result of the call\n            //!     the preceeding statement must end with a semicolon (;) or else the array\n            //!     looks like part of that statement\n            [mTAdditions, dTAdditions, returnableMsgs] = RED.util.cloneMessage(iterativeProcessor(sMsg))\n            //! This section until the major blue part about being about to loop through an array is duplicate 3\n            //First process the mTAdditions that are returned (if any)\n            if (compOut[0] === null){\n                //the array is transferred in when it can replace null\n                    compOut[0] = mTAdditions\n                } else if (Array.isArray(compOut[0])) {\n                //if however there is already an array, then more complexity is involved \n                    if (Array.isArray(mTAdditions)) {\n                    //this complexity only occurs if the returned value is an array\n                    //  if is is an array then this code loops through that array and\n                    //  adds each array member to the preexisting array\n                        for (index1 = 0; index1 < mTAdditions.length; index1++) { \n                            compOut[0].push(mTAdditions[index1])\n                        }    \n                    }\n                }\n            //Second process the dTAdditions that are returned (if any)\n                if (compOut[1] === null){\n                //the array is transferred in when it can replace null\n                    compOut[1] = dTAdditions\n                } else if (Array.isArray(compOut[1])) {\n                //if however there is already an array, then more complexity is involved \n                    if (Array.isArray(dTAdditions)) {\n                    //this complexity only occurs if the returned value is an array\n                    //  if is is an array then this code loops through that array and\n                    //  adds each array member to the preexisting array\n                        for (index1 = 0; index1 < dTAdditions.length; index1++) { \n                            compOut[1].push(dTAdditions[index1])\n                        }    \n                    }\n                }\n            //Third process the returnableMsgs that are returned (if any)\n                if (compOut[2] === null){\n                //the array is transferred in when it can replace null\n                    compOut[2] = returnableMsgs\n                } else if (Array.isArray(compOut[2])) {\n                //if however there is already an array, then more complexity is involved \n                    if (Array.isArray(returnableMsgs)) {\n                    //this complexity only occurs if the returned value is an array\n                    //  if is is an array then this code loops through that array and\n                    //  adds each array member to the preexisting array\n                        for (index1 = 0; index1 < returnableMsgs.length; index1++) { \n                            compOut[2].push(returnableMsgs[index1])\n                        }    \n                    }\n                }\n//? In retrospect, intead of getting 3 items back from iterative processor, it should have been possible to get a\n//?     single variable back and then looped through the array that was returned instead of having 3 very similar\n//?     code pieces (1 for each of the 3 pieces of data)\n                return compOut\n        case \"Object\":\n            //This is for handling an object. It then calls splitObj to create multiple msgs with the object keys into the names\n            //  and the values from those keys moved into the value of the new object.\n            \n            //put the inputs name aside for multiple reuses\n            name = Object.entries(sMsg.payload)[0][1].name\n            //Iterative loop\n            // for (let [key, value] of Object.entries(sMsg.payload.value)) {\n            for (let [key, value] of Object.entries(Object.entries(sMsg.payload)[0][1].value)) {\n                    if ((value !== null) && (key !== null)){\n                        Object.entries(sMsg.payload)[0][1].name = name + \":\" + key;\n                        Object.entries(sMsg.payload)[0][1].value = value; \n                        //recursively call this function in case the value is itself splittable\n                        //! Note that becaue an array of 3 variables is getting the result of the call\n                        //!     the preceeding statement must end with a semicolon (;) or else the array\n                        //!     looks like part of that statement\n                        [mTAdditions, dTAdditions, returnableMsgs] = RED.util.cloneMessage(iterativeProcessor(sMsg))\n                        //! This section until the major blue part about being about to loop through an array is duplicate 4\n                        //First process the mTAdditions that are returned (if any)\n                        if (compOut[0] === null){\n                            //the array is transferred in when it can replace null\n                                compOut[0] = mTAdditions\n                            } else if (Array.isArray(compOut[0])) {\n                            //if however there is already an array, then more complexity is involved \n                                if (Array.isArray(mTAdditions)) {\n                                //this complexity only occurs if the returned value is an array\n                                //  if is is an array then this code loops through that array and\n                                //  adds each array member to the preexisting array\n                                    for (index1 = 0; index1 < mTAdditions.length; index1++) { \n                                        compOut[0].push(mTAdditions[index1])\n                                    }    \n                                }\n                            }\n                        //Second process the dTAdditions that are returned (if any)\n                            if (compOut[1] === null){\n                            //the array is transferred in when it can replace null\n                                compOut[1] = dTAdditions\n                            } else if (Array.isArray(compOut[1])) {\n                            //if however there is already an array, then more complexity is involved \n                                if (Array.isArray(dTAdditions)) {\n                                //this complexity only occurs if the returned value is an array\n                                //  if is is an array then this code loops through that array and\n                                //  adds each array member to the preexisting array\n                                    for (index1 = 0; index1 < dTAdditions.length; index1++) { \n                                        compOut[1].push(dTAdditions[index1])\n                                    }    \n                                }\n                            }\n                        //Third process the returnableMsgs that are returned (if any)\n                            if (compOut[2] === null){\n                            //the array is transferred in when it can replace null\n                                compOut[2] = returnableMsgs\n                            } else if (Array.isArray(compOut[2])) {\n                            //if however there is already an array, then more complexity is involved \n                                if (Array.isArray(returnableMsgs)) {\n                                //this complexity only occurs if the returned value is an array\n                                //  if is is an array then this code loops through that array and\n                                //  adds each array member to the preexisting array\n                                    for (index1 = 0; index1 < returnableMsgs.length; index1++) { \n                                        compOut[2].push(returnableMsgs[index1])\n                                    }    \n                                }\n                            }\n//? In retrospect, intead of getting 3 items back from iterative processor, it should have been possible to get a\n//?     single variable back and then looped through the array that was returned instead of having 3 very similar\n//?     code pieces (1 for each of the 3 pieces of data)\n                }\n            }\n            return compOut\n        default:\n            //This is just in case no valid process is found by the typeofhubitatvalue function.\n            //  If you encounter this then you will either need to investigate the function or contact tmichael in\n            //  Hubitat discourse forums https://community.hubitat.com/\n            return [null,null,null]\n    }\n}\n\nfunction iterativeProcessor(iMsg){\n    let mTAdditions\n    let dTAdditions\n    let returnableMsgs\n\n    let typeOfValue\n    let iterOut=[null,null,null];\n//1. Iterate through the multiple xxx items within msg.payload\n    for (var [key, value] of Object.entries(iMsg.payload))\n    {\n        if (!(msg.payload.hasOwnProperty('deviceId')))\n        {\n            iMsg.payload ={[key]:value}\n        }\n        if (iMsg.payload[key].value === null){\n            node.warn(\"The value of   \"+iMsg.payload[key].name+\"   is null so reading will not be processed. The trackData that is returned by an echo dot is an example of a reading that triggers this.\")\n            continue\n        }\n//a. Determine Simple vs. Complex based on msg.payload.xxx.dataType:\n        typeOfValue = simpleVsComplex(iMsg.payload[key].value)\n        switch(typeOfValue)\n        {\n            case \"simple\":\n//1. Call simpleInputProcessor function and get back 3 items (Note: Only 0 or 1  of the 3 will have a length > 0):\n                //! Note that becaue an array of 3 variables is getting the result of the call\n                //!     the preceeding statement must end with a semicolon (;) or else the array\n                //!     looks like part of that statement\n                [mTAdditions, dTAdditions, returnableMsgs] = RED.util.cloneMessage(simpleInputProcessor(iMsg))\n                //! This section until the major blue part about being about to loop through an array is duplicate 5\n                //First process the mTAdditions that are returned (if any)\n                if (iterOut[0] === null){\n                    //the array is transferred in when it can replace null\n                        iterOut[0] = mTAdditions\n                    } else if (Array.isArray(iterOut[0])) {\n                    //if however there is already an array, then more complexity is involved \n                        if (Array.isArray(mTAdditions)) {\n                        //this complexity only occurs if the returned value is an array\n                        //  if is is an array then this code loops through that array and\n                        //  adds each array member to the preexisting array\n                            for (index1 = 0; index1 < mTAdditions.length; index1++) { \n                                iterOut[0].push(mTAdditions[index1])\n                            }    \n                        }\n                    }\n                //Second process the dTAdditions that are returned (if any)\n                    if (iterOut[1] === null){\n                    //the array is transferred in when it can replace null\n                        iterOut[1] = dTAdditions\n                    } else if (Array.isArray(iterOut[1])) {\n                    //if however there is already an array, then more complexity is involved \n                        if (Array.isArray(dTAdditions)) {\n                        //this complexity only occurs if the returned value is an array\n                        //  if is is an array then this code loops through that array and\n                        //  adds each array member to the preexisting array\n                            for (index1 = 0; index1 < dTAdditions.length; index1++) { \n                                iterOut[1].push(dTAdditions[index1])\n                            }    \n                        }\n                    }\n                //Third process the returnableMsgs that are returned (if any)\n                    if (iterOut[2] === null){\n                    //the array is transferred in when it can replace null\n                        iterOut[2] = returnableMsgs\n                    } else if (Array.isArray(iterOut[2])) {\n                    //if however there is already an array, then more complexity is involved \n                        if (Array.isArray(returnableMsgs)) {\n                        //this complexity only occurs if the returned value is an array\n                        //  if is is an array then this code loops through that array and\n                        //  adds each array member to the preexisting array\n                            for (index1 = 0; index1 < returnableMsgs.length; index1++) { \n                                iterOut[2].push(returnableMsgs[index1])\n                            }    \n                        }\n                    }\n//? In retrospect, intead of getting 3 items back from iterative processor, it should have been possible to get a\n//?     single variable back and then looped through the array that was returned instead of having 3 very similar\n//?     code pieces (1 for each of the 3 pieces of data)\n                    break\n            case \"splittable JSON\":\n            case \"complex splittable JSON\":\n                //! Note that becaue an array of 3 variables is getting the result of the call\n                //!     the preceeding statement must end with a semicolon (;) or else the array\n                //!     looks like part of that statement\n                [mTAdditions, dTAdditions, returnableMsgs] = RED.util.cloneMessage(complexInputProcessor(iMsg,\"Splittable JSON\"))\n                //! This section until the major blue part about being about to loop through an array is duplicate 6\n                //First process the mTAdditions that are returned (if any)\n                if (iterOut[0] === null){\n                    //the array is transferred in when it can replace null\n                        iterOut[0] = mTAdditions\n                    } else if (Array.isArray(iterOut[0])) {\n                    //if however there is already an array, then more complexity is involved \n                        if (Array.isArray(mTAdditions)) {\n                        //this complexity only occurs if the returned value is an array\n                        //  if is is an array then this code loops through that array and\n                        //  adds each array member to the preexisting array\n                            for (index1 = 0; index1 < mTAdditions.length; index1++) { \n                                iterOut[0].push(mTAdditions[index1])\n                            }    \n                        }\n                    }\n                //Second process the dTAdditions that are returned (if any)\n                    if (iterOut[1] === null){\n                    //the array is transferred in when it can replace null\n                        iterOut[1] = dTAdditions\n                    } else if (Array.isArray(iterOut[1])) {\n                    //if however there is already an array, then more complexity is involved \n                        if (Array.isArray(dTAdditions)) {\n                        //this complexity only occurs if the returned value is an array\n                        //  if is is an array then this code loops through that array and\n                        //  adds each array member to the preexisting array\n                            for (index1 = 0; index1 < dTAdditions.length; index1++) { \n                                iterOut[1].push(dTAdditions[index1])\n                            }    \n                        }\n                    }\n                //Third process the returnableMsgs that are returned (if any)\n                    if (iterOut[2] === null){\n                    //the array is transferred in when it can replace null\n                        iterOut[2] = returnableMsgs\n                    } else if (Array.isArray(iterOut[2])) {\n                    //if however there is already an array, then more complexity is involved \n                        if (Array.isArray(returnableMsgs)) {\n                        //this complexity only occurs if the returned value is an array\n                        //  if is is an array then this code loops through that array and\n                        //  adds each array member to the preexisting array\n                            for (index1 = 0; index1 < returnableMsgs.length; index1++) { \n                                iterOut[2].push(returnableMsgs[index1])\n                            }    \n                        }\n                    }\n//? In retrospect, intead of getting 3 items back from iterative processor, it should have been possible to get a\n//?     single variable back and then looped through the array that was returned instead of having 3 very similar\n//?     code pieces (1 for each of the 3 pieces of data)\n                    break\n            case \"unsplittable JSON\":\n            case \"complex unsplittable JSON\":\n                //! Note that becaue an array of 3 variables is getting the result of the call\n                //!     the preceeding statement must end with a semicolon (;) or else the array\n                //!     looks like part of that statement\n                [mTAdditions, dTAdditions, returnableMsgs] = RED.util.cloneMessage(complexInputProcessor(iMsg,\"Unsplittable JSON\"))\n                //! This section until the major blue part about being about to loop through an array is duplicate 7\n                //First process the mTAdditions that are returned (if any)\n                if (iterOut[0] === null){\n                    //the array is transferred in when it can replace null\n                        iterOut[0] = mTAdditions\n                    } else if (Array.isArray(iterOut[0])) {\n                    //if however there is already an array, then more complexity is involved \n                        if (Array.isArray(mTAdditions)) {\n                        //this complexity only occurs if the returned value is an array\n                        //  if is is an array then this code loops through that array and\n                        //  adds each array member to the preexisting array\n                            for (index1 = 0; index1 < mTAdditions.length; index1++) { \n                                iterOut[0].push(mTAdditions[index1])\n                            }    \n                        }\n                    }\n                //Second process the dTAdditions that are returned (if any)\n                    if (iterOut[1] === null){\n                    //the array is transferred in when it can replace null\n                        iterOut[1] = dTAdditions\n                    } else if (Array.isArray(iterOut[1])) {\n                    //if however there is already an array, then more complexity is involved \n                        if (Array.isArray(dTAdditions)) {\n                        //this complexity only occurs if the returned value is an array\n                        //  if is is an array then this code loops through that array and\n                        //  adds each array member to the preexisting array\n                            for (index1 = 0; index1 < dTAdditions.length; index1++) { \n                                iterOut[1].push(dTAdditions[index1])\n                            }    \n                        }\n                    }\n                //Third process the returnableMsgs that are returned (if any)\n                    if (iterOut[2] === null){\n                    //the array is transferred in when it can replace null\n                        iterOut[2] = returnableMsgs\n                    } else if (Array.isArray(iterOut[2])) {\n                    //if however there is already an array, then more complexity is involved \n                        if (Array.isArray(returnableMsgs)) {\n                        //this complexity only occurs if the returned value is an array\n                        //  if is is an array then this code loops through that array and\n                        //  adds each array member to the preexisting array\n                            for (index1 = 0; index1 < returnableMsgs.length; index1++) { \n                                iterOut[2].push(returnableMsgs[index1])\n                            }    \n                        }\n                    }\n//? In retrospect, intead of getting 3 items back from iterative processor, it should have been possible to get a\n//?     single variable back and then looped through the array that was returned instead of having 3 very similar\n//?     code pieces (1 for each of the 3 pieces of data)\n                    break\n            case \"splittable array\":\n            case \"complex splittable array\":\n                //! Note that becaue an array of 3 variables is getting the result of the call\n                //!     the preceeding statement must end with a semicolon (;) or else the array\n                //!     looks like part of that statement\n                [mTAdditions, dTAdditions, returnableMsgs] = RED.util.cloneMessage(complexInputProcessor(iMsg,\"Splittable Array\"))\n                //! This section until the major blue part about being about to loop through an array is duplicate 8\n                //First process the mTAdditions that are returned (if any)\n                if (iterOut[0] === null){\n                    //the array is transferred in when it can replace null\n                        iterOut[0] = mTAdditions\n                    } else if (Array.isArray(iterOut[0])) {\n                    //if however there is already an array, then more complexity is involved \n                        if (Array.isArray(mTAdditions)) {\n                        //this complexity only occurs if the returned value is an array\n                        //  if is is an array then this code loops through that array and\n                        //  adds each array member to the preexisting array\n                            for (index1 = 0; index1 < mTAdditions.length; index1++) { \n                                iterOut[0].push(mTAdditions[index1])\n                            }    \n                        }\n                    }\n                //Second process the dTAdditions that are returned (if any)\n                    if (iterOut[1] === null){\n                    //the array is transferred in when it can replace null\n                        iterOut[1] = dTAdditions\n                    } else if (Array.isArray(iterOut[1])) {\n                    //if however there is already an array, then more complexity is involved \n                        if (Array.isArray(dTAdditions)) {\n                        //this complexity only occurs if the returned value is an array\n                        //  if is is an array then this code loops through that array and\n                        //  adds each array member to the preexisting array\n                            for (index1 = 0; index1 < dTAdditions.length; index1++) { \n                                iterOut[1].push(dTAdditions[index1])\n                            }    \n                        }\n                    }\n                //Third process the returnableMsgs that are returned (if any)\n                    if (iterOut[2] === null){\n                    //the array is transferred in when it can replace null\n                        iterOut[2] = returnableMsgs\n                    } else if (Array.isArray(iterOut[2])) {\n                    //if however there is already an array, then more complexity is involved \n                        if (Array.isArray(returnableMsgs)) {\n                        //this complexity only occurs if the returned value is an array\n                        //  if is is an array then this code loops through that array and\n                        //  adds each array member to the preexisting array\n                            for (index1 = 0; index1 < returnableMsgs.length; index1++) { \n                                iterOut[2].push(returnableMsgs[index1])\n                            }    \n                        }\n                    }\n//? In retrospect, intead of getting 3 items back from iterative processor, it should have been possible to get a\n//?     single variable back and then looped through the array that was returned instead of having 3 very similar\n//?     code pieces (1 for each of the 3 pieces of data)\n                    break\n            case \"unsplittable array\":\n            case \"complex unsplittable array\":\n                //! Note that becaue an array of 3 variables is getting the result of the call\n                //!     the preceeding statement must end with a semicolon (;) or else the array\n                //!     looks like part of that statement\n                [mTAdditions, dTAdditions, returnableMsgs] = RED.util.cloneMessage(complexInputProcessor(iMsg,\"Unsplittable Array\"))\n                //! This section until the major blue part about being about to loop through an array is duplicate 9\n                //First process the mTAdditions that are returned (if any)\n                if (iterOut[0] === null){\n                    //the array is transferred in when it can replace null\n                        iterOut[0] = mTAdditions\n                    } else if (Array.isArray(iterOut[0])) {\n                    //if however there is already an array, then more complexity is involved \n                        if (Array.isArray(mTAdditions)) {\n                        //this complexity only occurs if the returned value is an array\n                        //  if is is an array then this code loops through that array and\n                        //  adds each array member to the preexisting array\n                            for (index1 = 0; index1 < mTAdditions.length; index1++) { \n                                iterOut[0].push(mTAdditions[index1])\n                            }    \n                        }\n                    }\n                //Second process the dTAdditions that are returned (if any)\n                    if (iterOut[1] === null){\n                    //the array is transferred in when it can replace null\n                        iterOut[1] = dTAdditions\n                    } else if (Array.isArray(iterOut[1])) {\n                    //if however there is already an array, then more complexity is involved \n                        if (Array.isArray(dTAdditions)) {\n                        //this complexity only occurs if the returned value is an array\n                        //  if is is an array then this code loops through that array and\n                        //  adds each array member to the preexisting array\n                            for (index1 = 0; index1 < dTAdditions.length; index1++) { \n                                iterOut[1].push(dTAdditions[index1])\n                            }    \n                        }\n                    }\n                //Third process the returnableMsgs that are returned (if any)\n                    if (iterOut[2] === null){\n                    //the array is transferred in when it can replace null\n                        iterOut[2] = returnableMsgs\n                    } else if (Array.isArray(iterOut[2])) {\n                    //if however there is already an array, then more complexity is involved \n                        if (Array.isArray(returnableMsgs)) {\n                        //this complexity only occurs if the returned value is an array\n                        //  if is is an array then this code loops through that array and\n                        //  adds each array member to the preexisting array\n                            for (index1 = 0; index1 < returnableMsgs.length; index1++) { \n                                iterOut[2].push(returnableMsgs[index1])\n                            }    \n                        }\n                    }\n//? In retrospect, intead of getting 3 items back from iterative processor, it should have been possible to get a\n//?     single variable back and then looped through the array that was returned instead of having 3 very similar\n//?     code pieces (1 for each of the 3 pieces of data)\n                    break\n            case \"complex object\":\n                //! Note that becaue an array of 3 variables is getting the result of the call\n                //!     the preceeding statement must end with a semicolon (;) or else the array\n                //!     looks like part of that statement\n                [mTAdditions, dTAdditions, returnableMsgs] = RED.util.cloneMessage(complexInputProcessor(iMsg,\"Object\"))\n                //! This section until the major blue part about being about to loop through an array is duplicate 10\n                //First process the mTAdditions that are returned (if any)\n                if (iterOut[0] === null){\n                    //the array is transferred in when it can replace null\n                        iterOut[0] = mTAdditions\n                    } else if (Array.isArray(iterOut[0])) {\n                    //if however there is already an array, then more complexity is involved \n                        if (Array.isArray(mTAdditions)) {\n                        //this complexity only occurs if the returned value is an array\n                        //  if is is an array then this code loops through that array and\n                        //  adds each array member to the preexisting array\n                            for (index1 = 0; index1 < mTAdditions.length; index1++) { \n                                iterOut[0].push(mTAdditions[index1])\n                            }    \n                        }\n                    }\n                //Second process the dTAdditions that are returned (if any)\n                    if (iterOut[1] === null){\n                    //the array is transferred in when it can replace null\n                        iterOut[1] = dTAdditions\n                    } else if (Array.isArray(iterOut[1])) {\n                    //if however there is already an array, then more complexity is involved \n                        if (Array.isArray(dTAdditions)) {\n                        //this complexity only occurs if the returned value is an array\n                        //  if is is an array then this code loops through that array and\n                        //  adds each array member to the preexisting array\n                            for (index1 = 0; index1 < dTAdditions.length; index1++) { \n                                iterOut[1].push(dTAdditions[index1])\n                            }    \n                        }\n                    }\n                //Third process the returnableMsgs that are returned (if any)\n                    if (iterOut[2] === null){\n                    //the array is transferred in when it can replace null\n                        iterOut[2] = returnableMsgs\n                    } else if (Array.isArray(iterOut[2])) {\n                    //if however there is already an array, then more complexity is involved \n                        if (Array.isArray(returnableMsgs)) {\n                        //this complexity only occurs if the returned value is an array\n                        //  if is is an array then this code loops through that array and\n                        //  adds each array member to the preexisting array\n                            for (index1 = 0; index1 < returnableMsgs.length; index1++) { \n                                iterOut[2].push(returnableMsgs[index1])\n                            }    \n                        }\n                    }\n//? In retrospect, intead of getting 3 items back from iterative processor, it should have been possible to get a\n//?     single variable back and then looped through the array that was returned instead of having 3 very similar\n//?     code pieces (1 for each of the 3 pieces of data)\n                    break\n            default:\n        }\n    }\n    return iterOut\n}","outputs":5,"noerr":0,"initialize":"","finalize":"","x":1140,"y":500,"wires":[["35244ca9.8065f4"],["15f9a90f.5e7597"],["74871039.cdc2b"],["fe26e0e8.6f10b"],["39877125.895c2e"]],"outputLabels":["Add array to Devices table","Add array to MeasurementTranslations table","Add array to DataTranslations table","Send to data translation process","Return results of successful lookup"]},{"id":"e0622a2d.00e228","type":"debug","z":"aad5f0e1.84355","g":"9f4937e5.d52ff8","name":"Output 5 Return results of successful lookup","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2210,"y":1380,"wires":[]},{"id":"685f00bd.3c4ae","type":"function","z":"aad5f0e1.84355","g":"e4830a6f.ee5ce8","name":"","func":"global.set(\"DataTranslations\",msg.payload)\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1280,"y":300,"wires":[["588790c9.d8919"]]},{"id":"18da18f6.f23207","type":"GSheet","z":"aad5f0e1.84355","g":"e4830a6f.ee5ce8","creds":"adb4e9b8.8beee8","method":"get","action":"","sheet":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","cells":"DataTranslations!A1:Z1000","name":"Read Input from GSheet","x":1090,"y":300,"wires":[["685f00bd.3c4ae"]],"info":"Use the GSheet node to get the a set of rows from a google spreadsheet.\n\n# **Inputs**\n### **creds**\nThis is the name on the gauth configuration node. How to get the details is beyond the scope of what I am going to put into an individual node instance. Some details are at [node-red-contrib-google-sheets](https://flows.nodered.org/node/node-red-contrib-google-sheets)\n### **Method**\nIn this case using the get cells method to read a set of data.\n### **SpreadsheetID**\nUnused as the spreadsheet ID is passed in as part of the input msg, but if needed it would be the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n### **Cells**\nUnused as the requested cells are passed in as part of the input msg, but if it was being manually built for a static data source the format is made of of 3 parts with specific seperators:\n * **[Sheetname]** like Sheet1\n * **[upper left corner cell address]** like A1\n * **[lower right corner cell address]** like B2\n\nThe format is **[Sheetname]**!**[upper left corner cell address]**:**[lower right corner cell address]** giving an input like **Sheet1!A1:B2**\n "},{"id":"77a65d8c.a5ca44","type":"GSheet","z":"aad5f0e1.84355","g":"784e22ba.1f900c","creds":"adb4e9b8.8beee8","method":"get","action":"","sheet":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","cells":"Devices!A1:Z1000","name":"Read Input from GSheet","x":1090,"y":100,"wires":[["c473872f.c48ee8"]],"info":"Use the GSheet node to get the a set of rows from a google spreadsheet.\n\n# **Inputs**\n### **creds**\nThis is the name on the gauth configuration node. How to get the details is beyond the scope of what I am going to put into an individual node instance. Some details are at [node-red-contrib-google-sheets](https://flows.nodered.org/node/node-red-contrib-google-sheets)\n### **Method**\nIn this case using the get cells method to read a set of data.\n### **SpreadsheetID**\nUnused as the spreadsheet ID is passed in as part of the input msg, but if needed it would be the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n### **Cells**\nUnused as the requested cells are passed in as part of the input msg, but if it was being manually built for a static data source the format is made of of 3 parts with specific seperators:\n * **[Sheetname]** like Sheet1\n * **[upper left corner cell address]** like A1\n * **[lower right corner cell address]** like B2\n\nThe format is **[Sheetname]**!**[upper left corner cell address]**:**[lower right corner cell address]** giving an input like **Sheet1!A1:B2**\n "},{"id":"c473872f.c48ee8","type":"function","z":"aad5f0e1.84355","g":"784e22ba.1f900c","name":"","func":"global.set(\"Devices\",msg.payload)\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1280,"y":100,"wires":[["588790c9.d8919"]]},{"id":"7704ff9e.7d439","type":"debug","z":"aad5f0e1.84355","g":"8b23774d.98e8e8","name":"Caught Error in Smarthome Monitoring Flow","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1330,"y":660,"wires":[]},{"id":"d0ffa256.f4e89","type":"catch","z":"aad5f0e1.84355","g":"8b23774d.98e8e8","name":"","scope":null,"uncaught":false,"x":1080,"y":660,"wires":[["7704ff9e.7d439"]]},{"id":"9f9e13da.e50aa","type":"change","z":"aad5f0e1.84355","g":"e7874dd3.6924a","name":"Prepare to write to MeasurementTranslations","rules":[{"t":"set","p":"payload","pt":"msg","to":"MeasurementTableAdditions","tot":"msg"},{"t":"set","p":"sheet","pt":"msg","to":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"MeasurementTranslations!A1:Z1000","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2010,"y":460,"wires":[["8e62c71f.b63fb8","fd067392.609dd"]]},{"id":"8e62c71f.b63fb8","type":"GSheet","z":"aad5f0e1.84355","g":"e7874dd3.6924a","creds":"adb4e9b8.8beee8","method":"append","action":"","sheet":"","cells":"","name":"Write requested items to table","x":2450,"y":480,"wires":[[]]},{"id":"e644c7ef.89f318","type":"change","z":"aad5f0e1.84355","g":"e7874dd3.6924a","name":"Prepare to write to DataTranslations","rules":[{"t":"set","p":"payload","pt":"msg","to":"DataTranslationTableAdditions","tot":"msg"},{"t":"set","p":"sheet","pt":"msg","to":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"DataTranslations!A1:Z1000","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1980,"y":500,"wires":[["8e62c71f.b63fb8","fd067392.609dd"]]},{"id":"74871039.cdc2b","type":"function","z":"aad5f0e1.84355","name":"Add Data Translation Stub to Global Variable","func":"dT=global.get(\"DataTranslations\")\nfor (index = 0; index < msg.DataTranslationTableAdditions.length; index++) { \n    \tdT.push(msg.DataTranslationTableAdditions[index]); } \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1550,"y":500,"wires":[["e644c7ef.89f318"]]},{"id":"15f9a90f.5e7597","type":"function","z":"aad5f0e1.84355","name":"Add Measurement Translation Stub to Global Variable","func":"mT=global.get(\"MeasurementTranslations\")\nfor (index = 0; index < msg.MeasurementTableAdditions.length; index++) { \n    \tmT.push(msg.MeasurementTableAdditions[index]); } \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1580,"y":460,"wires":[["9f9e13da.e50aa"]]},{"id":"35244ca9.8065f4","type":"function","z":"aad5f0e1.84355","name":"Add Device Stub to Global Variable","func":"dev=global.get(\"Devices\")\ndev.push(msg.payload)\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1520,"y":420,"wires":[["e625ff8e.09ee9"]]},{"id":"e625ff8e.09ee9","type":"change","z":"aad5f0e1.84355","g":"e7874dd3.6924a","name":"Prepare to write to Devices","rules":[{"t":"set","p":"sheet","pt":"msg","to":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"Devices!A1:Z1000","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1960,"y":420,"wires":[["8e62c71f.b63fb8","fd067392.609dd"]]},{"id":"b295d0a2.3827a","type":"inject","z":"aad5f0e1.84355","g":"76613d9c.dccc04","name":"Manual Trigger","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":200,"y":660,"wires":[["c91be57d.4adbd8"]]},{"id":"67948ec0.a84a8","type":"function","z":"aad5f0e1.84355","g":"76613d9c.dccc04","name":"Transform Homebridge Input into Hubitat format","func":"let hub = msg.Homebridge\nmsg.topic = msg.name\ntempReading = Object.values(msg.payload)[0]\ntempMeasure = Object.keys(msg.payload)[0]\nmsg.payload= {[tempMeasure]:{\"name\":tempMeasure, \"value\":tempReading,\"deviceId\":\"Placeholder\"}}\nmsg.Source = msg.Hombridge\ndelete msg._rawMessage\ndelete msg.Homebridge\ndelete msg.Manufacturer\ndelete msg._device\ndelete msg._confId\ndelete msg._msgid\ndelete msg._event\ndelete msg.name\nlet d = global.get(\"Devices\")\nlet deviceName = msg.topic\nlet mainIndex\nlet dNCol   //device name column number\n//get column number for Device Name\nfor (mainIndex = 0; mainIndex < d[0].length; mainIndex++) {\n    if (d[0][mainIndex] == 'Device') {\n        dNCol = mainIndex\n        continue\n    }}\nlet matchingDataRows = d.filter((item) => (item[dNCol]== deviceName))\nswitch (matchingDataRows.length) {\n    case 0:\n        msg.payload =  [deviceName,\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"placeholder\",\"HB TBD\",hub]\n        d.push(msg.payload)\n        return [msg,null]\n        break\n    case 1:\n        if(matchingDataRows[0][10]!==\"HB TBD\"){\n            msg.payload[tempMeasure].deviceId = matchingDataRows[0][10]\n        } else {\n            node.warn(\"The device \"+deviceName+`is in the Devices table, but won't be processed until the Device ID is changed from \"HB TBD\" to an actual ID`)\n            return\n        }\n        break\n    default:\n}\nreturn [null, msg]","outputs":2,"noerr":0,"initialize":"","finalize":"","x":720,"y":700,"wires":[["e39ed404.bfa118"],["e9516723.fc8bd8"]],"outputLabels":["Add array to Devices table","Return results of successful transformation"]},{"id":"5f5ef5d4.c6f11c","type":"link in","z":"aad5f0e1.84355","name":"Inputs from other sources in Hubitat format","links":["27fd400e.26a0b","e10fd081.b24e1","e793272.86ca2d8","e9516723.fc8bd8","7db29c53.77dd34","b6c8e770.ae0898","98a796c3.64daa8"],"x":720,"y":420,"wires":[["580a87ac.f86bf8"]],"l":true},{"id":"e9516723.fc8bd8","type":"link out","z":"aad5f0e1.84355","g":"76613d9c.dccc04","name":"","links":["5f5ef5d4.c6f11c"],"x":935,"y":720,"wires":[]},{"id":"e39ed404.bfa118","type":"link out","z":"aad5f0e1.84355","g":"76613d9c.dccc04","name":"","links":["8841d117.6795e"],"x":935,"y":680,"wires":[]},{"id":"fe26e0e8.6f10b","type":"link out","z":"aad5f0e1.84355","name":"Go Do Translation","links":["461ad8e2.0df698"],"x":1470,"y":540,"wires":[],"l":true},{"id":"e60a21f7.7e2dd","type":"link in","z":"aad5f0e1.84355","g":"9f4937e5.d52ff8","name":"Received Ouput","links":["39877125.895c2e","56032f68.120b7","60b3e478.2fc69c","8504be83.a891f","8c66f89e.b02828","a5c3185d.f9ce48"],"x":1920,"y":1340,"wires":[["e0622a2d.00e228","9b330506.a45d58"]],"l":true},{"id":"9b330506.a45d58","type":"change","z":"aad5f0e1.84355","g":"9f4937e5.d52ff8","name":"Excess Properties Removal","rules":[{"t":"delete","p":"Source","pt":"msg"},{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"_event","pt":"msg"},{"t":"delete","p":"exportableresults.Translation","pt":"msg"},{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2160,"y":1340,"wires":[["8ce9bbe4.145998","8cee6136.dcb9d"]]},{"id":"8ce9bbe4.145998","type":"debug","z":"aad5f0e1.84355","g":"9f4937e5.d52ff8","name":"Catch Excess Properties Removal","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2460,"y":1300,"wires":[]},{"id":"8cee6136.dcb9d","type":"function","z":"aad5f0e1.84355","g":"9f4937e5.d52ff8","name":"Format for InfluxDB & MQTT","func":"//Ref. TMS-000002\n/* This function takes input from the upstream processing \n    and creates an properly formated object to be sent to InfluxDB node via output 1 which will in turn write to the InfluxDB\n    It also formats an MQTT topic and the data sending that to output 2 which in turn can be used by an MQTT node to send to \n    MQTT\n */\n//gather the name of the device which had a reading that triggered the flow to be included as a tag (index) sent to InfluxDB\n//note: this is the hubitat device ID or the DeviceID pulled from the table for other sources\nvar deviceID = msg.exportableresults.DeviceID;\n//gather the name of the measurement that was sent by the device to be included as a tag (index) for invalid measurements and as the fieldname for valid measurements sent to InfluxDB\nvar typeOfMeasurement = msg.exportableresults.Measurement;\n\n//gather the actual measurement value that was sent by the device to be included as the data for the field (when the measurement is valid) sent to InfluxDB\nvar theData = msg.exportableresults.Value;\n//initialize the measurements object\nvar measurementsObj = {};\n\n//initialize the tags (indices) object\nvar tagsObj = {};\n\n//create the object that will later be used to combine the measurementsObj and tagsObj\nvar combinedObj;\n\n//create the boolean that will be used to hold the evaluation of whether the measurement is valid or not\nvar validMeasurement;\n\n//create the booleans that will be used to hold whether the reason a measurement is invalid is because it is a non-standard type or\n// if the type of the measurement and the type passed from the device differ or\n// if the value (data) is null\nvar nonStandardType = false;\nvar measurementTypeMismatch = false;\nvar nullData = false;\n\n//create a boolean to keep track of if there are any tags (indices) that should be sent to the InfluxDB \n// it starts false but if any tag is valid then will become true. See below for what to send to InfluxDB based on valid measures and tags\nvar validTag = false;\nif (msg.exportableresults.hasOwnProperty('dataType')){\n    //! I am not sure that this if then else is even needed. I think it will probably now always recieve a valid measurement designation\n    //if ((typeof theData == msg.exportableresults.dataType.toLowerCase()) || (msg.exportableresults.dataType == 'ENUM') || (theData === null))\n    if ((typeof theData == msg.exportableresults.dataType.toLowerCase()) || (msg.exportableresults.dataType == 'ENUM') || (theData === null))\n    {\n        if (typeof theData == 'number')\n        {\n            node.status({ fill: \"red\", shape: \"ring\", text: \"matched number\" });\n            if (!theData.isNaN)\n            {\n                validMeasurement = true;\n            }\n        }\n        else if (typeof theData == 'string')\n        {\n            node.status({ fill: \"red\", shape: \"ring\", text: \"matched string\" });\n            if (theData.length >= 0)\n            {\n                validMeasurement = true;\n            }\n        } \n        else if (typeof theData == 'boolean')\n        {\n            node.status({ fill: \"red\", shape: \"ring\", text: \"matched boolean\" });\n            validMeasurement = true;\n        }\n        else if (msg.exportableresults.dataType == 'ENUM')\n        { //This is checking to make sure the value matches one of the values in the ENUM from the device \n            node.status({ fill: \"red\", shape: \"ring\", text: msg.exportableresults.dataType + \" matched ENUM\" });\n            msg.exportableresults.values.forEach(element => {\n                if (flow.get(deviceID + element) == theData)\n                {\n                    validMeasurement = true;\n                }\n            })\n        }\n        else if (theData === null)\n        {\n            node.status({ fill: \"red\", shape: \"ring\", text: \"matched null data\" });\n            nullData = true;\n        }\n        else\n        {\n            node.status({ fill: \"red\", shape: \"ring\", text: \"matched nonstandardtype\" });\n            nonStandardType = true;\n        }\n    } //if ((typeof theData == msg.exportableresults.dataType.toLowerCase()) || (msg.exportableresults.dataType == 'ENUM') || (theData === null))\n    else\n    {\n        node.status({ fill: \"red\", shape: \"ring\", text: \"measurement type mismatch\" });\n        measurementTypeMismatch = true;\n    } //else  if ((typeof theData == msg.exportableresults.dataType.toLowerCase()) || (msg.exportableresults.dataType == 'ENUM') || (theData === null))\n}//if(msg.exportableresults.hasOwnProperty('dataType'))\nelse\n{\n    validMeasurement = true;\n}// else      if(msg.exportableresults.hasOwnProperty('dataType')) else\n\n//scanning all of the tags from the config node and creating a tag for that item if the entry on the config node has info\ncommonTags = [\"House\", \"Floor\", \"Room\", \"Location\", \"DeviceType\", \"Manufacturer\", \"AccessProtocol\", \"PhysicalVirtualType\",\"Hub\"]\nfor (innerIndex = 0; innerIndex < commonTags.length; innerIndex++)\n{\n    if (msg.exportableresults.hasOwnProperty(commonTags[innerIndex]))\n    {\n        if (msg.exportableresults[commonTags[innerIndex]]==\"\"){\n            //node.warn(\"About to create empty influxDB tag\")\n        } else{\n            tagsObj[commonTags[innerIndex]] = msg.exportableresults[commonTags[innerIndex]]\n        }\n    } //if (requestedDataTable[outerIndex][searchKeyIndices[innerIndex]] == searchValues[innerIndex]) else\n} //for (innerIndex = 0; innerIndex < searchKeyIndices.length; innerIndex++)\n\n//Based on whether or not the measurement is \"valid\" it either adds the device id to the tags or it goes to the else portion\nif (validMeasurement) {\n    measurementsObj[typeOfMeasurement] = theData;\n    if (deviceID.length > 0) {\n        tagsObj[\"DeviceID\"] = deviceID;\n        validTag = true;\n    }\n    if (validTag) {\n        combinedObj = [measurementsObj, tagsObj]\n    } else {\n        //skip tags if none would be valid\n        combinedObj = [measurementsObj]\n    }\n} else {\n    //if the measeurement was not \"valid\", then it puts in a Generic measurement of true and tag it as either Non-Standard Type of Measurement Type Mismatch\n    if (nonStandardType) {\n        measurementsObj[\"Generic\"] = true\n        tagsObj[\"ReasonGeneric\"] = \"Non-Standard Type\"\n        tagsObj[\"Measure\"] = typeOfMeasurement\n    }\n    if (deviceID.length > 0) {\n        tagsObj[\"DeviceID\"] = deviceID\n        validTag = true\n    }\n    if (measurementTypeMismatch) {\n        measurementsObj[\"Generic\"] = true\n        tagsObj[\"ReasonGeneric\"] = \"Measurement Type Mismatch\"\n        tagsObj[\"Measure\"] = typeOfMeasurement\n    }\n    if (deviceID.length > 0) {\n        tagsObj[\"DeviceID\"] = deviceID\n        validTag = true\n    }\n    combinedObj = [measurementsObj, tagsObj]\n}\n//put the object into the payload\nmsg.payload = combinedObj;\n//build the status to be shown on the status of the subnode\nmsg.status = msg.exportableresults.Device + \": \" + typeOfMeasurement + \": \" + theData;\n\n/* MQTT section \n  \n  \n  \n */\n//create the placeholder object\nvar msg2 = {}\n//add the MQTT topic\nmsg2.topic = msg.exportableresults.Hub +\"/\"+msg.exportableresults.MQTTDeviceTopic+\"/\"+ msg.exportableresults.Measurement\n//add the data to be recorded to MQTT\nmsg2.payload = theData\n//send the created combinedObj downstream (to the InfluxDB node), but only if the measurement is not null\nif (!nullData) {\n    return [msg, msg2]\n}","outputs":2,"noerr":0,"initialize":"","finalize":"","x":2500,"y":1340,"wires":[["10b91e22.6cd082","efe434db.e36b48"],["92b4cc1e.35457","dbcc8f4d.5cc5a"]]},{"id":"10b91e22.6cd082","type":"debug","z":"aad5f0e1.84355","g":"9f4937e5.d52ff8","name":"Influx Output","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2770,"y":1260,"wires":[]},{"id":"92b4cc1e.35457","type":"debug","z":"aad5f0e1.84355","g":"9f4937e5.d52ff8","name":"MQTT Output","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2780,"y":1420,"wires":[]},{"id":"efe434db.e36b48","type":"influxdb out","z":"aad5f0e1.84355","g":"9f4937e5.d52ff8","influxdb":"28ac2ef0.6cbb12","name":"Write reading to InfluxDB","measurement":"Smarthome","precision":"","retentionPolicy":"","x":2810,"y":1320,"wires":[]},{"id":"dbcc8f4d.5cc5a","type":"mqtt out","z":"aad5f0e1.84355","g":"9f4937e5.d52ff8","name":"Write reading to MQTT","topic":"","qos":"2","retain":"true","broker":"a5bf81ee.27852","x":2800,"y":1360,"wires":[]},{"id":"fd067392.609dd","type":"debug","z":"aad5f0e1.84355","g":"e7874dd3.6924a","name":"How Frequent Write to Sheet","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":2440,"y":440,"wires":[]},{"id":"39877125.895c2e","type":"link out","z":"aad5f0e1.84355","name":"Send to Output","links":["e60a21f7.7e2dd"],"x":1460,"y":580,"wires":[],"l":true},{"id":"cd01ecf3.e6aff","type":"debug","z":"aad5f0e1.84355","g":"e5fd1dc6.b851","name":"Output 4 Send to data translation process","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":2240,"y":600,"wires":[]},{"id":"8c66f89e.b02828","type":"link out","z":"aad5f0e1.84355","g":"e5fd1dc6.b851","name":"Send to Output","links":["e60a21f7.7e2dd"],"x":2560,"y":720,"wires":[],"l":true},{"id":"a7534bcc.c1ab18","type":"switch","z":"aad5f0e1.84355","g":"e5fd1dc6.b851","name":"10TF Translate","property":"exportableresults.Value","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":2380,"y":640,"wires":[["9c104f6e.afc2c"],["95b9cf5e.5ff32"]],"outputLabels":["True","False"]},{"id":"9c104f6e.afc2c","type":"change","z":"aad5f0e1.84355","g":"e5fd1dc6.b851","name":"Value True","rules":[{"t":"set","p":"exportableresults.Value","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":2550,"y":620,"wires":[["8504be83.a891f"]]},{"id":"95b9cf5e.5ff32","type":"change","z":"aad5f0e1.84355","g":"e5fd1dc6.b851","name":"Value False","rules":[{"t":"set","p":"exportableresults.Value","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":2550,"y":660,"wires":[["8504be83.a891f"]]},{"id":"832559f3.cc1bb8","type":"change","z":"aad5f0e1.84355","g":"e5fd1dc6.b851","name":"CtoF Translate","rules":[{"t":"set","p":"exportableresults.Measurement","pt":"msg","to":"msg.exportableresults.Measurement&\" F\"\t","tot":"jsonata"},{"t":"set","p":"exportableresults.Value","pt":"msg","to":"msg.exportableresults.Value*9/5+32","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":2380,"y":720,"wires":[["8c66f89e.b02828"]]},{"id":"ea6b3e97.c688e","type":"switch","z":"aad5f0e1.84355","g":"e5fd1dc6.b851","name":"CurrentHeatingCoolingState Translate","property":"exportableresults.Value","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"str"},{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"str"},{"t":"eq","v":"3","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":2450,"y":820,"wires":[["189d90e4.8ee89f"],["d65b1e49.85376"],["7aec7f68.da40a"],["87c2be57.634fa"]],"outputLabels":["off","heat","cool","heat-cool"]},{"id":"189d90e4.8ee89f","type":"change","z":"aad5f0e1.84355","g":"e5fd1dc6.b851","name":"Value Off","rules":[{"t":"set","p":"exportableresults.Value","pt":"msg","to":"off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2700,"y":760,"wires":[["60b3e478.2fc69c"]]},{"id":"d65b1e49.85376","type":"change","z":"aad5f0e1.84355","g":"e5fd1dc6.b851","name":"Value Heat","rules":[{"t":"set","p":"exportableresults.Value","pt":"msg","to":"heat","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2710,"y":800,"wires":[["60b3e478.2fc69c"]]},{"id":"7aec7f68.da40a","type":"change","z":"aad5f0e1.84355","g":"e5fd1dc6.b851","name":"Value Cool","rules":[{"t":"set","p":"exportableresults.Value","pt":"msg","to":"cool","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2710,"y":840,"wires":[["60b3e478.2fc69c"]]},{"id":"87c2be57.634fa","type":"change","z":"aad5f0e1.84355","g":"e5fd1dc6.b851","name":"Value Heat-Cool","rules":[{"t":"set","p":"exportableresults.Value","pt":"msg","to":"heat-cool","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2720,"y":880,"wires":[["60b3e478.2fc69c"]]},{"id":"d2515e1.0a2fba","type":"switch","z":"aad5f0e1.84355","g":"e5fd1dc6.b851","name":"","property":"exportableresults.Translation","propertyType":"msg","rules":[{"t":"eq","v":"10TF","vt":"str"},{"t":"eq","v":"C2F","vt":"str"},{"t":"eq","v":"NestThMap","vt":"str"},{"t":"eq","v":"012CF","vt":"str"},{"t":"eq","v":"E2DS","vt":"str"},{"t":"eq","v":"OTBS","vt":"str"},{"t":"eq","v":"OTICT","vt":"str"},{"t":"eq","v":"OTUT","vt":"str"},{"t":"eq","v":"E2DSx1k","vt":"str"}],"checkall":"true","repair":false,"outputs":9,"x":2150,"y":840,"wires":[["a7534bcc.c1ab18"],["832559f3.cc1bb8"],["ea6b3e97.c688e"],["d2ea1eb0.48f6c"],["cd164dba.524df"],["fe61512d.69ffc"],["d08f9116.8b5b8"],["c5bbe46.5e76b18"],["bfe3a4c6.afe848"]],"outputLabels":["1 or 0 to True or False Map","Celcius to Fahrenheit Conversion","Nest Thermostat Map","Celcius or Fahrenheit Map","Epoch to Date String","","","",null]},{"id":"d2ea1eb0.48f6c","type":"switch","z":"aad5f0e1.84355","g":"e5fd1dc6.b851","name":"012CF Translate","property":"exportableresults.Value","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":2390,"y":940,"wires":[["1aed5d8b.2984b2"],["de7f4a2d.125ad8"]],"outputLabels":["True","False"]},{"id":"1aed5d8b.2984b2","type":"change","z":"aad5f0e1.84355","g":"e5fd1dc6.b851","name":"Value Fahrenheit","rules":[{"t":"set","p":"exportableresults.Value","pt":"msg","to":"Fahrenheit","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2610,"y":920,"wires":[["56032f68.120b7"]]},{"id":"de7f4a2d.125ad8","type":"change","z":"aad5f0e1.84355","g":"e5fd1dc6.b851","name":"Value Celcius","rules":[{"t":"set","p":"exportableresults.Value","pt":"msg","to":"Celcius","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2600,"y":960,"wires":[["56032f68.120b7"]]},{"id":"8504be83.a891f","type":"link out","z":"aad5f0e1.84355","g":"e5fd1dc6.b851","name":"Send to Output","links":["e60a21f7.7e2dd"],"x":2720,"y":640,"wires":[],"l":true},{"id":"60b3e478.2fc69c","type":"link out","z":"aad5f0e1.84355","g":"e5fd1dc6.b851","name":"Send to Output","links":["e60a21f7.7e2dd"],"x":2940,"y":820,"wires":[],"l":true},{"id":"56032f68.120b7","type":"link out","z":"aad5f0e1.84355","g":"e5fd1dc6.b851","name":"Send to Output","links":["e60a21f7.7e2dd"],"x":2800,"y":940,"wires":[],"l":true},{"id":"461ad8e2.0df698","type":"link in","z":"aad5f0e1.84355","g":"e5fd1dc6.b851","name":"Go Do Translation","links":["fe26e0e8.6f10b"],"x":1930,"y":840,"wires":[["cd01ecf3.e6aff","d2515e1.0a2fba"]],"l":true},{"id":"cd164dba.524df","type":"function","z":"aad5f0e1.84355","g":"e5fd1dc6.b851","name":"Convert Epoch to String","func":"x = new Date(msg.exportableresults.Value)\nmsg.exportableresults.Value = x.toLocaleString()\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2410,"y":1000,"wires":[["a5c3185d.f9ce48"]]},{"id":"a5c3185d.f9ce48","type":"link out","z":"aad5f0e1.84355","g":"e5fd1dc6.b851","name":"Send to Output","links":["e60a21f7.7e2dd"],"x":2840,"y":1080,"wires":[],"l":true},{"id":"fe61512d.69ffc","type":"function","z":"aad5f0e1.84355","g":"e5fd1dc6.b851","name":"Convert Owntracks Battery Status","func":"switch (msg.exportableresults.Value) {\n    case 0:\n        msg.exportableresults.Value = \"unknown\"\n        break\n    case 1:\n        msg.exportableresults.Value = \"unplugged\"\n        break\n    case 2:\n        msg.exportableresults.Value = \"charging\"\n        break\n    case 3:\n        msg.exportableresults.Value = \"full \"\n        break\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2440,"y":1040,"wires":[["a5c3185d.f9ce48"]]},{"id":"d08f9116.8b5b8","type":"function","z":"aad5f0e1.84355","g":"e5fd1dc6.b851","name":"Convert Owntracks Internet Connectivity Type","func":"switch (msg.exportableresults.Value) {\n    case 'w':\n        msg.exportableresults.Value = \"WiFi\"\n        break\n    case 'o':\n        msg.exportableresults.Value = \"offline\"\n        break\n    case 'm':\n        msg.exportableresults.Value = \"mobile\"\n        break\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2480,"y":1080,"wires":[["a5c3185d.f9ce48"]]},{"id":"c5bbe46.5e76b18","type":"function","z":"aad5f0e1.84355","g":"e5fd1dc6.b851","name":"Convert Owntracks Update Trigger","func":"switch (msg.exportableresults.Value) {\n    case 'p':\n        msg.exportableresults.Value = \"random ping\"\n        break\n    case 'c':\n        msg.exportableresults.Value = \"region entry/exit\"\n        break\n    case 'b':\n        msg.exportableresults.Value = \"beacon entry/exit\"\n        break\n    case 'r':\n        msg.exportableresults.Value = \"requested\"\n        break\n    case 'u':\n        msg.exportableresults.Value = \"user published\"\n        break\n    case 't':\n        msg.exportableresults.Value = \"timer based\"\n        break\n    case 'v':\n        msg.exportableresults.Value = \"settings update\"\n        break\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2440,"y":1120,"wires":[["a5c3185d.f9ce48"]]},{"id":"bfe3a4c6.afe848","type":"function","z":"aad5f0e1.84355","g":"e5fd1dc6.b851","name":"Convert Epoch*1000 to String","func":"x = new Date(msg.exportableresults.Value*1000)\nmsg.exportableresults.Value = x.toLocaleString()\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2430,"y":1160,"wires":[["a5c3185d.f9ce48"]]},{"id":"9686658a.9e0c98","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Aqara button","server":"55e4481a.722098","deviceId":"356","attribute":"","sendEvent":true,"x":1150,"y":1640,"wires":[["69a47913.e8e1f8"]]},{"id":"4a4b8cce.471b54","type":"link out","z":"aad5f0e1.84355","g":"f9871510.22aa18","name":"Initialize all hubitat items","links":["8e6680a5.c7a8a","9b7fc51f.3b46a8"],"x":610,"y":520,"wires":[],"l":true},{"id":"2d909dd4.4e5672","type":"link in","z":"aad5f0e1.84355","g":"f9871510.22aa18","name":"Hubitat Outputs for InfluxDB, MQTT","links":["53b09982.84e0e8","80682547.0212b8","e2d7a703.b61058","fc1fcabf.d6eca8","3a72bb28.00de84","924f6fa.370e09","408607c0.0809c8","2287c36d.e8db3c","69a47913.e8e1f8","8ebf997a.87c988","31961548.aaeb2a","dc22a6e.c88b358","aee8065.1bbf6f8","8c497469.4907a8","c7bde6db.d7af08"],"x":240,"y":560,"wires":[["679aaed4.e03f5"]],"l":true},{"id":"ede75678.e2ec78","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Corner","server":"55e4481a.722098","deviceId":"100","attribute":"","sendEvent":true,"x":1130,"y":1680,"wires":[["69a47913.e8e1f8"]]},{"id":"9ac29116.d9479","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Cube 1","server":"55e4481a.722098","deviceId":"360","attribute":"","sendEvent":true,"x":1140,"y":1720,"wires":[["69a47913.e8e1f8"]]},{"id":"2b27b4b8.d9690c","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Downstairs Thermostat","server":"55e4481a.722098","deviceId":"161","attribute":"","sendEvent":true,"x":1190,"y":1920,"wires":[["69a47913.e8e1f8"]]},{"id":"2bc81335.2f14ac","type":"hubitat device","z":"aad5f0e1.84355","d":true,"g":"31fcce08.aeb912","name":"Echo - Office","server":"55e4481a.722098","deviceId":"321","attribute":"","sendEvent":true,"x":1150,"y":2160,"wires":[["31961548.aaeb2a"]]},{"id":"3f1ae5e1.92424a","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Master Fan","server":"55e4481a.722098","deviceId":"65","attribute":"","sendEvent":true,"x":1150,"y":3240,"wires":[["aee8065.1bbf6f8"]]},{"id":"d0446017.f96b6","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Master Light Overhead","server":"55e4481a.722098","deviceId":"33","attribute":"","sendEvent":true,"x":1180,"y":3280,"wires":[["aee8065.1bbf6f8"]]},{"id":"e8031c0e.d3d9a","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Mike Bedside","server":"55e4481a.722098","deviceId":"257","attribute":"","sendEvent":true,"x":1160,"y":3320,"wires":[["aee8065.1bbf6f8"]]},{"id":"21e9fa34.3b4a66","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Mike Credenza Light","server":"55e4481a.722098","deviceId":"388","attribute":"","sendEvent":true,"x":1180,"y":3360,"wires":[["aee8065.1bbf6f8"]]},{"id":"39a539e1.65d106","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Mike's Ipad","server":"55e4481a.722098","deviceId":"129","attribute":"","sendEvent":true,"x":1150,"y":3400,"wires":[["aee8065.1bbf6f8"]]},{"id":"8bd3f727.b29db8","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Office Desk Lamp","server":"55e4481a.722098","deviceId":"550","attribute":"","sendEvent":true,"x":1170,"y":3480,"wires":[["aee8065.1bbf6f8"]]},{"id":"718b3fd2.1f26e","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Watch Uverse","server":"55e4481a.722098","deviceId":"262","attribute":"","sendEvent":true,"x":1160,"y":4000,"wires":[["c7bde6db.d7af08"]]},{"id":"707812aa.431cac","type":"inject","z":"aad5f0e1.84355","g":"f9871510.22aa18","name":"Manual Trigger","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":200,"y":520,"wires":[["4a4b8cce.471b54"]]},{"id":"487ce08f.9b1a9","type":"change","z":"aad5f0e1.84355","g":"f9871510.22aa18","name":"Source = Homebridge","rules":[{"t":"set","p":"Source","pt":"msg","to":"Hubitat","tot":"str"},{"t":"delete","p":"_msgid","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":780,"y":560,"wires":[["580a87ac.f86bf8"]],"info":"## **inputs**\n### IgnoreEnvVar \nThis boolean needs to be true to tell that Read Spreadsheet For Details subflow that it should use the specs passed in the msg to determine what spreadsheet to read from and what portion of data to read from.\n### msg.SpreadsheetID\nThis is the very long string that identifies a specific google spreadsheet.\n### msg.Tab\nSpecifies the tab name that contains the data.\n### msg.ColStart\nSpecifies the leftmost column containing the desired data.\n### msg.ColEnd\nSpecifies the rightmost column containing the desired data. \n### msg.MinRow\nSpecifies the top row containing the desired data \n### msg.MaxRow\nSpecifies the bottom row containing the desired data "},{"id":"588790c9.d8919","type":"debug","z":"aad5f0e1.84355","g":"fbc622f3.83b57","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1490,"y":200,"wires":[]},{"id":"679aaed4.e03f5","type":"function","z":"aad5f0e1.84355","g":"f9871510.22aa18","name":"Hubitat Single/Multiple Handler","func":"if (msg.payload.hasOwnProperty('name')){\n    temp = RED.util.cloneMessage(msg.payload)\n    delete msg.payload\n    msg.payload ={}\n    msg.payload[temp.name] =temp\n    }\nreturn msg","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":560,"wires":[["487ce08f.9b1a9"]]},{"id":"53c980a9.dc33c","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"NOAA Tile","server":"55e4481a.722098","deviceId":"737","attribute":"","sendEvent":true,"x":1150,"y":3440,"wires":[["aee8065.1bbf6f8"]]},{"id":"b53ad46.e642028","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"WDG - Frisco Weather Data","server":"55e4481a.722098","deviceId":"744","attribute":"","sendEvent":true,"x":1200,"y":4040,"wires":[["c7bde6db.d7af08"]]},{"id":"3f3c92bc.cd5fce","type":"hubitat device","z":"aad5f0e1.84355","d":true,"g":"31fcce08.aeb912","name":"Echo - Eva Bedroom","server":"55e4481a.722098","deviceId":"353","attribute":"","sendEvent":true,"x":1180,"y":1960,"wires":[["69a47913.e8e1f8"]]},{"id":"933c1db8.d9032","type":"hubitat device","z":"aad5f0e1.84355","d":true,"g":"31fcce08.aeb912","name":"Echo - Everywhere (WHA)","server":"55e4481a.722098","deviceId":"449","attribute":"","sendEvent":true,"x":1200,"y":2000,"wires":[["69a47913.e8e1f8"]]},{"id":"5a908f73.da181","type":"hubitat device","z":"aad5f0e1.84355","d":true,"g":"31fcce08.aeb912","name":"Echo - Master Bathroom","server":"55e4481a.722098","deviceId":"553","attribute":"","sendEvent":true,"x":1190,"y":2040,"wires":[["8ebf997a.87c988"]]},{"id":"b0616ef3.ead08","type":"hubitat device","z":"aad5f0e1.84355","d":true,"g":"31fcce08.aeb912","name":"Echo - Master Bedroom","server":"55e4481a.722098","deviceId":"354","attribute":"","sendEvent":true,"x":1190,"y":2080,"wires":[["8ebf997a.87c988"]]},{"id":"b6da80b8.9f4e5","type":"hubitat device","z":"aad5f0e1.84355","d":true,"g":"31fcce08.aeb912","name":"Echo - Mike's Alexa App for PC","server":"55e4481a.722098","deviceId":"514","attribute":"","sendEvent":true,"x":1210,"y":2120,"wires":[["8ebf997a.87c988"]]},{"id":"ab473f5c.4e5d8","type":"hubitat device","z":"aad5f0e1.84355","d":true,"g":"31fcce08.aeb912","name":"Echo - TV Room","server":"55e4481a.722098","deviceId":"323","attribute":"","sendEvent":true,"x":1160,"y":2200,"wires":[["31961548.aaeb2a"]]},{"id":"6b444044.0dee2","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"1 Test Zwave Contact Sensor","server":"55e4481a.722098","deviceId":"743","attribute":"","sendEvent":true,"x":1200,"y":1560,"wires":[["69a47913.e8e1f8"]]},{"id":"dc464a97.634b78","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"A e12","server":"55e4481a.722098","deviceId":"547","attribute":"","sendEvent":true,"x":1130,"y":1600,"wires":[["69a47913.e8e1f8"]]},{"id":"33ab73a5.59c42c","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Double Relay","server":"55e4481a.722098","deviceId":"841","attribute":"","sendEvent":true,"x":1160,"y":1760,"wires":[["69a47913.e8e1f8"]]},{"id":"4a1c9677.755688","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Double Relay 1","server":"55e4481a.722098","deviceId":"842","attribute":"","sendEvent":true,"x":1160,"y":1800,"wires":[["69a47913.e8e1f8"]]},{"id":"db620345.d052b","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Double Relay 2","server":"55e4481a.722098","deviceId":"843","attribute":"","sendEvent":true,"x":1160,"y":1840,"wires":[["69a47913.e8e1f8"]]},{"id":"cb6c10b4.5a2e","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Downstairs Hall","server":"55e4481a.722098","deviceId":"390","attribute":"","sendEvent":true,"x":1160,"y":1880,"wires":[["69a47913.e8e1f8"]]},{"id":"f35d5349.5eb6d","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Evas","server":"55e4481a.722098","deviceId":"865","attribute":"","sendEvent":true,"x":1130,"y":2240,"wires":[["31961548.aaeb2a"]]},{"id":"34f72340.8b283c","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Evas (Light Notification 1)","server":"55e4481a.722098","deviceId":"869","attribute":"","sendEvent":true,"x":1190,"y":2280,"wires":[["31961548.aaeb2a"]]},{"id":"265659c4.d23e76","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Evas Fan","server":"55e4481a.722098","deviceId":"867","attribute":"","sendEvent":true,"x":1140,"y":2320,"wires":[["31961548.aaeb2a"]]},{"id":"5a451ce0.7a5274","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Evas Light","server":"55e4481a.722098","deviceId":"866","attribute":"","sendEvent":true,"x":1150,"y":2360,"wires":[["31961548.aaeb2a"]]},{"id":"7e4e69d.a9b0298","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Fire 7","server":"55e4481a.722098","deviceId":"705","attribute":"","sendEvent":true,"x":1130,"y":2400,"wires":[["31961548.aaeb2a"]]},{"id":"91d26d99.559fa","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Game Room Floor Lamp","server":"55e4481a.722098","deviceId":"357","attribute":"","sendEvent":true,"x":1190,"y":2440,"wires":[["31961548.aaeb2a"]]},{"id":"fbb470db.09ad5","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Game Room","server":"55e4481a.722098","deviceId":"551","attribute":"","sendEvent":true,"x":1150,"y":2480,"wires":[["dc22a6e.c88b358"]]},{"id":"76d5fc39.f0d2e4","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Harmony Hub","server":"55e4481a.722098","deviceId":"259","attribute":"","sendEvent":true,"x":1160,"y":2520,"wires":[["dc22a6e.c88b358"]]},{"id":"c4a10293.bcf0b","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"HDMI Cable","server":"55e4481a.722098","deviceId":"264","attribute":"","sendEvent":true,"x":1150,"y":2560,"wires":[["dc22a6e.c88b358"]]},{"id":"2dd0b340.1a587c","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"IKEA candle 1","server":"55e4481a.722098","deviceId":"103","attribute":"","sendEvent":true,"x":1160,"y":2600,"wires":[["dc22a6e.c88b358"]]},{"id":"9ffac8ed.762118","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Ilumin 1","server":"55e4481a.722098","deviceId":"742","attribute":"","sendEvent":true,"x":1140,"y":2640,"wires":[["dc22a6e.c88b358"]]},{"id":"184d9ad7.b114b5","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"In Box 1 (I Bulb)","server":"55e4481a.722098","deviceId":"97","attribute":"","sendEvent":true,"x":1160,"y":2680,"wires":[["dc22a6e.c88b358"]]},{"id":"b4138881.6751b8","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"K Temp 1","server":"55e4481a.722098","deviceId":"772","attribute":"","sendEvent":true,"x":1140,"y":2720,"wires":[["dc22a6e.c88b358"]]},{"id":"757d63b2.d0d25c","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"K temp 2","server":"55e4481a.722098","deviceId":"807","attribute":"","sendEvent":true,"x":1140,"y":2760,"wires":[["dc22a6e.c88b358"]]},{"id":"282fa136.55eb5e","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"K temp 3 rebuild","server":"55e4481a.722098","deviceId":"836","attribute":"","sendEvent":true,"x":1160,"y":2800,"wires":[["dc22a6e.c88b358"]]},{"id":"4874a973.627198","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"K temp 4","server":"55e4481a.722098","deviceId":"808","attribute":"","sendEvent":true,"x":1140,"y":2840,"wires":[["dc22a6e.c88b358"]]},{"id":"91880de4.14e32","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"K temp 5","server":"55e4481a.722098","deviceId":"810","attribute":"","sendEvent":true,"x":1140,"y":2880,"wires":[["dc22a6e.c88b358"]]},{"id":"1e9ddd8f.a38da2","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"K temp 6","server":"55e4481a.722098","deviceId":"809","attribute":"","sendEvent":true,"x":1140,"y":2920,"wires":[["dc22a6e.c88b358"]]},{"id":"89f8b40e.504f18","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"K temp 7","server":"55e4481a.722098","deviceId":"813","attribute":"","sendEvent":true,"x":1140,"y":2960,"wires":[["dc22a6e.c88b358"]]},{"id":"f592b991.a497f8","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"K temp 8","server":"55e4481a.722098","deviceId":"797","attribute":"","sendEvent":true,"x":1140,"y":3000,"wires":[["dc22a6e.c88b358"]]},{"id":"d0fc6523.c2f838","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"K temp 9","server":"55e4481a.722098","deviceId":"800","attribute":"","sendEvent":true,"x":1140,"y":3040,"wires":[["dc22a6e.c88b358"]]},{"id":"d351da0f.dd52c8","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"K Temp 10","server":"55e4481a.722098","deviceId":"819","attribute":"","sendEvent":true,"x":1150,"y":3080,"wires":[["dc22a6e.c88b358"]]},{"id":"a6318e8f.6ee14","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"MQTT test client","server":"55e4481a.722098","deviceId":"609","attribute":"","sendEvent":true,"x":1160,"y":3120,"wires":[["dc22a6e.c88b358"]]},{"id":"7d69bcc1.bdb604","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"MT Relay","server":"55e4481a.722098","deviceId":"101","attribute":"","sendEvent":true,"x":1140,"y":3160,"wires":[["aee8065.1bbf6f8"]]},{"id":"59a51be.7e822e4","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Multisensor 6","server":"55e4481a.722098","deviceId":"740","attribute":"","sendEvent":true,"x":1150,"y":3200,"wires":[["aee8065.1bbf6f8"]]},{"id":"b4361b99.d75f18","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Play X-Box","server":"55e4481a.722098","deviceId":"260","attribute":"","sendEvent":true,"x":1150,"y":3520,"wires":[["aee8065.1bbf6f8"]]},{"id":"e86fa2b3.9ef13","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Power Off TV","server":"55e4481a.722098","deviceId":"261","attribute":"","sendEvent":true,"x":1150,"y":3560,"wires":[["aee8065.1bbf6f8"]]},{"id":"a0496ad.affe898","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Solar Panels","server":"55e4481a.722098","deviceId":"577","attribute":"","sendEvent":true,"x":1150,"y":3600,"wires":[["aee8065.1bbf6f8"]]},{"id":"fd75b62c.e67cb8","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Table Lamp","server":"55e4481a.722098","deviceId":"225","attribute":"","sendEvent":true,"x":1150,"y":3640,"wires":[["aee8065.1bbf6f8"]]},{"id":"9c31b900.ed2898","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Toy north (I bulb)","server":"55e4481a.722098","deviceId":"105","attribute":"","sendEvent":true,"x":1170,"y":3680,"wires":[["aee8065.1bbf6f8"]]},{"id":"313b6c5.abff194","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Toy south (I Bulb)","server":"55e4481a.722098","deviceId":"99","attribute":"","sendEvent":true,"x":1170,"y":3720,"wires":[["aee8065.1bbf6f8"]]},{"id":"1536ac8c.ea23d3","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Vibration 1","server":"55e4481a.722098","deviceId":"835","attribute":"","sendEvent":true,"x":1150,"y":3760,"wires":[["8c497469.4907a8"]]},{"id":"a90e3954.76acb8","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Vibration 2","server":"55e4481a.722098","deviceId":"840","attribute":"","sendEvent":true,"x":1150,"y":3800,"wires":[["8c497469.4907a8"]]},{"id":"fa45468d.00d578","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Virtual Play Podcast In Bathroom","server":"55e4481a.722098","deviceId":"555","attribute":"","sendEvent":true,"x":1220,"y":3840,"wires":[["8c497469.4907a8"]]},{"id":"6e477e7a.aa08f","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Watch Apple TV","server":"55e4481a.722098","deviceId":"265","attribute":"","sendEvent":true,"x":1160,"y":3880,"wires":[["c7bde6db.d7af08"]]},{"id":"da0cb1bd.1903c","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Watch Fire TV","server":"55e4481a.722098","deviceId":"266","attribute":"","sendEvent":true,"x":1160,"y":3920,"wires":[["c7bde6db.d7af08"]]},{"id":"d36893a9.7c576","type":"hubitat device","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Watch PC on TV","server":"55e4481a.722098","deviceId":"263","attribute":"","sendEvent":true,"x":1160,"y":3960,"wires":[["c7bde6db.d7af08"]]},{"id":"9b7fc51f.3b46a8","type":"link in","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Initialize hubitat","links":["4a4b8cce.471b54"],"x":940,"y":2800,"wires":[["6b444044.0dee2","dc464a97.634b78","9686658a.9e0c98","ede75678.e2ec78","9ac29116.d9479","33ab73a5.59c42c","4a1c9677.755688","db620345.d052b","cb6c10b4.5a2e","2b27b4b8.d9690c","3f3c92bc.cd5fce","933c1db8.d9032","5a908f73.da181","b0616ef3.ead08","b6da80b8.9f4e5","2bc81335.2f14ac","ab473f5c.4e5d8","f35d5349.5eb6d","34f72340.8b283c","265659c4.d23e76","5a451ce0.7a5274","7e4e69d.a9b0298","91d26d99.559fa","fbb470db.09ad5","76d5fc39.f0d2e4","c4a10293.bcf0b","2dd0b340.1a587c","9ffac8ed.762118","184d9ad7.b114b5","b4138881.6751b8","757d63b2.d0d25c","282fa136.55eb5e","4874a973.627198","91880de4.14e32","1e9ddd8f.a38da2","89f8b40e.504f18","f592b991.a497f8","d0fc6523.c2f838","d351da0f.dd52c8","a6318e8f.6ee14","7d69bcc1.bdb604","59a51be.7e822e4","3f1ae5e1.92424a","d0446017.f96b6","e8031c0e.d3d9a","21e9fa34.3b4a66","39a539e1.65d106","53c980a9.dc33c","8bd3f727.b29db8","b4361b99.d75f18","e86fa2b3.9ef13","a0496ad.affe898","fd75b62c.e67cb8","9c31b900.ed2898","313b6c5.abff194","1536ac8c.ea23d3","a90e3954.76acb8","fa45468d.00d578","6e477e7a.aa08f","da0cb1bd.1903c","d36893a9.7c576","718b3fd2.1f26e","b53ad46.e642028"]],"l":true},{"id":"69a47913.e8e1f8","type":"link out","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Gather to Send Hubitat Outputs for InfluxDB, MQTT","links":["2d909dd4.4e5672"],"x":1590,"y":1620,"wires":[],"l":true},{"id":"8ebf997a.87c988","type":"link out","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Gather to Send Hubitat Outputs for InfluxDB, MQTT","links":["2d909dd4.4e5672"],"x":1590,"y":2120,"wires":[],"l":true},{"id":"31961548.aaeb2a","type":"link out","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Gather to Send Hubitat Outputs for InfluxDB, MQTT","links":["2d909dd4.4e5672"],"x":1590,"y":2280,"wires":[],"l":true},{"id":"dc22a6e.c88b358","type":"link out","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Gather to Send Hubitat Outputs for InfluxDB, MQTT","links":["2d909dd4.4e5672"],"x":1590,"y":2860,"wires":[],"l":true},{"id":"aee8065.1bbf6f8","type":"link out","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Gather to Send Hubitat Outputs for InfluxDB, MQTT","links":["2d909dd4.4e5672"],"x":1590,"y":3320,"wires":[],"l":true},{"id":"8c497469.4907a8","type":"link out","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Gather to Send Hubitat Outputs for InfluxDB, MQTT","links":["2d909dd4.4e5672"],"x":1590,"y":3820,"wires":[],"l":true},{"id":"c7bde6db.d7af08","type":"link out","z":"aad5f0e1.84355","g":"31fcce08.aeb912","name":"Gather to Send Hubitat Outputs for InfluxDB, MQTT","links":["2d909dd4.4e5672"],"x":1590,"y":3880,"wires":[],"l":true},{"id":"cd099940.525638","type":"mqtt in","z":"aad5f0e1.84355","g":"80316bba.f21e28","name":"","topic":"zigbee2mqtt/#","qos":"2","datatype":"auto","broker":"a5bf81ee.27852","x":110,"y":1560,"wires":[["b05fa203.88579"]]},{"id":"35065786.6c5288","type":"mqtt in","z":"aad5f0e1.84355","g":"80316bba.f21e28","name":"","topic":"fully/#","qos":"2","datatype":"auto","broker":"a5bf81ee.27852","x":90,"y":1720,"wires":[["bfd65805.3d00f8"]]},{"id":"cf18086e.605d38","type":"mqtt in","z":"aad5f0e1.84355","g":"80316bba.f21e28","name":"","topic":"owntracks/#","qos":"2","datatype":"auto","broker":"a5bf81ee.27852","x":110,"y":1800,"wires":[["c8d5e79e.9ad1b8"]]},{"id":"94d280de.04719","type":"function","z":"aad5f0e1.84355","g":"80316bba.f21e28","name":"Transform Zigbee2MQTT Input into Hubitat format","func":"/*\n * Main function node code \n * \n */\n msg.topic = msg.topic.slice(12, msg.topic.length)\n msg.deviceID = msg.topic\n let d = global.get(\"Devices\")\n let deviceName = msg.topic\n let mainIndex\n let dNCol   //device name column number\n //get column number for Device Name\n for (mainIndex = 0; mainIndex < d[0].length; mainIndex++) {\n     if (d[0][mainIndex] == 'Device') {\n         dNCol = mainIndex\n         continue\n     }}\n let matchingDataRows = d.filter((item) => (item[dNCol]== deviceName))\n switch (matchingDataRows.length) {\n     case 0:\n         msg.payload =  [deviceName,\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"Ashmont\",\"placeholder\",\"Z2M TBD\",\"Zigbee2M\"]\n         d.push(msg.payload)\n         return [msg,null]\n         break\n     case 1:\n         if(matchingDataRows[0][10]!==\"Z2M TBD\"){\n             msg.deviceId = matchingDataRows[0][10]\n         } else {\n             node.warn(matchingDataRows[0][10])\n             node.warn(\"The device \"+deviceName+` is in the Devices table, but won't be processed until the Device ID is changed from \"HB TBD\" to an actual ID`)\n             return\n         }\n         break\n     default:\n }\n\n\n\n\n\n\n\n\n\n\n\n\n\nmsg.temp = msg.payload\ndelete msg.payload\nmsg.payload= {value:msg.temp}\ndelete msg.temp\nmsg.MQTTName = \"zb2mqtt\"\n\n\n\n//Check if there is any data. If not, stop processing. At the time this was created, the trackData sent from a Hubitat Elevation device node was always null\nif (msg.payload.value === null) {\n    return null;\n}\n//initial call into the recursive function\nhandlemsg(msg)\n//send nothing from main code\nreturn\n\n/*\n * Main recursive function code\n *\n */\n\nfunction handlemsg(msg) {\n    //The evaluation part of this switch/case statement determines which type of entity is in the value\n    //  the key idea is that once the value is an atomic item (number, string, bool) then the message should be sent out\n    //  of the node to downstream, but if the value is a splittable, then it should be split into multiple messages. These\n    //  messages are then evaulated individually. They in turn are either found to have atomic entries in the value or have\n    //  values that are themselves splittable.\n    //  For example:\n    //  JSON - each key value pair will be used to create a new msg. The msg.payload.name will be changed to add \":\" and the key\n    //          from the key value pair. The msg.payload.value will become the value from the key value pair\n    //  Array - TBAdded\n    //  Object - TBAdded\n    let prepareAndSend = false\n    msg.topic = msg.topic.substring(msg.topic.lastIndexOf(\"/\") + 1);\n    switch (typeofhubitatvalue(msg.payload.value, \"msg.payload.value\")) {\n        case \"splittable JSON\":\n            //This is for cases where the JSON is in the form of key:value where there is at least 1 pair\n            //  Examples of \"valid\" JSON that would not be coming to this case would be {} or 100\n            splitJSON(msg)\n            break;\n        case \"splittable array\":\n            //This is for cases where the Array is in the form [\"A\",\"B\",\"C\"] where there is are at least 2 members\n            //  SplitArray function not yet built. TBD\n            splitArray(msg)\n            break;\n        case \"unsplittable array\":\n            //This case is where the item is an array, but with only a single entry. The idea is to move that single\n            //  value out of the array and into the value natively and then to call the recursive function to evaluate\n            //  what type of item it now is and then process (split or send or extract) appropriately\n            msg.payload.value = msg.payload.value[0]\n            handlemsg(RED.util.cloneMessage(msg))\n            break;\n        case \"object\":\n            //This is for handling an object. It then calls splitObj to create multiple msgs with the object keys into the names\n            //  and the values from those keys moved into the value of the new object.\n            splitObj(msg)\n            break\n        case \"number\":\n        case \"bigint\":\n        case \"boolean\":\n            //send the version of the msg with an atomic value to downstream nodes\n            prepareAndSend = true\n            break;\n        case \"string\":\n            //Strings are an atomic type of value and should be sent to downstream nodes\n        if (msg.payload.hasOwnProperty('name'))\n            {}\n            else\n            {\n                if (msg.topic.includes(\"/\"))\n                {\n                    msg.payload.name = msg.topic.substring(msg.topic.lastIndexOf(\"/\") + 1);\n                }\n                else\n                {\n                    msg.payload.name = msg.topic\n                }\n            }\n            prepareAndSend = true\n            break;\n        case \"unsplittable JSON\":\n            //This is for handling \"valid\" JSON that does not have key:value pairs.\n            //  Examples of \"valid\" JSON that are handed here are {} or 100 or \"100\"\n            //  This case either treats it as a string (no changes made) or a number where a number in\n            //  a string like \"100\" is changed into an actual number like 100\n\n            //by checking if NaN, if it is a number 100 or \"100\", the ++ followed by -- changes it to a number 100\n            //  without changing its actual value\n            if (isNaN(msg.payload.value)) { } else {\n                ++msg.payload.value;\n                --msg.payload.value;\n            }\n            prepareAndSend = true\n            break\n        default:\n            //This is just in case no valid process is found by the typeofhubitatvalue function.\n            //  If you encounter this then you will either need to investigate the function or contact tmichael in\n            //  Hubitat discourse forums https://community.hubitat.com/\n            return\n    }\n    if (prepareAndSend) {\n        // node.warn(msg)\n        tempReading = msg.payload.value\n        tempMeasure = msg.payload.name\n\n\n\n\n\n\n\n\n\n\n\n\n        msg.payload[tempMeasure]={name:tempMeasure, value:tempReading, deviceId:msg.deviceId}\n        // node.warn(tempMeasure)\n        // node.warn(tempReading)\n        // node.warn(msg)\n        //!insert the deviceId lookup built for hombridge here\n        // node.send(msg)\n        prepareAndSend = false\n        delete msg.deviceId\n        delete msg.payload.value\n        delete msg.payload.name\n        delete msg.qos\n        delete msg.retain\n        delete msg._msgid\n        delete msg.deviceID\n        delete msg.MQTTName\n        node.send([null,msg])\n    }\n}\n\n/*\n * This function is used by the Main recursive function (handlemsg) to decide whether to send the msg on as\n *  the msg.payload.value is atomic or if it needs to split the value into multiple msgs\n *\n */\nfunction typeofhubitatvalue(value, source = \"\") {\n    switch (typeof (value)) {\n        case \"number\":\n            //atomic just return the result of typeof\n            return \"number\"\n            break;\n        case \"bigint\":\n            //atomic just return the result of typeof\n            return \"bigint\"\n            break;\n        case \"boolean\":\n            //atomic just return the result of typeof\n            return \"boolean\"\n            break;\n        case \"string\":\n            //most splittable values are encoded strictly as text and so may be identified as a string\n\n            //Fist check if the string is \"valid\" JSON\n            if (isvalidJSONstring(value)) {\n                //When it is \"valid\" JSON, check if it is splittable\n                if (issplittablevalidJSONstring(value)) {\n                    //When it is splittable, then return type as splittable JSON\n                    return \"splittable JSON\"\n                }\n                else {\n                    //if it is JSON, but not splittable ({}, \"100, 100) return unsplittable JSON\n                    return \"unsplittable JSON\"\n                }\n            }\n            else {\n                //When it isn't \"valid\" JSON, check if it is an array\n                if (isvalidarray(value)) {\n                    //When it is an array, check if it is splittable\n                    if (issplittablearray(value)) {\n                        //When it is splittable, return splittable Array\n                        return \"splittable Array\"\n                    }\n                    else {\n                        //if the array is not splittable ([\"apple\"]) return unsplittable array\n                        return \"unsplittable array\"\n                    }\n                }\n                else {\n                    //When it is neither JSON or Array, then it is really just a string, so return string\n                    return \"string\"\n                }\n            }\n            break;\n        case \"object\":\n            //some  splittable values are identified as objects\n\n            //Fist check if the object is \"valid\" JSON\n            if (isvalidJSONstring(value)) {\n                //When it is \"valid\" JSON, check if it is splittable\n                if (issplittablevalidJSONstring(value)) {\n                    //When it is splittable, then return type as splittable JSON\n                    return \"splittable JSON\"\n                }\n                else {\n                    //if it is JSON, but not splittable ({}, \"100, 100) return unsplittable JSON\n                    return \"unsplittable JSON\"\n                }\n            }\n            else {\n                //When it isn't \"valid\" JSON, check if it is an array\n                if (isvalidarray(value)) {\n                    //When it is an array, check if it is splittable\n                    if (issplittablearray(value)) {\n                        //When it is splittable, return splittable Array\n                        return \"splittable Array\"\n                    }\n                    else {\n                        //if the array is not splittable ([\"apple\"]) return unsplittable array\n                        return \"unsplittable array\"\n                    }\n                }\n                else {\n                    //When it is neither JSON or Array, then I have not accounted for it. If you reach this point during an\n                    //  investigation, it might be worth using the example that triggered your investigation to see if the object\n                    //  is really just a string (without a triggering example I have not investigated)\n                    return \"object\"\n                }\n            }\n            break;\n        default:\n            //When the type is not one that I coded for then return unhandled because the situation is by definition unhandled\n            return \"unhandled\"\n            break;\n    }\n}\n\n//True False functions\n/*\n * This function was found on the internet to check if an input is valid JSON\n * There seems to be a belief that there should be some more elegant method that trying parse and the catching the error,\n * but no one seems to have demonstrated what that more elegant way would be\n */\nfunction isvalidJSONstring(str) {\n    try {\n        JSON.parse(str);\n    } catch (e) {\n        return false;\n    }\n    return true;\n}\n\n/*\n * This function decides where the JSON is made up of at least 1 key:value pair\n */\nfunction issplittablevalidJSONstring(str) {\n    if (str.includes(\":\")) {\n        return true;\n    }\n    else {\n        return false;\n    }\n}\n/*\n * This function is simply wrapping the Array.isArray, to align the function naming with the other true false functions\n */\nfunction isvalidarray(str) {\n    if (Array.isArray(str)) {\n        return true;\n    }\n    else {\n        return false;\n    }\n}\n/*\n * This function identifies if the array has only a single entry or multiple entries i.e. [\"Apple\"] not splittable,\n *  [\"Apple\",\"Pear\"] splittable\n */\nfunction issplittablearray(str) {\n    // If the length is more than 1, then the array has mutliple entries, but if it is just 1, then it is not splittable\n    if (str.length > 1) {\n        return true;\n    }\n    else {\n        return false;\n    }\n}\n\n//Splitting functions\n/*\n * This function takes in a msg where msg.payload.value is splittable JSON and iterates through all key:value pairs and then\n *  recursively calls handlemsg with multiple messages. Each new message retains most of the details of the input message, \n *  but the name and value are changed.\n *  The name has the key from the key:value pair appended with a : as a seperator\n *  The value is replaced with the value from the key:value pair\n *  A new message is created for each key:value pair\n */\nfunction splitJSON(latestMsg) {\n    //put the inputs value into a variable for easier access\n    var valueJSON = JSON.parse(latestMsg.payload.value);\n    //put the inputs name aside for multiple reuses\n    var name = latestMsg.payload.name\n    //Iterative loop\n    Object.keys(valueJSON).forEach(function (key) {\n        //concatenate the original name, a colon and the key from the pair\n        if (typeof name === 'undefined') \n        {\n            latestMsg.payload.name = key;\n        } \n        else \n        {\n            latestMsg.payload.name = name + \"/\" + key;\n        }\n        //move the value from the pair to payload.value\n        latestMsg.payload.value = valueJSON[key];\n        //recursively call this function in case the value is itself splittable\n        handlemsg(RED.util.cloneMessage(latestMsg))\n    }\n    )\n    return\n}\n\n/*\n * This function takes in a msg where msg.payload.value is splittable object\n *  and iterates through all key:value pairs and then\n *  recursively calls handlemsg with multiple messages. Each new message retains most of the details of the input message,\n *  but the name and value are changed.\n *  The name has the key from the key:value pair appended with a : as a seperator\n *  The value is replaced with the value from the key:value pair\n *  A new message is created for each key:value pair\n *  \n *  Note: While working on the splitArray function, I realized that I may not have tested this on an object value with multiple\n *  pairs, so it is possible that the function only handles the first pair\n */\nfunction splitObj(oMsg) {\n    //put the inputs name aside for multiple reuses\n    var name = oMsg.payload.name\n//Iterative loop\n    for (let [key, value] of Object.entries(oMsg.payload.value)) {\n        if ((value !== null) && (key !== null)) {\n            oMsg.payload.name = name + \"/\" + key;\n            oMsg.payload.value = value;\n            //recursively call this function in case the value is itself splittable\n            handlemsg(RED.util.cloneMessage(oMsg))\n        }\n    }\n}\n\n/*\n * Note: At the time of creation, I did not have a live example and had too many other things in the works to construct one.\n * \n * This function takes in a msg where msg.payload.value is splittable array\n *  and iterates through all entries and recursively calls handlemsg with multiple messages. \n *  Each new message retains most of the details of the input message,\n *  but the value is changed.\n *  The value is replaced with the value from the entry in the Array\n *  For example if the input value is [\"Apple\",\"Pear\"], then the first msg will have a value of \"Apple\"\n *  and the second will have a value of \"Pear\"\n */\nfunction splitArray(aMsg) {\n    //Iterative loop\n    for (index = 0; index < aMsg.payload.value.length; index++) {\n        (aMsg.payload.value = aMsg.payload.value[index]);\n        //recursively call this function in case the value is itself splittable\n        handlemsg(RED.util.cloneMessage(aMsg))\n    }\n}","outputs":2,"noerr":0,"initialize":"","finalize":"","x":530,"y":1640,"wires":[["c01af137.e08d9"],["7db29c53.77dd34"]]},{"id":"c01af137.e08d9","type":"link out","z":"aad5f0e1.84355","g":"80316bba.f21e28","name":"","links":["8841d117.6795e","9c3ac4a6.123078"],"x":755,"y":1620,"wires":[]},{"id":"7db29c53.77dd34","type":"link out","z":"aad5f0e1.84355","g":"80316bba.f21e28","name":"","links":["5f5ef5d4.c6f11c"],"x":755,"y":1660,"wires":[]},{"id":"bfd65805.3d00f8","type":"function","z":"aad5f0e1.84355","g":"80316bba.f21e28","name":"Transform Fully Browser Kiosk Input into Hubitat format","func":"/*\n * Main function node code \n * \n */\n msg.topic = msg.topic.slice(6, msg.topic.length)\n msg.deviceID = msg.topic\n let d = global.get(\"Devices\")\n let deviceName = msg.topic\n let mainIndex\n let dNCol   //device name column number\n //get column number for Device Name\n for (mainIndex = 0; mainIndex < d[0].length; mainIndex++) {\n     if (d[0][mainIndex] == 'Device') {\n         dNCol = mainIndex\n         continue\n     }}\n let matchingDataRows = d.filter((item) => (item[dNCol]== deviceName))\n switch (matchingDataRows.length) {\n     case 0:\n         msg.payload =  [deviceName,\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"Ashmont\",\"placeholder\",\"FBK TBD\",\"FullyBrowser\"]\n         d.push(msg.payload)\n         return [msg,null]\n         break\n     case 1:\n         if(matchingDataRows[0][10]!==\"Z2M TBD\"){\n             msg.deviceId = matchingDataRows[0][10]\n         } else {\n             node.warn(\"The device \"+deviceName+`is in the Devices table, but won't be processed until the Device ID is changed from \"HB TBD\" to an actual ID`)\n             return\n         }\n         break\n     default:\n }\n\n\n\n\n\n\n\n\n\n\n\n\n\n msg.temp = msg.payload\ndelete msg.payload\nmsg.payload= {value:msg.temp}\ndelete msg.temp\nmsg.MQTTName = \"zb2mqtt\"\n\n\n\n//Check if there is any data. If not, stop processing. At the time this was created, the trackData sent from a Hubitat Elevation device node was always null\nif (msg.payload.value === null) {\n    return null;\n}\n//initial call into the recursive function\nhandlemsg(msg)\n//send nothing from main code\nreturn\n\n/*\n * Main recursive function code\n *\n */\n\nfunction handlemsg(msg) {\n    //The evaluation part of this switch/case statement determines which type of entity is in the value\n    //  the key idea is that once the value is an atomic item (number, string, bool) then the message should be sent out\n    //  of the node to downstream, but if the value is a splittable, then it should be split into multiple messages. These\n    //  messages are then evaulated individually. They in turn are either found to have atomic entries in the value or have\n    //  values that are themselves splittable.\n    //  For example:\n    //  JSON - each key value pair will be used to create a new msg. The msg.payload.name will be changed to add \":\" and the key\n    //          from the key value pair. The msg.payload.value will become the value from the key value pair\n    //  Array - TBAdded\n    //  Object - TBAdded\n    let prepareAndSend = false\n    msg.topic = msg.topic.substring(msg.topic.lastIndexOf(\"/\") + 1);\n    switch (typeofhubitatvalue(msg.payload.value, \"msg.payload.value\")) {\n        case \"splittable JSON\":\n            //This is for cases where the JSON is in the form of key:value where there is at least 1 pair\n            //  Examples of \"valid\" JSON that would not be coming to this case would be {} or 100\n            splitJSON(msg)\n            break;\n        case \"splittable array\":\n            //This is for cases where the Array is in the form [\"A\",\"B\",\"C\"] where there is are at least 2 members\n            //  SplitArray function not yet built. TBD\n            splitArray(msg)\n            break;\n        case \"unsplittable array\":\n            //This case is where the item is an array, but with only a single entry. The idea is to move that single\n            //  value out of the array and into the value natively and then to call the recursive function to evaluate\n            //  what type of item it now is and then process (split or send or extract) appropriately\n            msg.payload.value = msg.payload.value[0]\n            handlemsg(RED.util.cloneMessage(msg))\n            break;\n        case \"object\":\n            //This is for handling an object. It then calls splitObj to create multiple msgs with the object keys into the names\n            //  and the values from those keys moved into the value of the new object.\n            splitObj(msg)\n            break\n        case \"number\":\n        case \"bigint\":\n        case \"boolean\":\n            //send the version of the msg with an atomic value to downstream nodes\n            prepareAndSend = true\n            break;\n        case \"string\":\n            //Strings are an atomic type of value and should be sent to downstream nodes\n        if (msg.payload.hasOwnProperty('name'))\n            {}\n            else\n            {\n                if (msg.topic.includes(\"/\"))\n                {\n                    msg.payload.name = msg.topic.substring(msg.topic.lastIndexOf(\"/\") + 1);\n                }\n                else\n                {\n                    msg.payload.name = msg.topic\n                }\n            }\n            prepareAndSend = true\n            break;\n        case \"unsplittable JSON\":\n            //This is for handling \"valid\" JSON that does not have key:value pairs.\n            //  Examples of \"valid\" JSON that are handed here are {} or 100 or \"100\"\n            //  This case either treats it as a string (no changes made) or a number where a number in\n            //  a string like \"100\" is changed into an actual number like 100\n\n            //by checking if NaN, if it is a number 100 or \"100\", the ++ followed by -- changes it to a number 100\n            //  without changing its actual value\n            if (isNaN(msg.payload.value)) { } else {\n                ++msg.payload.value;\n                --msg.payload.value;\n            }\n            prepareAndSend = true\n            break\n        default:\n            //This is just in case no valid process is found by the typeofhubitatvalue function.\n            //  If you encounter this then you will either need to investigate the function or contact tmichael in\n            //  Hubitat discourse forums https://community.hubitat.com/\n            return\n    }\n    if (prepareAndSend) {\n        // node.warn(msg)\n        tempReading = msg.payload.value\n        tempMeasure = msg.payload.name\n\n\n\n\n\n\n\n\n\n\n\n\n        msg.payload[tempMeasure]={name:tempMeasure, value:tempReading, deviceId:msg.deviceId}\n        // node.warn(tempMeasure)\n        // node.warn(tempReading)\n        // node.warn(msg)\n        //!insert the deviceId lookup built for hombridge here\n        // node.send(msg)\n        prepareAndSend = false\n        delete msg.deviceId\n        delete msg.payload.value\n        delete msg.payload.name\n        delete msg.qos\n        delete msg.retain\n        delete msg._msgid\n        delete msg.deviceID\n        delete msg.MQTTName\n        node.send([null,msg])\n    }\n}\n\n/*\n * This function is used by the Main recursive function (handlemsg) to decide whether to send the msg on as\n *  the msg.payload.value is atomic or if it needs to split the value into multiple msgs\n *\n */\nfunction typeofhubitatvalue(value, source = \"\") {\n    switch (typeof (value)) {\n        case \"number\":\n            //atomic just return the result of typeof\n            return \"number\"\n            break;\n        case \"bigint\":\n            //atomic just return the result of typeof\n            return \"bigint\"\n            break;\n        case \"boolean\":\n            //atomic just return the result of typeof\n            return \"boolean\"\n            break;\n        case \"string\":\n            //most splittable values are encoded strictly as text and so may be identified as a string\n\n            //Fist check if the string is \"valid\" JSON\n            if (isvalidJSONstring(value)) {\n                //When it is \"valid\" JSON, check if it is splittable\n                if (issplittablevalidJSONstring(value)) {\n                    //When it is splittable, then return type as splittable JSON\n                    return \"splittable JSON\"\n                }\n                else {\n                    //if it is JSON, but not splittable ({}, \"100, 100) return unsplittable JSON\n                    return \"unsplittable JSON\"\n                }\n            }\n            else {\n                //When it isn't \"valid\" JSON, check if it is an array\n                if (isvalidarray(value)) {\n                    //When it is an array, check if it is splittable\n                    if (issplittablearray(value)) {\n                        //When it is splittable, return splittable Array\n                        return \"splittable Array\"\n                    }\n                    else {\n                        //if the array is not splittable ([\"apple\"]) return unsplittable array\n                        return \"unsplittable array\"\n                    }\n                }\n                else {\n                    //When it is neither JSON or Array, then it is really just a string, so return string\n                    return \"string\"\n                }\n            }\n            break;\n        case \"object\":\n            //some  splittable values are identified as objects\n\n            //Fist check if the object is \"valid\" JSON\n            if (isvalidJSONstring(value)) {\n                //When it is \"valid\" JSON, check if it is splittable\n                if (issplittablevalidJSONstring(value)) {\n                    //When it is splittable, then return type as splittable JSON\n                    return \"splittable JSON\"\n                }\n                else {\n                    //if it is JSON, but not splittable ({}, \"100, 100) return unsplittable JSON\n                    return \"unsplittable JSON\"\n                }\n            }\n            else {\n                //When it isn't \"valid\" JSON, check if it is an array\n                if (isvalidarray(value)) {\n                    //When it is an array, check if it is splittable\n                    if (issplittablearray(value)) {\n                        //When it is splittable, return splittable Array\n                        return \"splittable Array\"\n                    }\n                    else {\n                        //if the array is not splittable ([\"apple\"]) return unsplittable array\n                        return \"unsplittable array\"\n                    }\n                }\n                else {\n                    //When it is neither JSON or Array, then I have not accounted for it. If you reach this point during an\n                    //  investigation, it might be worth using the example that triggered your investigation to see if the object\n                    //  is really just a string (without a triggering example I have not investigated)\n                    return \"object\"\n                }\n            }\n            break;\n        default:\n            //When the type is not one that I coded for then return unhandled because the situation is by definition unhandled\n            return \"unhandled\"\n            break;\n    }\n}\n\n//True False functions\n/*\n * This function was found on the internet to check if an input is valid JSON\n * There seems to be a belief that there should be some more elegant method that trying parse and the catching the error,\n * but no one seems to have demonstrated what that more elegant way would be\n */\nfunction isvalidJSONstring(str) {\n    try {\n        JSON.parse(str);\n    } catch (e) {\n        return false;\n    }\n    return true;\n}\n\n/*\n * This function decides where the JSON is made up of at least 1 key:value pair\n */\nfunction issplittablevalidJSONstring(str) {\n    if (str.includes(\":\")) {\n        return true;\n    }\n    else {\n        return false;\n    }\n}\n/*\n * This function is simply wrapping the Array.isArray, to align the function naming with the other true false functions\n */\nfunction isvalidarray(str) {\n    if (Array.isArray(str)) {\n        return true;\n    }\n    else {\n        return false;\n    }\n}\n/*\n * This function identifies if the array has only a single entry or multiple entries i.e. [\"Apple\"] not splittable,\n *  [\"Apple\",\"Pear\"] splittable\n */\nfunction issplittablearray(str) {\n    // If the length is more than 1, then the array has mutliple entries, but if it is just 1, then it is not splittable\n    if (str.length > 1) {\n        return true;\n    }\n    else {\n        return false;\n    }\n}\n\n//Splitting functions\n/*\n * This function takes in a msg where msg.payload.value is splittable JSON and iterates through all key:value pairs and then\n *  recursively calls handlemsg with multiple messages. Each new message retains most of the details of the input message, \n *  but the name and value are changed.\n *  The name has the key from the key:value pair appended with a : as a seperator\n *  The value is replaced with the value from the key:value pair\n *  A new message is created for each key:value pair\n */\nfunction splitJSON(latestMsg) {\n    //put the inputs value into a variable for easier access\n    var valueJSON = JSON.parse(latestMsg.payload.value);\n    //put the inputs name aside for multiple reuses\n    var name = latestMsg.payload.name\n    //Iterative loop\n    Object.keys(valueJSON).forEach(function (key) {\n        //concatenate the original name, a colon and the key from the pair\n        if (typeof name === 'undefined') \n        {\n            latestMsg.payload.name = key;\n        } \n        else \n        {\n            latestMsg.payload.name = name + \"/\" + key;\n        }\n        //move the value from the pair to payload.value\n        latestMsg.payload.value = valueJSON[key];\n        //recursively call this function in case the value is itself splittable\n        handlemsg(RED.util.cloneMessage(latestMsg))\n    }\n    )\n    return\n}\n\n/*\n * This function takes in a msg where msg.payload.value is splittable object\n *  and iterates through all key:value pairs and then\n *  recursively calls handlemsg with multiple messages. Each new message retains most of the details of the input message,\n *  but the name and value are changed.\n *  The name has the key from the key:value pair appended with a : as a seperator\n *  The value is replaced with the value from the key:value pair\n *  A new message is created for each key:value pair\n *  \n *  Note: While working on the splitArray function, I realized that I may not have tested this on an object value with multiple\n *  pairs, so it is possible that the function only handles the first pair\n */\nfunction splitObj(oMsg) {\n    //put the inputs name aside for multiple reuses\n    var name = oMsg.payload.name\n//Iterative loop\n    for (let [key, value] of Object.entries(oMsg.payload.value)) {\n        if ((value !== null) && (key !== null)) {\n            oMsg.payload.name = name + \"/\" + key;\n            oMsg.payload.value = value;\n            //recursively call this function in case the value is itself splittable\n            handlemsg(RED.util.cloneMessage(oMsg))\n        }\n    }\n}\n\n/*\n * Note: At the time of creation, I did not have a live example and had too many other things in the works to construct one.\n * \n * This function takes in a msg where msg.payload.value is splittable array\n *  and iterates through all entries and recursively calls handlemsg with multiple messages. \n *  Each new message retains most of the details of the input message,\n *  but the value is changed.\n *  The value is replaced with the value from the entry in the Array\n *  For example if the input value is [\"Apple\",\"Pear\"], then the first msg will have a value of \"Apple\"\n *  and the second will have a value of \"Pear\"\n */\nfunction splitArray(aMsg) {\n    //Iterative loop\n    for (index = 0; index < aMsg.payload.value.length; index++) {\n        (aMsg.payload.value = aMsg.payload.value[index]);\n        //recursively call this function in case the value is itself splittable\n        handlemsg(RED.util.cloneMessage(aMsg))\n    }\n}","outputs":2,"noerr":0,"initialize":"","finalize":"","x":520,"y":1720,"wires":[["b12cd0e6.dfbe8"],["b6c8e770.ae0898"]]},{"id":"b12cd0e6.dfbe8","type":"link out","z":"aad5f0e1.84355","g":"80316bba.f21e28","name":"","links":["8841d117.6795e","9c3ac4a6.123078"],"x":755,"y":1700,"wires":[]},{"id":"b6c8e770.ae0898","type":"link out","z":"aad5f0e1.84355","g":"80316bba.f21e28","name":"","links":["5f5ef5d4.c6f11c"],"x":755,"y":1740,"wires":[]},{"id":"c8d5e79e.9ad1b8","type":"function","z":"aad5f0e1.84355","g":"80316bba.f21e28","name":"Transform owntracks Input into Hubitat format","func":"/*\n * Main function node code \n * \n */\n msg.topic = msg.topic.slice(10, msg.topic.length)\n msg.deviceID = msg.topic\n let d = global.get(\"Devices\")\n let deviceName = msg.topic\n let mainIndex\n let dNCol   //device name column number\n //get column number for Device Name\n for (mainIndex = 0; mainIndex < d[0].length; mainIndex++) {\n     if (d[0][mainIndex] == 'Device') {\n         dNCol = mainIndex\n         continue\n     }}\n let matchingDataRows = d.filter((item) => (item[dNCol]== deviceName))\n switch (matchingDataRows.length) {\n     case 0:\n         msg.payload =  [deviceName,\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"Ashmont\",\"placeholder\",\"Owntracks TBD\",\"OwnTracks\"]\n         d.push(msg.payload)\n         return [msg,null]\n         break\n     case 1:\n         if(matchingDataRows[0][10]!==\"Z2M TBD\"){\n             msg.deviceId = matchingDataRows[0][10]\n         } else {\n             node.warn(\"The device \"+deviceName+`is in the Devices table, but won't be processed until the Device ID is changed from \"HB TBD\" to an actual ID`)\n             return\n         }\n         break\n     default:\n }\n\n\n\n\n\n\n\n\n\n\n\n\n\n msg.temp = msg.payload\ndelete msg.payload\nmsg.payload= {value:msg.temp}\ndelete msg.temp\nmsg.MQTTName = \"zb2mqtt\"\n\n\n\n//Check if there is any data. If not, stop processing. At the time this was created, the trackData sent from a Hubitat Elevation device node was always null\nif (msg.payload.value === null) {\n    return null;\n}\n//initial call into the recursive function\nhandlemsg(msg)\n//send nothing from main code\nreturn\n\n/*\n * Main recursive function code\n *\n */\n\nfunction handlemsg(msg) {\n    //The evaluation part of this switch/case statement determines which type of entity is in the value\n    //  the key idea is that once the value is an atomic item (number, string, bool) then the message should be sent out\n    //  of the node to downstream, but if the value is a splittable, then it should be split into multiple messages. These\n    //  messages are then evaulated individually. They in turn are either found to have atomic entries in the value or have\n    //  values that are themselves splittable.\n    //  For example:\n    //  JSON - each key value pair will be used to create a new msg. The msg.payload.name will be changed to add \":\" and the key\n    //          from the key value pair. The msg.payload.value will become the value from the key value pair\n    //  Array - TBAdded\n    //  Object - TBAdded\n    let prepareAndSend = false\n    msg.topic = msg.topic.substring(msg.topic.lastIndexOf(\"/\") + 1);\n    switch (typeofhubitatvalue(msg.payload.value, \"msg.payload.value\")) {\n        case \"splittable JSON\":\n            //This is for cases where the JSON is in the form of key:value where there is at least 1 pair\n            //  Examples of \"valid\" JSON that would not be coming to this case would be {} or 100\n            splitJSON(msg)\n            break;\n        case \"splittable array\":\n            //This is for cases where the Array is in the form [\"A\",\"B\",\"C\"] where there is are at least 2 members\n            //  SplitArray function not yet built. TBD\n            splitArray(msg)\n            break;\n        case \"unsplittable array\":\n            //This case is where the item is an array, but with only a single entry. The idea is to move that single\n            //  value out of the array and into the value natively and then to call the recursive function to evaluate\n            //  what type of item it now is and then process (split or send or extract) appropriately\n            msg.payload.value = msg.payload.value[0]\n            handlemsg(RED.util.cloneMessage(msg))\n            break;\n        case \"object\":\n            //This is for handling an object. It then calls splitObj to create multiple msgs with the object keys into the names\n            //  and the values from those keys moved into the value of the new object.\n            splitObj(msg)\n            break\n        case \"number\":\n        case \"bigint\":\n        case \"boolean\":\n            //send the version of the msg with an atomic value to downstream nodes\n            prepareAndSend = true\n            break;\n        case \"string\":\n            //Strings are an atomic type of value and should be sent to downstream nodes\n        if (msg.payload.hasOwnProperty('name'))\n            {}\n            else\n            {\n                if (msg.topic.includes(\"/\"))\n                {\n                    msg.payload.name = msg.topic.substring(msg.topic.lastIndexOf(\"/\") + 1);\n                }\n                else\n                {\n                    msg.payload.name = msg.topic\n                }\n            }\n            prepareAndSend = true\n            break;\n        case \"unsplittable JSON\":\n            //This is for handling \"valid\" JSON that does not have key:value pairs.\n            //  Examples of \"valid\" JSON that are handed here are {} or 100 or \"100\"\n            //  This case either treats it as a string (no changes made) or a number where a number in\n            //  a string like \"100\" is changed into an actual number like 100\n\n            //by checking if NaN, if it is a number 100 or \"100\", the ++ followed by -- changes it to a number 100\n            //  without changing its actual value\n            if (isNaN(msg.payload.value)) { } else {\n                ++msg.payload.value;\n                --msg.payload.value;\n            }\n            prepareAndSend = true\n            break\n        default:\n            //This is just in case no valid process is found by the typeofhubitatvalue function.\n            //  If you encounter this then you will either need to investigate the function or contact tmichael in\n            //  Hubitat discourse forums https://community.hubitat.com/\n            return\n    }\n    if (prepareAndSend) {\n        // node.warn(msg)\n        tempReading = msg.payload.value\n        tempMeasure = msg.payload.name\n\n\n\n\n\n\n\n\n\n\n\n\n        msg.payload[tempMeasure]={name:tempMeasure, value:tempReading, deviceId:msg.deviceId}\n        // node.warn(tempMeasure)\n        // node.warn(tempReading)\n        // node.warn(msg)\n        //!insert the deviceId lookup built for hombridge here\n        // node.send(msg)\n        prepareAndSend = false\n        delete msg.deviceId\n        delete msg.payload.value\n        delete msg.payload.name\n        delete msg.qos\n        delete msg.retain\n        delete msg._msgid\n        delete msg.deviceID\n        delete msg.MQTTName\n        node.send([null,msg])\n    }\n}\n\n/*\n * This function is used by the Main recursive function (handlemsg) to decide whether to send the msg on as\n *  the msg.payload.value is atomic or if it needs to split the value into multiple msgs\n *\n */\nfunction typeofhubitatvalue(value, source = \"\") {\n    switch (typeof (value)) {\n        case \"number\":\n            //atomic just return the result of typeof\n            return \"number\"\n            break;\n        case \"bigint\":\n            //atomic just return the result of typeof\n            return \"bigint\"\n            break;\n        case \"boolean\":\n            //atomic just return the result of typeof\n            return \"boolean\"\n            break;\n        case \"string\":\n            //most splittable values are encoded strictly as text and so may be identified as a string\n\n            //Fist check if the string is \"valid\" JSON\n            if (isvalidJSONstring(value)) {\n                //When it is \"valid\" JSON, check if it is splittable\n                if (issplittablevalidJSONstring(value)) {\n                    //When it is splittable, then return type as splittable JSON\n                    return \"splittable JSON\"\n                }\n                else {\n                    //if it is JSON, but not splittable ({}, \"100, 100) return unsplittable JSON\n                    return \"unsplittable JSON\"\n                }\n            }\n            else {\n                //When it isn't \"valid\" JSON, check if it is an array\n                if (isvalidarray(value)) {\n                    //When it is an array, check if it is splittable\n                    if (issplittablearray(value)) {\n                        //When it is splittable, return splittable Array\n                        return \"splittable Array\"\n                    }\n                    else {\n                        //if the array is not splittable ([\"apple\"]) return unsplittable array\n                        return \"unsplittable array\"\n                    }\n                }\n                else {\n                    //When it is neither JSON or Array, then it is really just a string, so return string\n                    return \"string\"\n                }\n            }\n            break;\n        case \"object\":\n            //some  splittable values are identified as objects\n\n            //Fist check if the object is \"valid\" JSON\n            if (isvalidJSONstring(value)) {\n                //When it is \"valid\" JSON, check if it is splittable\n                if (issplittablevalidJSONstring(value)) {\n                    //When it is splittable, then return type as splittable JSON\n                    return \"splittable JSON\"\n                }\n                else {\n                    //if it is JSON, but not splittable ({}, \"100, 100) return unsplittable JSON\n                    return \"unsplittable JSON\"\n                }\n            }\n            else {\n                //When it isn't \"valid\" JSON, check if it is an array\n                if (isvalidarray(value)) {\n                    //When it is an array, check if it is splittable\n                    if (issplittablearray(value)) {\n                        //When it is splittable, return splittable Array\n                        return \"splittable Array\"\n                    }\n                    else {\n                        //if the array is not splittable ([\"apple\"]) return unsplittable array\n                        return \"unsplittable array\"\n                    }\n                }\n                else {\n                    //When it is neither JSON or Array, then I have not accounted for it. If you reach this point during an\n                    //  investigation, it might be worth using the example that triggered your investigation to see if the object\n                    //  is really just a string (without a triggering example I have not investigated)\n                    return \"object\"\n                }\n            }\n            break;\n        default:\n            //When the type is not one that I coded for then return unhandled because the situation is by definition unhandled\n            return \"unhandled\"\n            break;\n    }\n}\n\n//True False functions\n/*\n * This function was found on the internet to check if an input is valid JSON\n * There seems to be a belief that there should be some more elegant method that trying parse and the catching the error,\n * but no one seems to have demonstrated what that more elegant way would be\n */\nfunction isvalidJSONstring(str) {\n    try {\n        JSON.parse(str);\n    } catch (e) {\n        return false;\n    }\n    return true;\n}\n\n/*\n * This function decides where the JSON is made up of at least 1 key:value pair\n */\nfunction issplittablevalidJSONstring(str) {\n    if (str.includes(\":\")) {\n        return true;\n    }\n    else {\n        return false;\n    }\n}\n/*\n * This function is simply wrapping the Array.isArray, to align the function naming with the other true false functions\n */\nfunction isvalidarray(str) {\n    if (Array.isArray(str)) {\n        return true;\n    }\n    else {\n        return false;\n    }\n}\n/*\n * This function identifies if the array has only a single entry or multiple entries i.e. [\"Apple\"] not splittable,\n *  [\"Apple\",\"Pear\"] splittable\n */\nfunction issplittablearray(str) {\n    // If the length is more than 1, then the array has mutliple entries, but if it is just 1, then it is not splittable\n    if (str.length > 1) {\n        return true;\n    }\n    else {\n        return false;\n    }\n}\n\n//Splitting functions\n/*\n * This function takes in a msg where msg.payload.value is splittable JSON and iterates through all key:value pairs and then\n *  recursively calls handlemsg with multiple messages. Each new message retains most of the details of the input message, \n *  but the name and value are changed.\n *  The name has the key from the key:value pair appended with a : as a seperator\n *  The value is replaced with the value from the key:value pair\n *  A new message is created for each key:value pair\n */\nfunction splitJSON(latestMsg) {\n    //put the inputs value into a variable for easier access\n    var valueJSON = JSON.parse(latestMsg.payload.value);\n    //put the inputs name aside for multiple reuses\n    var name = latestMsg.payload.name\n    //Iterative loop\n    Object.keys(valueJSON).forEach(function (key) {\n        //concatenate the original name, a colon and the key from the pair\n        if (typeof name === 'undefined') \n        {\n            latestMsg.payload.name = key;\n        } \n        else \n        {\n            latestMsg.payload.name = name + \"/\" + key;\n        }\n        //move the value from the pair to payload.value\n        latestMsg.payload.value = valueJSON[key];\n        //recursively call this function in case the value is itself splittable\n        handlemsg(RED.util.cloneMessage(latestMsg))\n    }\n    )\n    return\n}\n\n/*\n * This function takes in a msg where msg.payload.value is splittable object\n *  and iterates through all key:value pairs and then\n *  recursively calls handlemsg with multiple messages. Each new message retains most of the details of the input message,\n *  but the name and value are changed.\n *  The name has the key from the key:value pair appended with a : as a seperator\n *  The value is replaced with the value from the key:value pair\n *  A new message is created for each key:value pair\n *  \n *  Note: While working on the splitArray function, I realized that I may not have tested this on an object value with multiple\n *  pairs, so it is possible that the function only handles the first pair\n */\nfunction splitObj(oMsg) {\n    //put the inputs name aside for multiple reuses\n    var name = oMsg.payload.name\n//Iterative loop\n    for (let [key, value] of Object.entries(oMsg.payload.value)) {\n        if ((value !== null) && (key !== null)) {\n            oMsg.payload.name = name + \"/\" + key;\n            oMsg.payload.value = value;\n            //recursively call this function in case the value is itself splittable\n            handlemsg(RED.util.cloneMessage(oMsg))\n        }\n    }\n}\n\n/*\n * Note: At the time of creation, I did not have a live example and had too many other things in the works to construct one.\n * \n * This function takes in a msg where msg.payload.value is splittable array\n *  and iterates through all entries and recursively calls handlemsg with multiple messages. \n *  Each new message retains most of the details of the input message,\n *  but the value is changed.\n *  The value is replaced with the value from the entry in the Array\n *  For example if the input value is [\"Apple\",\"Pear\"], then the first msg will have a value of \"Apple\"\n *  and the second will have a value of \"Pear\"\n */\nfunction splitArray(aMsg) {\n    //Iterative loop\n    for (index = 0; index < aMsg.payload.value.length; index++) {\n        (aMsg.payload.value = aMsg.payload.value[index]);\n        //recursively call this function in case the value is itself splittable\n        handlemsg(RED.util.cloneMessage(aMsg))\n    }\n}","outputs":2,"noerr":0,"initialize":"","finalize":"","x":550,"y":1800,"wires":[["310ccc9e.f2d9c4"],["98a796c3.64daa8"]]},{"id":"310ccc9e.f2d9c4","type":"link out","z":"aad5f0e1.84355","g":"80316bba.f21e28","name":"","links":["8841d117.6795e","9c3ac4a6.123078"],"x":755,"y":1780,"wires":[]},{"id":"98a796c3.64daa8","type":"link out","z":"aad5f0e1.84355","g":"80316bba.f21e28","name":"","links":["5f5ef5d4.c6f11c"],"x":755,"y":1820,"wires":[]},{"id":"5fca20ed.d9177","type":"hb-status","z":"aad5f0e1.84355","g":"ebf77e9c.f4512","name":"Downstairs Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestDownstairs Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":2620,"y":1586,"wires":[["c1aa0bf.f4185f8"]]},{"id":"71e72d51.053644","type":"comment","z":"aad5f0e1.84355","g":"9834023f.0eb12","name":"Placeholder Kathy Home","info":"","x":4210,"y":1786,"wires":[]},{"id":"2141dfc8.694e4","type":"hb-status","z":"aad5f0e1.84355","g":"9834023f.0eb12","name":"Anyone","Homebridge":"Homebridge","Manufacturer":"Default-Manufacturer","Service":"Occupancy Sensor","device":"HomebridgeCC:22:3D:E3:CE:30Default-ManufacturerAnyone00000086","conf":"df59aa47.b26148","x":4160,"y":1586,"wires":[["65234354.ebf3ec"]]},{"id":"2abbe3d2.3077cc","type":"hb-status","z":"aad5f0e1.84355","g":"77f71e65.e470f","name":"Downstairs Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestDownstairs Motion00000085","conf":"df59aa47.b26148","x":2080,"y":1706,"wires":[["3f3c1b3f.18fef4"]]},{"id":"55a42036.68041","type":"hb-status","z":"aad5f0e1.84355","g":"fef43fdd.99e2e","name":"Downstairs Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestDownstairs Smoke00000087","conf":"df59aa47.b26148","x":3170,"y":1586,"wires":[["76334fc8.eadf1"]]},{"id":"2ca51afb.75f7d6","type":"hb-status","z":"aad5f0e1.84355","g":"cd25065b.de59c8","name":"Gratuity Thermostat - Eco Mode","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Switch","device":"HomebridgeCC:22:3D:E3:CE:30NestGratuity Thermostat - Eco Mode00000049","conf":"df59aa47.b26148","x":3710,"y":1586,"wires":[["151d2efd.7e8481"]]},{"id":"62ef5c1a.dfdb84","type":"hb-status","z":"aad5f0e1.84355","g":"cd25065b.de59c8","name":"Gratuity Thermostat - Fan","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Fan","device":"HomebridgeCC:22:3D:E3:CE:30NestGratuity Thermostat - Fan00000040","conf":"df59aa47.b26148","x":3690,"y":1666,"wires":[["151d2efd.7e8481"]]},{"id":"e0007e6f.b8466","type":"hb-status","z":"aad5f0e1.84355","g":"cd25065b.de59c8","name":"Gratuity Thermostat","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Thermostat","device":"HomebridgeCC:22:3D:E3:CE:30NestGratuity Thermostat0000004A","conf":"df59aa47.b26148","x":3670,"y":1746,"wires":[["151d2efd.7e8481"]]},{"id":"b9e75269.5c12d","type":"hb-status","z":"aad5f0e1.84355","g":"9834023f.0eb12","name":"Mike iPhone Home","Homebridge":"Homebridge","Manufacturer":"Default-Manufacturer","Service":"Occupancy Sensor","device":"HomebridgeCC:22:3D:E3:CE:30Default-ManufacturerMike iPhone Home00000086","conf":"df59aa47.b26148","x":4190,"y":1666,"wires":[["65234354.ebf3ec"]]},{"id":"bde48c26.b9345","type":"comment","z":"aad5f0e1.84355","g":"9834023f.0eb12","name":"Placeholder Eva Home","info":"","x":4200,"y":1826,"wires":[]},{"id":"28906905.70d9f6","type":"comment","z":"aad5f0e1.84355","g":"9834023f.0eb12","name":"Placeholder Eva LTHS","info":"","x":4200,"y":1866,"wires":[]},{"id":"3cad3f54.76744","type":"comment","z":"aad5f0e1.84355","g":"9834023f.0eb12","name":"Placeholder Eva CTE","info":"","x":4200,"y":1906,"wires":[]},{"id":"eef9cff5.9a2d9","type":"comment","z":"aad5f0e1.84355","g":"9834023f.0eb12","name":"Placeholder Eva Dance","info":"","x":4200,"y":1946,"wires":[]},{"id":"b6f9cec9.a3b52","type":"comment","z":"aad5f0e1.84355","g":"9834023f.0eb12","name":"Placeholder Kathy Dance","info":"","x":4210,"y":1986,"wires":[]},{"id":"759c545b.c3563c","type":"comment","z":"aad5f0e1.84355","g":"9834023f.0eb12","name":"Placeholder Mike Work","info":"","x":4200,"y":1746,"wires":[]},{"id":"b74bcaff.688858","type":"hb-status","z":"aad5f0e1.84355","g":"ebf77e9c.f4512","name":"Eva Hallway Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestEva Hallway Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":2630,"y":1666,"wires":[["c1aa0bf.f4185f8"]]},{"id":"4715a743.874778","type":"hb-status","z":"aad5f0e1.84355","g":"ebf77e9c.f4512","name":"Evas Bedroom Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestEvas Bedroom Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":2640,"y":1746,"wires":[["c1aa0bf.f4185f8"]]},{"id":"1232a17e.690f7f","type":"hb-status","z":"aad5f0e1.84355","g":"ebf77e9c.f4512","name":"Game Room Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestGame Room Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":2630,"y":1826,"wires":[["c1aa0bf.f4185f8"]]},{"id":"8cbf499c.833c58","type":"hb-status","z":"aad5f0e1.84355","g":"ebf77e9c.f4512","name":"Guest Bedroom Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestGuest Bedroom Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":2640,"y":1906,"wires":[["c1aa0bf.f4185f8"]]},{"id":"daf44023.0a56c","type":"hb-status","z":"aad5f0e1.84355","g":"ebf77e9c.f4512","name":"Master Bedroom Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestMaster Bedroom Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":2640,"y":1986,"wires":[["764591d6.f90ae"]]},{"id":"889acb57.8e7e68","type":"hb-status","z":"aad5f0e1.84355","g":"ebf77e9c.f4512","name":"Toy Room Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestToy Room Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":2620,"y":2066,"wires":[["764591d6.f90ae"]]},{"id":"17244be3.93d874","type":"hb-status","z":"aad5f0e1.84355","g":"ebf77e9c.f4512","name":"Toy Room Hallway Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestToy Room Hallway Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":2650,"y":2146,"wires":[["764591d6.f90ae"]]},{"id":"6193baf8.1ebd04","type":"hb-status","z":"aad5f0e1.84355","g":"77f71e65.e470f","name":"Eva Hallway Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestEva Hallway Motion00000085","conf":"df59aa47.b26148","x":2080,"y":1786,"wires":[["3f3c1b3f.18fef4"]]},{"id":"88eb591a.cceea8","type":"hb-status","z":"aad5f0e1.84355","g":"77f71e65.e470f","name":"Evas Bedroom Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestEvas Bedroom Motion00000085","conf":"df59aa47.b26148","x":2090,"y":1866,"wires":[["3f3c1b3f.18fef4"]]},{"id":"f61e3814.cf3248","type":"hb-status","z":"aad5f0e1.84355","g":"77f71e65.e470f","name":"Guest Bedroom Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestGuest Bedroom Motion00000085","conf":"df59aa47.b26148","x":2100,"y":2026,"wires":[["a6c60f34.491f4"]]},{"id":"5f2a119f.5822b","type":"hb-status","z":"aad5f0e1.84355","g":"77f71e65.e470f","name":"Master Bedroom Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestMaster Bedroom Motion00000085","conf":"df59aa47.b26148","x":2100,"y":2106,"wires":[["a6c60f34.491f4"]]},{"id":"510dcf85.3a02f","type":"hb-status","z":"aad5f0e1.84355","g":"77f71e65.e470f","name":"Toy Room Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestToy Room Motion00000085","conf":"df59aa47.b26148","x":2080,"y":2186,"wires":[["a6c60f34.491f4"]]},{"id":"2d6f09e.c5c90f6","type":"hb-status","z":"aad5f0e1.84355","g":"77f71e65.e470f","name":"Toy Room Hallway Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestToy Room Hallway Motion00000085","conf":"df59aa47.b26148","x":2100,"y":2266,"wires":[["a6c60f34.491f4"]]},{"id":"bdfa65e1.617688","type":"hb-status","z":"aad5f0e1.84355","g":"77f71e65.e470f","name":"Game Room Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestGame Room Motion00000085","conf":"df59aa47.b26148","x":2090,"y":1946,"wires":[["3f3c1b3f.18fef4"]]},{"id":"ed2504d.1fef1f8","type":"hb-status","z":"aad5f0e1.84355","g":"fef43fdd.99e2e","name":"Eva Hallway Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestEva Hallway Smoke00000087","conf":"df59aa47.b26148","x":3180,"y":1666,"wires":[["76334fc8.eadf1"]]},{"id":"c39d5d8c.91dac","type":"hb-status","z":"aad5f0e1.84355","g":"fef43fdd.99e2e","name":"Evas Bedroom Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestEvas Bedroom Smoke00000087","conf":"df59aa47.b26148","x":3180,"y":1746,"wires":[["76334fc8.eadf1"]]},{"id":"f547610e.77f35","type":"hb-status","z":"aad5f0e1.84355","g":"fef43fdd.99e2e","name":"Game Room Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestGame Room Smoke00000087","conf":"df59aa47.b26148","x":3180,"y":1826,"wires":[["76334fc8.eadf1"]]},{"id":"b57bbced.6239a","type":"hb-status","z":"aad5f0e1.84355","g":"fef43fdd.99e2e","name":"Guest Bedroom Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestGuest Bedroom Smoke00000087","conf":"df59aa47.b26148","x":3190,"y":1906,"wires":[["bfa05903.f8cb38"]]},{"id":"5a40284.62595d8","type":"hb-status","z":"aad5f0e1.84355","g":"fef43fdd.99e2e","name":"Master Bedroom Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestMaster Bedroom Smoke00000087","conf":"df59aa47.b26148","x":3190,"y":1986,"wires":[["bfa05903.f8cb38"]]},{"id":"7f870556.6466bc","type":"hb-status","z":"aad5f0e1.84355","g":"fef43fdd.99e2e","name":"Toy Room Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestToy Room Smoke00000087","conf":"df59aa47.b26148","x":3170,"y":2066,"wires":[["bfa05903.f8cb38"]]},{"id":"5f80a4cb.10025c","type":"hb-status","z":"aad5f0e1.84355","g":"fef43fdd.99e2e","name":"Toy Room Hallway Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestToy Room Hallway Smoke00000087","conf":"df59aa47.b26148","x":3190,"y":2146,"wires":[["bfa05903.f8cb38"]]},{"id":"9f909535.038648","type":"hb-status","z":"aad5f0e1.84355","g":"146deab7.c05a55","name":"Eve Motion Passthrough","Homebridge":"Homebridge","Manufacturer":"Default-Manufacturer","Service":"Switch","device":"HomebridgeCC:22:3D:E3:CE:30Default-ManufacturerEve Motion Passthrough00000049","conf":"df59aa47.b26148","x":2090,"y":1586,"wires":[["3f3c1b3f.18fef4"]]},{"id":"7622423a.cac26c","type":"hb-event","z":"aad5f0e1.84355","g":"146deab7.c05a55","name":"Eve Motion Passthrough","Homebridge":"Homebridge","Manufacturer":"Default-Manufacturer","Service":"Switch","device":"HomebridgeCC:22:3D:E3:CE:30Default-ManufacturerEve Motion Passthrough00000049","conf":"df59aa47.b26148","x":2090,"y":1626,"wires":[["3f3c1b3f.18fef4"]]},{"id":"885d993a.fd3208","type":"hb-event","z":"aad5f0e1.84355","g":"cd25065b.de59c8","name":"Gratuity Thermostat","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Thermostat","device":"HomebridgeCC:22:3D:E3:CE:30NestGratuity Thermostat0000004A","conf":"df59aa47.b26148","x":3670,"y":1786,"wires":[["151d2efd.7e8481"]]},{"id":"67f25f0.fa84aa","type":"hb-event","z":"aad5f0e1.84355","g":"cd25065b.de59c8","name":"Gratuity Thermostat - Fan","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Fan","device":"HomebridgeCC:22:3D:E3:CE:30NestGratuity Thermostat - Fan00000040","conf":"df59aa47.b26148","x":3690,"y":1706,"wires":[["151d2efd.7e8481"]]},{"id":"6e0aafc0.e29d8","type":"hb-event","z":"aad5f0e1.84355","g":"cd25065b.de59c8","name":"Gratuity Thermostat - Eco Mode","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Switch","device":"HomebridgeCC:22:3D:E3:CE:30NestGratuity Thermostat - Eco Mode00000049","conf":"df59aa47.b26148","x":3710,"y":1626,"wires":[["151d2efd.7e8481"]]},{"id":"46ec3a5d.ec1c54","type":"hb-event","z":"aad5f0e1.84355","g":"77f71e65.e470f","name":"Downstairs Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestDownstairs Motion00000085","conf":"df59aa47.b26148","x":2080,"y":1746,"wires":[["3f3c1b3f.18fef4"]]},{"id":"aaf72904.785ac8","type":"hb-event","z":"aad5f0e1.84355","g":"77f71e65.e470f","name":"Eva Hallway Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestEva Hallway Motion00000085","conf":"df59aa47.b26148","x":2080,"y":1826,"wires":[["3f3c1b3f.18fef4"]]},{"id":"5b71736f.78baac","type":"hb-event","z":"aad5f0e1.84355","g":"77f71e65.e470f","name":"Evas Bedroom Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestEvas Bedroom Motion00000085","conf":"df59aa47.b26148","x":2090,"y":1906,"wires":[["3f3c1b3f.18fef4"]]},{"id":"a019df8.057cf2","type":"hb-event","z":"aad5f0e1.84355","g":"77f71e65.e470f","name":"Game Room Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestGame Room Motion00000085","conf":"df59aa47.b26148","x":2080,"y":1986,"wires":[["3f3c1b3f.18fef4"]]},{"id":"54e7940b.d9bcbc","type":"hb-event","z":"aad5f0e1.84355","g":"77f71e65.e470f","name":"Guest Bedroom Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestGuest Bedroom Motion00000085","conf":"df59aa47.b26148","x":2090,"y":2066,"wires":[["a6c60f34.491f4"]]},{"id":"a22edff9.efc3e","type":"hb-event","z":"aad5f0e1.84355","g":"77f71e65.e470f","name":"Master Bedroom Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestMaster Bedroom Motion00000085","conf":"df59aa47.b26148","x":2090,"y":2146,"wires":[["a6c60f34.491f4"]]},{"id":"2657afa2.16e68","type":"hb-event","z":"aad5f0e1.84355","g":"77f71e65.e470f","name":"Toy Room Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestToy Room Motion00000085","conf":"df59aa47.b26148","x":2070,"y":2226,"wires":[["a6c60f34.491f4"]]},{"id":"c2bd7a8d.c5d448","type":"hb-event","z":"aad5f0e1.84355","g":"77f71e65.e470f","name":"Toy Room Hallway Motion","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Motion Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestToy Room Hallway Motion00000085","conf":"df59aa47.b26148","x":2100,"y":2306,"wires":[["a6c60f34.491f4"]]},{"id":"2e628595.e1e36a","type":"hb-event","z":"aad5f0e1.84355","g":"fef43fdd.99e2e","name":"Downstairs Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestDownstairs Smoke00000087","conf":"df59aa47.b26148","x":3170,"y":1626,"wires":[["76334fc8.eadf1"]]},{"id":"9d4d6ce3.887dc","type":"hb-event","z":"aad5f0e1.84355","g":"fef43fdd.99e2e","name":"Eva Hallway Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestEva Hallway Smoke00000087","conf":"df59aa47.b26148","x":3170,"y":1706,"wires":[["76334fc8.eadf1"]]},{"id":"78486b97.576e34","type":"hb-event","z":"aad5f0e1.84355","g":"fef43fdd.99e2e","name":"Evas Bedroom Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestEvas Bedroom Smoke00000087","conf":"df59aa47.b26148","x":3180,"y":1786,"wires":[["76334fc8.eadf1"]]},{"id":"e752bc04.c8411","type":"hb-event","z":"aad5f0e1.84355","g":"fef43fdd.99e2e","name":"Game Room Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestGame Room Smoke00000087","conf":"df59aa47.b26148","x":3170,"y":1866,"wires":[["76334fc8.eadf1"]]},{"id":"cdf114a6.0927e8","type":"hb-event","z":"aad5f0e1.84355","g":"fef43fdd.99e2e","name":"Guest Bedroom Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestGuest Bedroom Smoke00000087","conf":"df59aa47.b26148","x":3180,"y":1946,"wires":[["bfa05903.f8cb38"]]},{"id":"22a580c6.d24fe","type":"hb-event","z":"aad5f0e1.84355","g":"fef43fdd.99e2e","name":"Master Bedroom Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestMaster Bedroom Smoke00000087","conf":"df59aa47.b26148","x":3190,"y":2026,"wires":[["bfa05903.f8cb38"]]},{"id":"6707634c.609abc","type":"hb-event","z":"aad5f0e1.84355","g":"fef43fdd.99e2e","name":"Toy Room Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestToy Room Smoke00000087","conf":"df59aa47.b26148","x":3160,"y":2106,"wires":[["bfa05903.f8cb38"]]},{"id":"d3c0d72c.f06bf8","type":"hb-event","z":"aad5f0e1.84355","g":"fef43fdd.99e2e","name":"Toy Room Hallway Smoke","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Smoke Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestToy Room Hallway Smoke00000087","conf":"df59aa47.b26148","x":3190,"y":2186,"wires":[["bfa05903.f8cb38"]]},{"id":"6327ffb0.5cfb3","type":"hb-event","z":"aad5f0e1.84355","g":"ebf77e9c.f4512","name":"Downstairs Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestDownstairs Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":2620,"y":1626,"wires":[["c1aa0bf.f4185f8"]]},{"id":"ca5872f5.b3abc","type":"hb-event","z":"aad5f0e1.84355","g":"ebf77e9c.f4512","name":"Eva Hallway Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestEva Hallway Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":2630,"y":1706,"wires":[["c1aa0bf.f4185f8"]]},{"id":"5437f1fb.3c186","type":"hb-event","z":"aad5f0e1.84355","g":"ebf77e9c.f4512","name":"Evas Bedroom Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestEvas Bedroom Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":2630,"y":1786,"wires":[["c1aa0bf.f4185f8"]]},{"id":"2fdc5364.37623c","type":"hb-event","z":"aad5f0e1.84355","g":"ebf77e9c.f4512","name":"Game Room Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestGame Room Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":2630,"y":1866,"wires":[["c1aa0bf.f4185f8"]]},{"id":"b6583b9b.b0f1b8","type":"hb-event","z":"aad5f0e1.84355","g":"ebf77e9c.f4512","name":"Guest Bedroom Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestGuest Bedroom Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":2640,"y":1946,"wires":[["764591d6.f90ae"]]},{"id":"21b1d38.3c5722c","type":"hb-event","z":"aad5f0e1.84355","g":"ebf77e9c.f4512","name":"Master Bedroom Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestMaster Bedroom Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":2640,"y":2026,"wires":[["764591d6.f90ae"]]},{"id":"63be61b0.967be","type":"hb-event","z":"aad5f0e1.84355","g":"ebf77e9c.f4512","name":"Toy Room Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestToy Room Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":2620,"y":2106,"wires":[["764591d6.f90ae"]]},{"id":"2b3f0c7.2ac52f4","type":"hb-event","z":"aad5f0e1.84355","g":"ebf77e9c.f4512","name":"Toy Room Hallway Carbon Monoxide","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Carbon Monoxide Sensor","device":"HomebridgeCC:22:3D:E3:CE:30NestToy Room Hallway Carbon Monoxide0000007F","conf":"df59aa47.b26148","x":2640,"y":2186,"wires":[["764591d6.f90ae"]]},{"id":"b4ce45ab.d2fa38","type":"hb-event","z":"aad5f0e1.84355","g":"9834023f.0eb12","name":"Anyone","Homebridge":"Homebridge","Manufacturer":"Default-Manufacturer","Service":"Occupancy Sensor","device":"HomebridgeCC:22:3D:E3:CE:30Default-ManufacturerAnyone00000086","conf":"df59aa47.b26148","x":4150,"y":1626,"wires":[["65234354.ebf3ec"]]},{"id":"76776180.9ea89","type":"hb-event","z":"aad5f0e1.84355","g":"9834023f.0eb12","name":"Mike iPhone Home","Homebridge":"Homebridge","Manufacturer":"Default-Manufacturer","Service":"Occupancy Sensor","device":"HomebridgeCC:22:3D:E3:CE:30Default-ManufacturerMike iPhone Home00000086","conf":"df59aa47.b26148","x":4190,"y":1706,"wires":[["65234354.ebf3ec"]]},{"id":"81f45827.0d7048","type":"link in","z":"aad5f0e1.84355","g":"9834023f.0eb12","name":"Manual Trigger","links":["c91be57d.4adbd8"],"x":4035,"y":1626,"wires":[["2141dfc8.694e4","b9e75269.5c12d"]]},{"id":"c91be57d.4adbd8","type":"link out","z":"aad5f0e1.84355","g":"76613d9c.dccc04","name":"Send Manual Trigger","links":["81f45827.0d7048","ae1ba01c.692a8","46e4d5f0.ea3dac","26c4754b.7bba6a","17c6ce0.96c3f32","4dbc729f.3f0fec"],"x":440,"y":660,"wires":[],"l":true},{"id":"53b88059.cdf48","type":"link in","z":"aad5f0e1.84355","g":"76613d9c.dccc04","name":"Recieve All Trigger","links":["866b342f.343a68"],"x":190,"y":700,"wires":[["c91be57d.4adbd8"]],"l":true},{"id":"4d2c9b75.7d98a4","type":"link in","z":"aad5f0e1.84355","g":"76613d9c.dccc04","name":"Homebridge Inputs","links":["76334fc8.eadf1","65234354.ebf3ec","3f3c1b3f.18fef4","a6c60f34.491f4","c1aa0bf.f4185f8","764591d6.f90ae","151d2efd.7e8481","bfa05903.f8cb38"],"x":430,"y":700,"wires":[["67948ec0.a84a8"]],"l":true},{"id":"46e4d5f0.ea3dac","type":"link in","z":"aad5f0e1.84355","g":"146deab7.c05a55","name":"Manual Trigger","links":["c91be57d.4adbd8"],"x":1895,"y":1866,"wires":[["9f909535.038648","2abbe3d2.3077cc","6193baf8.1ebd04","88eb591a.cceea8","bdfa65e1.617688","f61e3814.cf3248","5f2a119f.5822b","510dcf85.3a02f","2d6f09e.c5c90f6"]]},{"id":"26c4754b.7bba6a","type":"link in","z":"aad5f0e1.84355","g":"fef43fdd.99e2e","name":"Manual Trigger","links":["c91be57d.4adbd8"],"x":2995,"y":1866,"wires":[["55a42036.68041","ed2504d.1fef1f8","c39d5d8c.91dac","f547610e.77f35","b57bbced.6239a","5a40284.62595d8","7f870556.6466bc","5f80a4cb.10025c"]]},{"id":"17c6ce0.96c3f32","type":"link in","z":"aad5f0e1.84355","g":"ebf77e9c.f4512","name":"Manual Trigger","links":["c91be57d.4adbd8"],"x":2415,"y":1866,"wires":[["5fca20ed.d9177","b74bcaff.688858","4715a743.874778","1232a17e.690f7f","8cbf499c.833c58","daf44023.0a56c","889acb57.8e7e68","17244be3.93d874"]]},{"id":"4dbc729f.3f0fec","type":"link in","z":"aad5f0e1.84355","g":"cd25065b.de59c8","name":"Manual Trigger","links":["c91be57d.4adbd8"],"x":3495,"y":1666,"wires":[["2ca51afb.75f7d6","62ef5c1a.dfdb84","e0007e6f.b8466"]]},{"id":"76334fc8.eadf1","type":"link out","z":"aad5f0e1.84355","g":"fef43fdd.99e2e","name":"Send Homebridge Inputs","links":["4d2c9b75.7d98a4"],"x":3395,"y":1726,"wires":[]},{"id":"65234354.ebf3ec","type":"link out","z":"aad5f0e1.84355","g":"9834023f.0eb12","name":"Send Homebridge Inputs","links":["4d2c9b75.7d98a4"],"x":4355,"y":1606,"wires":[]},{"id":"3f3c1b3f.18fef4","type":"link out","z":"aad5f0e1.84355","g":"146deab7.c05a55","name":"Send Homebridge Inputs","links":["4d2c9b75.7d98a4"],"x":2315,"y":1806,"wires":[]},{"id":"a6c60f34.491f4","type":"link out","z":"aad5f0e1.84355","g":"146deab7.c05a55","name":"Send Homebridge Inputs","links":["4d2c9b75.7d98a4"],"x":2315,"y":2186,"wires":[]},{"id":"c1aa0bf.f4185f8","type":"link out","z":"aad5f0e1.84355","g":"ebf77e9c.f4512","name":"Send Homebridge Inputs","links":["4d2c9b75.7d98a4"],"x":2895,"y":1706,"wires":[]},{"id":"764591d6.f90ae","type":"link out","z":"aad5f0e1.84355","g":"ebf77e9c.f4512","name":"Send Homebridge Inputs","links":["4d2c9b75.7d98a4"],"x":2895,"y":2026,"wires":[]},{"id":"151d2efd.7e8481","type":"link out","z":"aad5f0e1.84355","g":"cd25065b.de59c8","name":"Send Homebridge Inputs","links":["4d2c9b75.7d98a4"],"x":3935,"y":1686,"wires":[]},{"id":"bfa05903.f8cb38","type":"link out","z":"aad5f0e1.84355","g":"fef43fdd.99e2e","name":"Send Homebridge Inputs","links":["4d2c9b75.7d98a4"],"x":3395,"y":2026,"wires":[]},{"id":"b9c32ccf.e2554","type":"inject","z":"aad5f0e1.84355","name":"Manual Trigger Hubitat and Hombridge","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":250,"y":40,"wires":[["866b342f.343a68"]]},{"id":"866b342f.343a68","type":"link out","z":"aad5f0e1.84355","name":"","links":["ca1f0289.5f67f","53b88059.cdf48"],"x":435,"y":40,"wires":[]},{"id":"ca1f0289.5f67f","type":"link in","z":"aad5f0e1.84355","g":"f9871510.22aa18","name":"Recieve All Trigger","links":["866b342f.343a68"],"x":390,"y":500,"wires":[["4a4b8cce.471b54"]],"l":true},{"id":"4d5c35eb.8281bc","type":"inject","z":"aad5f0e1.84355","g":"fbc622f3.83b57","name":"Automatically Trigger Needed GSheet Population","props":[{"p":"payload"}],"repeat":"300","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":710,"y":200,"wires":[["77a65d8c.a5ca44","18da18f6.f23207","36b2610.0603da"]]},{"id":"36b2610.0603da","type":"GSheet","z":"aad5f0e1.84355","g":"c006d5be.c7de98","creds":"adb4e9b8.8beee8","method":"get","action":"","sheet":"1gQZK2aV9LaQT23WInvlTiUUIX-vMVbBA_k1eCda7Kus","cells":"MeasurementTranslations!A1:Z2000","name":"Read Input from GSheet","x":1090,"y":200,"wires":[["78c01376.f5c0ac"]],"info":"Use the GSheet node to get the a set of rows from a google spreadsheet.\n\n# **Inputs**\n### **creds**\nThis is the name on the gauth configuration node. How to get the details is beyond the scope of what I am going to put into an individual node instance. Some details are at [node-red-contrib-google-sheets](https://flows.nodered.org/node/node-red-contrib-google-sheets)\n### **Method**\nIn this case using the get cells method to read a set of data.\n### **SpreadsheetID**\nUnused as the spreadsheet ID is passed in as part of the input msg, but if needed it would be the long spreadsheet identifier that can be pulled from the spreadsheet's URL when editing it using Google Sheets.\n### **Cells**\nUnused as the requested cells are passed in as part of the input msg, but if it was being manually built for a static data source the format is made of of 3 parts with specific seperators:\n * **[Sheetname]** like Sheet1\n * **[upper left corner cell address]** like A1\n * **[lower right corner cell address]** like B2\n\nThe format is **[Sheetname]**!**[upper left corner cell address]**:**[lower right corner cell address]** giving an input like **Sheet1!A1:B2**\n "},{"id":"78c01376.f5c0ac","type":"function","z":"aad5f0e1.84355","g":"c006d5be.c7de98","name":"","func":"global.set(\"MeasurementTranslations\",msg.payload)\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1280,"y":200,"wires":[["588790c9.d8919"]]},{"id":"b05fa203.88579","type":"function","z":"aad5f0e1.84355","g":"80316bba.f21e28","name":"Pass zigbee2mqtt/bridge/state while removing all other zigbee2mqtt/bridge/# items","func":"if(msg.topic.slice(0,18) !== \"zigbee2mqtt/bridge\"){\n  return msg  \n} else{\n    if(msg.topic.slice(0,24) == \"zigbee2mqtt/bridge/state\"){\n        return msg;\n    }\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":490,"y":1560,"wires":[["94d280de.04719"]]},{"id":"bfa732f1.ea609","type":"worldmap in","z":"1a0aa13a.9d7b8f","name":"test map out","path":"/worldmapF","events":"all","x":1960,"y":480,"wires":[["96433b2c.1f0208"]]},{"id":"96433b2c.1f0208","type":"debug","z":"1a0aa13a.9d7b8f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2140,"y":480,"wires":[]},{"id":"cd6675bd.9c96d8","type":"ui_numeric","z":"1f1da42b.7b60bc","name":"","label":"numeric","tooltip":"","group":"6a229a9c.dc9cc4","order":3,"width":0,"height":0,"wrap":false,"passthru":true,"topic":"","format":"{{value}}","min":0,"max":10,"step":1,"x":280,"y":840,"wires":[["56c26b0d.3d6074","383dd7f9.3c2cd8","af2b4940.4e97a8","53e45e11.12805","e8cc4fd4.80c99","ac122ee.e72e5d","626b4a42.a58b64","f94b4e03.d008b","49c8e2e6.73ca4c","ed71effe.ca84d","1c96b7ca.ac1228","1c55ffa2.623d7","c0be50a5.2e4aa"]]},{"id":"56c26b0d.3d6074","type":"ui_gauge","z":"1f1da42b.7b60bc","name":"","group":"6a229a9c.dc9cc4","order":1,"width":"3","height":"3","gtype":"gage","title":"gauge","label":"units","format":"{{value}}","min":0,"max":10,"colors":["#00b500","#e6e600","#ca3838"],"seg1":"abc","seg2":"def","x":470,"y":800,"wires":[]},{"id":"383dd7f9.3c2cd8","type":"ui_gauge","z":"1f1da42b.7b60bc","name":"","group":"6a229a9c.dc9cc4","order":2,"width":"3","height":"3","gtype":"donut","title":"gauge","label":"units","format":"{{value}}","min":0,"max":10,"colors":["#00b500","#e6e600","#ca3838"],"seg1":"abc","seg2":"def","x":470,"y":840,"wires":[]},{"id":"af2b4940.4e97a8","type":"ui_gauge","z":"1f1da42b.7b60bc","name":"","group":"6a229a9c.dc9cc4","order":4,"width":"3","height":"3","gtype":"compass","title":"gauge","label":"units","format":"{{value}}","min":0,"max":10,"colors":["#00b500","#e6e600","#ca3838"],"seg1":"abc","seg2":"def","x":470,"y":880,"wires":[]},{"id":"53e45e11.12805","type":"ui_gauge","z":"1f1da42b.7b60bc","name":"","group":"6a229a9c.dc9cc4","order":5,"width":"3","height":"3","gtype":"wave","title":"gauge","label":"units","format":"{{value}}","min":0,"max":10,"colors":["#00b500","#e6e600","#ca3838"],"seg1":"abc","seg2":"def","x":470,"y":920,"wires":[]},{"id":"e8cc4fd4.80c99","type":"ui_text","z":"1f1da42b.7b60bc","group":"6a229a9c.dc9cc4","order":5,"width":"3","height":"3","name":"","label":"text","format":"{{msg.payload}}","layout":"col-center","x":470,"y":760,"wires":[]},{"id":"ac122ee.e72e5d","type":"ui_chart","z":"1f1da42b.7b60bc","name":"","group":"6a229a9c.dc9cc4","order":6,"width":"3","height":"3","label":"chart","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":true,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":470,"y":960,"wires":[[]]},{"id":"626b4a42.a58b64","type":"ui_chart","z":"1f1da42b.7b60bc","name":"","group":"6a229a9c.dc9cc4","order":6,"width":"3","height":"3","label":"chart","chartType":"bar","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":true,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":470,"y":1000,"wires":[[]]},{"id":"f94b4e03.d008b","type":"ui_chart","z":"1f1da42b.7b60bc","name":"","group":"6a229a9c.dc9cc4","order":6,"width":"3","height":"3","label":"chart","chartType":"horizontalBar","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":true,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":470,"y":1040,"wires":[[]]},{"id":"49c8e2e6.73ca4c","type":"ui_chart","z":"1f1da42b.7b60bc","name":"","group":"6a229a9c.dc9cc4","order":6,"width":"3","height":"3","label":"chart","chartType":"pie","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":true,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":470,"y":1080,"wires":[[]]},{"id":"ed71effe.ca84d","type":"ui_chart","z":"1f1da42b.7b60bc","name":"","group":"6a229a9c.dc9cc4","order":6,"width":"3","height":"3","label":"chart","chartType":"polar-area","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":true,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":470,"y":1120,"wires":[[]]},{"id":"1c96b7ca.ac1228","type":"ui_chart","z":"1f1da42b.7b60bc","name":"","group":"6a229a9c.dc9cc4","order":6,"width":"3","height":"3","label":"chart","chartType":"radar","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":true,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":470,"y":1160,"wires":[[]]},{"id":"3a84e894.3e0d68","type":"ui_audio","z":"1f1da42b.7b60bc","name":"","group":"6a229a9c.dc9cc4","voice":"en-US","always":false,"x":540,"y":640,"wires":[]},{"id":"4ba10532.34d0ec","type":"inject","z":"1f1da42b.7b60bc","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"Alexa show timers","payloadType":"str","x":270,"y":680,"wires":[["3a84e894.3e0d68"]]},{"id":"1c55ffa2.623d7","type":"ui_toast","z":"1f1da42b.7b60bc","position":"prompt","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"Cancel","raw":true,"topic":"","name":"test Notification","x":490,"y":1240,"wires":[["3765f1e.172d50e","c0be50a5.2e4aa"]]},{"id":"933207cd.14fe18","type":"ui_ui_control","z":"1f1da42b.7b60bc","name":"","events":"all","x":730,"y":800,"wires":[[]]},{"id":"c0be50a5.2e4aa","type":"ui_template","z":"1f1da42b.7b60bc","group":"6a229a9c.dc9cc4","name":"","order":13,"width":0,"height":0,"format":"<div ng-bind-html=\"msg.payload\"></div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":480,"y":1300,"wires":[[]]},{"id":"3765f1e.172d50e","type":"debug","z":"1f1da42b.7b60bc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":1240,"wires":[]},{"id":"cb7f3d05.97917","type":"ui_worldmap","z":"1a0aa13a.9d7b8f","group":"c7810244.5e40a","order":1,"width":"17","height":"14","name":"Common Map","lat":"33.110554","lon":"-96.790415","zoom":"7","layer":"OSM grey","cluster":"","maxage":"","usermenu":"hide","layers":"show","panit":"false","panlock":"false","zoomlock":"false","hiderightclick":"true","coords":"none","showgrid":"false","path":"/worldmapF","x":1680,"y":40,"wires":[]},{"id":"3f475fc9.12594","type":"harmonyws-command","z":"b2da258c.19e8d8","name":"","server":"cf631ec5.cd065","activity":"14144391","command":"14144391:InputNext","hold":"0","repeat":"1","delay":"0","x":270,"y":40,"wires":[[]]},{"id":"a97d4aba.60b928","type":"inject","z":"b2da258c.19e8d8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":100,"y":40,"wires":[["3f475fc9.12594"]]},{"id":"adf35407.239188","type":"harmonyws-command","z":"b2da258c.19e8d8","g":"c1445c3e.6d48e","name":"","server":"cf631ec5.cd065","activity":"14144391","command":"14144391:InputNext","hold":"0","repeat":"2","delay":"1","x":270,"y":120,"wires":[["dd027c5b.142bc"]]},{"id":"cb166a55.6d7d58","type":"inject","z":"b2da258c.19e8d8","g":"c1445c3e.6d48e","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":120,"wires":[["adf35407.239188"]]},{"id":"a4dfce19.68cc2","type":"mqtt in","z":"b2da258c.19e8d8","name":"","topic":"Hubitat/Virtual Play Podcast In Bathroom/switch","qos":"1","datatype":"utf8","broker":"a5bf81ee.27852","x":200,"y":300,"wires":[[]]},{"id":"ace450ca.adc15","type":"debug","z":"b2da258c.19e8d8","name":"3","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1030,"y":400,"wires":[]},{"id":"34988442.e4176c","type":"switch","z":"b2da258c.19e8d8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":390,"y":200,"wires":[["b78a656d.4c34a8"],[]]},{"id":"dd027c5b.142bc","type":"hubitat command","z":"b2da258c.19e8d8","name":"Echo - Office","server":"55e4481a.722098","deviceId":"321","command":"speak","commandArgs":"Soundbar fixed","x":790,"y":160,"wires":[["ace450ca.adc15"]]},{"id":"6652d0f5.9939d","type":"hubitat command","z":"b2da258c.19e8d8","name":"Echo - TV Room","server":"55e4481a.722098","deviceId":"323","command":"speak","commandArgs":"Soundbar fixed","x":620,"y":40,"wires":[[]]},{"id":"b4d80203.df0b2","type":"inject","z":"b2da258c.19e8d8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":460,"y":40,"wires":[["6652d0f5.9939d"]]},{"id":"a2cf5f37.e615d","type":"hubitat device","z":"b2da258c.19e8d8","name":"Virtual Play Podcast In Bathroom","server":"55e4481a.722098","deviceId":"555","attribute":"switch","sendEvent":true,"x":200,"y":520,"wires":[["e47249bf.257018"]]},{"id":"b78a656d.4c34a8","type":"hubitat command","z":"b2da258c.19e8d8","name":"Office Desk Lamp On","server":"55e4481a.722098","deviceId":"550","command":"on","commandArgs":"","x":600,"y":200,"wires":[["dd027c5b.142bc"]]},{"id":"8e30782a.89da78","type":"function","z":"87dacf16.bc47f","name":"Translate Duration Function","func":"/* \n * Create Variables\n * \n */\n        var milliseconds = msg.payload;\n        var years, weeks, days, hours, minutes, seconds, millis;\n    //creating 2 string versions of each of the durations that can be in the middle of a 1:01:01.001 duration \n    //minstr is the always 2 character one\n    //lminstr is the version that can be 1 or more characers that will be used when that part is the portion of the duration\n        var minstr, secstr, millistr, lminstr, lsecstr, lmillistr;\n        var whichcomponents, readableduration;\n\n/*\n * Calculate the numbers for the subcomponents\n * \n */\n    //by getting the remainder when dividing by 1000\n    //it leaves just the fraction of milliseconds\n        millis = milliseconds % 1000;\n    //the floor function drops the decimal portion\n    //returning the non fractional seconds\n        seconds = Math.floor(milliseconds / 1000);\n    //the floor function drops the decimal portion\n    //returning the non fractional minutes\n        minutes = Math.floor(seconds / 60);\n    //Once the minutes have been calculated, then\n    //the seconds is replaced with those seconds not\n    //accounted for by the minutes\n        seconds = seconds % 60;\n    //The same sequence as used for minutes/seconds\n    //then used to calulate minutes, hours, dayss, weeks, years\n\n        hours = Math.floor(minutes / 60);\n        minutes = minutes % 60;\n        days = Math.floor(hours / 24);\n        hours = hours % 24;\n        weeks = Math.floor(days / 7)\n        days = days % 7;\n        years = Math.floor(days / 365.25)\n        weeks = weeks % 52;\n\n/*\n * Put the subcomponents into msg payloads for easy access by later nodes\n *\n */\n        msg.years = years\n        msg.weeks = weeks\n        msg.days = days\n        msg.hours = hours\n        msg.minutes = minutes\n        msg.seconds = seconds\n        msg.millis = millis\n \n\n/*\n * create the string verssion for the subcomponents\n */\n    //milliseconds\n        lmillistr = millis.toString();\n        //put padding on the milliseconds so that 1 ms shows as .001 and not .1 when concatenated after a decimal\n            millistr = millis.toString().padStart(3, \"0\");\n    //seconds\n        lsecstr = seconds.toString();\n        //put padding on the seconds so that 1 s shows as :01.000 and not :1.000 when concatenated after a dividing :\n            secstr = lsecstr.padStart(2, \"0\");\n    //minutes\n        lminstr = minutes.toString();\n        //put padding on the minutes so that 1 m shows as :01:00.000 and not :1:00.000 when concatenated after a dividing :\n            minstr = lminstr.padStart(2, \"0\");\n\n/*\n * Build output based on largest significant populated unit\n * The general rule is to include in the output the largest unit (years, weeks, days, etc) followed by the next 2\n * smaller units if the happen to be populated\n */\n    readableduration =\"\"\n//years populated\n    if (years !== 0) { \n        if (days !== 0) {\n            if (days === 1) {\n                readableduration = \" \".concat(days.toString(), \" Day\", readableduration)\n            } else {\n                readableduration = \" \".concat(days.toString(), \" Days\", readableduration)\n            }\n        }\n        if (weeks !== 0) {\n            if (weeks === 1) {\n                readableduration = \" \".concat(weeks.toString(), \" Week\", readableduration)\n            } else {\n                readableduration = \" \".concat(weeks.toString(), \" Weeks\", readableduration)\n            }\n        }\n        if (years === 1) {\n            readableduration = years.toString().concat(\" Year\", readableduration)\n        } else {\n            readableduration = years.toString().concat(\" Years\", readableduration)\n        }\n//weeks populated\n    } else if (weeks !== 0) {\n        if (hours !== 0) {\n            if (hours === 1) {\n                readableduration = \" \".concat(hours.toString(), \" Hour\", readableduration)\n            } else {\n                readableduration = \" \".concat(hours.toString(), \" Hours\", readableduration)\n            }\n        }\n        if (days !== 0) {\n            if (weeks === 1) {\n                readableduration = \" \".concat(days.toString(), \" Day\", readableduration)\n            } else {\n                readableduration = \" \".concat(days.toString(), \" Days\", readableduration)\n            }\n        }\n        if (weeks === 1) {\n            readableduration = weeks.toString().concat(\" Week\", readableduration)\n        } else {\n            readableduration = weeks.toString().concat(\" Weeks\", readableduration)\n        }\n//days populated\n    } else if (days !== 0) {\n        if ((minutes !== 0) && (hours !== 0)) { //If both are non-zero then 1:01 format. If only 1 then either 2 hours or 1 minute\n            if (minutes !== 0) {\n                readableduration = \":\".concat(minstr, readableduration)\n            }\n            if (hours !== 0) {\n                readableduration = \" \".concat(hours.toString(), readableduration)\n            } else {\n                readableduration = \" 0\".concat(readableduration)\n            }\n        } else {\n            if (minutes === 1) {\n                readableduration = \" 1 Minute\".concat(readableduration)\n            } else if (minutes > 1) {\n                readableduration = \" \".concat(lminstr,\" Minutes\", readableduration)\n            } else if (hours === 1) {\n                readableduration = \" 1 Hour\".concat(readableduration)\n            } else {\n                if (hours >1) {\n                    readableduration = \" \".concat(hours.toString(),\" Hours\", readableduration)\n                }\n            }\n        }\n        if (days === 1) {\n            readableduration = days.toString().concat(\" Day\", readableduration)\n        } else {\n            readableduration = days.toString().concat(\" Days\", readableduration)\n        }\n//hours populated\n    } else if (hours !== 0) {\n        if ((minutes !== 0) || (seconds !== 0)) { //End result h Hours or h:mm:ss\n            readableduration = hours.toString().concat(\":\", minstr, \":\", secstr, readableduration)\n        } else {\n            if (hours === 1) {\n                readableduration = \"1 Hour\"\n            } else {\n                readableduration = hours.toString().concat(\" Hours\", readableduration)\n            }\n        }\n//minutes populated\n    } else if (minutes !== 0) { //End result m Minutes or mm:ss.MMM\n        if (seconds !== 0 || millis !== 0) { //End result h Hours or h:mm:ss\n            readableduration = lminstr.concat(\":\", secstr, \".\", millistr, readableduration)\n        } else {\n            if (minutes === 1) {\n                readableduration = \"1 Minute\".concat( readableduration)\n            } else {\n                readableduration = lminstr.concat(\" Minutes\", readableduration)\n            }\n        }\n//seconds populated\n    } else if (seconds !== 0) {\n        if (millis !== 0) { //End result s Seconds or s.MMM\n            readableduration = lsecstr.concat(\".\", millistr, \" Seconds\", readableduration)\n        } else {\n            if (seconds === 1) {\n                readableduration = \"1 Second\".concat( readableduration)\n            } else {\n                readableduration = lsecstr.concat(\" Seconds\", readableduration)\n            }\n        }\n//milliseconds populated\n    } else if (millis !== 0) {\n        if (millis !== 1) {\n            readableduration = lmillistr.concat(\" Milliseconds\", readableduration)\n        } else {\n            readableduration = \"1 Millisecond\".concat( readableduration)\n        }\n    } else {\n        readableduration = \"0\"\n    }\n    msg.years = years\n    msg.weeks = weeks\n    msg.days = days\n    msg.hours = hours\n    msg.minutes = minutes\n    msg.seconds = seconds\n    msg.millis = millis\n    msg.payload = readableduration\n    return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":180,"wires":[["ad92d2cf.6a228"]]},{"id":"4c1bd2f5.d16dbc","type":"simpletime","z":"87dacf16.bc47f","name":"","mydate":false,"myymd":false,"myyear":false,"mymonth":false,"mymonthn":false,"mydom":false,"mydoy":false,"myday":false,"myhourpm":false,"myhour":false,"mytime":false,"mytimes":false,"myminute":false,"myminutes":false,"mysecond":false,"mymillis":false,"myepoch":true,"myrawdate":false,"mypm":false,"x":530,"y":280,"wires":[["ad92d2cf.6a228"]]},{"id":"a80be878.6eb368","type":"inject","z":"87dacf16.bc47f","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":310,"y":280,"wires":[["4c1bd2f5.d16dbc"]]},{"id":"ad92d2cf.6a228","type":"debug","z":"87dacf16.bc47f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":800,"y":280,"wires":[]},{"id":"83e4d9ec.841318","type":"simpletime","z":"b2da258c.19e8d8","name":"","mydate":false,"myymd":false,"myyear":false,"mymonth":false,"mymonthn":false,"mydom":false,"mydoy":false,"myday":false,"myhourpm":false,"myhour":false,"mytime":false,"mytimes":false,"myminute":false,"myminutes":false,"mysecond":false,"mymillis":false,"myepoch":true,"myrawdate":false,"mypm":false,"x":590,"y":520,"wires":[["ff916e2e.11e4c","303c2f00.fc32"]]},{"id":"2ca8d4b2.1fff6c","type":"function","z":"b2da258c.19e8d8","name":"","func":"old = flow.get(\"time\") || msg.myepoch\nnode.warn (old + \" is either and \"+ msg.myepoch + \" is the current\")\nflow.set(\"time\", msg.myepoch)\nnode.warn(\"The difference is \"+ (msg.myepoch - old))\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":640,"wires":[[]]},{"id":"fb15be85.5d0b","type":"inject","z":"b2da258c.19e8d8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":640,"wires":[["ddfd28c5.f4afd8"]]},{"id":"ddfd28c5.f4afd8","type":"simpletime","z":"b2da258c.19e8d8","name":"","mydate":false,"myymd":false,"myyear":false,"mymonth":false,"mymonthn":false,"mydom":false,"mydoy":false,"myday":false,"myhourpm":false,"myhour":false,"mytime":false,"mytimes":false,"myminute":false,"myminutes":false,"mysecond":false,"mymillis":false,"myepoch":true,"myrawdate":false,"mypm":false,"x":270,"y":640,"wires":[["2ca8d4b2.1fff6c"]]},{"id":"303c2f00.fc32","type":"function","z":"b2da258c.19e8d8","d":true,"name":"","func":"old = flow.get(\"time\") || msg.myepoch\n//node.warn (old + \" is either and \"+ msg.myepoch + \" is the current\")\nflow.set(\"time\", msg.myepoch)\n//node.warn(\"The difference is \"+ (msg.myepoch - old))\n\nif(typeof(msg.payload) == 'number'){\n    //node.warn(\"1 or 4\")\n    flow.set(\"time1\", msg.myepoch)\n}\nif(typeof(msg.payload) == 'object'){\n    //node.warn(2)\n    flow.set(\"time2\", msg.myepoch)\n}\nif(typeof(msg.payload) == 'string'){\n    //node.warn(3)\n    flow.set(\"time3\", msg.myepoch)\n}\nnode.warn(\"1 to 2 is \"+ (flow.get(\"time2\")-flow.get(\"time1\")))\nnode.warn(\"2 to 3 is \"+ (flow.get(\"time3\")-flow.get(\"time2\")))\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":480,"wires":[[]]},{"id":"4443d528.3faf8c","type":"debug","z":"b2da258c.19e8d8","name":"3","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":670,"y":320,"wires":[]},{"id":"ff916e2e.11e4c","type":"debug","z":"b2da258c.19e8d8","name":"hubitat input","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":630,"y":460,"wires":[]},{"id":"7ffca974.ce47a8","type":"change","z":"b2da258c.19e8d8","name":"","rules":[{"t":"delete","p":"time","pt":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":350,"y":740,"wires":[[]]},{"id":"abb9e066.ffd3f","type":"simpletime","z":"b2da258c.19e8d8","name":"","mydate":false,"myymd":false,"myyear":false,"mymonth":false,"mymonthn":false,"mydom":false,"mydoy":false,"myday":false,"myhourpm":false,"myhour":false,"mytime":false,"mytimes":false,"myminute":false,"myminutes":false,"mysecond":false,"mymillis":false,"myepoch":true,"myrawdate":false,"mypm":false,"x":910,"y":700,"wires":[["b187c14d.a1d6b"]]},{"id":"63657dd5.f3a6a4","type":"simpletime","z":"b2da258c.19e8d8","name":"","mydate":false,"myymd":false,"myyear":false,"mymonth":false,"mymonthn":false,"mydom":false,"mydoy":false,"myday":false,"myhourpm":false,"myhour":false,"mytime":false,"mytimes":false,"myminute":false,"myminutes":false,"mysecond":false,"mymillis":false,"myepoch":true,"myrawdate":false,"mypm":false,"x":470,"y":700,"wires":[["303c2f00.fc32","39b2cb29.502a14"]]},{"id":"39b2cb29.502a14","type":"debug","z":"b2da258c.19e8d8","name":"trigger","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":630,"y":760,"wires":[]},{"id":"b187c14d.a1d6b","type":"debug","z":"b2da258c.19e8d8","name":"Echo triggered","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1100,"y":740,"wires":[]},{"id":"97d936cb.35dbb8","type":"debug","z":"b2da258c.19e8d8","name":"mqtt input","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":740,"y":380,"wires":[]},{"id":"520c9a34.363fa4","type":"function","z":"b2da258c.19e8d8","name":"","func":"node.warn(typeof(msg.payload))","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":780,"wires":[[]]},{"id":"9eb02863.173368","type":"inject","z":"b2da258c.19e8d8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":880,"y":80,"wires":[[]]},{"id":"12916484.c3bc7b","type":"inject","z":"b2da258c.19e8d8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":600,"y":260,"wires":[[]]},{"id":"dce1bf0d.5df65","type":"alexa-remote-event","z":"b2da258c.19e8d8","name":"","account":"10d58216.fa5bae","event":"ws-device-activity","x":180,"y":580,"wires":[["e47249bf.257018"]]},{"id":"e47249bf.257018","type":"debug","z":"b2da258c.19e8d8","name":"mqtt input","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":500,"y":580,"wires":[]},{"id":"a1e8e3eb.4ee7b","type":"alexa-remote-other","z":"b2da258c.19e8d8","name":"","account":"10d58216.fa5bae","config":{"option":"get","value":{"what":"accounts"}},"x":370,"y":380,"wires":[["4443d528.3faf8c"]]},{"id":"7f0896c4.036a38","type":"inject","z":"b2da258c.19e8d8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":380,"wires":[["a1e8e3eb.4ee7b"]]},{"id":"b41f1693.48c3c8","type":"mqtt in","z":"79e87940.d7f498","name":"","topic":"Hubitat/Virtual Play Podcast In Bathroom/switch","qos":"1","datatype":"utf8","broker":"a5bf81ee.27852","x":320,"y":500,"wires":[["d130a4b3.32b2e8"]]},{"id":"4136f2a9.8d13cc","type":"switch","z":"79e87940.d7f498","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":770,"y":500,"wires":[["5e713b57.52da94"],[]]},{"id":"5e713b57.52da94","type":"simpletime","z":"79e87940.d7f498","name":"","mydate":false,"myymd":false,"myyear":false,"mymonth":false,"mymonthn":false,"mydom":false,"mydoy":false,"myday":false,"myhourpm":false,"myhour":false,"mytime":false,"mytimes":false,"myminute":false,"myminutes":false,"mysecond":false,"mymillis":false,"myepoch":true,"myrawdate":false,"mypm":false,"x":1010,"y":500,"wires":[["f8503cc7.b6056","5cd538f2.4bd828","73c3ef49.d2b8f"]]},{"id":"89dc332d.ae0e9","type":"switch","z":"79e87940.d7f498","name":"Ignore Wakeword Event","property":"payload.description.summary","propertyType":"msg","rules":[{"t":"eq","v":"alexa","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":670,"y":260,"wires":[[],["f0c63f04.ea7ec"]]},{"id":"8d4816b6.3da258","type":"alexa-remote-event","z":"79e87940.d7f498","name":"","account":"10d58216.fa5bae","event":"ws-device-activity","x":230,"y":260,"wires":[["bc8d49a9.ad9ee8"]]},{"id":"8e57d915.f9a5e8","type":"hubitat device","z":"79e87940.d7f498","name":"Virtual Play Podcast In Bathroom","server":"55e4481a.722098","deviceId":"555","attribute":"switch","sendEvent":true,"x":280,"y":340,"wires":[["13d5bb6f.1f1555"]]},{"id":"fcfc7dff.ca6b6","type":"switch","z":"79e87940.d7f498","name":"","property":"payload.value","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":710,"y":340,"wires":[["6b4164cf.8afebc"],[]]},{"id":"f0c63f04.ea7ec","type":"simpletime","z":"79e87940.d7f498","name":"","mydate":false,"myymd":false,"myyear":false,"mymonth":false,"mymonthn":false,"mydom":false,"mydoy":false,"myday":false,"myhourpm":false,"myhour":false,"mytime":false,"mytimes":false,"myminute":false,"myminutes":false,"mysecond":false,"mymillis":false,"myepoch":true,"myrawdate":false,"mypm":false,"x":1010,"y":260,"wires":[["1801f317.09c35d","d10b3666.4a79b8","73c3ef49.d2b8f"]]},{"id":"6b4164cf.8afebc","type":"simpletime","z":"79e87940.d7f498","name":"","mydate":false,"myymd":false,"myyear":false,"mymonth":false,"mymonthn":false,"mydom":false,"mydoy":false,"myday":false,"myhourpm":false,"myhour":false,"mytime":false,"mytimes":false,"myminute":false,"myminutes":false,"mysecond":false,"mymillis":false,"myepoch":true,"myrawdate":false,"mypm":false,"x":1010,"y":340,"wires":[["fa077634.b38c18","57c2931a.86150c","73c3ef49.d2b8f"]]},{"id":"f8503cc7.b6056","type":"debug","z":"79e87940.d7f498","name":"MQTT to NR","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"myepoch","targetType":"msg","statusVal":"","statusType":"auto","x":1170,"y":500,"wires":[]},{"id":"1801f317.09c35d","type":"debug","z":"79e87940.d7f498","name":"Amazon to NR","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"myepoch","targetType":"msg","statusVal":"","statusType":"auto","x":1180,"y":260,"wires":[]},{"id":"fa077634.b38c18","type":"debug","z":"79e87940.d7f498","name":"Primary Switch Hubitat to NR","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"myepoch","targetType":"msg","statusVal":"","statusType":"auto","x":1220,"y":340,"wires":[]},{"id":"d10b3666.4a79b8","type":"debug","z":"79e87940.d7f498","name":"Full Amazon to NR ","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1190,"y":220,"wires":[]},{"id":"a8effa0d.2ec738","type":"switch","z":"79e87940.d7f498","name":"Only track office","property":"payload.name","propertyType":"msg","rules":[{"t":"eq","v":"Office","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":840,"y":160,"wires":[["f0c63f04.ea7ec"],[]]},{"id":"73c3ef49.d2b8f","type":"function","z":"79e87940.d7f498","name":"","func":"if (msg.which == 'A2NR') {\n    flow.set(\"time_A2NR\", msg.myepoch)\n    node.warn(\"A2NR epoch = \"+ msg.myepoch)\n    delayWWOH = flow.get(\"time_A2H2NR\")-flow.get(\"time_A2NR\")\n    delayWWOHAM = flow.get(\"time_A2H2NR\")-flow.get(\"time_A2NR\")\n    if ((delayWWOH > 0 ) &&(delayWWOH < 5000 )){\n        node.warn(\"Alexa to Node Red was \"+delayWWOH+\"ms faster than Alexa to Hubitat to Node Red.\")\n    } else if ((delayWWOH < 0 ) &&(delayWWOH > -5000 )) {\n        delayWWOH = delayWWOH * -1\n        node.warn(\"Alexa to Node Red was \"+delayWWOH+\"ms slower than Alexa to Hubitat to Node Red.\")\n        // multiply by -1 then statement\n    }\n    if ((delayWWOHAM > 0 ) &&(delayWWOHAM < 5000 )){\n        //x was faster\n    } else if ((delayWWOHAM < 0 ) &&(delayWWOHAM > -5000 )) {\n        // multiply by -1 then statement\n    }\n}\n\n\nif(msg.which == 'A2H2NR'){\n    flow.set(\"time_A2H2NR\", msg.myepoch)\n    node.warn(\"A2H2NR epoch = \"+ msg.myepoch)\n    \n    \n    \n}\nif(msg.which == 'A2H2NR2M2NR'){\n    flow.set(\"time_A2H2NR2M2NR\", msg.myepoch)\n  node.warn(\"A2H2NR2M2NR epoch = \"+ msg.myepoch)\n}\n\n\n\n\n\n//if (flow.get(\"time_A2NR\") < flow.get(\"time_A2H2NR\")) {\n  //  node.warn(\"Amazon to NR was faster than passing through Hubitat by \"+(flow.get(\"time_A2H2NR\")-flow.get(\"time_A2NR\"))+ \" ms.\" )\n//} else {\n  //      node.warn(\"Amazon to NR was slower than passing through Hubitat by \"+(flow.get(\"time_A2NR\")-flow.get(\"time_A2H2NR\"))+ \" ms.\" )\n//}\n\n//node.warn(\"1 to 2 is \"+ (flow.get(\"time A2H2NR\")-flow.get(\"time A2NR\")))\n//node.warn(\"2 to 3 is \"+ (flow.get(\"time3\")-flow.get(\"time A2H2NR\")))\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1660,"y":280,"wires":[[]]},{"id":"57c2931a.86150c","type":"debug","z":"79e87940.d7f498","name":"Full Switch Primary Hubitat to NR ","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1240,"y":300,"wires":[]},{"id":"5cd538f2.4bd828","type":"debug","z":"79e87940.d7f498","name":"Full MQTT to NR ","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1190,"y":460,"wires":[]},{"id":"9ddd692d.f7b148","type":"switch","z":"79e87940.d7f498","name":"","property":"payload.value","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":570,"y":420,"wires":[["f09bd263.372a6"],[]]},{"id":"f09bd263.372a6","type":"simpletime","z":"79e87940.d7f498","name":"","mydate":false,"myymd":false,"myyear":false,"mymonth":false,"mymonthn":false,"mydom":false,"mydoy":false,"myday":false,"myhourpm":false,"myhour":false,"mytime":false,"mytimes":false,"myminute":false,"myminutes":false,"mysecond":false,"mymillis":false,"myepoch":true,"myrawdate":false,"mypm":false,"x":1010,"y":420,"wires":[["bb6ca7ac.98e848","ccdd0b0e.87d918","73c3ef49.d2b8f"]]},{"id":"bb6ca7ac.98e848","type":"debug","z":"79e87940.d7f498","name":"Dev Switch Hubitat to NR","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"myepoch","targetType":"msg","statusVal":"","statusType":"auto","x":1210,"y":420,"wires":[]},{"id":"ccdd0b0e.87d918","type":"debug","z":"79e87940.d7f498","name":"Full Dev Switch Hubitat to NR ","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1230,"y":380,"wires":[]},{"id":"e8c3553e.fcc188","type":"hubitat device","z":"79e87940.d7f498","name":"Test V Switch 116","server":"ee56137f.1880e","deviceId":"97","attribute":"switch","sendEvent":true,"x":230,"y":420,"wires":[["9b64aa68.dcb958"]]},{"id":"7079bea9.5f6b9","type":"inject","z":"79e87940.d7f498","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":180,"y":620,"wires":[["e8c3553e.fcc188"]]},{"id":"1841d502.dea3cb","type":"debug","z":"79e87940.d7f498","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":540,"y":640,"wires":[]},{"id":"bc8d49a9.ad9ee8","type":"change","z":"79e87940.d7f498","name":"","rules":[{"t":"set","p":"which","pt":"msg","to":"A2NR","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":440,"y":260,"wires":[["89dc332d.ae0e9"]]},{"id":"13d5bb6f.1f1555","type":"change","z":"79e87940.d7f498","name":"","rules":[{"t":"set","p":"which","pt":"msg","to":"A2H2NR","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":340,"wires":[["fcfc7dff.ca6b6"]]},{"id":"9b64aa68.dcb958","type":"change","z":"79e87940.d7f498","name":"","rules":[{"t":"set","p":"which","pt":"msg","to":"A2H2NR","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":420,"wires":[["9ddd692d.f7b148"]]},{"id":"d130a4b3.32b2e8","type":"change","z":"79e87940.d7f498","name":"","rules":[{"t":"set","p":"which","pt":"msg","to":"A2H2NR2M2NR","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":500,"wires":[["4136f2a9.8d13cc"]]},{"id":"346909b5.b8f336","type":"hubitat command","z":"79e87940.d7f498","g":"cff2e07e.8e261","name":"Echo - Office","server":"55e4481a.722098","deviceId":"321","command":"executeRoutineId","commandArgs":"amzn1.alexa.automation.d7648579-f345-4dc7-81c4-2d4b176ecc13","x":390,"y":100,"wires":[[]]},{"id":"722d5fa.6b610a","type":"inject","z":"79e87940.d7f498","g":"cff2e07e.8e261","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":220,"y":100,"wires":[["346909b5.b8f336"]]},{"id":"6e8360c9.0631d","type":"sun events","z":"6f78a5a4.5b3adc","testmode":true,"verbose":false,"topic":"","name":"","x":310,"y":180,"wires":[["95f8390d.bc29f8"]]},{"id":"95f8390d.bc29f8","type":"debug","z":"6f78a5a4.5b3adc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":580,"y":180,"wires":[]},{"id":"192816bf.28dd39","type":"schedex","z":"6f78a5a4.5b3adc","name":"","passthroughunhandled":false,"suspended":false,"lat":"33.110557","lon":"-96.790405","ontime":"sunset","ontopic":"On","onpayload":"On","onoffset":0,"onrandomoffset":0,"offtime":"23:00","offtopic":"Off","offpayload":"Off","offoffset":0,"offrandomoffset":0,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"sun":true,"x":330,"y":280,"wires":[["95f8390d.bc29f8"]]},{"id":"27e3a3a7.e59b1c","type":"bigtimer","z":"6f78a5a4.5b3adc","outtopic":"","outpayload1":"","outpayload2":"","name":"Big Timer","comment":"","lat":"33.110557","lon":"-96.790405","starttime":5001,"endtime":1425,"starttime2":0,"endtime2":0,"startoff":0,"endoff":0,"startoff2":0,"endoff2":0,"offs":0,"outtext1":"","outtext2":"","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"day6":0,"month6":0,"day7":0,"month7":0,"day8":0,"month8":0,"day9":0,"month9":0,"day10":0,"month10":0,"day11":0,"month11":0,"day12":0,"month12":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"d6":0,"w6":0,"xday1":0,"xmonth1":0,"xday2":0,"xmonth2":0,"xday3":0,"xmonth3":0,"xday4":0,"xmonth4":0,"xday5":0,"xmonth5":0,"xday6":0,"xmonth6":0,"xd1":0,"xw1":0,"xd2":0,"xw2":0,"xd3":0,"xw3":0,"xd4":0,"xw4":0,"xd5":0,"xw5":0,"xd6":0,"xw6":0,"suspend":false,"random":false,"repeat":true,"atstart":true,"odd":false,"even":false,"x":350,"y":400,"wires":[[],[],[]]},{"id":"ecefd332.54434","type":"time-comp","z":"6f78a5a4.5b3adc","outputs":1,"name":"","positionConfig":"aeee420f.f7cd4","input":"","inputType":"msgPayload","inputFormat":"4","inputOffset":0,"inputOffsetType":"none","inputOffsetMultiplier":60000,"rules":[],"checkall":"true","result1":"","result1Type":"msgPayload","result1Value":"","result1ValueType":"input","result1Format":"0","result1Offset":0,"result1OffsetType":"none","result1OffsetMultiplier":60000,"x":380,"y":520,"wires":[[]]},{"id":"81adc9d8.3a80b8","type":"sun-position","z":"6f78a5a4.5b3adc","name":"","positionConfig":"aeee420f.f7cd4","rules":[],"onlyOnChange":"true","topic":"","outputs":1,"start":"","startType":"none","startOffset":0,"startOffsetType":"none","startOffsetMultiplier":60000,"end":"","endType":"none","endOffset":0,"endOffsetType":"none","endOffsetMultiplier":60000,"x":400,"y":580,"wires":[[]]},{"id":"ee1b4244.7fd8d","type":"time-span","z":"6f78a5a4.5b3adc","outputs":2,"name":"","positionConfig":"aeee420f.f7cd4","operand1":"astronomicalDawn","operand1Type":"pdsTime","operand1Format":"0","operand1Offset":0,"operand1OffsetType":"none","operand1OffsetMultiplier":60000,"operand2":"solarNoon","operand2Type":"pdsTime","operand2Format":"0","operand2Offset":0,"operand2OffsetType":"none","operand2OffsetMultiplier":60000,"rules":[{"operator":"1","operatorText":"==     (equal)","operandType":"num","operandValue":"","multiplier":"60000"}],"checkall":"true","result1":"","result1Type":"msgPayload","result1Value":"","result1ValueType":"timespan","result1TSFormat":1,"result1Format":0,"result1Offset":0,"result1OffsetType":"none","result1OffsetMultiplier":60000,"x":480,"y":640,"wires":[[],[]]},{"id":"1b02a2b.abcaf5d","type":"comment","z":"a280aade.b19d78","g":"642f4ba4.a9e314","name":"Function","info":"","x":170,"y":60,"wires":[]},{"id":"e38469d0.d510a8","type":"comment","z":"a280aade.b19d78","g":"642f4ba4.a9e314","name":"Other","info":"","x":420,"y":60,"wires":[]},{"id":"d9df1bf2.6077f8","type":"mqtt out","z":"a280aade.b19d78","g":"bdde2335.4840a","name":"Pass Name to update Firmware","topic":"zigbee2mqtt/bridge/ota_update/update","qos":"","retain":"","broker":"a5bf81ee.27852","x":570,"y":400,"wires":[]},{"id":"be27da93.96e918","type":"inject","z":"a280aade.b19d78","g":"bdde2335.4840a","name":"Passing in Bulb_C7DE_Color_600lm","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"Bulb_C7DE_Color_600lm","payloadType":"str","x":260,"y":400,"wires":[["d9df1bf2.6077f8"]]},{"id":"93df9b22.f75298","type":"mqtt in","z":"e44a28b6.338da8","name":"","topic":"zigbee2mqtt/Bulb_C7DE_Color_600lm","qos":"1","datatype":"auto","broker":"a5bf81ee.27852","x":250,"y":1440,"wires":[["e2a9abe8.db0f08"]]},{"id":"e2a9abe8.db0f08","type":"debug","z":"e44a28b6.338da8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":630,"y":1240,"wires":[]},{"id":"79466a10.e77e44","type":"mqtt out","z":"e44a28b6.338da8","name":"Bulb_C7DE_Color_600lm","topic":"zigbee2mqtt/Outlet_Ikea/set","qos":"0","retain":"false","broker":"a5bf81ee.27852","x":970,"y":380,"wires":[]},{"id":"1b807b01.c46da5","type":"inject","z":"e44a28b6.338da8","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":220,"wires":[["e5bb270f.1453c8"]]},{"id":"e5bb270f.1453c8","type":"change","z":"e44a28b6.338da8","name":"Turn ON {\"state\":\"ON\"}","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"state\":\"ON\"}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":360,"y":220,"wires":[["79466a10.e77e44"]]},{"id":"75fe7d18.14bdf4","type":"change","z":"e44a28b6.338da8","name":"Turn Off {\"state\":\"OFF\"}","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"state\":\"OFF\"}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":370,"y":260,"wires":[["79466a10.e77e44"]]},{"id":"21cbcd63.fbf2b2","type":"change","z":"e44a28b6.338da8","name":"Change Color {\"color\":{\"x\":1,\"y\":1}}","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"color\":{\"x\":0.9505,\"y\":1}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":540,"wires":[["79466a10.e77e44"]]},{"id":"c86dbb38.e7d4f8","type":"change","z":"e44a28b6.338da8","name":"Change Color {\"color\":{\"x\":0,\"y\":0}}","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"color\":{\"x\":0,\"y\":0}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":580,"wires":[["79466a10.e77e44"]]},{"id":"5c0ea56b.f540fc","type":"change","z":"e44a28b6.338da8","name":"Bright Full {\"brightness\":255}","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"brightness\":255}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":380,"y":300,"wires":[["79466a10.e77e44"]]},{"id":"16dedb06.644005","type":"change","z":"e44a28b6.338da8","name":"Bright Min {\"brightness\":\"1\"}","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"brightness\":\"1\",\"transition\":\"10\"}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":380,"y":340,"wires":[["79466a10.e77e44"]]},{"id":"5db9a82f.762ca8","type":"change","z":"e44a28b6.338da8","name":"Set Transition to 10s {\"transition\":\"10\"}","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"transition\":\"10\"}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":620,"wires":[["79466a10.e77e44"]]},{"id":"4d2e3c0d.45a6c4","type":"change","z":"e44a28b6.338da8","name":"Set Transition to 1s {\"transition\":\"1\"}","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"transition\":\"1\"}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":660,"wires":[["79466a10.e77e44"]]},{"id":"62e29ce5.871e94","type":"change","z":"e44a28b6.338da8","name":"Set Transition to instant {\"transition\":\"0\"}","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"transition\":\"0\"}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":700,"wires":[["79466a10.e77e44"]]},{"id":"b7580b31.722038","type":"change","z":"e44a28b6.338da8","name":"Maybe Bright Transition {\"brightness_move\":-40}","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"brightness_move\":-40}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":440,"y":380,"wires":[["79466a10.e77e44"]]},{"id":"5ae89a1.233a764","type":"change","z":"e44a28b6.338da8","name":"Maybe Bright Transition{\"brightness_move\":\"start\"}","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"brightness_move\":\"start\"}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":450,"y":460,"wires":[["79466a10.e77e44"]]},{"id":"ecf7b8bc.15cee8","type":"change","z":"e44a28b6.338da8","name":"Maybe Bright Transition {\"brightness_move\":60}","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"brightness_move\":60}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":440,"y":420,"wires":[["79466a10.e77e44"]]},{"id":"38c047a3.f94408","type":"change","z":"e44a28b6.338da8","name":"Maybe Bright Transition{\"brightness_move\":\"start\"}","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"brightness_move\":\"stop\"}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":450,"y":500,"wires":[["79466a10.e77e44"]]},{"id":"cdea7e33.edebf","type":"inject","z":"e44a28b6.338da8","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":260,"wires":[["75fe7d18.14bdf4"]]},{"id":"dfd92856.06fd98","type":"inject","z":"e44a28b6.338da8","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":300,"wires":[["5c0ea56b.f540fc"]]},{"id":"1ed0681a.a79e38","type":"inject","z":"e44a28b6.338da8","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":340,"wires":[["16dedb06.644005"]]},{"id":"def4c240.1cd12","type":"inject","z":"e44a28b6.338da8","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":380,"wires":[["b7580b31.722038"]]},{"id":"4e04071c.f39628","type":"inject","z":"e44a28b6.338da8","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":420,"wires":[["ecf7b8bc.15cee8"]]},{"id":"bd18b05c.13617","type":"inject","z":"e44a28b6.338da8","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":460,"wires":[["5ae89a1.233a764"]]},{"id":"55ea914e.96d4c","type":"inject","z":"e44a28b6.338da8","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":500,"wires":[["38c047a3.f94408"]]},{"id":"50f9bb70.c6e254","type":"inject","z":"e44a28b6.338da8","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":540,"wires":[["21cbcd63.fbf2b2"]]},{"id":"3882c67b.eb5aea","type":"inject","z":"e44a28b6.338da8","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":580,"wires":[["c86dbb38.e7d4f8"]]},{"id":"ed101f0a.e99c4","type":"inject","z":"e44a28b6.338da8","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":620,"wires":[["5db9a82f.762ca8"]]},{"id":"ed576871.9e6078","type":"inject","z":"e44a28b6.338da8","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":660,"wires":[["4d2e3c0d.45a6c4"]]},{"id":"a0ea8f41.bb05b","type":"inject","z":"e44a28b6.338da8","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":700,"wires":[["62e29ce5.871e94"]]},{"id":"73a8427c.b75f2c","type":"mqtt in","z":"e44a28b6.338da8","name":"","topic":"zigbee2mqtt/Motion_Ikea","qos":"1","datatype":"auto","broker":"a5bf81ee.27852","x":210,"y":1320,"wires":[["e2a9abe8.db0f08"]]},{"id":"61947766.4c1348","type":"mqtt in","z":"e44a28b6.338da8","name":"","topic":"zigbee2mqtt/Black_Spinner","qos":"1","datatype":"auto","broker":"a5bf81ee.27852","x":210,"y":1140,"wires":[[]]},{"id":"bb8c6553.a52628","type":"mqtt in","z":"e44a28b6.338da8","name":"","topic":"zigbee2mqtt/White_Spinner","qos":"1","datatype":"auto","broker":"a5bf81ee.27852","x":220,"y":1200,"wires":[[]]},{"id":"d3ea7c14.101b8","type":"mqtt in","z":"e44a28b6.338da8","name":"","topic":"zigbee2mqtt/Remote_5_Buttons","qos":"1","datatype":"auto","broker":"a5bf81ee.27852","x":230,"y":1260,"wires":[[]]},{"id":"c2496954.9c3eb8","type":"mqtt in","z":"e44a28b6.338da8","name":"","topic":"zigbee2mqtt/Dimmer_Ikea","qos":"1","datatype":"auto","broker":"a5bf81ee.27852","x":210,"y":1380,"wires":[["e2a9abe8.db0f08"]]},{"id":"914de32.667242","type":"inject","z":"e44a28b6.338da8","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":760,"wires":[["bd51fcec.5b0a4"]]},{"id":"bd51fcec.5b0a4","type":"change","z":"e44a28b6.338da8","name":"Change Color {\"color\":{\"x\":0,\"y\":0}}","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"transition\":\"10\",\"color\":{\"x\":0,\"y\":0}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":760,"wires":[["79466a10.e77e44"]]},{"id":"d814ded8.cb373","type":"inject","z":"e44a28b6.338da8","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":800,"wires":[["c8c62b5b.3db1c8"]]},{"id":"c8c62b5b.3db1c8","type":"change","z":"e44a28b6.338da8","name":"Change Color {\"color\":\"white\"}","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"state\":\"ON\",\"brightness\":255,\"color_temp\":155,\"color\":{\"hex\":\"#ffffff\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":390,"y":800,"wires":[["79466a10.e77e44"]]},{"id":"fc6d31eb.d797b","type":"mqtt in","z":"e44a28b6.338da8","name":"","topic":"zigbee2mqtt/Bulb_C7DE_Color_600lm","qos":"2","datatype":"auto","broker":"a5bf81ee.27852","x":290,"y":1640,"wires":[["6734c4b1.74738c","1de4b75a.706dd9"]]},{"id":"6734c4b1.74738c","type":"debug","z":"e44a28b6.338da8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":590,"y":1640,"wires":[]},{"id":"4b844da2.706644","type":"change","z":"e44a28b6.338da8","name":"Change Color {\"color\":\"white\"}","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"state\":\"ON\",\"brightness\":255,\"color_temp\":155,\"color\":{\"x\":0.3227,\"y\":0.33}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":390,"y":840,"wires":[["79466a10.e77e44"]]},{"id":"9370617f.ee8be","type":"inject","z":"e44a28b6.338da8","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":840,"wires":[["4b844da2.706644"]]},{"id":"2253a7f6.2d7b38","type":"ui_slider","z":"e44a28b6.338da8","g":"b132be5b.9e822","name":"","label":"slider","tooltip":"","group":"87b2e499.dc7108","order":1,"width":0,"height":0,"passthru":true,"outs":"all","topic":"","min":"1","max":"255","step":1,"x":170,"y":1940,"wires":[["ea184bab.747168"]]},{"id":"1de4b75a.706dd9","type":"function","z":"e44a28b6.338da8","name":"","func":"var color = msg.payload.color;\n flow.set(\"Bulb_C7DE_Color_600lm\", color);\n return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":600,"y":1580,"wires":[[]]},{"id":"ea184bab.747168","type":"function","z":"e44a28b6.338da8","g":"b132be5b.9e822","name":"","func":"var x = msg.payload;\nvar color = flow.get(\"Bulb_C7DE_Color_600lm\");\n//msg.payload = {\n//    \"brightness\": x,\n//    \"color\" : color\n//}\nmsg.payload = {\n    \"brightness\": x\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":340,"y":1940,"wires":[["dc54ae57.73fe1"]]},{"id":"dc54ae57.73fe1","type":"mqtt out","z":"e44a28b6.338da8","g":"b132be5b.9e822","name":"","topic":"zigbee2mqtt/Bulb_C7DE_Color_600lm/set","qos":"0","retain":"false","broker":"a5bf81ee.27852","x":1000,"y":1940,"wires":[]},{"id":"d4093dc4.b77d1","type":"ui_colour_picker","z":"e44a28b6.338da8","g":"b132be5b.9e822","name":"","label":"","group":"87b2e499.dc7108","format":"hex","outformat":"string","showSwatch":true,"showPicker":true,"showValue":true,"showHue":true,"showAlpha":true,"showLightness":true,"square":"false","dynOutput":"true","order":2,"width":"6","height":"6","passthru":true,"topic":"","x":190,"y":2000,"wires":[["5ea1ab79.f59de4","3602f87d.88dce8"]]},{"id":"3602f87d.88dce8","type":"function","z":"e44a28b6.338da8","g":"b132be5b.9e822","name":"","func":" var x = msg.payload;\n msg.payload = {\"color\": {\"hex\":\"#\"+x}}\n return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":400,"y":1980,"wires":[["7cdc2414.004fbc","dc54ae57.73fe1"]]},{"id":"5ea1ab79.f59de4","type":"debug","z":"e44a28b6.338da8","g":"b132be5b.9e822","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":450,"y":2080,"wires":[]},{"id":"1e2072ed.e80add","type":"inject","z":"e44a28b6.338da8","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":760,"y":580,"wires":[[]]},{"id":"54f7870b.0dd738","type":"mqtt in","z":"e44a28b6.338da8","name":"","topic":"Zigbee2M/Black Spinner/Brightness","qos":"1","datatype":"auto","broker":"a5bf81ee.27852","x":240,"y":1020,"wires":[["a2558fa1.97aa1"]]},{"id":"a2558fa1.97aa1","type":"function","z":"e44a28b6.338da8","name":"","func":"var x = msg.payload;\n var color = flow.get(\"Bulb_C7DE_Color_600lm\");\n msg.payload = {\"brightness\": x,\n     \"color\" : color\n }\n return msg;","outputs":1,"noerr":0,"x":820,"y":1020,"wires":[["e2a9abe8.db0f08","79466a10.e77e44"]]},{"id":"c54c81cf.3a417","type":"ui_button","z":"e44a28b6.338da8","d":true,"g":"b132be5b.9e822","name":"","group":"87b2e499.dc7108","order":2,"width":0,"height":0,"passthru":false,"label":"On","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"state\":\"on\"}","payloadType":"json","topic":"zigbee2mqtt/Bulb_C7DE_Color_600lm/set","x":170,"y":2080,"wires":[["8f7a8370.fbb19"]]},{"id":"e078961d.4e68b8","type":"ui_button","z":"e44a28b6.338da8","d":true,"g":"b132be5b.9e822","name":"","group":"87b2e499.dc7108","order":2,"width":0,"height":0,"passthru":false,"label":"Off","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"state\":\"off\"}","payloadType":"json","topic":"zigbee2mqtt/Bulb_C7DE_Color_600lm/set","x":170,"y":2120,"wires":[["8f7a8370.fbb19"]]},{"id":"8f7a8370.fbb19","type":"ui_switch","z":"e44a28b6.338da8","g":"b132be5b.9e822","name":"","label":"switch","tooltip":"","group":"87b2e499.dc7108","order":4,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"{\"state\":\"on\"}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"state\":\"off\"}","offvalueType":"json","officon":"","offcolor":"","x":310,"y":2040,"wires":[["dc54ae57.73fe1"]]},{"id":"cb93c0f4.0bfdf","type":"ui_numeric","z":"e44a28b6.338da8","g":"b132be5b.9e822","name":"{\"brightness\":255}","label":"numeric","tooltip":"","group":"87b2e499.dc7108","order":3,"width":0,"height":0,"wrap":true,"passthru":true,"topic":"","format":"{{value}}","min":"1","max":"254","step":"5","x":210,"y":2160,"wires":[["945316e0.7e2a28"]]},{"id":"945316e0.7e2a28","type":"function","z":"e44a28b6.338da8","g":"b132be5b.9e822","name":"","func":"var x = msg.payload;\n msg.payload = {\"brightness\": x }\n return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":380,"y":2160,"wires":[["dc54ae57.73fe1"]]},{"id":"9c3ac4a6.123078","type":"link in","z":"aad5f0e1.84355","name":"","links":["c01af137.e08d9","b12cd0e6.dfbe8","310ccc9e.f2d9c4"],"x":1275,"y":420,"wires":[["35244ca9.8065f4"]]},{"id":"7cdc2414.004fbc","type":"debug","z":"e44a28b6.338da8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":540,"y":1820,"wires":[]},{"id":"d0e1cd62.02f32","type":"mqtt in","z":"e44a28b6.338da8","name":"","topic":"Hubitat/Mike's Credenza Light/set","qos":"0","datatype":"json","broker":"a5bf81ee.27852","x":290,"y":2300,"wires":[["65ed95ed.e5d33c"]]},{"id":"506eed50.6588d4","type":"mqtt out","z":"e44a28b6.338da8","name":"","topic":"Hubitat/Mike's Credenza Light/set","qos":"0","retain":"false","broker":"a5bf81ee.27852","x":440,"y":2400,"wires":[]},{"id":"ba785ff4.54c2b","type":"debug","z":"e44a28b6.338da8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1150,"y":2280,"wires":[]},{"id":"ce5d4b60.3de9b8","type":"inject","z":"e44a28b6.338da8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":170,"y":2400,"wires":[["506eed50.6588d4","35028229.cf6ade"]]},{"id":"35028229.cf6ade","type":"hubitat command","z":"e44a28b6.338da8","name":"Mike Credenza Light","server":"55e4481a.722098","deviceId":"388","command":"on","commandArgs":"","x":600,"y":2500,"wires":[[]]},{"id":"65ed95ed.e5d33c","type":"change","z":"e44a28b6.338da8","name":"","rules":[{"t":"set","p":"command","pt":"msg","to":"payload.state","tot":"msg"},{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"payload","pt":"msg"},{"t":"delete","p":"qos","pt":"msg"},{"t":"delete","p":"retain","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":2320,"wires":[["38ae557.786c4aa"]]},{"id":"98edaccb.87a0b","type":"change","z":"e44a28b6.338da8","name":"","rules":[{"t":"set","p":"command","pt":"msg","to":"payload.state","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":630,"y":2260,"wires":[[]]},{"id":"38ae557.786c4aa","type":"string","z":"e44a28b6.338da8","name":"","methods":[{"name":"slugify","params":[]}],"prop":"command","propout":"command","object":"msg","objectout":"msg","x":850,"y":2300,"wires":[["35028229.cf6ade","e9057cc9.9a2a2"]]},{"id":"e9057cc9.9a2a2","type":"string","z":"e44a28b6.338da8","name":"","methods":[{"name":"capitalize","params":[]}],"prop":"command","propout":"command","object":"msg","objectout":"msg","x":1010,"y":2260,"wires":[["ba785ff4.54c2b"]]},{"id":"19dc4.7aeeb23c8","type":"inject","z":"e44a28b6.338da8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":680,"y":1740,"wires":[["be6e2e3c.1d5d","e81e6109.5a7c5","1ea8b20b.d247ae"]]},{"id":"be6e2e3c.1d5d","type":"function","z":"e44a28b6.338da8","name":"ON","func":"msg.payload = {state:\"ON\"}\nmsg.topic =\"zigbee2mqtt/Bulb_C7DE_Color_600lm/set\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":750,"y":1840,"wires":[[]]},{"id":"e81e6109.5a7c5","type":"function","z":"e44a28b6.338da8","name":"On","func":"msg.payload = {state:\"On\"}\nmsg.topic =\"zigbee2mqtt/Bulb_C7DE_Color_600lm/set\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":830,"y":1740,"wires":[[]]},{"id":"1ea8b20b.d247ae","type":"function","z":"e44a28b6.338da8","name":"on","func":"msg.payload = {state:\"on\"}\nmsg.topic =\"zigbee2mqtt/Bulb_C7DE_Color_600lm/set\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":830,"y":1780,"wires":[["dc54ae57.73fe1"]]},{"id":"aec05993.afa768","type":"inject","z":"e44a28b6.338da8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":180,"y":2560,"wires":[["a7d5bd5d.e3098","339a3878.074f38","ea05d27f.0acd2"]]},{"id":"a7d5bd5d.e3098","type":"function","z":"e44a28b6.338da8","name":"ON","func":"msg.command = 'ON'\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":330,"y":2580,"wires":[["35028229.cf6ade"]]},{"id":"339a3878.074f38","type":"function","z":"e44a28b6.338da8","name":"On","func":"msg.command = 'On'\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":330,"y":2640,"wires":[["35028229.cf6ade"]]},{"id":"ea05d27f.0acd2","type":"function","z":"e44a28b6.338da8","name":"on","func":"msg.command = 'on'\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":330,"y":2700,"wires":[["35028229.cf6ade"]]},{"id":"2bc33989.0e89e6","type":"ui_button","z":"e44a28b6.338da8","g":"cc225987.ffcee8","name":"","group":"87b2e499.dc7108","order":2,"width":0,"height":0,"passthru":false,"label":"{\"state\":\"off\"}","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"state\":\"off\"}","payloadType":"json","topic":"zigbee2mqtt/Bulb_C7DE_Color_600lm/set","x":290,"y":3340,"wires":[["ad285b99.fc74b8"]]},{"id":"4a3f9c76.970004","type":"ui_button","z":"e44a28b6.338da8","g":"cc225987.ffcee8","name":"","group":"87b2e499.dc7108","order":2,"width":0,"height":0,"passthru":false,"label":"{\"state\":\"on\"}","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"state\":\"on\"}","payloadType":"json","topic":"zigbee2mqtt/Bulb_C7DE_Color_600lm/set","x":290,"y":3300,"wires":[["ad285b99.fc74b8"]]},{"id":"ad285b99.fc74b8","type":"ui_switch","z":"e44a28b6.338da8","g":"cc225987.ffcee8","name":"","label":"switch","tooltip":"","group":"87b2e499.dc7108","order":4,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"{\"state\":\"on\"}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"state\":\"off\"}","offvalueType":"json","officon":"","offcolor":"","x":450,"y":3320,"wires":[["4c11bd56.c00074","50a7660c.894a18","d368bbf9.2d2178"]]},{"id":"4c11bd56.c00074","type":"mqtt out","z":"e44a28b6.338da8","g":"cc225987.ffcee8","name":"","topic":"zigbee2mqtt/Bulb_C7DE_Color_600lm/set","qos":"0","retain":"false","broker":"a5bf81ee.27852","x":1020,"y":3320,"wires":[]},{"id":"50a7660c.894a18","type":"change","z":"e44a28b6.338da8","g":"cc225987.ffcee8","name":"payload -> command","rules":[{"t":"set","p":"command","pt":"msg","to":"payload.state","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":660,"y":3380,"wires":[[]]},{"id":"1ebda1a7.499b6e","type":"hubitat command","z":"e44a28b6.338da8","g":"cc225987.ffcee8","name":"Mike Credenza Light","server":"55e4481a.722098","deviceId":"742","command":"on","commandArgs":"","x":980,"y":3380,"wires":[[]]},{"id":"a7319be8.a96638","type":"ui_button","z":"e44a28b6.338da8","g":"7d1b3f3e.fa86d","name":"","group":"87b2e499.dc7108","order":2,"width":0,"height":0,"passthru":false,"label":"off","tooltip":"","color":"","bgcolor":"","icon":"","payload":"off","payloadType":"str","topic":"zigbee2mqtt/Bulb_C7DE_Color_600lm/set","x":270,"y":3600,"wires":[["4f89b4b7.3c75cc"]]},{"id":"b3fddad3.fa2898","type":"ui_button","z":"e44a28b6.338da8","g":"7d1b3f3e.fa86d","name":"","group":"87b2e499.dc7108","order":2,"width":0,"height":0,"passthru":false,"label":"on","tooltip":"","color":"","bgcolor":"","icon":"","payload":"on","payloadType":"str","topic":"zigbee2mqtt/Bulb_C7DE_Color_600lm/set","x":270,"y":3560,"wires":[["4f89b4b7.3c75cc"]]},{"id":"4f89b4b7.3c75cc","type":"ui_switch","z":"e44a28b6.338da8","g":"7d1b3f3e.fa86d","name":"","label":"switch","tooltip":"","group":"87b2e499.dc7108","order":4,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":410,"y":3580,"wires":[["d24423d4.34e07","a99ff613.c827b8","77ce1917.fc4498"]]},{"id":"77ce1917.fc4498","type":"mqtt out","z":"e44a28b6.338da8","g":"7d1b3f3e.fa86d","name":"","topic":"zigbee2mqtt/Bulb_C7DE_Color_600lm/set","qos":"0","retain":"false","broker":"a5bf81ee.27852","x":1000,"y":3580,"wires":[]},{"id":"d24423d4.34e07","type":"change","z":"e44a28b6.338da8","g":"7d1b3f3e.fa86d","name":"payload -> command","rules":[{"t":"set","p":"command","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":640,"y":3640,"wires":[["ffac1bf3.869248"]]},{"id":"ffac1bf3.869248","type":"hubitat command","z":"e44a28b6.338da8","g":"7d1b3f3e.fa86d","name":"Mike Credenza Light","server":"55e4481a.722098","deviceId":"388","command":"on","commandArgs":"","x":940,"y":3640,"wires":[[]]},{"id":"df63f0eb.9a41c","type":"hb-control","z":"e44a28b6.338da8","name":"Home Occupied - Ashmont","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Switch","device":"HomebridgeCC:22:3D:E3:CE:30NestHome Occupied - Ashmont00000049","conf":"df59aa47.b26148","x":500,"y":3860,"wires":[]},{"id":"3685924c.13c9ee","type":"inject","z":"e44a28b6.338da8","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"on\":0}","payloadType":"json","x":290,"y":3860,"wires":[["df63f0eb.9a41c"]]},{"id":"db0f4a3c.744a38","type":"hb-control","z":"e44a28b6.338da8","g":"7d1b3f3e.fa86d","name":"Home Occupied - Ashmont","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Switch","device":"HomebridgeCC:22:3D:E3:CE:30NestHome Occupied - Ashmont00000049","conf":"df59aa47.b26148","x":1220,"y":3700,"wires":[]},{"id":"a99ff613.c827b8","type":"switch","z":"e44a28b6.338da8","g":"7d1b3f3e.fa86d","name":"payload = on -> 1, payload = off -> 2","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":690,"y":3700,"wires":[["2f9778a9.980358"],["2787e91f.733566"]]},{"id":"2f9778a9.980358","type":"change","z":"e44a28b6.338da8","g":"7d1b3f3e.fa86d","name":"set msg.payload.on = 1","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"on\":1}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":970,"y":3680,"wires":[["db0f4a3c.744a38"]]},{"id":"2787e91f.733566","type":"change","z":"e44a28b6.338da8","g":"7d1b3f3e.fa86d","name":"set msg.payload.on =0","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"on\":0}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":960,"y":3720,"wires":[["db0f4a3c.744a38"]]},{"id":"d368bbf9.2d2178","type":"switch","z":"e44a28b6.338da8","g":"cc225987.ffcee8","name":"payload.state = on -> 1, payload.state = off -> 2","property":"payload.state","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":740,"y":3440,"wires":[["7968fdae.101df4"],["bcd4d82d.ecc1e8"]]},{"id":"7968fdae.101df4","type":"change","z":"e44a28b6.338da8","g":"cc225987.ffcee8","name":"set msg.payload.on =1","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"on\":1}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1040,"y":3420,"wires":[["d5bb4820.386358"]]},{"id":"bcd4d82d.ecc1e8","type":"change","z":"e44a28b6.338da8","g":"cc225987.ffcee8","name":"set msg.payload.on = 0","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"on\":0}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1050,"y":3460,"wires":[["d5bb4820.386358"]]},{"id":"d5bb4820.386358","type":"hb-control","z":"e44a28b6.338da8","g":"cc225987.ffcee8","name":"Home Occupied - Ashmont","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Switch","device":"HomebridgeCC:22:3D:E3:CE:30NestHome Occupied - Ashmont00000049","conf":"df59aa47.b26148","x":1300,"y":3440,"wires":[]},{"id":"358b2ec.b1e73d2","type":"ui_switch","z":"e44a28b6.338da8","name":"","label":"Run Counter","tooltip":"","group":"87b2e499.dc7108","order":12,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"control","style":"","onvalue":"toggle","onvalueType":"str","onicon":"","oncolor":"","offvalue":"toggle","offvalueType":"str","officon":"","offcolor":"","x":810,"y":2640,"wires":[["62a2327d.0527cc"]]},{"id":"93fd2ca4.5d85a","type":"counter","z":"e44a28b6.338da8","name":"279000","init":"1","step":"27900","lower":"0","upper":"16777215","mode":"increment","outputs":"1","x":1080,"y":2740,"wires":[["6ee71bea.2a8234","5c04ce6a.9f6bd"]]},{"id":"3ee48aa4.085806","type":"inject","z":"e44a28b6.338da8","name":"","props":[{"p":"payload"}],"repeat":"1","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"1","payloadType":"num","x":690,"y":2780,"wires":[["62a2327d.0527cc"]]},{"id":"a78612a.50c49f","type":"debug","z":"e44a28b6.338da8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1410,"y":2720,"wires":[]},{"id":"62a2327d.0527cc","type":"gate","z":"e44a28b6.338da8","name":"","controlTopic":"control","defaultState":"closed","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","defaultCmd":"default","persist":false,"x":930,"y":2780,"wires":[["93fd2ca4.5d85a"]]},{"id":"6ee71bea.2a8234","type":"function","z":"e44a28b6.338da8","name":"","func":"msg.payload = msg.count.toString(16);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1220,"y":2700,"wires":[["a78612a.50c49f","1d1ff10.d5aec0f","3c2419ca.8772b6"]]},{"id":"1d1ff10.d5aec0f","type":"function","z":"e44a28b6.338da8","name":"","func":" var x = msg.payload;\n msg.payload = {\"color\": {\"hex\":\"#\"+x}}\n return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1300,"y":1840,"wires":[["dc54ae57.73fe1"]]},{"id":"3c2419ca.8772b6","type":"ui_text","z":"e44a28b6.338da8","group":"87b2e499.dc7108","order":13,"width":0,"height":0,"name":"","label":"hex","format":"{{msg.payload}}","layout":"row-spread","x":1410,"y":2680,"wires":[]},{"id":"9389d83e.fe3fe8","type":"inject","z":"e44a28b6.338da8","name":"","props":[{"p":"reset","v":"1","vt":"num"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":970,"y":2540,"wires":[["93fd2ca4.5d85a"]]},{"id":"5c04ce6a.9f6bd","type":"ui_text","z":"e44a28b6.338da8","group":"87b2e499.dc7108","order":13,"width":0,"height":0,"name":"","label":"decimal","format":"{{msg.count}}","layout":"row-spread","x":1260,"y":2800,"wires":[]},{"id":"3206288d.5e7308","type":"inject","z":"e44a28b6.338da8","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"224396","payloadType":"str","x":190,"y":1820,"wires":[["d4093dc4.b77d1"]]},{"id":"90f0cc14.30531","type":"ui_button","z":"481337e1.e82348","d":true,"g":"1cfc0072.40871","name":"","group":"87b2e499.dc7108","order":2,"width":"5","height":"1","passthru":false,"label":"Hubitat Example {\"state\":\"off\"}","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"state\":\"off\"}","payloadType":"json","topic":"zigbee2mqtt/Bulb_C7DE_Color_600lm/set","x":210,"y":140,"wires":[["8664d555.58afb8"]]},{"id":"bcfb8526.b53e18","type":"ui_button","z":"481337e1.e82348","d":true,"g":"1cfc0072.40871","name":"","group":"87b2e499.dc7108","order":2,"width":"5","height":"1","passthru":false,"label":"Hubitat Example {\"state\":\"on\"}","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"state\":\"on\"}","payloadType":"json","topic":"zigbee2mqtt/Bulb_C7DE_Color_600lm/set","x":210,"y":100,"wires":[["8664d555.58afb8"]]},{"id":"8664d555.58afb8","type":"ui_switch","z":"481337e1.e82348","d":true,"g":"1cfc0072.40871","name":"","label":"Hubitat Example switch","tooltip":"","group":"87b2e499.dc7108","order":4,"width":"5","height":"1","passthru":true,"decouple":"false","topic":"","style":"","onvalue":"{\"state\":\"on\"}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"state\":\"off\"}","offvalueType":"json","officon":"","offcolor":"","x":470,"y":120,"wires":[["e5a812bc.f89"]]},{"id":"e5a812bc.f89","type":"change","z":"481337e1.e82348","g":"1cfc0072.40871","name":"payload -> command","rules":[{"t":"set","p":"command","pt":"msg","to":"payload.state","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":700,"y":120,"wires":[["4dbd9fce.6a7e5"]]},{"id":"fedd4e4d.ae903","type":"hubitat command","z":"481337e1.e82348","g":"5cc37db4.5a2044","name":"A e12","server":"55e4481a.722098","deviceId":"547","command":"","commandArgs":"","x":170,"y":240,"wires":[[]]},{"id":"b1f1f25b.1fc4f","type":"hubitat command","z":"481337e1.e82348","g":"5cc37db4.5a2044","name":"Corner","server":"55e4481a.722098","deviceId":"100","command":"","commandArgs":"","x":170,"y":280,"wires":[[]]},{"id":"f1ca7a62.85d178","type":"hubitat command","z":"481337e1.e82348","g":"5cc37db4.5a2044","name":"Double Relay (Install to Check if On/Off vs Child On/Off works","server":"55e4481a.722098","deviceId":"841","command":"","commandArgs":"","x":340,"y":320,"wires":[[]]},{"id":"4cea4a5c.197bc4","type":"hubitat command","z":"481337e1.e82348","g":"b1681343.9904d","name":"","server":"55e4481a.722098","deviceId":"","command":"","commandArgs":"","x":1060,"y":120,"wires":[[]]},{"id":"eab19d68.9462d","type":"hubitat command","z":"481337e1.e82348","g":"5cc37db4.5a2044","name":"Double Relay 1","server":"55e4481a.722098","deviceId":"842","command":"","commandArgs":"","x":200,"y":360,"wires":[[]]},{"id":"746947a4.f11db8","type":"hubitat command","z":"481337e1.e82348","g":"5cc37db4.5a2044","name":"Double Relay 2","server":"55e4481a.722098","deviceId":"843","command":"","commandArgs":"","x":200,"y":400,"wires":[[]]},{"id":"9e4c834d.6c39f","type":"hubitat command","z":"481337e1.e82348","g":"5cc37db4.5a2044","name":"Downstairs Hall","server":"55e4481a.722098","deviceId":"390","command":"","commandArgs":"","x":200,"y":440,"wires":[[]]},{"id":"a1ce02e6.a318b","type":"hubitat command","z":"481337e1.e82348","g":"5cc37db4.5a2044","name":"Evas","server":"55e4481a.722098","deviceId":"865","command":"","commandArgs":"","x":170,"y":480,"wires":[[]]},{"id":"4ca6fee6.fc1a4","type":"hubitat command","z":"481337e1.e82348","g":"5cc37db4.5a2044","name":"Evas (Light Notification 1)","server":"55e4481a.722098","deviceId":"869","command":"","commandArgs":"","x":230,"y":520,"wires":[[]]},{"id":"41b2ef5a.7319","type":"hubitat command","z":"481337e1.e82348","g":"5cc37db4.5a2044","name":"Evas Fan","server":"55e4481a.722098","deviceId":"867","command":"","commandArgs":"","x":180,"y":560,"wires":[[]]},{"id":"1fa5a655.6e047a","type":"hubitat command","z":"481337e1.e82348","g":"5cc37db4.5a2044","name":"Evas Light","server":"55e4481a.722098","deviceId":"866","command":"","commandArgs":"","x":190,"y":600,"wires":[[]]},{"id":"bde033ac.6a6db","type":"hubitat command","z":"481337e1.e82348","g":"5cc37db4.5a2044","name":"Fire 7","server":"55e4481a.722098","deviceId":"705","command":"","commandArgs":"","x":170,"y":640,"wires":[[]]},{"id":"b783cc2b.d48de","type":"hubitat command","z":"481337e1.e82348","g":"5cc37db4.5a2044","name":"Game Room","server":"55e4481a.722098","deviceId":"551","command":"","commandArgs":"","x":190,"y":680,"wires":[[]]},{"id":"e684cbd9.e7ddb8","type":"hubitat command","z":"481337e1.e82348","g":"5cc37db4.5a2044","name":"Game Room Floor Lamp","server":"55e4481a.722098","deviceId":"357","command":"","commandArgs":"","x":690,"y":240,"wires":[[]]},{"id":"885f1db3.2806d","type":"hubitat command","z":"481337e1.e82348","g":"5cc37db4.5a2044","name":"Harmony Hub","server":"55e4481a.722098","deviceId":"259","command":"","commandArgs":"","x":660,"y":280,"wires":[[]]},{"id":"68cf880c.c002c8","type":"hubitat command","z":"481337e1.e82348","g":"5cc37db4.5a2044","name":"HDMI Cable","server":"55e4481a.722098","deviceId":"264","command":"","commandArgs":"","x":650,"y":320,"wires":[[]]},{"id":"e4307409.5cf348","type":"hubitat command","z":"481337e1.e82348","g":"5cc37db4.5a2044","name":"IKEA candle 1","server":"55e4481a.722098","deviceId":"103","command":"","commandArgs":"","x":660,"y":360,"wires":[[]]},{"id":"fc3adce1.8e926","type":"hubitat command","z":"481337e1.e82348","g":"5cc37db4.5a2044","name":"Ilumin 1","server":"55e4481a.722098","deviceId":"742","command":"","commandArgs":"","x":640,"y":400,"wires":[[]]},{"id":"7824f88c.bb1848","type":"hubitat command","z":"481337e1.e82348","g":"5cc37db4.5a2044","name":"In Box 1 (I Bulb)","server":"55e4481a.722098","deviceId":"97","command":"","commandArgs":"","x":660,"y":440,"wires":[[]]},{"id":"cc05cf89.21677","type":"hubitat command","z":"481337e1.e82348","g":"5cc37db4.5a2044","name":"Master Fan","server":"55e4481a.722098","deviceId":"65","command":"","commandArgs":"","x":650,"y":480,"wires":[[]]},{"id":"32b2350d.f3fe1a","type":"hubitat command","z":"481337e1.e82348","g":"5cc37db4.5a2044","name":"Master Light Overhead","server":"55e4481a.722098","deviceId":"33","command":"","commandArgs":"","x":680,"y":520,"wires":[[]]},{"id":"55159957.ef2368","type":"hubitat command","z":"481337e1.e82348","g":"5cc37db4.5a2044","name":"Mike Bedside","server":"55e4481a.722098","deviceId":"257","command":"","commandArgs":"","x":660,"y":560,"wires":[[]]},{"id":"f6748f23.aface","type":"hubitat command","z":"481337e1.e82348","g":"5cc37db4.5a2044","name":"Mike Credenza Light","server":"55e4481a.722098","deviceId":"388","command":"","commandArgs":"","x":680,"y":600,"wires":[[]]},{"id":"8b7a6450.aacce8","type":"hubitat command","z":"481337e1.e82348","g":"5cc37db4.5a2044","name":"MT Relay","server":"55e4481a.722098","deviceId":"101","command":"","commandArgs":"","x":640,"y":640,"wires":[[]]},{"id":"9ccf5fc3.e644c","type":"hubitat command","z":"481337e1.e82348","g":"5cc37db4.5a2044","name":"Office Desk Lamp","server":"55e4481a.722098","deviceId":"550","command":"","commandArgs":"","x":670,"y":680,"wires":[[]]},{"id":"c172e9ad.ce4098","type":"hubitat command","z":"481337e1.e82348","g":"5cc37db4.5a2044","name":"Play X-Box","server":"55e4481a.722098","deviceId":"260","command":"","commandArgs":"","x":930,"y":240,"wires":[[]]},{"id":"7fbbf644.8d2188","type":"hubitat command","z":"481337e1.e82348","g":"5cc37db4.5a2044","name":"Power Off TV","server":"55e4481a.722098","deviceId":"261","command":"","commandArgs":"","x":940,"y":280,"wires":[[]]},{"id":"49d4edee.f18604","type":"hubitat command","z":"481337e1.e82348","g":"5cc37db4.5a2044","name":"Table Lamp","server":"55e4481a.722098","deviceId":"225","command":"","commandArgs":"","x":930,"y":320,"wires":[[]]},{"id":"8b01bd7b.527a2","type":"hubitat command","z":"481337e1.e82348","g":"5cc37db4.5a2044","name":"Toy north (I bulb)","server":"55e4481a.722098","deviceId":"105","command":"","commandArgs":"","x":950,"y":360,"wires":[[]]},{"id":"280721d6.7c18ee","type":"hubitat command","z":"481337e1.e82348","g":"5cc37db4.5a2044","name":"Toy south (I Bulb)","server":"55e4481a.722098","deviceId":"99","command":"","commandArgs":"","x":950,"y":400,"wires":[[]]},{"id":"10910d68.1eef73","type":"hubitat command","z":"481337e1.e82348","g":"5cc37db4.5a2044","name":"Virtual Play Podcast In Bathroom","server":"55e4481a.722098","deviceId":"555","command":"","commandArgs":"","x":1000,"y":440,"wires":[[]]},{"id":"2d93e75.9b43d18","type":"hubitat command","z":"481337e1.e82348","g":"5cc37db4.5a2044","name":"Virtual Play Podcast In Office","server":"55e4481a.722098","deviceId":"554","command":"","commandArgs":"","x":980,"y":480,"wires":[[]]},{"id":"69d99ef7.b96fe","type":"hubitat command","z":"481337e1.e82348","g":"5cc37db4.5a2044","name":"Watch Apple TV","server":"55e4481a.722098","deviceId":"265","command":"","commandArgs":"","x":940,"y":520,"wires":[[]]},{"id":"1bec295c.0f92b7","type":"hubitat command","z":"481337e1.e82348","g":"5cc37db4.5a2044","name":"Watch Fire TV","server":"55e4481a.722098","deviceId":"266","command":"","commandArgs":"","x":940,"y":560,"wires":[[]]},{"id":"4dbd9fce.6a7e5","type":"change","z":"481337e1.e82348","g":"b1681343.9904d","name":"742 is Ilumin","rules":[{"t":"set","p":"deviceId","pt":"msg","to":"742","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":910,"y":120,"wires":[["4cea4a5c.197bc4"]]},{"id":"e4d53505.aa5f28","type":"hubitat command","z":"481337e1.e82348","g":"5cc37db4.5a2044","name":"Watch PC on TV","server":"55e4481a.722098","deviceId":"263","command":"","commandArgs":"","x":940,"y":600,"wires":[[]]},{"id":"6642f91c.3e8d98","type":"hubitat command","z":"481337e1.e82348","g":"5cc37db4.5a2044","name":"Watch Uverse","server":"55e4481a.722098","deviceId":"262","command":"","commandArgs":"","x":940,"y":640,"wires":[[]]},{"id":"4e3730d.e5190d","type":"hubitat command","z":"481337e1.e82348","g":"5cc37db4.5a2044","name":"WDG - Frisco Weather Data","server":"55e4481a.722098","deviceId":"744","command":"","commandArgs":"","x":980,"y":680,"wires":[[]]},{"id":"515cd74d.7f7d28","type":"hubitat command","z":"481337e1.e82348","g":"5fcf2c1c.449414","name":"A e12","server":"55e4481a.722098","deviceId":"547","command":"","commandArgs":"","x":130,"y":980,"wires":[[]]},{"id":"f78aa478.45d368","type":"hubitat command","z":"481337e1.e82348","g":"5fcf2c1c.449414","name":"Game Room","server":"55e4481a.722098","deviceId":"551","command":"","commandArgs":"","x":150,"y":1020,"wires":[[]]},{"id":"5bcd4d89.6513a4","type":"hubitat command","z":"481337e1.e82348","g":"5fcf2c1c.449414","name":"Ilumin 1","server":"55e4481a.722098","deviceId":"742","command":"","commandArgs":"","x":140,"y":1060,"wires":[[]]},{"id":"97507876.983ee8","type":"hubitat command","z":"481337e1.e82348","g":"5fcf2c1c.449414","name":"Toy north (I bulb)","server":"55e4481a.722098","deviceId":"105","command":"","commandArgs":"","x":170,"y":1100,"wires":[[]]},{"id":"d5904e32.44aaf","type":"hubitat command","z":"481337e1.e82348","g":"5fcf2c1c.449414","name":"Toy south (I Bulb)","server":"55e4481a.722098","deviceId":"99","command":"","commandArgs":"","x":170,"y":1140,"wires":[[]]},{"id":"8324096.dc7cbf8","type":"hubitat command","z":"481337e1.e82348","g":"b5b8aad0.940468","name":"A e12","server":"55e4481a.722098","deviceId":"547","command":"","commandArgs":"","x":1290,"y":100,"wires":[[]]},{"id":"6741ff76.5ffc","type":"hubitat command","z":"481337e1.e82348","g":"b5b8aad0.940468","name":"Evas","server":"55e4481a.722098","deviceId":"865","command":"","commandArgs":"","x":1290,"y":140,"wires":[[]]},{"id":"fc102f26.cb3e9","type":"hubitat command","z":"481337e1.e82348","g":"b5b8aad0.940468","name":"Evas Fan","server":"55e4481a.722098","deviceId":"867","command":"","commandArgs":"","x":1300,"y":180,"wires":[[]]},{"id":"21f15176.1fa80e","type":"hubitat command","z":"481337e1.e82348","g":"b5b8aad0.940468","name":"Evas Light","server":"55e4481a.722098","deviceId":"866","command":"","commandArgs":"","x":1310,"y":220,"wires":[[]]},{"id":"ef72e3a8.e236d","type":"hubitat command","z":"481337e1.e82348","g":"b5b8aad0.940468","name":"Fire 7","server":"55e4481a.722098","deviceId":"705","command":"","commandArgs":"","x":1290,"y":260,"wires":[[]]},{"id":"6454b524.365b2c","type":"hubitat command","z":"481337e1.e82348","g":"b5b8aad0.940468","name":"Game Room","server":"55e4481a.722098","deviceId":"551","command":"","commandArgs":"","x":1310,"y":300,"wires":[[]]},{"id":"e66ac6da.b340e8","type":"hubitat command","z":"481337e1.e82348","g":"b5b8aad0.940468","name":"Game Room Floor Lamp","server":"55e4481a.722098","deviceId":"357","command":"","commandArgs":"","x":1350,"y":340,"wires":[[]]},{"id":"64929fcd.f4c78","type":"hubitat command","z":"481337e1.e82348","g":"b5b8aad0.940468","name":"Harmony Hub","server":"55e4481a.722098","deviceId":"259","command":"","commandArgs":"","x":1320,"y":380,"wires":[[]]},{"id":"7edfaff8.d08f6","type":"hubitat command","z":"481337e1.e82348","g":"b5b8aad0.940468","name":"IKEA candle 1","server":"55e4481a.722098","deviceId":"103","command":"","commandArgs":"","x":1320,"y":420,"wires":[[]]},{"id":"a8021164.f656c","type":"hubitat command","z":"481337e1.e82348","g":"b5b8aad0.940468","name":"Ilumin 1","server":"55e4481a.722098","deviceId":"742","command":"","commandArgs":"","x":1300,"y":460,"wires":[[]]},{"id":"dae17a18.9e7e08","type":"hubitat command","z":"481337e1.e82348","g":"b5b8aad0.940468","name":"In Box 1 (I Bulb)","server":"55e4481a.722098","deviceId":"97","command":"","commandArgs":"","x":1320,"y":500,"wires":[[]]},{"id":"6426f02e.271d3","type":"hubitat command","z":"481337e1.e82348","g":"b5b8aad0.940468","name":"Master Fan","server":"55e4481a.722098","deviceId":"65","command":"","commandArgs":"","x":1310,"y":540,"wires":[[]]},{"id":"49171ad.54822e4","type":"hubitat command","z":"481337e1.e82348","g":"b5b8aad0.940468","name":"Office Desk Lamp","server":"55e4481a.722098","deviceId":"550","command":"","commandArgs":"","x":1330,"y":580,"wires":[[]]},{"id":"48baeb3e.f01624","type":"hubitat command","z":"481337e1.e82348","g":"b5b8aad0.940468","name":"Table Lamp","server":"55e4481a.722098","deviceId":"225","command":"","commandArgs":"","x":1310,"y":620,"wires":[[]]},{"id":"ab1865ce.bc9a48","type":"hubitat command","z":"481337e1.e82348","g":"b5b8aad0.940468","name":"Toy north (I bulb)","server":"55e4481a.722098","deviceId":"105","command":"","commandArgs":"","x":1330,"y":660,"wires":[[]]},{"id":"ac4740a0.1f37e","type":"hubitat command","z":"481337e1.e82348","g":"b5b8aad0.940468","name":"Toy south (I Bulb)","server":"55e4481a.722098","deviceId":"99","command":"","commandArgs":"","x":1330,"y":700,"wires":[[]]},{"id":"a617dd42.ebdf4","type":"hubitat command","z":"481337e1.e82348","g":"2194357f.89933a","name":"A e12","server":"55e4481a.722098","deviceId":"547","command":"","commandArgs":"","x":1590,"y":100,"wires":[[]]},{"id":"239b1054.7376","type":"hubitat command","z":"481337e1.e82348","g":"2194357f.89933a","name":"Evas","server":"55e4481a.722098","deviceId":"865","command":"","commandArgs":"","x":1590,"y":140,"wires":[[]]},{"id":"17c26925.860b87","type":"hubitat command","z":"481337e1.e82348","g":"2194357f.89933a","name":"Evas Light","server":"55e4481a.722098","deviceId":"866","command":"","commandArgs":"","x":1610,"y":180,"wires":[[]]},{"id":"fa57579c.221228","type":"hubitat command","z":"481337e1.e82348","g":"2194357f.89933a","name":"Game Room Floor Lamp","server":"55e4481a.722098","deviceId":"357","command":"","commandArgs":"","x":1650,"y":220,"wires":[[]]},{"id":"f26bcbe6.0fc778","type":"hubitat command","z":"481337e1.e82348","g":"2194357f.89933a","name":"IKEA candle 1","server":"55e4481a.722098","deviceId":"103","command":"","commandArgs":"","x":1620,"y":260,"wires":[[]]},{"id":"537f73d.857728c","type":"hubitat command","z":"481337e1.e82348","g":"2194357f.89933a","name":"Ilumin 1","server":"55e4481a.722098","deviceId":"742","command":"","commandArgs":"","x":1600,"y":300,"wires":[[]]},{"id":"99c0eadd.9f9a68","type":"hubitat command","z":"481337e1.e82348","g":"2194357f.89933a","name":"In Box 1 (I Bulb)","server":"55e4481a.722098","deviceId":"97","command":"","commandArgs":"","x":1620,"y":340,"wires":[[]]},{"id":"7dfc5bc2.981494","type":"hubitat command","z":"481337e1.e82348","g":"2194357f.89933a","name":"Office Desk Lamp","server":"55e4481a.722098","deviceId":"550","command":"","commandArgs":"","x":1630,"y":380,"wires":[[]]},{"id":"a49b8c46.6e61","type":"hubitat command","z":"481337e1.e82348","g":"2194357f.89933a","name":"Table Lamp","server":"55e4481a.722098","deviceId":"225","command":"","commandArgs":"","x":1610,"y":420,"wires":[[]]},{"id":"9e7ee581.78da68","type":"hubitat command","z":"481337e1.e82348","g":"2194357f.89933a","name":"Toy north (I bulb)","server":"55e4481a.722098","deviceId":"105","command":"","commandArgs":"","x":1630,"y":460,"wires":[[]]},{"id":"1c5e5e4e.59f752","type":"hubitat command","z":"481337e1.e82348","g":"2194357f.89933a","name":"Toy south (I Bulb)","server":"55e4481a.722098","deviceId":"99","command":"","commandArgs":"","x":1630,"y":500,"wires":[[]]},{"id":"51b641a7.dbc0b","type":"hubitat command","z":"481337e1.e82348","g":"e2b7b94f.02bf78","name":"Double Relay","server":"55e4481a.722098","deviceId":"841","command":"","commandArgs":"","x":1120,"y":980,"wires":[[]]},{"id":"46716217.ec44cc","type":"hubitat command","z":"481337e1.e82348","g":"e2b7b94f.02bf78","name":"Evas","server":"55e4481a.722098","deviceId":"865","command":"","commandArgs":"","x":1090,"y":1020,"wires":[[]]},{"id":"65d7f4e4.bbe14c","type":"hubitat command","z":"481337e1.e82348","g":"3602fd1c.580aa2","name":"Downstairs Thermostat","server":"55e4481a.722098","deviceId":"161","command":"","commandArgs":"","x":1450,"y":1040,"wires":[[]]},{"id":"84cb058.cc221f8","type":"hubitat command","z":"481337e1.e82348","g":"c27d7eb3.149fc","name":"Mike's Ipad","server":"55e4481a.722098","deviceId":"129","command":"","commandArgs":"","x":390,"y":1120,"wires":[[]]},{"id":"3952d0aa.59f2d","type":"hubitat command","z":"481337e1.e82348","g":"ec8e921b.d0ce5","name":"Mike's Ipad","server":"55e4481a.722098","deviceId":"129","command":"","commandArgs":"","x":610,"y":1120,"wires":[[]]},{"id":"3c7a681b.8ba658","type":"hubitat command","z":"481337e1.e82348","g":"3af227d6.68cec8","name":"Evas","server":"55e4481a.722098","deviceId":"865","command":"","commandArgs":"","x":810,"y":1120,"wires":[[]]},{"id":"cb808f9d.84ead","type":"hubitat command","z":"481337e1.e82348","g":"d40b3c67.f669","name":"Harmony Hub","server":"55e4481a.722098","deviceId":"259","command":"","commandArgs":"","x":1620,"y":600,"wires":[[]]},{"id":"c4aaba66.dba198","type":"hubitat command","z":"481337e1.e82348","g":"8bfaa544.8fa1d8","name":"Evas Fan","server":"55e4481a.722098","deviceId":"867","command":"","commandArgs":"","x":820,"y":980,"wires":[[]]},{"id":"b33a6178.6d6be","type":"hubitat command","z":"481337e1.e82348","g":"8bfaa544.8fa1d8","name":"Master Fan","server":"55e4481a.722098","deviceId":"65","command":"","commandArgs":"","x":830,"y":1020,"wires":[[]]},{"id":"de76a753.ee18a8","type":"hubitat command","z":"481337e1.e82348","g":"4171da49.8a2e44","name":"Ilumin 1","server":"55e4481a.722098","deviceId":"742","command":"","commandArgs":"","x":380,"y":980,"wires":[[]]},{"id":"43479e5c.d3962","type":"hubitat command","z":"481337e1.e82348","g":"4171da49.8a2e44","name":"Game Room","server":"55e4481a.722098","deviceId":"551","command":"","commandArgs":"","x":390,"y":1020,"wires":[[]]},{"id":"ead00cef.d826c","type":"hubitat command","z":"481337e1.e82348","g":"ac710f2a.d2737","name":"Vibration 1","server":"55e4481a.722098","deviceId":"835","command":"","commandArgs":"","x":1610,"y":700,"wires":[[]]},{"id":"d17d82f2.030be","type":"hubitat command","z":"481337e1.e82348","g":"ac710f2a.d2737","name":"Vibration 1","server":"55e4481a.722098","deviceId":"840","command":"","commandArgs":"","x":1770,"y":700,"wires":[[]]},{"id":"2a0007f9.e3a438","type":"hubitat command","z":"481337e1.e82348","g":"691926c9.59a1e8","name":"Fire 7","server":"55e4481a.722098","deviceId":"705","command":"","commandArgs":"","x":130,"y":880,"wires":[[]]},{"id":"47d22d28.c47b84","type":"hubitat command","z":"481337e1.e82348","g":"fbe7994a.3fd628","name":"A e12","server":"55e4481a.722098","deviceId":"547","command":"","commandArgs":"","x":1870,"y":100,"wires":[[]]},{"id":"63fc0dc0.2fd394","type":"hubitat command","z":"481337e1.e82348","g":"fbe7994a.3fd628","name":"Evas","server":"55e4481a.722098","deviceId":"865","command":"","commandArgs":"","x":1870,"y":140,"wires":[[]]},{"id":"381c5439.2cb0ec","type":"hubitat command","z":"481337e1.e82348","g":"fbe7994a.3fd628","name":"Evas Light","server":"55e4481a.722098","deviceId":"866","command":"","commandArgs":"","x":1890,"y":180,"wires":[[]]},{"id":"a69a21fb.4e10e","type":"hubitat command","z":"481337e1.e82348","g":"fbe7994a.3fd628","name":"Game Room Floor Lamp","server":"55e4481a.722098","deviceId":"357","command":"","commandArgs":"","x":1930,"y":220,"wires":[[]]},{"id":"41da27bf.765ff8","type":"hubitat command","z":"481337e1.e82348","g":"fbe7994a.3fd628","name":"IKEA candle 1","server":"55e4481a.722098","deviceId":"103","command":"","commandArgs":"","x":1900,"y":260,"wires":[[]]},{"id":"ac614496.960178","type":"hubitat command","z":"481337e1.e82348","g":"fbe7994a.3fd628","name":"Ilumin 1","server":"55e4481a.722098","deviceId":"742","command":"","commandArgs":"","x":1880,"y":300,"wires":[[]]},{"id":"bc9f26a2.8bc7c8","type":"hubitat command","z":"481337e1.e82348","g":"fbe7994a.3fd628","name":"In Box 1 (I Bulb)","server":"55e4481a.722098","deviceId":"97","command":"","commandArgs":"","x":1900,"y":340,"wires":[[]]},{"id":"c4f855a8.478738","type":"hubitat command","z":"481337e1.e82348","g":"fbe7994a.3fd628","name":"Office Desk Lamp","server":"55e4481a.722098","deviceId":"550","command":"","commandArgs":"","x":1910,"y":380,"wires":[[]]},{"id":"e5224b3a.a4e618","type":"hubitat command","z":"481337e1.e82348","g":"fbe7994a.3fd628","name":"Table Lamp","server":"55e4481a.722098","deviceId":"225","command":"","commandArgs":"","x":1890,"y":420,"wires":[[]]},{"id":"970f2d6e.13372","type":"hubitat command","z":"481337e1.e82348","g":"fbe7994a.3fd628","name":"Toy north (I bulb)","server":"55e4481a.722098","deviceId":"105","command":"","commandArgs":"","x":1910,"y":460,"wires":[[]]},{"id":"13cd04c4.acea3b","type":"hubitat command","z":"481337e1.e82348","g":"fbe7994a.3fd628","name":"Toy south (I Bulb)","server":"55e4481a.722098","deviceId":"99","command":"","commandArgs":"","x":1910,"y":500,"wires":[[]]},{"id":"bac2d7d7.6bd6c8","type":"node-comment","z":"481337e1.e82348","g":"3602fd1c.580aa2","comment":"Mode Controls: auto, cool, heat, emergencyHeat, off, setThermostatMode, switchMode","background":"#3FADB5","color":"black","x":1640,"y":840,"wires":[]},{"id":"bd2af955.ef6598","type":"node-comment","z":"481337e1.e82348","g":"3602fd1c.580aa2","comment":"Temp Setting Controls: coolLevelDown, coolLevelUp, heatLevelDown, heatLevelUp","background":"#3FADB5","color":"black","x":1630,"y":1000,"wires":[]},{"id":"eaae5ca7.e708e","type":"node-comment","z":"481337e1.e82348","g":"3602fd1c.580aa2","comment":"Poll Controls: poll, refresh","background":"#3FADB5","color":"black","x":1450,"y":880,"wires":[]},{"id":"e30dfb91.e146d8","type":"node-comment","z":"481337e1.e82348","g":"3602fd1c.580aa2","comment":"Fan Controls: fanAuto, fanCirculate, fanOn, setThermostatFanMode, switchFanMode","background":"#3FADB5","color":"black","x":1630,"y":800,"wires":[]},{"id":"6b635506.e948ac","type":"node-comment","z":"481337e1.e82348","g":"3602fd1c.580aa2","comment":"Program Controls: setCoolingSetpoint, setHeatingSetpoint, setThermostatProgram, switchProgram","background":"#3FADB5","color":"black","x":1680,"y":960,"wires":[]},{"id":"d47ef1ee.537aa","type":"node-comment","z":"481337e1.e82348","g":"3602fd1c.580aa2","comment":"Presence Controls: away, present","background":"#3FADB5","color":"black","x":1470,"y":920,"wires":[]},{"id":"12b3cb36.3eb905","type":"node-comment","z":"481337e1.e82348","g":"691926c9.59a1e8","comment":"Hubitat FKB Sound Items: beep, mute, playSound, setVolume, siren, speak, stopSound, strobe, unmute, volumeDown, volumeUp","background":"#3FADB5","color":"black","x":510,"y":800,"wires":[]},{"id":"d70644b.75340b8","type":"node-comment","z":"481337e1.e82348","g":"691926c9.59a1e8","comment":"Hubitat FKB Screen Items: bringFullyToFront, loadStartURL, loadURL, screenOff, screenOn, setScreenBrightness, startScreensaver, stopScreensaver, triggerMotion","background":"#3FADB5","color":"black","x":620,"y":840,"wires":[]},{"id":"303c7206.6ed8ee","type":"ui_switch","z":"e44a28b6.338da8","name":"","label":"Outlet Switch","tooltip":"","group":"87b2e499.dc7108","order":4,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"{\"state\":\"on\"}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"state\":\"off\"}","offvalueType":"json","officon":"","offcolor":"","x":490,"y":3020,"wires":[["fbf55de8.b10c9"]]},{"id":"fbf55de8.b10c9","type":"mqtt out","z":"e44a28b6.338da8","name":"","topic":"zigbee2mqtt/Fixed Outlet Maybe/set","qos":"0","retain":"false","broker":"a5bf81ee.27852","x":770,"y":3020,"wires":[]},{"id":"8211996b.2cfe68","type":"ui_button","z":"481337e1.e82348","d":true,"g":"6ecada9d.502b84","name":"","group":"87b2e499.dc7108","order":2,"width":"5","height":"1","passthru":false,"label":"Z2M Example {\"state\":\"off\"}","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"state\":\"off\"}","payloadType":"json","topic":"zigbee2mqtt/Bulb_C7DE_Color_600lm/set","x":180,"y":1300,"wires":[["fa854bd6.b3d638"]]},{"id":"93c3f7b8.06fa18","type":"ui_button","z":"481337e1.e82348","d":true,"g":"6ecada9d.502b84","name":"","group":"87b2e499.dc7108","order":2,"width":"5","height":"1","passthru":false,"label":"Z2M Example {\"state\":\"on\"}","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"state\":\"on\"}","payloadType":"json","topic":"zigbee2mqtt/Bulb_C7DE_Color_600lm/set","x":180,"y":1260,"wires":[["fa854bd6.b3d638"]]},{"id":"fa854bd6.b3d638","type":"ui_switch","z":"481337e1.e82348","d":true,"g":"6ecada9d.502b84","name":"","label":"Z2M Example switch","tooltip":"","group":"87b2e499.dc7108","order":4,"width":"5","height":"1","passthru":true,"decouple":"false","topic":"","style":"","onvalue":"{\"state\":\"on\"}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"state\":\"off\"}","offvalueType":"json","officon":"","offcolor":"","x":420,"y":1280,"wires":[["5460ac7a.f7e854"]]},{"id":"5460ac7a.f7e854","type":"mqtt out","z":"481337e1.e82348","g":"6ecada9d.502b84","name":"","topic":"zigbee2mqtt/Bulb_C7DE_Color_600lm/set","qos":"0","retain":"false","broker":"a5bf81ee.27852","x":700,"y":1280,"wires":[]},{"id":"4f8817a.d72a6e8","type":"mqtt out","z":"481337e1.e82348","g":"37ff4f4f.b6184","name":"","topic":"zigbee2mqtt/Bulb_C7DE_Color_600lm/set","qos":"0","retain":"false","broker":"a5bf81ee.27852","x":240,"y":1380,"wires":[]},{"id":"5b02fc04.de2ca4","type":"mqtt out","z":"481337e1.e82348","g":"37ff4f4f.b6184","name":"","topic":"zigbee2mqtt/Fixed Outlet Maybe/set","qos":"0","retain":"false","broker":"a5bf81ee.27852","x":230,"y":1440,"wires":[]},{"id":"bcf60527.834e88","type":"mqtt out","z":"481337e1.e82348","g":"6afd9338.2d5d3c","name":"","topic":"zigbee2mqtt/Bulb_C7DE_Color_600lm/set","qos":"0","retain":"false","broker":"a5bf81ee.27852","x":620,"y":1380,"wires":[]},{"id":"22d00ca4.c9e694","type":"mqtt out","z":"481337e1.e82348","g":"fda02c70.1211e","name":"","topic":"zigbee2mqtt/Bulb_C7DE_Color_600lm/set","qos":"0","retain":"false","broker":"a5bf81ee.27852","x":620,"y":1480,"wires":[]},{"id":"f4df6486.cdd2b8","type":"ui_button","z":"481337e1.e82348","d":true,"g":"e5284a2c.f8baa8","name":"","group":"87b2e499.dc7108","order":2,"width":"3","height":"1","passthru":false,"label":"{\"state\":\"off\"}","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"state\":\"off\"}","payloadType":"json","topic":"zigbee2mqtt/Bulb_C7DE_Color_600lm/set","x":150,"y":1680,"wires":[["5e64def3.ca5bd"]]},{"id":"d32fc9e5.21a7e8","type":"ui_button","z":"481337e1.e82348","d":true,"g":"e5284a2c.f8baa8","name":"","group":"87b2e499.dc7108","order":2,"width":"3","height":"1","passthru":false,"label":"{\"state\":\"on\"}","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"state\":\"on\"}","payloadType":"json","topic":"zigbee2mqtt/Bulb_C7DE_Color_600lm/set","x":150,"y":1640,"wires":[["5e64def3.ca5bd"]]},{"id":"5e64def3.ca5bd","type":"ui_switch","z":"481337e1.e82348","d":true,"g":"e5284a2c.f8baa8","name":"","label":"HomeBridge Switch","tooltip":"","group":"87b2e499.dc7108","order":4,"width":"3","height":"1","passthru":true,"decouple":"false","topic":"","style":"","onvalue":"{\"state\":\"on\"}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"state\":\"off\"}","offvalueType":"json","officon":"","offcolor":"","x":350,"y":1660,"wires":[["20ae92aa.eaa5ee"]]},{"id":"20ae92aa.eaa5ee","type":"switch","z":"481337e1.e82348","g":"e5284a2c.f8baa8","name":"payload.state = on -> 1, payload.state = off -> 2","property":"payload.state","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":640,"y":1660,"wires":[["616e6017.c4931"],["bf15a5fd.ebd9c8"]]},{"id":"616e6017.c4931","type":"change","z":"481337e1.e82348","g":"e5284a2c.f8baa8","name":"set msg.payload.on =1","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"on\":1}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":940,"y":1640,"wires":[["6e495760.f7b1d8"]]},{"id":"bf15a5fd.ebd9c8","type":"change","z":"481337e1.e82348","g":"e5284a2c.f8baa8","name":"set msg.payload.on = 0","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"on\":0}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":950,"y":1680,"wires":[["6e495760.f7b1d8"]]},{"id":"6e495760.f7b1d8","type":"hb-control","z":"481337e1.e82348","g":"e5284a2c.f8baa8","name":"Home Occupied - Ashmont","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Switch","device":"HomebridgeCC:22:3D:E3:CE:30NestHome Occupied - Ashmont00000049","conf":"df59aa47.b26148","x":1200,"y":1660,"wires":[]},{"id":"8ccdbe13.fae39","type":"hb-control","z":"481337e1.e82348","g":"d7efe446.21ed78","name":"Gratuity Thermostat","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Thermostat","device":"HomebridgeCC:22:3D:E3:CE:30NestGratuity Thermostat0000004A","conf":"df59aa47.b26148","x":410,"y":1940,"wires":[]},{"id":"34b5558e.a9e7ba","type":"hb-control","z":"481337e1.e82348","g":"e769370a.657bb8","name":"Gratuity Thermostat - Eco Mode","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Switch","device":"HomebridgeCC:22:3D:E3:CE:30NestGratuity Thermostat - Eco Mode00000049","conf":"df59aa47.b26148","x":430,"y":1740,"wires":[]},{"id":"67332e58.d9463","type":"hb-control","z":"481337e1.e82348","g":"e769370a.657bb8","name":"Home Occupied - Ashmont","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Switch","device":"HomebridgeCC:22:3D:E3:CE:30NestHome Occupied - Ashmont00000049","conf":"df59aa47.b26148","x":420,"y":1780,"wires":[]},{"id":"d1fef5f2.aa4c28","type":"hb-control","z":"481337e1.e82348","g":"e769370a.657bb8","name":"Gratuity Thermostat - Fan","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Fan","device":"HomebridgeCC:22:3D:E3:CE:30NestGratuity Thermostat - Fan00000040","conf":"df59aa47.b26148","x":410,"y":1820,"wires":[]},{"id":"fb9a586.eba64a8","type":"change","z":"481337e1.e82348","g":"d7efe446.21ed78","name":"Target Temp in Celcius","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"TargetTemperature\":22}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":180,"y":1940,"wires":[["8ccdbe13.fae39"]]},{"id":"ea7a3a4a.96a588","type":"hb-control","z":"481337e1.e82348","g":"5c5015c4.d11ccc","name":"Gratuity Thermostat","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Thermostat","device":"HomebridgeCC:22:3D:E3:CE:30NestGratuity Thermostat0000004A","conf":"df59aa47.b26148","x":410,"y":2040,"wires":[]},{"id":"aac5a23a.34e79","type":"change","z":"481337e1.e82348","g":"5c5015c4.d11ccc","name":"Target Temp in Celcius","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"CoolingThresholdTemperature\":22}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":180,"y":2040,"wires":[["ea7a3a4a.96a588"]]},{"id":"565c2b07.2a1f84","type":"hb-control","z":"481337e1.e82348","g":"809745d4.ddc178","name":"Gratuity Thermostat","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Thermostat","device":"HomebridgeCC:22:3D:E3:CE:30NestGratuity Thermostat0000004A","conf":"df59aa47.b26148","x":890,"y":1940,"wires":[]},{"id":"309239cd.81e696","type":"change","z":"481337e1.e82348","g":"809745d4.ddc178","name":"Target Temp in Celcius","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"HeatingThresholdTemperature\":22}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":660,"y":1940,"wires":[["565c2b07.2a1f84"]]},{"id":"52792ea7.98309","type":"hb-control","z":"481337e1.e82348","g":"56c25a14.8719e4","name":"Gratuity Thermostat","Homebridge":"Homebridge","Manufacturer":"Nest","Service":"Thermostat","device":"HomebridgeCC:22:3D:E3:CE:30NestGratuity Thermostat0000004A","conf":"df59aa47.b26148","x":790,"y":2040,"wires":[]},{"id":"70a516e8.cc1b08","type":"change","z":"481337e1.e82348","g":"56c25a14.8719e4","name":"Set Mode","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"TargetHeatingCoolingState\":1}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":2040,"wires":[["52792ea7.98309"]]},{"id":"8936cd64.8f414","type":"fully-tts","z":"1f1da42b.7b60bc","host":"192.168.86.118","password":"","x":550,"y":440,"wires":[]},{"id":"dfaa837b.6509c","type":"mqtt in","z":"98a6e865.a02ea8","name":"","topic":"Hubitat/Aqara button/Pushed","qos":"1","datatype":"json","broker":"a5bf81ee.27852","x":180,"y":840,"wires":[[]]},{"id":"eda85b3b.626828","type":"mqtt in","z":"98a6e865.a02ea8","name":"","topic":"Hubitat/Aqara button/Pushed","qos":"1","datatype":"json","broker":"a5bf81ee.27852","x":440,"y":920,"wires":[[]]},{"id":"1aefdc91.e6f523","type":"hubitat command","z":"98a6e865.a02ea8","name":"Mike Bedside","server":"55e4481a.722098","deviceId":"257","command":"","commandArgs":"","x":680,"y":1000,"wires":[[]]},{"id":"7758612a.17966","type":"mqtt out","z":"98a6e865.a02ea8","name":"M1","topic":"","qos":"","retain":"","broker":"a5bf81ee.27852","x":510,"y":1160,"wires":[]},{"id":"ef14009f.437e7","type":"mqtt in","z":"98a6e865.a02ea8","name":"M2","topic":"Zigbee2M/Switch Ikea/Action","qos":"0","datatype":"auto","broker":"a5bf81ee.27852","x":360,"y":1240,"wires":[["80d2b83b.742b28"]]},{"id":"80d2b83b.742b28","type":"debug","z":"98a6e865.a02ea8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":660,"y":1260,"wires":[]},{"id":"3653a639.f1634a","type":"mqtt in","z":"b1faba.70712548","name":"","topic":"zigbee2mqtt/Remote_5_Buttons","qos":"2","datatype":"json","broker":"a5bf81ee.27852","x":170,"y":160,"wires":[["da5f43db.0f438"]]},{"id":"da5f43db.0f438","type":"switch","z":"b1faba.70712548","name":"","property":"payload.action","propertyType":"msg","rules":[{"t":"eq","v":"toggle","vt":"str"},{"t":"eq","v":"brightness_down_click","vt":"str"},{"t":"eq","v":"brightness_up_click","vt":"str"},{"t":"eq","v":"arrow_left_click","vt":"str"},{"t":"eq","v":"arrow_right_click","vt":"str"}],"checkall":"true","repair":false,"outputs":5,"x":370,"y":160,"wires":[["564e4575.2f5efc"],[],[],[],[]]},{"id":"564e4575.2f5efc","type":"hubitat device","z":"b1faba.70712548","name":"Mike Credenza Light","server":"55e4481a.722098","deviceId":"388","attribute":"switch","sendEvent":false,"x":580,"y":140,"wires":[["802e309.1f448d"]]},{"id":"802e309.1f448d","type":"switch","z":"b1faba.70712548","name":"Off/On","property":"payload.value","propertyType":"msg","rules":[{"t":"eq","v":"off","vt":"str"},{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":800,"y":140,"wires":[["5014f61d.60e988"],["b24d79d5.043438"]]},{"id":"5014f61d.60e988","type":"change","z":"b1faba.70712548","name":"On","rules":[{"t":"set","p":"command","pt":"msg","to":"on","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":920,"y":120,"wires":[["dbd85c73.276d1"]]},{"id":"b24d79d5.043438","type":"change","z":"b1faba.70712548","name":"Off","rules":[{"t":"set","p":"command","pt":"msg","to":"off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":920,"y":160,"wires":[["4807ae43.dd768"]]},{"id":"dbd85c73.276d1","type":"hubitat command","z":"b1faba.70712548","name":"Mike Credenza Light","server":"55e4481a.722098","deviceId":"388","command":"off","commandArgs":"","x":1130,"y":120,"wires":[[]]},{"id":"4807ae43.dd768","type":"hubitat command","z":"b1faba.70712548","name":"Mike Credenza Light","server":"55e4481a.722098","deviceId":"388","command":"on","commandArgs":"","x":1130,"y":160,"wires":[[]]},{"id":"ff95a0d8.94a08","type":"mqtt in","z":"b1faba.70712548","name":"","topic":"Hubitat/Mike's Credenza Light/switch","qos":"2","datatype":"auto","broker":"a5bf81ee.27852","x":160,"y":360,"wires":[["7a9c615b.7ae49","580ee6ca.88af78"]]},{"id":"7a9c615b.7ae49","type":"function","z":"b1faba.70712548","name":"","func":"mqttTopics = msg.topic.split('/')\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":340,"wires":[[]]},{"id":"580ee6ca.88af78","type":"debug","z":"b1faba.70712548","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":460,"y":280,"wires":[]}]